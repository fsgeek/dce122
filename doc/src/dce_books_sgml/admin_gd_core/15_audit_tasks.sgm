<!--
# @OSF_COPYRIGHT@
# 
# 
# HISTORY
# $Log: 15_audit_tasks.sgm,v $
# Revision 1.1.2.10  1996/12/04  22:48:45  carrig
# 	{enh,R1.2.2}
# 	JC's edits
# 	[1996/12/04  22:46:25  carrig]
#
# Revision 1.1.2.9  1996/11/29  20:20:15  carrig
# 	{enh,R1.2.2}
# 	Finished edit changes; must scale graphics
# 	[1996/11/29  20:16:43  carrig]
# 
# Revision 1.1.2.8  1996/11/27  21:43:11  carrig
# 	{enh,R1.2.2}
# 	More editor's comments
# 	[1996/11/27  21:41:08  carrig]
# 
# 	{enh,R1.2.2}
# 	More editor's comments
# 	[1996/11/27  21:27:54  carrig]
# 
# Revision 1.1.2.7  1996/11/26  21:44:46  carrig
# 	{enh,R1.2.2}
# 	Putting in editor's comments
# 	[1996/11/26  21:40:20  carrig]
# 
# Revision 1.1.2.6  1996/11/25  21:50:55  carrig
# 	{enh,R1.2.2}
# 	Started to put in editor's comments
# 	[1996/11/25  21:48:47  carrig]
# 
# Revision 1.1.2.5  1996/11/07  20:43:03  weir
# 	Cleaned up history
# 	[1996/11/07  20:41:05  weir]
# 
# Revision 1.1.2.4  1996/11/06  20:40:13  carrig
# 	{enh,R1.2.2}
# 	OK for editing
# 	[1996/11/06  20:37:35  carrig]
# 
# Revision 1.1.2.3  1996/11/05  18:58:26  carrig
# 	{enh,R1.2.2}
# 	Second pass
# 	[1996/11/05  18:55:03  carrig]
# 
# Revision 1.1.2.2  1996/11/04  22:03:20  carrig
# 	{enh,R1.2.2}
# 	First pass at corrections
# 	[1996/11/04  21:59:45  carrig]
# 
# Revision 1.1.2.1  1996/11/01  18:19:47  wardr
# 	{edit,R1.2.2}
# 	Initial checkin after sgml conversion
# 	[1996/11/01  18:17:33  wardr]
# 
# Revision 1.1.1.2  1996/11/01  18:17:33  wardr
# 	{edit,R1.2.2}
# 	Initial checkin after sgml conversion
# 
# $EndLog$
-->
<!---->
<!-- Fragment document type declaration subset:
ArborText, Inc., 1988-1993, v.4001
<!DOCTYPE Book PUBLIC "-//Davenport//DTD DocBook V2.4//EN" [
]>
-->
<!-- COPYRIGHT NOTICE-->
<!-- Copyright (c) 1990, 1991, 1992, 1993, 1994 Open Software Foundation, Inc.-->
<!-- ALL RIGHTS RESERVED (DCE).  See the file named COPYRIGHT.DCE for-->
<!-- the full copyright text.-->
<!-- -->
<!-- HISTORY-->
<!-- Revision 1.1.5.3  1996/10/21  18:08:22  wardr-->
<!-- 	{edit,R1.2.2}-->
<!-- 	Update for sgml conversion-->
<!-- 	[1996/10/21  18:07:56  wardr]-->
<!---->
<!-- Revision 1.1.5.2  1996/09/19  17:42:12  sherman-->
<!-- 	{def,13575,R1.2.2}-->
<!-- 	Fixed various dcecp problems-->
<!-- 	[1996/09/19  17:41:43  sherman]-->
<!-- -->
<!-- Revision 1.1.5.1  1996/08/15  19:26:26  weir-->
<!-- 	CR 13480: updated audit record examples-->
<!-- 	[1996/08/15  19:20:19  weir]-->
<!-- -->
<!-- Revision 1.1.2.11  1995/05/25  19:07:11  rcb-->
<!-- 	PRENTICE HALL reformat: final changes-->
<!-- 	[1995/05/25  13:24:21  rcb]-->
<!-- -->
<!-- 	more font-fixing-->
<!-- 	[1995/03/30  20:00:17  rcb]-->
<!-- -->
<!-- 	minor font correction-->
<!-- 	[1995/03/30  19:54:30  rcb]-->
<!-- -->
<!-- 	PRENTICE HALL reformat - index entries, odds and ends-->
<!-- 	[1995/03/27  19:51:50  rcb]-->
<!-- -->
<!-- 	PRENTICE HALL reformat-->
<!-- 	[1995/03/20  14:47:15  rcb]-->
<!-- -->
<!-- 	incorporated 1.1 edits-->
<!-- 	[1995/03/20  14:00:55  rcb]-->
<!-- -->
<!-- Revision 1.1.2.10  1994/10/21  17:31:18  wardr-->
<!-- 	{edit R1.1}-->
<!-- 	Final GA release edits-->
<!-- 	[1994/10/21  17:31:04  wardr]-->
<!-- -->
<!-- Revision 1.1.2.9  1994/10/20  16:18:31  cruz-->
<!-- 	more final edits.-->
<!-- 	[1994/10/20  16:18:13  cruz]-->
<!-- -->
<!-- Revision 1.1.2.8  1994/10/20  03:47:02  cruz-->
<!-- 	final edits-->
<!-- 	[1994/10/20  03:46:46  cruz]-->
<!-- -->
<!-- Revision 1.1.2.7  1994/10/18  23:29:13  cruz-->
<!-- 	Added text for CRs 11444 and 12290.-->
<!-- 	[1994/10/18  23:28:42  cruz]-->
<!-- -->
<!-- Revision 1.1.2.6  1994/10/18  19:25:27  blazin-->
<!-- 	Corrected multiple uses of dcecp, added new default filter info., and added-->
<!-- 	info. about DCEAUDITTRAILSIZE.-->
<!-- 	[1994/10/18  19:21:33  blazin]-->
<!-- -->
<!-- Revision 1.1.2.5  1994/10/17  23:52:22  cruz-->
<!-- 	Corrected pathname of central trail file. (CR 12558)-->
<!-- 	[1994/10/17  23:51:52  cruz]-->
<!-- -->
<!-- Revision 1.1.2.4  1994/09/14  13:27:13  cruz-->
<!-- 	Recovered from technical comments.-->
<!-- 	[1994/09/14  13:26:59  cruz]-->
<!-- -->
<!-- Revision 1.1.2.3  1994/06/27  17:32:23  steto-->
<!-- 	{CR 10014, R1.1}-->
<!-- 	Changed the auditcp information into dcecp information.-->
<!-- 	[1994/06/27  17:32:02  steto]-->
<!-- -->
<!-- Revision 1.1.2.2  1994/06/13  18:07:31  devobj-->
<!-- 	cr10872 - fix copyright-->
<!-- 	[1994/06/13  18:07:01  devobj]-->
<!-- -->
<!-- Revision 1.1.2.1  1994/05/27  18:55:04  cruz-->
<!-- 	enh,10234,R1.1-->
<!-- 	Moved this chapter to a new file, from 14_audit.gpsml-to correct-->
<!-- 	formatting error.-->
<!-- 	[1994/05/27  18:50:27  cruz]-->
<!-- -->
<!---->
<!-- -->
<Chapter Id="AGCC.SECAT.div.1">
<Title>DCE Audit Service Administrative Tasks</Title>
<Para><IndexTerm Id="AGCC.SECAT.indx.1">
<Primary>audit</Primary>
<Secondary>service</Secondary>
<Tertiary>administration tasks</Tertiary>
</IndexTerm>This chapter describes the 
following administrative tasks that are performed for
the DCE Audit Service:
</Para>
<ItemizedList>
<ListItem>
<Para>Setting the DCE audit environment variables.
</Para>
</ListItem>
<ListItem>
<Para>Starting (and stopping) the DCE audit daemon.
</Para>
</ListItem>
<ListItem>
<Para>Controlling access to the DCE audit daemon.
</Para>
</ListItem>
<ListItem>
<Para>Creating and maintaining
event classes to logically group  a set of audit events. 
Event classes are created by editing event class files.
</Para>
</ListItem>
<ListItem>
<Para>Creating and maintaining 
filters that set the criteria for recording audit events in an
audit trail file.
</Para>
</ListItem>
<ListItem>
<Para>Enabling and disabling the audit logging service of the   
DCE audit daemon.
</Para>
</ListItem>
<ListItem>
<Para>Modifying and querying the attributes of the DCE audit daemon.
</Para>
</ListItem>
<ListItem>
<Para>Controlling and displaying the audit trail file. 
</Para>
</ListItem>
<ListItem>
<Para>Using the DCE serviceability routing file.
</Para>
</ListItem>
</ItemizedList>
<Para>All of the examples that the chapter gives for audit tasks use the DCE
control program (<Command>dcecp</Command>).
</Para>
<Sect1 Id="AGCC.SECAT.div.2">
<Title>Setting DCE Audit Environment Variables</Title>
<Para>There are three environment variables that are related to the operation of 
the DCE Audit Service.
The DCE audit environment variables should be set before running the
application server (that is, the DCE audit client).
The environment variables are as follows:
</Para>
<ItemizedList>
<ListItem>
<Para><Literal>DCEAUDITOFF</Literal>&mdash;If this variable is declared at the time the 
application is started, auditing is turned off.
By default, this variable is not declared.
</Para>
</ListItem>
<ListItem>
<Para><Literal>DCEAUDITFILTERON</Literal>&mdash;If this variable is declared at the 
time the application is started, filtering
is enabled.  By default, this variable is not declared; that is, there is
no filtering and all audit events are recorded.
</Para>
</ListItem>
<ListItem>
<Para><Literal>DCEAUDITTRAILSIZE</Literal>&mdash;Sets the maximum size of the audit trail.
</Para>
</ListItem>
</ItemizedList>
</Sect1>
<Sect1 Id="AGCC.SECAT.div.3">
<Title>Starting the Audit Daemon</Title>
<Para><IndexTerm Id="AGCC.SECAT.indx.2">
<Primary>audit</Primary>
<Secondary>daemon</Secondary>
</IndexTerm>
<IndexTerm Id="AGCC.SECAT.indx.3">
<Primary>audit</Primary>
<Secondary>daemon</Secondary>
<Tertiary>starting</Tertiary>
</IndexTerm>The DCE Audit Service is not a distributed application.
The audit daemon (<Command>auditd</Command>) does not need to run on all DCE hosts even
if a client application is making use of the audit service.  The audit daemon
only needs to run on a host if the audit logs are to go to the central
trail file or if filters are to be installed on the host.  This is because
the audit daemon controls access to the central trail file and also manages
the audit filters.
However, since the DTS daemon and the security server daemon are audit
clients, you may want to consider running the 
audit daemon on all hosts in the cell.
</Para>
<Para>You must be <Literal>root</Literal> to be able to start the audit daemon.
</Para>
<Para>Use the following command to start the audit daemon:  
</Para>
<InformalExample>
<Para><ProgramListing><UserInput>auditd
</UserInput></ProgramListing></Para>
</InformalExample>
<Para>This command uses flags that influence the behavior of the
daemon.  For more details on these flags, see the 
<Command>auditd(8sec)</Command> reference page.
</Para>
</Sect1>
<Sect1 Id="AGCC.SECAT.div.4">
<Title>Controlling Access to the Audit Daemon</Title>
<Para><IndexTerm Id="AGCC.SECAT.indx.4">
<Primary>audit</Primary>
<Secondary>daemon</Secondary>
<Tertiary>controlling access to</Tertiary>
</IndexTerm>You must control
access to the audit daemon to prevent
unauthorized application servers (the audit clients) from 
using it.  If an unauthorized server
is able to log its audit records, the audit storage space would be
exhausted.
</Para>
<Para>You control access to the audit daemon by editing the ACL of the audit 
daemon object, <Filename>/.:/hosts/</Filename><Symbol Role="Variable">hostname</Symbol><Filename>/audit-server</Filename>, 
using <Command>dcecp</Command>.
</Para>
<Sect2 Id="AGCC.SECAT.div.5">
<Title>DCE Permissions Supported by the DCE Audit Service</Title>
<Para><IndexTerm Id="AGCC.SECAT.indx.5">
<Primary>audit</Primary>
<Secondary>service</Secondary>
<Tertiary>ACL permissions</Tertiary>
</IndexTerm>The DCE Audit Service supports the following DCE permissions that can be
used to define the ACL of the audit daemon:
</Para>
<VariableList>
<VarListEntry>
<Term><Literal>r</Literal></Term>
<ListItem>
<Para>Read permission.  Allows a principal to read the filters.
</Para>
</ListItem>
</VarListEntry>
<VarListEntry>
<Term><Literal>w</Literal></Term>
<ListItem>
<Para>Write permission.  Allows a principal to modify the filters.
</Para>
</ListItem>
</VarListEntry>
<VarListEntry>
<Term><Literal>c</Literal></Term>
<ListItem>
<Para>Control permission.  Allows a principal to control the audit daemon.  
This includes the ability to enable or
disable the logging service, and to modify the ACL of the audit 
daemon.
</Para>
</ListItem>
</VarListEntry>
<VarListEntry>
<Term><Literal>l</Literal></Term>
<ListItem>
<Para>Log permission.  Allows a principal to write audit
records in the audit trail file.
</Para>
</ListItem>
</VarListEntry>
</VariableList>
</Sect2>
<Sect2 Id="AGCC.SECAT.div.6">
<Title>Initial ACL of the Audit Daemon</Title>
<Para><IndexTerm Id="AGCC.SECAT.indx.6">
<Primary>audit</Primary>
<Secondary>daemon</Secondary>
<Tertiary>initial ACL</Tertiary>
</IndexTerm>The initial ACL of a host's audit daemon 
contains the following entries:	
</Para>
<InformalExample>
<Para><ProgramListing>{unauthenticated -r--}
{user hosts/nodoz/self crwl}
{group subsys/dce/audit-admin crwl}
{any_other -r--}
</ProgramListing></Para>
</InformalExample>
<Para><?sml-need 8>The first entry allows any unauthenticated user only <Literal>read</Literal> access to the
filters.
The second entry allows the host principal 
(<Filename>hosts/</Filename><Symbol Role="Variable">&lt;hostname></Symbol><Filename>/self</Filename>)
to query and modify the filters, 
control the audit daemon, and to write to
the audit trail file. 
The third entry allows the members of the group <Filename>subsys/dce/audit-admin</Filename>
the same access rights as the host principal.
The last entry allows all other principals only <Literal>read</Literal> access
to the filters.
You can modify this ACL to suit your security requirements by using 
<Command>dcecp</Command>.
</Para>
</Sect2>
<Sect2 Id="AGCC.SECAT.div.7">
<Title>Giving Permissions to Audit Clients and Administrators</Title>
<Para><IndexTerm Id="AGCC.SECAT.indx.7">
<Primary>audit</Primary>
<Secondary>daemon</Secondary>
<Tertiary>giving permissions to</Tertiary>
</IndexTerm>Using <Command>dcecp</Command>, you can add entries to
the ACL of the audit daemon that will grant audit clients the <Command>log</Command>
permission to the audit trail file.  
You can create a DCE security group 
that consists of the servers on the host that are authorized to generate
audit records.  For example:
</Para>
<InformalExample>
<Para><ProgramListing><UserInput>group/hosts/<Symbol Role="Variable">&lt;hostname></Symbol><Literal>/audit-clients
</Literal></UserInput></ProgramListing></Para>
</InformalExample>
<Para RevisionFlag="Changed">Give this group the <Command>log</Command> permission to the audit daemon.  
For example:
<?og-ChangeStart def, 13575,R1.2.2,fixed the missing dcecp prompt"></Para>
<InformalExample>
<Para><ProgramListing RevisionFlag="Changed">dcecp> <Literal>acl modify /.:/hosts/machine1/audit-server \</Literal> 
> <Literal>-add {group hosts/machine1/audit-clients l}</Literal>
dcecp> 
</ProgramListing></Para>
</InformalExample>
<?og-ChangeEnd def, 13575,R1.2.2,fixed the missing dcecp prompt">
<Para>All audit clients can then be made members of this
group and inherit its permissions to the audit daemon.
</Para>
<Para RevisionFlag="Changed">ACL entries must also be added to grant designated administrators the read,
query, and control permissions to the audit daemon.
For example, for the administrator's group 
<Literal>group/hosts/machine1/audit-admin</Literal>:
<?og-ChangeStart def, 13575,R1.2.2,fixed the missing dcecp prompt"></Para>
<InformalExample>
<Para><ProgramListing RevisionFlag="Changed">dcecp> <Literal>acl modify /.:/hosts/machine1/audit-server \</Literal> 
> <Literal>-add {group hosts/machine1/audit-admin rwc}</Literal>
dcecp> 
</ProgramListing></Para>
</InformalExample>
<?og-ChangeEnd def, 13575,R1.2.2,fixed the missing dcecp prompt">
</Sect2>
</Sect1>
<Sect1 Id="AGCC.SECAT.div.8">
<Title>Defining Event Classes</Title>
<Para><IndexTerm Id="AGCC.SECAT.indx.8">
<Primary>event class</Primary>
<Secondary>defining </Secondary>
</IndexTerm>Individual audit events can be grouped together 
to form event classes.  The event class provides an efficient mechanism
by which sets of events can be logically grouped and selected
using a single value.  
</Para>
<Para>DCE audit event classes are
configurable.  You can add or remove events of
an existing event class or define new event classes.  
</Para>
<Para>The ability to define local event classes is
useful in simplifying the management of audit services in multiple DCE
applications.  Administrators can design their own audit event classes
reflecting their security requirements and trail storage resource constraints.
</Para>
<Para>Temporary event classes can also be created 
to track down security violations. 
</Para>
<Sect2 Id="AGCC.SECAT.div.9">
<Title>Steps in Defining an Event Class</Title>
<Para><IndexTerm Id="AGCC.SECAT.indx.9">
<Primary>audit</Primary>
<Secondary>event class</Secondary>
<Tertiary>how to define</Tertiary>
</IndexTerm>To define an event class, follow these steps:
</Para>
<OrderedList>
<ListItem>
<Para>Obtain an event class number for the event class from your cell
administrator.
A range of event class numbers should have been allocated to your
organization by OSF.  If not, contact OSF.
</Para>
</ListItem>
<ListItem>
<Para>Create an event class file in the
<Symbol Role="Variable">dcelocal</Symbol><Filename>/etc/audit/ec</Filename> directory.  
Edit the file as follows:
</Para>
<OrderedList>
<ListItem>
<Para>Declare the <Symbol Role="Variable">event class number</Symbol> (ECN) by adding a line 
with the following format:
</Para>
<InformalExample>
<Para><ProgramListing>ECN=<Replaceable>_event_class_number</Replaceable>
</ProgramListing></Para>
</InformalExample>
</ListItem>
<ListItem>
<Para>Optionally, you can add a <Symbol Role="Variable">server event prefix</Symbol>
(SEP) line in the file.  The SEP line
contains the event number prefixes of each server.  The event number 
prefix is the lowest event number in each server.
<IndexTerm Id="AGCC.SECAT.indx.10">
<Primary>audit</Primary>
<Secondary>event class file</Secondary>
<Tertiary>SEP line</Tertiary>
</IndexTerm>The SEP line has the following format:
</Para>
<InformalExample>
<Para><ProgramListing>SEP=<Replaceable>_event_number1 event_number2 event_number3 ...</Replaceable>
</ProgramListing></Para>
</InformalExample>
<Para><?sml-need 3>You can put the SEP line anywhere in the file.
The SEP line speeds up the scanning of 
audit clients by skipping irrelevant event class files.
</Para>
</ListItem>
<ListItem>
<Para>From the application, obtain the event numbers for the 
code points that you want to include in the event class.
</Para>
</ListItem>
<ListItem>
<Para>Add the event numbers corresponding to the events that you want to 
include in the event class, one number per line.
</Para>
</ListItem>
</OrderedList>
</ListItem>
</OrderedList>
<Para>In the event class file, empty lines are ignored and
comments are designated by a # (number sign) preceding the comment text.
</Para>
</Sect2>
<Sect2 Id="AGCC.SECAT.div.10">
<Title>Example Event Class File</Title>
<Para>Following is a sample event class file named
<Literal>ec_local_cell_critical_events</Literal>:  
</Para>
<InformalExample>
<Para><ProgramListing role="page-wide"><?sml-point-size 10>
<!--no-op:  12-->
ECN = 0xC0000005

# Server Event Number Prefixes
# 0x000001 Security Service Events
# 0x000002 Time Service Events 
# 0x000003 Audit Service Events

SEP = 0x00000100 0x00000200 0x00000300

# Security Service Critical Events
# evt_osf_dce_rs_properties_set_info (sets registry properties)
0x0000011f
# evt_osf_dce_rs_policy_set_info (sets registry policy)
0x00000121
# evt_osf_dce_rs_rep_admin_stop (stops the registry service)
0x00000127
# evet_osf_dce_rs_rep_admin_mkey (changes master key)
0x00000129

# Time Service Critical Events
# evt_osf_dce_dts_create (creates a server or a clerk)
0x00000201
# evt_osf_dce_dts_delete (deletes a server or a clerk)
0x00000202
# evt_osf_dce_dts_enable (enables the time service)
0x00000203
# evt_osf_dce_dts_disable (disables the time service)
0x00000204

# Audit Service Critical Events
# evt_osf_dce_aud_enable (enables audit-record logging service)
0x00000301
# evt_osf_dce_aud_disable (disables audit-record logging service)
0x00000302
# evt_osf_dce_aud_stop (terminates the execution of the audit daemon)
0x00000303
<?sml-point-size 12>
<!--no-op:  14-->
</ProgramListing></Para>
</InformalExample>
</Sect2>
</Sect1>
<Sect1 Id="AGCC.SECAT.div.11">
<Title>Creating and Maintaining Filters</Title>
<Para><IndexTerm Id="AGCC.SECAT.indx.11">
<Primary>audit</Primary>
<Secondary>filter</Secondary>
<Tertiary>creating and maintaining</Tertiary>
</IndexTerm>
<IndexTerm Id="AGCC.SECAT.indx.12">
<Primary>filter</Primary>
<Secondary>creating and maintaining</Secondary>
</IndexTerm>After starting the audit daemon and creating the event class file, 
you can run <Command>dcecp</Command> to create, modify, or display the filters 
maintained by the audit daemon.  
Use the <Command>audfilter create</Command>, <Command>audfilter modify</Command>, and
<Command>audfilter delete</Command> commands to create, modify, and delete the filters.  Use
the <Command>audfilter catalog</Command> and <Command>audfilter show</Command> commands to display the
existing filters.  
</Para>
<Sect2 Id="AGCC.SECAT.div.12">
<Title>Creating Filters</Title>
<Para RevisionFlag="Changed"><IndexTerm Id="AGCC.SECAT.indx.13">
<Primary>DCE control program</Primary>
<Secondary>creating audit filters</Secondary>
</IndexTerm>The following is an example <Command>audfilter create</Command> command for creating
a filter:
<?og-ChangeStart def, 13575,R1.2.2,fixed the missing dcecp prompt"></Para>
<InformalExample>
<Para><ProgramListing RevisionFlag="Changed">dcecp> <Literal>audfilter create  {group trust} \</Literal>
> <Literal>-attribute {ec_local_bank_audit denial log}</Literal>
dcecp>
</ProgramListing></Para>
</InformalExample>
<?og-ChangeEnd def, 13575,R1.2.2,fixed the missing dcecp prompt">
<Para>The example command specifies that a filter type <Command>group</Command> be created for
the DCE group named <Literal>trust</Literal> in the local cell.
</Para>
<Para RevisionFlag="Changed"><?og-ChangeStart def, 13575,R1.2.2,changed attributes to attribute">The <Option>attribute</Option> option is required.  The argument to the option is a
<Symbol Role="Variable">filter guide</Symbol> or list of guides.  Each filter guide is made up of three
elements: an <Symbol Role="Variable">event class name</Symbol> or list of names, an
<Symbol Role="Variable">audit condition</Symbol> or list of conditions, and an <Symbol Role="Variable">audit action</Symbol> or
list of actions.
<?og-ChangeEnd def, 13575,R1.2.2,changed attributes to attribute"></Para>
<Para>The event class name corresponds to the name of the event class file for
which your are creating a filter.
</Para>
<Para>The audit condition is the condition required for the event to be audited.
Valid conditions are <Literal>success</Literal>, <Literal>denial</Literal>, <Literal>failure</Literal>, 
<Literal>pending</Literal>, and <Literal>all</Literal>.
</Para>
<Para>The audit action is the action to take if the event being generated matches
the audit condition specified.  Valid actions are <Command>log</Command>, <Literal>alarm</Literal>, 
and <Literal>all</Literal>.
</Para>
</Sect2>
<Sect2 Id="AGCC.SECAT.div.13">
<Title>Modifying Filters</Title>
<Para><IndexTerm Id="AGCC.SECAT.indx.14">
<Primary>DCE control program</Primary>
<Secondary>modifying filters</Secondary>
</IndexTerm>You can modify an existing audit filter by adding or deleting one or more of
the filter's guides.  The following is a sample <Command>dcecp</Command> command for
modifying an existing filter:
</Para>
<InformalExample>
<Para><ProgramListing>dcecp> <Literal>audfilter modify world -add {Monetary_Transfers denial log}
</Literal>
dcecp>
</ProgramListing></Para>
</InformalExample>
<Para>The example command adds a guide with an event class of
<Literal>Monetary_Transfers</Literal>, an audit condition of <Literal>denial</Literal>, and an audit
action of <Command>log</Command> to the existing filter type <Literal>world</Literal>.  
Note that the filter type <Literal>world</Literal> does not take a key.
</Para>
<Para>The DCE control program does not use commas.  
Multiple guides and multiple filters
are specified in the standard <Command>dcecp</Command> list format: <Literal>{x y}</Literal> for single
arguments or <Literal>{{x y} {a b}}</Literal> for multiple arguments.
</Para>
<Para>In order to execute the <Command>audfilter modify</Command> command, you must have write
(<Literal>w</Literal>) permission to the audit daemon's ACL.
</Para>
</Sect2>
<Sect2 Id="AGCC.SECAT.div.14">
<Title>Deleting Filters</Title>
<Para><IndexTerm Id="AGCC.SECAT.indx.15">
<Primary>DCE control program</Primary>
<Secondary>modifying filters</Secondary>
</IndexTerm>You can delete one or more of the audit filters for a DCE client by
using the <Command>audfilter delete</Command> command.  The following is an example
<Command>audfilter delete</Command> command:
</Para>
<InformalExample>
<Para><ProgramListing>dcecp> <Literal>audfilter delete  {foreign_principal /.../foreign_cell_name/jedwards}
</Literal>
dcecp>
</ProgramListing></Para>
</InformalExample>
<Para>The example command deletes the audit filter for the DCE principal
<Literal>jedwards</Literal> in the foreign cell <Filename>/.../foreign_cell_name</Filename>.
</Para>
<Para>You can specify more than one filter
to be operated on in the <Command>audfilter delete</Command> command.  
As with the previous example of modifying filters, when deleting multiple
filter, you must use the standard <Command>dcecp</Command> syntax.
</Para>
<Para>In order to execute this command, you must have write (<Literal>w</Literal>) permission
to the audit daemon's ACL.
</Para>
</Sect2>
<Sect2 Id="AGCC.SECAT.div.15">
<Title>Default Filters</Title>
<IndexTerm Id="AGCC.SECAT.indx.16">
<Primary>default filters</Primary>
</IndexTerm>
<IndexTerm Id="AGCC.SECAT.indx.17">
<Primary>filter</Primary>
<Secondary>default</Secondary>
</IndexTerm>
<Para>During the configuration of the host (using <Literal>dce_config</Literal>), the following
<Command>audfilter create</Command> commands 
(using <Command>dcecp</Command>) are executed to create filters for
the security daemon, the DTS daemon, and the audit daemon:
</Para>
<InformalExample>
<Para><ProgramListing role="page-wide"><?sml-point-size 10>
<!--no-op:  12-->
audfilter create world -at {dce_sec_modify success log}

audfilter create world -at {dce_sec_modify {failure denial} all}

audfilter create world -at {dce_sec_server success log}

audfilter create world -at {dce_sec_server {failure denial} all}

audfilter create world -at {dce_sec_authent {failure denial} all}

audfilter create world -at {dce_sec_query denial all}


audfilter create world -at {dce_dts_mgt_modify success log}

audfilter create world -at {dce_dts_mgt_modify {failure denial} all}

audfilter create world -at {dce_dts_mgt_query {failure denial} all}


audfilter create world -at {dce_audit_admin_modify success log}

audfilter create world -at {dce_audit_admin_modify {failure denial} all}

audfilter create world -at {dce_audit_filter_modify success log}

audfilter create world -at {dce_audit_filter_modify {failure denial} all}

audfilter create world -at {dce_audit_admin_query {failure denial} all}

audfilter create world -at {dce_audit_filter_query {failure denial} all}
<?sml-point-size 12>
<!--no-op:  14-->
</ProgramListing></Para>
</InformalExample>
</Sect2>
<Sect2 Id="AGCC.SECAT.div.16">
<Title>Enabling Audit Filters</Title>
<Para>If you want to enable the audit filters, you must first set the 
<Literal>DCEAUDITFILTERON</Literal>  environment variable.  You must set this variable
before starting the server (that is, the audit client).
</Para>
<Sect3 Id="AGCC.SECAT.div.17">
<Title>Removing the Update Binding File</Title>
<Para>If a server (audit client) is running with
filters enabled (that is, <Literal>DCEAUDITFILTERON</Literal>
was set), <Command>libaudit</Command> (which is linked to the server) obtains 
the server's binding information and stores it in the following: 
</Para>
<Para><Filename>/opt/dcelocal/var/audit/client/</Filename><Symbol Role="Variable">pid-of-server</Symbol><Filename>/update_binding_file</Filename>
</Para>
<Para>where <Symbol Role="Variable">pid-of-server</Symbol> is the process ID of the server.
</Para>
<Para>If the server ends abnormally, this file must be removed manually.
If this is not removed, you will receive an error message 
the next time you restart the server with <Literal>DCEAUDITFILTERON</Literal>.
The message indicates that the audit daemon is unable to inform the 
audit client of filter updates:
</Para>
<InformalExample>
<Para><ProgramListing>unable to inform process 
/opt/dcelocal/var/audit/client/<Symbol Role="Variable">pid-of-server</Symbol>/update_binding_file 
about esl update.
</ProgramListing></Para>
</InformalExample>
<Para>You can also check for stale 
update binding files by checking what 
servers are running (for example, using <Literal>ps -e</Literal>) and comparing their
process IDs with the pathnames of the
update binding files.  Because the pathname of
these files contain a <Symbol Role="Variable">pid-of-server</Symbol> component, you can determine what
files correspond to nonexistent servers.
</Para>
<Para>Both the binding information file and the directory containing it
(<Symbol Role="Variable">pid-of-server</Symbol>) must be removed.
</Para>
</Sect3>
<Sect3 Id="AGCC.SECAT.div.18">
<Title>Buffering of the Audit Trail</Title>
<Para>The operating system buffers the audit trail data while it is written before
writing it to disk.
For this reason, the growth of the audit trail file will not become
apparent until the data is flushed to disk.
</Para>
</Sect3>
</Sect2>
</Sect1>
<Sect1 Id="AGCC.SECAT.div.19">
<Title>Enabling and Disabling the Audit Logging Service</Title>
<Para><IndexTerm Id="AGCC.SECAT.indx.18">
<Primary>DCE control program</Primary>
<Secondary>enabling and disabling audit logging</Secondary>
</IndexTerm>Use <Command>dcecp</Command> to enable or disable the 
audit record logging service of the audit daemon.
The <Command>aud enable</Command> command enables the logging service, and 
the <Command>aud disable</Command> command disables it.
</Para>
<Para>You may want to disable the logging service when the audit trail
file becomes too large, and then enable it again after the audit trail
has been backed up and rewound (using the <Command>aud rewind</Command> command).
</Para>
<Para>Using the enable or disable commands enable or disable audit record logging
to the central audit trail file.  Applications such as the security server
and the time server use their own audit trail files and are not affected
by use of enable or disable.
</Para>
<Para>The <Command>aud stop</Command> command stops the audit daemon.
</Para>
</Sect1>
<Sect1 Id="AGCC.SECAT.div.20">
<Title>Modifying and Querying Audit Daemon Attributes</Title>
<Para><IndexTerm Id="AGCC.SECAT.indx.19">
<Primary>DCE control program</Primary>
<Secondary>modifying and querying audit daemon attributes</Secondary>
</IndexTerm>The DCE audit daemon has two attributes that relate to the
audit trail file:
<IndexTerm Id="AGCC.SECAT.indx.20">
<Primary>audit</Primary>
<Secondary>daemon</Secondary>
<Tertiary>attributes</Tertiary>
</IndexTerm></Para>
<ItemizedList>
<ListItem>
<Para><Literal>stostrategy</Literal>&mdash;Specifies the storage strategy when the size of the 
audit trail file has reached its limit.
You can specify either of the following storage strategies:
</Para>
<VariableList>
<VarListEntry>
<Term><Literal>save</Literal></Term>
<ListItem>
<?sml-need 6>
<Para>If the specified trail size limit is reached, the audit daemon saves the
current trail file to a new file (renaming it to its original name with a 
timestamp appended at the end of the name).  The audit daemon then deletes
the contents of the original trail file and continues  auditing from the 
beginning of this file.  This is the default value for <Literal>stostrategy</Literal>.
</Para>
</ListItem>
</VarListEntry>
<VarListEntry>
<Term><Literal>wrap</Literal></Term>
<ListItem>
<Para>The audit daemon will overwrite the old audit trails.
</Para>
</ListItem>
</VarListEntry>
</VariableList>
</ListItem>
<ListItem>
<Para><Literal>state</Literal>&mdash;Indicates whether the audit daemon is servicing 
audit record logging requests from audit clients.
The possible values for this attribute are <Literal>enabled</Literal> (default value)
or <Literal>disabled</Literal>.
</Para>
</ListItem>
</ItemizedList>
<Para RevisionFlag="Changed">You can use <Command>dcecp</Command> to see the value of these settings,
as follows:
<?og-ChangeStart def, 13575,R1.2.2,fixed the missing dcecp prompt"></Para>
<InformalExample>
<Para><ProgramListing RevisionFlag="Changed">dcecp> <Literal>aud show</Literal>
{state enabled}
{stostrategy save}
dcecp>
</ProgramListing></Para>
</InformalExample>
<?og-ChangeEnd def, 13575,R1.2.2,fixed the missing dcecp prompt">
<Para>Use the <Command>aud modify</Command> command to change these attributes.
</Para>
</Sect1>
<Sect1 Id="AGCC.SECAT.div.21">
<Title>Controlling and Displaying Audit Trails</Title>
<Para>Audit daemons log audit records sent 
from audit clients into an audit trail
file.  If the audit daemon is started without any argument, then
the default audit trail file used is
<Symbol Role="Variable">dcelocal</Symbol><Filename>/var/audit/adm/central_trail</Filename>. 
You can also direct the audit trail to another file
by using the <Option>t</Option> option of the <Command>auditd</Command> command 
when starting daemon; the <Symbol Role="Variable">trail</Symbol> argument to the <Option>t</Option> option
specifies the pathname of the file to which the logs should be written.
</Para>
<Sect2 Id="AGCC.SECAT.div.22">
<Title>Displaying Audit Trail Files</Title>
<Para><IndexTerm Id="AGCC.SECAT.indx.21">
<Primary>audit</Primary>
<Secondary>trail file</Secondary>
<Tertiary>displaying</Tertiary>
</IndexTerm>Use the <Command>dcecp</Command> <Command>auditrail show</Command> command
to examine the contents of an audit trail file.  
You can display the contents of either the central or local
audit trail file.
</Para>
<Para RevisionFlag="Changed">For example, you can use the following 
command to see the contents of the audit trail file <Literal>central_trail</Literal>:
<!-- -->
<?og-ChangeStart def,13480,R1.2.2,update record examples">
<!-- -->
</Para>
<InformalExample>
<Para><ProgramListing RevisionFlag="Changed"><?sml-need 15>dcecp> <Literal>audtrail show  /opt/dcelocal/var/audit/adm/central_trail</Literal>

--- Start of an event record --- Event Number: 275
Event Name: LOGIN_getinfo
Event Outcome: success
Server: /.../stp.gburg.ibm.com/hosts/dceos2
Client: /.../stp.gburg.ibm.com/hosts/drinkernisti/self
Number of groups: 0
Authorization Status: Authorized with a pac
Date and Time recorded: 1994-12-19-19:02:27.037-05:00I-----
1 Event(s) specific:
   - item number 1             hosts/drinkernisti/self
--- End of an event record ---

--- Start of an event record --- Event Number: 275
Event Name: LOGIN_getinfo
Event Outcome: success
Server: /.../stp.gburg.ibm.com/hosts/dceos2
Client: Unknown client and cell uuids
Number of groups: 0
Authorization Status: Authorized with a pac
Date and Time recorded: 1994-12-19-19:02:28.819-05:00I-----
1 Event(s) specific:
   - item number 1             dce-rgy
--- End of an event record --- 

</ProgramListing></Para>
</InformalExample>
<!-- -->
<?og-ChangeEnd def,13480,R1.2.2,update record examples">
<!-- -->
<Para>If you prefer to have the audit trail data put into a file instead of
displayed on your screen, include the <Option>to</Option> option in the
<Command>audtrail show</Command> command line.  This option prints the audit trail
file's contents to a specified filename.  Using this option is strongly
recommended for large trail files. 
</Para>
</Sect2>
<Sect2 Id="AGCC.SECAT.div.23">
<Title>Controlling the Audit Trail Size</Title>
<Para><IndexTerm Id="AGCC.SECAT.indx.22">
<Primary>audit</Primary>
<Secondary>trail file</Secondary>
<Tertiary>controlling</Tertiary>
</IndexTerm>By default, audit trail files are limited to a size of 2 MB.  When the
audit service detects that the trail file will grow larger than this
value, it closes the file, creates a new unique name for the file by using
timestamp information, and then opens a new trail file with the original name.
It then proceeds to write new audit logs to this file.  When this file
grows too large, this process is repeated.
</Para>
<Para>If you wish to change the size of the audit trail file, you must set
the environment variable <Literal>DCEAUDITTRAILSIZE</Literal> to the size you
require before starting the application that is using the audit service.
Setting this environment variable overrides the default 2 MB size limit.
</Para>
<Para><?sml-need 4>For example, if you wish to use a trail file size of 5 MB, the value of
<Literal>DCEAUDITTRAILSIZE</Literal> should be as follows:
</Para>
<InformalExample>
<Para><ProgramListing>DCEAUDITTRAILSIZE 5000000
</ProgramListing></Para>
</InformalExample>
<Para>You can also allow the audit daemon to wrap around 
the central trail file when its limit (the default 2 MB or set by
<Literal>DCEAUDITTRAILSIZE</Literal>) is reached.  
To do this, you should start
the audit daemon with the <Option>wrap</Option> option:
</Para>
<InformalExample>
<Para><ProgramListing><UserInput>auditd -wrap
</UserInput></ProgramListing></Para>
</InformalExample>
<Para>You may also want to use this option if old audit 
records have little or no value and you want to keep 
only relatively recent records. 
</Para>
<Para>A trail size limit can also be set using the <Option>s</Option> option of
the <Command>auditd</Command> command.  
The limit set using this method overrides the default 2 MB limit.
</Para>
<Para>If for any reason you desire to take a snapshot of the audit trail
before it reaches the limit, 
you can use the <Command>dcecp</Command> <Command>aud disable</Command> command to
disable logging and then copy the file. 
You can then use the <Command>dcecp</Command> <Command>aud rewind</Command> 
command to rewind the central audit trail file.  (Note that, if required, you 
can back up this audit file at this time.  But, if backup is
desired, it is best to let the audit service automatically create new
trail files and back these up.)  Then use the <Command>aud enable</Command> command to
enable the audit daemon's logging service again.  
</Para>
</Sect2>
<Sect2 Id="AGCC.SECAT.div.24">
<Title>Changing the Audit Trail File Storage Option</Title>
<Para><IndexTerm Id="AGCC.SECAT.indx.23">
<Primary>audit</Primary>
<Secondary>trail file</Secondary>
<Tertiary>changing storage option</Tertiary>
</IndexTerm>The storage strategy option can be changed while the audit 
daemon is running.  
This can only be performed on the central audit trail file.
</Para>
<Para RevisionFlag="Changed">The following example shows how the
<Command>aud modify</Command> command is used to cause the
audit trail to wrap when it reaches the limit of the file:
<?og-ChangeStart def, 13575,R1.2.2,fixed the missing dcecp prompt"></Para>
<InformalExample>
<Para><ProgramListing RevisionFlag="Changed">dcecp> <Literal>aud modify  -stostrategy wrap</Literal>
dcecp>
</ProgramListing></Para>
</InformalExample>
<?og-ChangeEnd def, 13575,R1.2.2,fixed the missing dcecp prompt">
<Para>This example command changes the value of the audit daemon's storage strategy
attribute to <Literal>wrap</Literal>.
<!-- Select an attribute type (0: state, 1: stostrategy) \*L1\*O-->
<!-- Enter stostrategy attribute value (512: stop, 256: wrap) \*L256\*O-->
</Para>
</Sect2>
</Sect1>
</Chapter>
<!--+ 10/31/96 16:05:54
    | tagMorph:  $Id: 15_audit_tasks.sgm,v 1.1.2.10 1996/12/04 22:48:45 carrig Exp $
    | tagMorph library:  $Id: 15_audit_tasks.sgm,v 1.1.2.10 1996/12/04 22:48:45 carrig Exp $
    | sml-to-docbook:  1.24
    +-->

...\"
...\" @OSF_COPYRIGHT@
...\" COPYRIGHT NOTICE
...\" Copyright (c) 1990, 1991, 1992, 1993 Open Software Foundation, Inc.
...\" ALL RIGHTS RESERVED (DCE).  See the file named COPYRIGHT.DCE in the
...\" src directory for the full copyright text.
...\"
...\"
...\" HISTORY
...\" $Log: 1_intro_dts.gpsml,v $
...\" Revision 1.1.8.1  1996/09/19  15:24:47  sherman
...\" 	{def,13575,R1.2.2}
...\" 	Removed info on non-dcecp control programs
...\" 	[1996/09/19  15:24:10  sherman]
...\"
...\" Revision 1.1.6.14  1995/05/25  19:04:38  rcb
...\" 	PRENTICE HALL reformat: final changes
...\" 	[1995/05/25  13:17:00  rcb]
...\" 
...\" 	PRENTICE HALL reformat
...\" 	[1995/04/17  20:21:26  rcb]
...\" 
...\" 	1.1 edit; terminology fix
...\" 	[1995/04/10  18:49:11  rcb]
...\" 
...\" 	PRENTICE HALL reformat -- index entries, odds and ends
...\" 	[1995/03/27  19:50:14  rcb]
...\" 
...\" 	prevented hyphenation of option names
...\" 	[1995/03/09  15:01:23  rcb]
...\" 
...\" 	corrected Appendix C reference
...\" 	[1995/03/06  17:59:10  rcb]
...\" 
...\" 	PRENTICE HALL reformat
...\" 	[1995/03/06  16:48:03  rcb]
...\" 
...\" 	incorporated 1.1 edits
...\" 	[1995/03/06  16:20:21  rcb]
...\" 
...\" Revision 1.1.6.13  1994/10/20  14:25:07  steto
...\" 	{edt, R1.1, Checked for freeze.}
...\" 	[1994/10/20  14:22:56  steto]
...\" 
...\" Revision 1.1.6.12  1994/10/19  20:13:03  wardr
...\" 	{edit R1.1}
...\" 	Final GA release edits
...\" 	[1994/10/19  20:10:49  wardr]
...\" 
...\" Revision 1.1.6.11  1994/10/18  20:08:58  neilson
...\" 	CR 9381 - Add what happens when courier finds no global server.
...\" 	[1994/10/18  20:08:34  neilson]
...\" 
...\" Revision 1.1.6.10  1994/10/14  19:20:20  steto
...\" 	{edt, R1.1, Incorporated review comments.}
...\" 	[1994/10/14  19:19:51  steto]
...\" 
...\" Revision 1.1.6.9  1994/09/07  14:50:46  steto
...\" 	{enh, CR10014, R1.1, Prepared for final review.}
...\" 	[1994/09/07  14:50:25  steto]
...\" 
...\" Revision 1.1.6.8  1994/08/01  15:33:42  steto
...\" 	{edt, R1.1, Changed for final reviwew.}
...\" 	[1994/08/01  15:33:12  steto]
...\" 
...\" Revision 1.1.6.7  1994/05/06  21:30:25  steto
...\" 	{enh, 10014, R1.1}
...\" 	Updated according to engineer's review comments.
...\" 	[1994/05/06  21:28:27  steto]
...\" 
...\" Revision 1.1.6.6  1994/05/03  15:32:43  steto
...\" 	{enh, 10014, edt, R1.1}
...\" 	Added information for the DCE control program.  Fixed the spacing and paragraph
...\" 	tags per OSF's conventions for guide material.
...\" 	[1994/05/03  15:32:16  steto]
...\" 
...\" Revision 1.1.6.5  1993/08/24  01:29:25  tmw
...\" 	Added index entries for second version of master index.
...\" 	[1993/08/24  01:03:04  tmw]
...\" 
...\" Revision 1.1.6.4  1993/07/06  18:36:47  buckler
...\" 	{edit, R1.0.2}
...\" 	Prentice-Hall editorial changes.
...\" 	[1993/07/06  18:21:22  buckler]
...\" 
...\" Revision 1.1.6.3  1993/06/01  18:16:55  buckler
...\" 	{edit, R1.0.2}
...\" 	Removed blank line at beginning that was causing header problems.
...\" 	[1993/05/27  13:58:19  buckler]
...\" 
...\" Revision 1.1.6.2  1993/05/25  15:41:19  buckler
...\" 	{edit, R1.0.2}
...\" 	Prentice-Hall editorial review.
...\" 	[1993/05/25  15:37:50  buckler]
...\" 
...\" Revision 1.1.4.6  1993/02/15  22:08:38  buckler
...\" 	Changed .P! to .pI and added Postscript boundary boxes
...\" 	[1993/02/15  22:07:27  buckler]
...\" 
...\" Revision 1.1.4.5  1993/01/28  20:08:13  dbelch
...\" 	Embedding copyright notice
...\" 	[1993/01/28  18:42:32  dbelch]
...\" 
...\" Revision 1.1.4.4  1993/01/27  17:21:27  buckler
...\" 	Fixed cross-refs and figure calls for new book org
...\" 	[1993/01/27  17:18:01  buckler]
...\" 
...\" Revision 1.1.4.3  1993/01/07  16:57:51  buckler
...\" 	Bug 5335: Changed ISO acronym expansion from "International Standards
...\" 	Organization" to "International Organization for Standardization".
...\" 	[1993/01/07  16:56:27  buckler]
...\" 
...\" Revision 1.1.4.2  1992/08/31  17:42:22  weir
...\" 	Removed change bars
...\" 	[1992/08/31  17:36:39  weir]
...\" 
...\" Revision 1.1.2.5  1992/07/10  20:09:42  steiner
...\" 	Fixed spacing of figures, removed spurious page breaks.
...\" 	[1992/07/10  20:09:02  steiner]
...\" 
...\" Revision 1.1.2.4  1992/07/07  19:19:58  liza
...\" 	Changes made: Page 1-11, Added a reference to the BNF in Appendix B
...\" 	File name:    1_intro_dts.gpsml
...\" 	Change request number: 2985
...\" 	[1992/07/07  19:19:04  liza]
...\" 
...\" Revision 1.1.2.3  1992/06/18  15:33:58  h_hoff
...\" 	Changed manual reference from 'app dev ref' to 'app dev gd' to comply with
...\" 	reopened CR2897
...\" 	[1992/06/18  14:07:51  h_hoff]
...\" 
...\" Revision 1.1.2.2  1992/05/28  18:09:17  h_hoff
...\" 	Changed postion of '.zA macro for added illustration
...\" 	[1992/05/28  18:05:49  h_hoff]
...\" 
...\" 	submitted by Heinz A.  Hoffmann - DOC; User name: h_hoff
...\" 	  Date: 5/20/92
...\" 	  Number of files: 1.
...\" 	  Number of fixes 22.
...\" 
...\" 	1. 1_intro_dts.gpsml " CR2841 -- pp 1-12, para 4: added new figure
...\" 	        showing relative time format.
...\" 
...\" 	2. 1_intro_dts.gpsml " CR2841 -- pp 1-15, para 6: changed 'need to' to
...\" 	        'needs to.'
...\" 	[1992/05/20  12:22:04  h_hoff]
...\" 
...\" Revision 1.1  1992/01/29  16:18:57  damon
...\" 	Initial revision
...\" 
...\" $EndLog$
...\"
...\" Copyright 1991, Open Software Foundation, Inc.  ALL RIGHTS RESERVED.
...\"   HISTORY COMMENTS:
...\"
...\"   DATE:                            COMMENT:
...\"
...\"	Fri Oct 25, 1991                 Initial File Submission for final
...\"                                    integration at IBM
...\"
...\"   Sat Dec 7, 1991                  Index entry fixes by IBM
...\"                                    (lines 89, 90, 81, and 887)
...\"
...\" ********************************************************************
...\"                                                                    *
...\" COPYRIGHT (c) 1991 BY DIGITAL EQUIPMENT CORPORATION,               *
...\" Maynard, Massachusetts                                             *
...\" All Rights Reserved.                                               *
...\"                                                                    *
...\" This document is furnished under a license and may be used and     *
...\" copied only in accordance with the terms of such license and with  *
...\" the inclusion of the above copyright notice.  No title to or        *
...\" ownership of the document is hereby transferred.                   *
...\"                                                                    *
...\" The information in this document is subject to change without      *
...\" notice and should not be construed as a commitment by Digital      *
...\" Equipment Corporation.                                             *
...\"                                                                    *
...\" ********************************************************************
.iX "-: UTC" "Coordinated Universal Time"
.H 1 "Introduction to DCE Distributed Time Service"
.P
.iX "DTS" "clerks" "about"
.iX "DTS" "servers " "about"
.iX "synchronization" "about"
.iX "entities" "in DTS" 
This chapter gives a conceptual overview of the DCE Distributed Time Service 
(DTS).  Some basic time and clock concepts, DTS time
representation, and basic DTS operation are also presented.
.P
DTS is a software-based service that provides precise,
fault-tolerant clock synchronization for systems in local area networks 
(LANs) and wide area networks (WANs).  The clock synchronization 
that is provided by DTS enables distributed computing applications to
determine event sequencing, duration, and scheduling.
.P
DTS consists of software components on a group of cooperating systems; it
conforms to the client/server model that is used in DCE.  In the DTS
implementation, each server supplies the
time to many client systems and applications through intermediaries called
\*Eclerks\*O.  Clerks reside on their client systems.  (Note that,
throughout this part of this guide,
the term \*Ventity\*O is used to refer to either the server process
or the clerk process when they have the same functions.) 
.P
.ne 7
Most DCE nodes have a DTS clerk that adjusts the clock on its client system;
clerks use remote procedure calls (RPCs) to obtain time values from one or
several servers in the network.  The nodes that do not have DTS clerks have DTS
servers; in addition to providing time values to clerks, servers also adjust
the system clocks on their host systems.  Servers are also able to obtain
reference time values from sources of standardized time that are outside 
of the network. 
.P
.iX "interval" 
Because no device can measure the exact time at a particular instant,
DTS expresses the time as an interval
that contains the correct time.  In the DTS model, clerks
obtain time intervals from several servers and compute the intersection
where the intervals overlap.  Clerks then adjust the system clocks of their
client systems to the midpoint of the computed intersection.  When clerks
receive a time interval that does not intersect with the majority, the
clerks declare the nonintersecting value to be faulty.  Clerks ignore faulty
values when computing new times, thereby ensuring that defective server
clocks do not affect clients.
.P
.iX "-[" "time" "standards"
DTS also permits the importation of time values from outside sources, such as
the U.S.  National Institute for Standards and Technology (NIST).  DTS uses the
UTC (Coordinated Universal Time) standard that has largely replaced Greenwich
Mean Time (GMT) as a reference.  Many standards bodies disseminate UTC by
radio, telephone, and satellite; commercial devices (time-providers) are
available to receive and interpret these signals.  DTS offers a
Time-Provider Interface (TPI) that describes how a time-provider process can
pass UTC time values to a DTS server and propagate them in the network.  The
TPI also permits other distributed time services to interoperate with DTS.
.P
DTS provides many other valuable services for computer
networks that run distributed applications.  The major features
and benefits of DTS are the following:
.ML
.LI
Correctness\(emDTS maximizes the probability that a
client will receive the correct time.  DTS uses UTC
as a base reference and defines any time interval
containing UTC as correct.
.LI
Quantitative Time Measurement\(emDTS uses specific
measurement and manufacturer's specifications to determine the quality of
the times that are reported by servers.
.LI
.ne 2
Fault Tolerance\(emDTS reports faulty servers and does
not use their time values during clock synchronizations.
.zA "def, 13575,R1.2.2,Remove info on non-dcecp control programs"
.LI
.ne 2
Management Capability\(emThe DCE control program (\*Ldcecp\*O) enables 
you to control and monitor the software.
.LI
.ne 3
Application Programming Interface (API)\(emDTS provides an
interface that allows applications to obtain, compare, and calculate UTC
time values.
.LI
Local Time Translation\(emWhen displaying time values, 
DTS translates the UTC times that it uses internally into local
time values.
.LI
Monotonicity\(emDTS normally provides unidirectional clock
adjustment.  You can use the DCE control program, though,
for nonmonotonic clock adjustment.
.zZ "def, 13575,R1.2.2,Remove info on non-dcecp control programs"
.LI
Automatic Configuration\(emDTS entities use RPC profiles (search tables)
to obtain the locations of servers in a local area or cell.
.LI
Efficiency\(emComplexity is placed in the servers; network overhead is
minimal.
.LE
.iX "-]" "time" "standards"
.H 2 "DTS Advantages"
.P
.iX "applications" "using DTS"
DTS offers all the features that are normally provided by a time
service, but it also has several features that enhance network
performance.  The following subsections describe these DTS features:
.ML
.LI
Applications support
.LI
External time-provider support
.LI
Manageability
.LI
Quantitative inaccuracy measurement
.LE
.nL
.ne 10
.H 3 "Applications Support"
.P
.iX "applications" "using DTS"
Operating systems and distributed applications require synchronized time
measurements to coordinate their processes.  DTS
synchronizes the system clocks in a network with each other and, in the
presence of an external time-provider, to the UTC time standard.  Any
distributed application that reads the system clock, which is the majority of
applications, needs DTS.  As the number of distributed
applications and systems in a network increases, DTS
becomes increasingly vital to process coordination.
.P
There are several types of existing applications that use the synchronized
time DTS provides to system clocks.  These applications
must reference synchronized system clocks in order to coordinate the events
that occur throughout the network.  Applications use synchronized clocks for
the following functions:
.ML
.LI
Event Measurement\(emApplications can read the system clock to start and
stop timers and to measure the elapsed time between events.
.LI
Event Reporting\(emApplications can read the clock when an event occurs
and append a timestamp to the event report.
.LI
Event Scheduling\(emApplications can read the system clock and add a
relative time to determine the occurrence of a future event.
.LI
Event Sequencing\(emApplications can determine the order of events by
reading the event report timestamps that are 
derived from the synchronized system clock.
.LE
.P
For new applications, DTS provides an API.  This
API provides routines that new applications
can use to obtain and manipulate binary timestamps.  The 
DTS API supports ANSI C language constructs.  (See the
\*(Dk for further information on the
DTS API.)
.H 3 "External Time-Provider Support"
.P
.iX "-[" "time-provider" "support"
For most networks, it is desirable to synchronize the system clocks with the
UTC time standard.  Many commercial devices are available for obtaining the
UTC time that is 
provided by standards organizations; these devices receive signals by
short-wave radio, satellite, and telephone.  If your network or cell is larger
than a single LAN, it is recommended that you use at least one external
time-provider in combination with the DTS software.  (See 
Appendix C for a list
of suppliers of time-provider hardware.  Sample time-provider programs are
available online in \*Vdcelocal\*L/usr/examples/dts\*O.)
.P
DTS servers can synchronize with time-providers by means
of the TPI, which is described in the 
\*(Dk.  The TPI specifies the 
communications between the DTS server process and the time-provider process.
.P
When a DTS server attempts to synchronize, it uses the TPI
to check for a time-provider process.  If one is available, the server
synchronizes only with the time-provider.  If no time-provider is present, the
server synchronizes with other servers in the network.
.P
By using a time-provider with a DTS server, you can
ensure that the server is closely synchronized with UTC.  When other servers
request a time from the server with the time-provider (the 
TP server), the TP server's precise time is propagated throughout
the network.  (See 
...\" the section about basic DTS concepts 
Section 23.2
for further information 
about time-providers and the server synchronization process.)
.iX "-]" "time-provider" "support"
.H 3 "Manageability"
.P
.iX "DTS" "managing"
The DTS synchronization functions run as background
processes; little or no input is required from system managers to
synchronize system clocks after DTS is initially
configured.  DTS is also fault tolerant.  It prevents
malfunctioning clocks from providing the wrong time to other clocks in the
network.  Occasionally, however, system managers may need to perform the
following functions:
.ML
.LI
Identify system clock problems
.LI
Adjust system clocks
.LI
Change DTS attributes due to varying network conditions
.LI
Modify system configurations when the network topology changes
.LE
.P
DTS provides a full-featured management interface that
allows system managers to adjust system clocks, change the values of the
DTS management parameters, and add or subtract servers
from the network.
.P
To aid in solving problems with system clocks, DTS
provides event reporting that notifies system operators and managers in the
rare event that a system clock is inaccurate or fails to synchronize.
.H 3 "Quantitative Inaccuracy Measurement"
.P
Unlike other network time services, DTS uses
manufacturers' specifications and direct observation to determine the
inaccuracy of system clocks relative to UTC.  DTS appends
an inaccuracy measurement to each time value that it uses internally.  This
measurement takes into account cumulative clock error, communications
delays, and processing delays.  DTS uses combined time and
inaccuracy measurements from one or several sources to calculate the most
accurate new clock settings for client systems.  (See 
...\" the section that describes synchronizing system clocks
Section 23.2.3
for further information about the DTS synchronization
process.)
.H 2 "Basic DTS Concepts"
.P
.iX "-[" "synchronization" "how it works"
The following subsections describe system clock and network characteristics,
DTS synchronization concepts, DTS clock adjustment, and 
DTS time representations.  System managers
need to read these subsections to gain a basic understanding of 
DTS concepts before progressing to Chapter 25.
.H 3 "Time Measurement Factors"
.P
The following subsections describe 
the factors that affect time measurement and explain how DTS handles them.
.H 4 "Clock Error"
.P
.iX "clocks" "errors"
.iX "drift"
All system clocks have common properties that contribute to clock error and
interfere with the synchronization process.  System clock error tends to
increase over time; the rate of change of error is known as \*Edrift\*O.  If
each system clock in a network started at the same time and ran at the same
rate, the clocks would remain synchronized.  Because each system clock drifts
at a different rate, however, the system clocks throughout a network become
desynchronized.
.P
.iX "skew"
The difference between any two clock readings is known as the \*Eskew\*O
between the clocks.  The clocks that are used in many computer systems have
a specified maximum drift of a few seconds per day.  If uncorrected for
several days, the skew between networked system clocks can inhibit the
performance of distributed applications.
.P
The DTS server or clerk on each node tracks the drift of its client's system
clock and periodically synchronizes with other DTS nodes to reduce the skew
between its client's time value and those of the other DTS nodes.  The DTS
server or clerk adjusts the system clock on its client node as the final step
in this repeating synchronization process.
.H 4 "Communications and Processing Uncertainties"
.P
Communications delays also inhibit the synchronization process, especially
when two systems communicate over a WAN or low-speed link.  DTS can adjust
for the known processing delays that are required to
send and receive messages between systems.  Due to the varying quality of
communications links, however, the time that is required to send, receive, and
acknowledge messages varies from one message to the next.  These delays cannot
be known exactly because transit over the network and the time required to
read an incoming timestamp both vary.
.P
Rather than using estimates of communications and processing delays,
DTS records all known error factors that accompany a time
measurement sent over the network.  This measurement enables 
DTS to determine the relative quality of a time source
regardless of its geographic location or changing conditions on
communications links.
.H 3 "Inaccuracy Values"
.P
.iX "-[" "inaccuracy values" "determining"
.iX "time-provider" "determining accuracy"
In order to synchronize system clocks to the most accurate settings,
DTS needs a way to determine the accuracy of time sources
relative to each other and to UTC.  This section describes how 
DTS determines the relative accuracy of any time source
that is available in the network.
.P
DTS uses an inaccuracy value, or tolerance, to
determine the relative precision of time values that it obtains from system
clocks and external time-providers.  This DTS feature
effectively transforms each time value into an interval, or range, rather
than a point on a continuum.
.P
Inaccuracy values are determined by the following three factors:
.ML
.iX "drift"
.iX "leap seconds" "inaccuracy values"
.LI
Drift\(emWhen reading a clock, DTS calculates
the amount of time that the clock may have drifted since 
DTS previously read the clock.  Drift is the largest
component of most inaccuracy values.
.LI
Communications Delay\(emThe inaccuracy also contains the uncertain
portions of the communications delays between systems.  Although 
DTS compensates for processing delays, it cannot predict
or directly measure the varying delays that occur on network links.  The
inaccuracy values that a clerk or server obtains from \%co-located systems on a
LAN tend to be much lower than those obtained from servers outside the LAN.
.LI
Leap Seconds\(emUTC time is measured by atomic clocks, which are
extremely stable.  The standard, however, keeps time based on the earth's
position.  Due to the slowing of the earth's rotation, it occasionally
becomes necessary to advance UTC time by 1 second.  These events are known
as \*Eleap seconds\*O.  Leap seconds may occur in the final second of
any month, and normally occur about once every 18 months.  At the end of each
month, DTS accounts for leap seconds by increasing all
inaccuracy measurements by 1 second.  DTS later adjusts
the clocks to remove the extra second of inaccuracy if an external
time-provider determines that a leap second did not actually occur.
.LE
.P
Without DTS to correct it, a system clock's inaccuracy is
always increasing.  For example, suppose that a clock starts with a UTC time
of 0:00:00.00 (midnight) and zero inaccuracy.  Due to drift, when the clock
next shows a time of 0:00:00.00, the inaccuracy is 8 seconds.  UTC time may
be 23:59:52.00 or 0:00:08.00, but is probably somewhere in between.
Therefore, the system time is an interval that contains 
UTC time and is bounded by the inaccuracy, as shown in 
Figure 23-1.  Using the
DTS format for displaying time, the combined time and
inaccuracy interval is expressed as follows:
.oS
1993-08-03-00:00:00.000I08.000.
.oE
.P
.FG "Time and Inaccuracy"
.pI ../dts/dts/figures/1_intro_dts_10.ps 0 0 1
.sp .5
.P
.iX "-]" "inaccuracy values" "determining"
.H 3 "Synchronizing System Clocks"
.P
.iX "-[" "clocks" "synchronizing"
.iX "DTS" "servers" "synchronization procedures"
.iX "DTS" "clerks" "synchronization procedures"
To maintain uniform system times, DTS servers and clerks
periodically synchronize the clocks in all network systems.  The
DTS entity that is on each system performs these synchronizations
by requesting that servers send their combined clock and inaccuracy values 
(time intervals) to the originating system.  The entity then uses the values
that are sent by the servers to compute a new system time.
.P
DTS servers and clerks have slightly different
synchronization procedures.  Before attempting to synchronize with other
systems, DTS servers always check that an external
time-provider is present on the server system.  A given server requests times
from other servers if no time-provider is available.  When no time-provider
is available and a server synchronizes with its peer servers, the server
uses its own system time as one of the input values when it computes a new
system time.
.P
Most network systems run the DTS clerk process.  Clerks
cannot have time-providers, and they do not use the system time of their
client systems to compute new times.  When a clerk is synchronizing its
client system's clock, the clerk uses only the time values that it obtains
from servers to compute a new system time.
.P
.iX "computed time"
When a DTS clerk requests time intervals from
several servers, it uses them to calculate a new 
time that is correct (that is, contains UTC) 
and that minimizes inaccuracy.  When the servers respond and the 
DTS clerk calculates network communications
uncertainties and drift for each of the time values, the clerk has a
set of intervals (\*Lt1\*O through \*Lt4\*O in Figure 23-2).  Since each
interval contains UTC, the intersection is the smallest interval the clerk
can choose that also contains UTC.  This intersection is the 
computed time.  The DTS entity uses the computed
time interval to adjust the clock on the system that receives the server
values.
.P
In addition to eliminating large inaccuracy values during synchronization,
DTS also discards intervals that are received from faulty clocks 
(\*Lt2\*O in the figure).  DTS detects and rejects
clock intervals that do not intersect with the majority of the
intervals.  When DTS detects a faulty interval, it notifies the system
manager by displaying an event message, identifying the server that sent the
faulty value.
.P
A server that has a high-drift clock or is far away in the network submits its
time to the DTS entity (\*Lt1\*O in the figure), but the large time
interval is ignored since more accurate times are available.  Note that, in 
Figure 23-2, the endpoints of correct time (\*Lt1\*O) are further from the
computed time midpoint than those of the interval that 
is declared faulty (\*Lt2\*O).
.P
.ne 4i
.FG "Computed Time"
.pI ../dts/dts/figures/1_intro_dts_20.ps 0 0 1
.sp .5
.P
During the synchronization process, servers with the greatest accuracy have
the most influence in determining new system times throughout the
network.  In the previous figure, the server that submitted time value
\*Lt3\*O has
the smallest correct interval and is therefore the closest to the computed
time.  Server systems with external time-providers are usually the servers
with the most accurate times.  Beyond TP servers, those servers with the
highest quality clocks and best communications links tend to influence the
time on other systems to the greatest degree.
.P
.iX "skew"
The synchronization process also reduces the skew between systems.  The
computed time interval is often smaller than the interval that is
supplied by any single clock.  Note that the 
computed time in the previous figure is a
smaller interval than any of the source intervals.  As the synchronization
procedure is constantly repeated on each network system, the skew between
systems is reduced and they are more closely synchronized.  However, if a
time-provider is absent from the network, the clocks may collectively drift
away from UTC.
.iX "-]" "clocks" "synchronizing"
.H 3 "How DTS Adjusts System Clocks"
.P
.iX "clocks" "adjustment mechanism"
.iX "tick"
Many system clocks are based on an oscillator and operate with a combination
of hardware and software.  The hardware for each clock contains a timer that
sends interrupts to the operating system at fixed intervals; each interrupt is
a single ``tick.''  A software register that contains the current value of the
time is incremented by a fixed amount (for example, 10 milliseconds) at each
tick.  DTS adjusts the rate of the clock by changing only the incremental value
that is added to the software register.  It does not directly affect the ticks
of the hardware clock.
.P
DTS adjusts system clocks at the rate of 100 to 1; that is, it
requires 100 time units to adjust 1 time unit of error.  For example, it
takes 1 minute and 40 seconds to correct a 1-second error.  This rate of
adjustment exceeds the normal rate of drift so that synchronization is
carried out without further significant interference from the clock.
.P
Figure 23-3 illustrates how DTS changes the increment to the software
register.  The top line represents a 10-millisecond increment to the normal
clock at every 10-millisecond tick.  The middle line illustrates the adjustment
to a fast clock; DTS slows the clock by incrementing the register by 9.9
milliseconds instead of 10 milliseconds
at each tick.  The bottom line illustrates the
adjustment to a slow clock; DTS speeds it up by
incrementing the register by 10.1 milliseconds instead of the 
usual 10 milliseconds at each tick.
.P
.FG "Adjustment of the Clock"
.pI ../dts/dts/figures/1_intro_dts_30.ps 0 0 1
.sp .5
.P
It is occasionally preferable to set the system clock immediately, rather
than adjusting it gradually.  DTS provides this option for
the following situations:
.ML
.LI
During system startup when you want to set the initial system time
.LI
If it has been a long time since the last synchronization, and you
decide that the skews between system clocks are too large to wait for a
gradual adjustment
.LI
When a network has had catastrophic hardware problems, causing a large
number of the clocks to become faulty
.LI
When the time interval for a given clock does not intersect with the
intervals of other clocks, and the error exceeds a predetermined tolerance
.LE
.iX "-]" "synchronization" "how it works"
.H 3 "DTS Time Representation"
.P
.iX "-[" "time" "display formats"
.iX "UTC" "about"
.iX "timestamps" "manipulating"
UTC is the international time standard that has
largely replaced GMT.  The standard is administrated by
the International Time Bureau (BIH) and is in widespread use.  For all its
internal processes, DTS uses opaque binary timestamps
that represent UTC.  You cannot read or disassemble a DTS
binary timestamp.  The DTS API
allows other applications to convert or manipulate the
timestamps, but they cannot be displayed.  DTS also
translates the binary timestamps into ASCII text for display on a client
system.
.H 4 "Absolute Time"
.P
.iX "-[" "absolute time"
An absolute time is a point on a time scale.  For 
DTS, absolute times reference the UTC time scale.  Absolute
time measurements are derived from system clocks or external time-providers.
When DTS reads a system clock time, the time is recorded
in an opaque binary timestamp that also includes the inaccuracy and other
information.  When you use the DCE control program (\*Ldcecp\*O)
\*Lclock show\*O command to display an absolute time, it is converted to
ASCII text, as shown in the following display:
.oS
1993-11-21-13:30:25.78523-04:00I010.0825
.oE
.P
.ne 3
DTS displays all times in an ISO-compliant format.  The
International Organization for Standardization (ISO)
format that generated the previous display example is detailed as 
shown in Figure 23-4.
.P
.FG "ISO-Compliant Time Format"
.pI ../dts/dts/figures/1_intro_dts_40.ps 0 0 1
.sp .5
.P
In the format example shown in the preceding figure, 
the relative time preceded by the \*L+\*O (plus sign) or \*L-\*O
(minus sign) indicates the hours and minutes that the calendar date and
inaccuracy are offset from UTC.  The presence of one of these characters in the
string also indicates that the calendar date and time are the local time of the
system, not UTC.  The delineator I indicates the beginning of the inaccuracy
component that is associated with the time.  You can express the DTS time
that you want to display in several ways.  The DTS time in BNF format is defined
in 
...\" Appendix B.
Appendix D.
.P
Although the \*Ldcecp\*O \*Lclock show\*O command displays all times
in the previous format (see Figure 23-4), 
the interface also accepts the following variations
to the ISO format on input, as shown in Figure 23-5.
.P
.ne 2.25i
.FG "ISO-Compliant Time Format Variation"
.pI ../dts/dts/figures/1_intro_dts_50.ps 0 0 1
.sp .5
...\"sourcefile = 1_intro_dts_50.gra scaled to 76%
.P
In the preceding example, 
the delineator T separates the calendar date from the time, a \*L,\*O
(comma) separates seconds from fractional seconds, and the \(+- (plus-or-minus
sign) indicates the beginning of the inaccuracy component.
.P
.iX "time" "translating UTC to local"
.iX "UTC" "and local time"
DTS offers a translation feature that changes UTC-based
absolute times to your local time whenever the time is displayed.  The local
time displayed is derived from UTC plus a Time Differential Factor (TDF),
which can have a positive or negative value.  In the previous example, the
string [\*L+\*O/\*L-\*O] \*Vhh\*L:\*Vmm\*O denotes the TDF.  When 
installing a system, you select
a time-zone rule for the system, which determines the TDF and any seasonal
changes to the TDF.  After the initial startup, all subsequent output times
reflect the local time.  If an absolute time is displayed by your system, and
it does not contain TDF information, it is a UTC time.
.P
The following section describes relative time, which is derived from
absolute time.
.iX "-]" "absolute time"
.H 4 "Relative Time"
.P
.iX "-[" "relative time"
A relative time is a discrete time interval that is usually added
to or subtracted from another time.  The TDF that
is associated with absolute times
is an example of a relative time.  Relative times are normally used as input
for commands or system routines.
.P
Figure 23-6 shows the format for relative time.
.P
.ne 2i
.FG "Relative Time Format"
.pI ../dts/dts/figures/1_intro_dts_60.ps 0 0 1
.sp .5
...\ "sourcefile = 1_reltime_format_30_dts.gra scaled to 76%
.P
The simple relative times that you specify with DTS-related \*Ldcecp\*O 
commands do not use the calendar date nor inaccuracy fields because these
fields are associated with absolute times.  Positive relative times are not
signed, but negative relative times are preceded with a \*L-\*O (minus sign).
.P
The following example shows a relative time used in a typical DTS-related
\*Ldcecp\*O command:
.oS
21-08:30:25.000
.oE
.P
Simple relative times are often subtracted from or added to other relative or
absolute times.  For example, if you say, ``I will meet you 
in an hour,'' you add a relative time 
of +01:00 to the present absolute time.  In the case where you
add or subtract a relative time and an absolute time, note that the inaccuracy
of the input absolute time is carried over to the resulting absolute time.  For
example, 1993-11-30-00:30:25.000I00.030 minus 00-00:15:25.000 equals
1993-11-30-00:15:00.000I00.030.
.iX "-]" "relative time" 
.iX "-]" "time" "display formats" 
.H 2 "How DTS Works"
.P
.iX "-[" "DTS" "how it works"
DTS has two major software components:
.ML
.LI
Clerks
.LI
Servers
.LE
.P
.ne 3
The following subsections describe each of these components and tell you
how they interact to provide time to 
client applications and to synchronize system clocks.
.H 3 "Clerks"
.P
.iX "-[" "DTS" "clerks" "about"
Any system that is not a DTS server is a 
DTS clerk.  Most network systems run clerk
software.  Clerks maintain server lists and perform the synchronization
functions for DTS client systems.
.P
.iX "profiles" "role in lookups"
In order to build server lists and synchronize with the servers on the list,
clerks need to be able to locate servers automatically.  They discover
servers by using remote procedure call (RPC) profiles.  Recall that profiles
are search tables that contain the following types of entries:
.ML
.LI
Server Entries\(emThe CDS names of individual resource providers.
.LI
Service Group Entries\(emA group of resource providers identified by a
single CDS name.
.LI
Profile Entries\(emThe names of other configuration profiles. 
These entries allow hierarchical nesting of profiles.
.LE
.P
Each DTS clerk node contains up to three profiles.  When it attempts to locate
servers, a clerk first performs an RPC lookup of the entries in a base profile
called the \*Enode initial profile\*O.  The clerk then looks for the LAN
profile entry.  If the LAN profile entry is not found, the clerk searches for
the default profile entry; the default profile may contain the LAN
profile entry.  When the clerk locates the LAN profile, it reads the server
entries to build a list of local servers.  This process is repeated at set
intervals.
.P
If a clerk does not obtain enough server entries as dictated by the DTS
management attribute \*Lminservers\*O, it attempts to
locate additional servers, usually those outside the LAN.  To locate these
servers, a clerk locates the cell profile, which has a well-known CDS
name.  The cell profile contains global server entries; that is, servers that
are normally found outside the LAN.  (See Section 23.3.2 for further
information on servers.)
.P
After building a server list with enough entries, a clerk can directly request
time values from several of the servers on the list.  The
clerk then receives these time values and uses them to compute a new system
time for its client system.
.iX "-]" "DTS" "clerks" "about"
.H 3 "Servers"
.P
.iX "-[" "DTS" "servers" "about"
Servers provide many of the communications and synchronization functions for 
DTS.  Like clerks, they import information about other servers from LAN
and cell profiles.  Servers, however, also export bindings to their own CDS
namespace entries and export their names to the LAN and cell profiles.  (See
the following subsections on the server subtypes for further information on how
servers are configured and located.)
.P
External time-providers can be connected to servers, which
propagate the precise time intervals they obtain from the
time-providers throughout the network.
.P
.iX "epochs" "about"
Before one server can obtain time values from another, the servers must have
the same epoch number.  Epochs divide the DTS
implementation into logically separate areas.  Servers only synchronize with
other servers that have the same epoch number.  All servers have the same
epoch number when they are created.  Infrequently, you may wish to change a
server's epoch number, using the management interface, to isolate it from
the network in order to correct a problem.
.H 4 "The Local Server Set"
.P
.iX "local" "servers"
Local servers reside on the same LAN and maintain their clocks
by synchronizing with each other.  Due to the high throughput on this type of
network, the skews between the local servers on a LAN are normally maintained
at under 200 milliseconds.  If at least one of the servers in the local set
synchronizes with an accurate time-provider, inaccuracies at each
server may be less.
.P
When a server is first initialized, it exports its binding to its entry in the
namespace and adds its name entry to the LAN profile.  Every server is
automatically entered in the LAN profile for the related portion of the
network.  Local servers also import bindings from the LAN profile to build
lists of servers with which they can synchronize.
.P
.ne 7
Local servers perform time interval computations, adjust their clocks, and
provide time values to each other for synchronization purposes.  Each server
attempts to synchronize with every other server in the local set at periodic
intervals.  At longer intervals, clerks request time values from the local
servers.  Clerks, however, need only to request intervals from the number of
servers determined by the \*Lminservers\*O attribute, which is usually a
subset of all the local servers.
.H 4 "The Global Server Set"
.P
.iX "global servers"
Local servers are available only to the servers and clerks that
are in a single LAN, but global servers are available throughout a cell.  Any
server can be configured as either a local or a global server (See the DCE
control program \*Ldts configure\*O command).  The number of
global servers is usually small, but global servers have several important
functions that enable DTS to synchronize every node in the network.  Global
servers are necessary in the following situations:
.ML
.LI
When a network has multiple LANs or an extended LAN
.LI
When systems that are not on LANs have access to LANs through
point-to-point links
.LI
When clerks or local servers cannot access the required number of local
servers determined by the \*Lminservers\*O attribute
.LE
.P
You can reconfigure a local server as a global
server by using the \*Ldcecp\*O \*Ldts configure\*O command
with the \%\*L-global\*O option.  Configuring a server as a global server
causes the server to export its binding to its entry in the namespace
and its name to the cell profile.
.P
Local servers and clerks request time values from global servers when they
cannot obtain the number of local server responses that are mandated by the
\*Lminservers\*O attribute.  Certain local servers also regularly request
the time from global servers.  See the following
subsection.
.nL
.ne 8
.H 4 "Couriers"
.P
.iX "couriers" "about"
Local servers called \*Ecouriers\*O request time values from one randomly
selected global server at every synchronization.  When DTS starts up,
it automatically sets the server's \*Lcourierrole\*O attribute value to
\*Lbackup\*O.  You can change the server's courier role by manually changing
this attribute value.  To do this, you use the \*Ldcecp\*O \*Ldts modify\*O 
command with the \%\*L-change\*O option.  If a server is connected to an 
external time-provider, you want to reconfigure it as a courier.
.P
Couriers maintain lists of global servers whose bindings they import from the
cell profile.  At every synchronization, couriers use the responses of all
local servers and one global server when synchronizing their own
clocks.  Couriers provide network-wide synchronization through the following
procedure:
.AL
.LI
Couriers request time values from at least one global server in a remote
area and request the balance of values from local servers up to the number
determined by the \*Lminservers\*O attribute.
.LI
Couriers use the global server times and local server times to
synchronize the clocks that are in their respective systems.
.LI
Couriers relay newly computed clock times to other servers and clerks on
the LAN during future synchronizations.
.LE
.P
For a network containing multiple LANs or point-to-point links, one server
on each LAN or segment needs to be configured as a courier.  This configuration
ensures that various portions of the network remain synchronized and are not
isolated from each other.
.P
Using the management interface, you can also designate one or more servers to
be backup couriers.  These local servers temporarily assume courier
functions in the event that no courier servers are available on the LAN.  In
such a case, the backup courier with the lowest ordered Universal Unique
Identifier (UUID) regularly synchronizes with global servers until a courier is
again available.
.P
If a courier cannot find any global server, then it uses local
servers and increments its \*Lno global server detected\*O count.
.iX "-]" "DTS" "servers" "about"
.iX "-]" "DTS" "how it works"
...\"
...\".H 2 "Interoperation with CDS"
...\" .P
...\".iX "CDS" "use by DTS"
...\".iX "servers" "global " "discovery of"
...\".iX "namespace (CDS)"
...\".iX "objects (CDS)"
...\".iX "CDS" "objects"
...\"The DCE Cell Directory Service (CDS) provides a
...\"network-wide registry called a \*Lnamespace\*O, which stores the names
...\"and characteristics of many types of network resources. 
...\"DTS server names are maintained as objects in the
...\"CDS namespace.  For further information about 
...\"CDS and namespace objects, see the CDS section in the 
...\"\*(Ac.
...\"

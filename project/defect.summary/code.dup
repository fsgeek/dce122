CR Number                     : 13476
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : key_mgmt
Short Description             : keytab can get out of sync with rgy
Reported Date                 : 5/22/96
Found in Baseline             : 1.1
Found Date                    : 5/22/96
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 13433
Fix By Baseline               : 1.2
Fixed In Baseline             : 
Affected File(s)              : security/client/key_mgmt/keymgmt.c
Sensitivity                   : public

[5/22/96 public]

If the sec_rgy_acct_passwd fails (because the rgy is unavailable, etc.),
sec_key_mgmt_change_key can make the keytab file get out of sync.  That is,
the new key is entered in the keytab file but not in the registry.

The diff below causes sec_key_mgmt_change_key to back the key out of the
keytab file if the rgy update fails.

*** security/client/key_mgmt/keymgmt.c
--- 12.7        1996/04/16 20:07:49
***************
*** 361,370 ****
--- 373,399 ----
 
                      /* Set the key in the registry */
                      if (GOOD_STATUS(err)) {
+                       /* In case sec_rgy_acct_passwd mucks with next_vno,
+                        * which it is entitled to do.
+                        */
+                       unsigned32 n_kvno = next_vno;
+
                          sec_rgy_acct_passwd(rgy_h, &login_name, oldkey,
                                              (sec_passwd_rec_t *) keydata,
                                              sec_passwd_des, &next_vno, err);
                          sec_key_mgmt_free_key(oldkey, &lst);
+                       if (BAD_STATUS(err)) {
+                           /* If setting the key in the rgy failed, remove
+                            * the key from the keytab also.  This is
+                            * guaranteed not to wipe out a key that was valid
+                            * before we were called, because if next_vno were
+                            * valid then, the sec_key_mgmt_set_key call above
+                            * would have failed.
+                            */
+                           sec_key_mgmt_delete_key(authn_service, arg,
+                                                   principal_name, n_kvno,
+                                                   &lst);
+                       }
                      }
                  }
              } /* set_key succeeded */

[5/22/96 public]
Uhhh. Duplicate of CR13433 by cox@transarc.com. Must be your evil twin. :-)

Fixed here already. It should go into 1.2.2.



CR Number                     : 13408
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : dfam
Subcomponent Name             : 
Short Description             : Unexpected behavior of stat system call
Reported Date                 : 3/27/96
Found in Baseline             : 1.2.1
Found Date                    : 3/27/96
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 13406
Fix By Baseline               : 
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[3/27/96 public]

The DFAM CHO execution has surfaced an issue w.r.t. the behavior of the 'stat'
system call.  Transarc is waiting on more debug information from Hitachi in 
order to continue.  See below email dialogue:

>From yamaur_t@soft.hitachi.co.jp Mon Mar 25 05:24:20 1996
From: yamaur_t@soft.hitachi.co.jp
Subject: Re: Re: A bug in DFS ?? (which caused DFAM failure ?)
To: cfe+@transarc.com, susan@osf.org, Vikram_Biyani@transarc.com
Date: Mon, 25 Mar 96 19:04:37 JST
Cc: mcg@osf.org, marty@osf.org, nick@alphaville.osf.org, mstaff@osf.org,
        dce12-pm@osf.org, Jason_Gait@transarc.com
Mailer: Elm [revision: 70.85]

> >             He looked into the DFAM trace file to find that an unexpected
> >      behavior of the stat system call seems to have triggered the DFAM
> >      failure.  The DFAM trace file showed that the stat system call was
> >      issued to a DFS (LFS) file (not a UNIX file), and the issued system
> >      call sometimes waited for 2 hours before it stopped and reported a
> >      connection time out error.  The previous spec of the stat system
> >      call, however, was that it waits only for 5 minutes, then issues a
> >      connection time out error.
> 
> The ``dfstrace'' output from the DFS cache manager would be useful in
> determining just what was going on here.  Without that I can only
> speculate as to the possible causes.
> 
> The DFS CM sets a 10-minute timeout for each RPC that it makes to the
> file server, so that if a call does not complete in that interval, the
> calling thread will continue with the timeout signal.  Furthermore, if
> the CM does not receive a response from the dfsbind helper process
> within three minutes, the CM thread will continue with an error
> indication.  If a second client holds conflicting tokens but is
> unreachable due to a network partition, after two minutes the tokens
> will be preemptively revoked and our client will be able to continue.
> 
> However, there are several circumstances that will cause a thread to
> retry an operation for an unbounded interval; these are in general
> controlled by the result of the cm_Analyze() routine in
> src/file/cm/cm_rrequest.c.  The usual causes of these long (but
> interruptible) retry sequences are that the fileset on which the
> operation is being performed is involved in some long-lived
> administrative activity.  It is conceivable, for instance, that moving a
> very large, actively-updated fileset from server to server across a slow
> link might delay a client this much.  Initial replica propagation might
> conceivably take this long, as well.  Of course, these delays and
> retries should have resulted in the eventual success of the call, not in
> a connection timeout.
> 
> In any case, I am unaware of any specification for the stat() system
> call that claims it will wait for only five minutes before declaring a
> failure.  If there was a two-hour delay, it is worth trying to
> understand why that delay was occurring, particularly if it ultimately
> fails.  I would recommend the output of dfstrace and the console log as
> being relevant to this further diagnosis.


            Thank you very much for the detailed diagnosis.  For
     your information, we did not use the replica when we were
     running DFAM 48 CHO (FYI, the DFAM Agent is a client of DFS).


> 
> >             DFAM generates a process in every 2 to 3 seconds.  If the
> >      stat system call waits for 2 hours, the number of the generated
> >      process goes up to 3,000, and this can easily cause the shortage
> >      of memory, which stops the DFAM 48 CHO.
> >
> >             The questions we would like to ask the DFS engineers are:
> >
> >      Q1: Has the spec of the stat system call issued against DFS files
> >          been changed so that the system call waits for 2 hours ?
> 
> As above: I am unaware of any such specification.  However, the RPCs
> that the DFS CM generates are made with two timeouts:
>     - the comm_timeout of (default+2), or about 2.5 minutes
>     - the call_timeout of ten minutes
> Either of these could result in an ETIMEDOUT value in errno.
> 
> >      Q2: If yes, Why ?
> >
> >      Q3: If no, could you please check the system call ?
> 
> I would be happy to investigate the trace and console output....



            Thank you very much.  Here is a question on how to use 
     dfstrace.  

            We executed the dfstrace command to get the information 
     listed as "Attachment 1," which we cannot find out what it 
     actually means.  We think the trace information should have 
     the format listed as "Attachment 2."  Do we need special setting
     to get the proper trace information (you can assume that the 
     NLS path was properly set) ?



--------------------------  Attachment 1  -----------------------------
DFS Trace Dump -

   Date: Mon Mar 25 15:26:54 1996

Found 1 logs.

Contents of log cmfx:
Log wrapped; data missing.
raw op 29c9c088, time 332.974613, pid 27825
p0:0x5d0e390
raw op 29c9c0dc, time 332.974620, pid 27825
p0:0
raw op 29c9c001, time 332.974636, pid 27825
p0:0x5d0e390 p1:dir
raw op 29c9c03c, time 332.974647, pid 27825
p0:0x5d0e390 p1:dir
raw op 29c9c0ec, time 332.974654, pid 27825
p0:0x5d0e390 p1:1028
raw op 29c9c002, time 332.974665, pid 27825
p0:0x5d0e390 p1:1107296240
raw op 29c9c003, time 332.974672, pid 27825
p0:63
-----------------------------------------------------------------------------



-------------------------  Attachment 2  -------------------------------------
DFS Trace Dump -

   Date: Mon Mar 25 15:33:01 1996

Found 2 logs.

Contents of log disk:

Contents of log cmfx:
Log wrapped; data missing.
time 917.440039, pid 5771: checkerror returning code 0
time 917.440040, pid 5771: inactive vp 165c650
time 917.440041, pid 5771: cm_lookup 16542b0 dirb
time 917.440042, pid 5771: gettokens vp 16542b0, rights.low 0x404
time 917.440048, pid 5771: nh_dolookup dvp 16542b0, name dirb
time 917.440049, pid 5771: gettokens vp 16542b0, rights.low 0x404
time 917.440053, pid 5771: cm_GetScache vp 165c650, volume.low 0x1, vnode 0x1bfe

time 917.440056, pid 5771: found fid d04f7878.1.1bfe.0 (hex)
time 917.440057, pid 5771: lookup returning vp 165c650

-----------------------------------------------------------------------------

> 
>From cfe+@transarc.com Mon Mar 25 11:41:18 1996
Date: Mon, 25 Mar 1996 11:40:16 -0500 (EST)
From: Craig_Everhart@transarc.com
To: susan@osf.org, Vikram_Biyani@transarc.com, yamaur_t@soft.hitachi.co.jp
Subject: Re: A bug in DFS ?? (which caused DFAM failure ?)
Cc: mcg@osf.org, marty@osf.org, nick@alphaville.osf.org, mstaff@osf.org,
        dce12-pm@osf.org, Jason_Gait@transarc.com

Excerpts from mail: 25-Mar-96 Re: Re: A bug in DFS ?? (wh..
yamaur_t@soft.hitachi.co (5671)

>             We executed the dfstrace command to get the information 
>      listed as "Attachment 1," which we cannot find out what it 
>      actually means.  We think the trace information should have 
>      the format listed as "Attachment 2."  Do we need special setting
>      to get the proper trace information (you can assume that the 
>      NLS path was properly set) ?

Thanks very much for your follow-up message.  Indeed, I would expect
that dfstrace output would look like ``Attachment 2'' rather than like
``Attachment 1''.  The dfstrace program simply calls
dce_error_inq_text() to find the interpretation of the 32-bit ``raw op''
value for the trace code.  The message catalogs that are to supply the
text strings for dfstrace should be installed as files named dfszXX.cat,
for some two characters XX.  Perhaps these are not installed in the
environment in which dfstrace is run, as local root, with what you're
using for LANG and NLSPATH.  (I doubt that these catalogs would have
been translated into Japanese, for example.)  These are the old-style
catalogs, generated with the compile_et tool rather than with the sams
tool.

I don't know what will make these catalogs available in your
environment.  If all else fails, it might be necessary to set LANG to C
or en_US or some such.  Certainly your ``Attachment 2'' formatting looks
just fine, and I don't know why your ``Attachment 1'' doesn't look like
``Attachment 2'' other than what I've told you.

I hope that this helps isolate the problem with dfstrace, and I'm sorry
that it isn't working correctly for you yet.

Once you obtain the trace information in the correct format, you might
be able to do some of the log analysis yourself, if you wish.  The
dfstrace information is kept in kernel memory in a circular log. 
Dfstrace controls the size of this log; you can examine it with the
``dfstrace lslog'' sub-command and you can set it with the ``dfstrace
setlog'' sub-command.  The default cmfx log size might only contain a
few minutes' worth of information for a busy cache manager, so you may
wish to increase the log size before trying to reproduce this stat()
problem--but of course the fact that the log is in kernel memory will
limit the log size.  After a test fails, you might wish immediately to
execute ``dfstrace setset -inactive'' which will stop all additional
logging, preserving the existing log contents until ``dfstrace dump''
could be executed.

Ideally, the result log would show how an error condition would evolve,
ultimately seeing both the beginning of the CM's vnode operation to the
end where it returns the error code that is passed to your test as an
errno value that you do not expect.

                Craig
>From yamaur_t@soft.hitachi.co.jp Tue Mar 26 01:24:10 1996
From: yamaur_t@soft.hitachi.co.jp
Subject: Re: Re: A bug in DFS ??
To: cfe+@transarc.com
Date: Tue, 26 Mar 96 15:23:08 JST
Cc: mcg@osf.org, marty@osf.org, mstaff@osf.org, dce12-pm@osf.org,
        nick@alphaville.osf.org, Vikram_Biyani@transarc.com,
        Jason_Gait@transarc.com
Mailer: Elm [revision: 70.85]

     Dear Craig:

            Thank you very much for your quick suggestions.
     Now the trace command works.  We are trying to reproduce
     the memory shortage.  We will send you the trace file 
     when we catch the problem.

                                  Thank you very much again.
                                  Tsuneo Yamaura



CR Number                     : 13401
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : 
Short Description             : preauth event is not logged
Reported Date                 : 3/22/96
Found in Baseline             : 1.1
Found Date                    : 3/22/96
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 12526
Fix By Baseline               : 
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[3/22/96 public]

Pre-authentication event (success/failure) is not logged for the secd.
There is an event defined for dce_sec_authent event class: TGS_ValidateReq,
but it does not appear in any place of a secd's trail file.

To see the problem, create an account with preauth era set to 2. Then dce
login with a bad password. The login will fail, but you won't see anything
from the secd's trail.

[3/22/96 public]
This is NOT audit problem.  In order to record the Preauth events, two things
needs to be done in security codes:
   1) Enable the flag: DCE_AUD_POINT. This flag has been disabled since DCE1.1
   2) Calling the Audit APIs (dce_aud_start* and dce_aud_committ) with the right
      parameteres.  

I beleive that HP is trying to support it now.  This is a DUP of 12526 and another
just was opened recently by HP. Please cancel it.

[3/22/96 public]
Indeed, this is not an audit problem, but the secd as an audit cleint.
Marked it as dup of 12526.

Well, I tried to cancel it, but I don't know what to put for responsible 
engineer field. I will leave it to the sec component owner to cancel it.



CR Number                     : 13334
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : aud
Subcomponent Name             : 
Short Description             : dce_aud_next() TIME predicate.
Reported Date                 : 2/19/96
Found in Baseline             : 1.1
Found Date                    : 2/19/96
Severity                      : B
Priority                      : 0
Status                        : dup
Duplicate Of                  : 13312
Fix By Baseline               : 1.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[2/19/96 public]

The man page says that the operators for the time predicate are
= > <.  In the code, they really are just :> and :<. 

Suggested fix:

Diffing Delta aswini-17366-sec-aud-dce_aud_next-time-pred 1.2
==============================================================================
File: security/audit/libaudit/evt_read.c
===================================================================
RCS file: RCS/evt_read.c,v
retrieving revision 12.4
retrieving revision 12.8
diff -c -r12.4 -r12.8
***************
*** 143,151 ****
      unsigned32      authz_status;
      unsigned32      evt_id, evt_outcome;
      unsigned32      rec_start_pos;
!     utc_t           before_time, after_time;
      uuid_t          server_uuid, client_uuid, cell_uuid, group_uuid;
!     boolean32       check_evt, check_outcome, check_authz_status, check_time_before, check_time_after, check_server, check_client, check_cell, check_group, check_addr;
      unsigned_char_t *addr;
      enum utc_cmptype time_relation;
      char             *local_predicate = NULL;
--- 161,169 ----
      unsigned32      authz_status;
      unsigned32      evt_id, evt_outcome;
      unsigned32      rec_start_pos;
!     utc_t           before_time, after_time, at_time;
      uuid_t          server_uuid, client_uuid, cell_uuid, group_uuid;
!     boolean32       check_evt, check_outcome, check_authz_status, check_time, check_time_before, check_time_after, check_server, check_client, check_cell, check_group, check_addr;
      unsigned_char_t *addr;
      enum utc_cmptype time_relation;
      char             *local_predicate = NULL;
***************
*** 159,165 ****
      *status = aud_s_ok;
      *ard = NULL;
  
!     check_evt = check_outcome = check_authz_status = check_time_before
        = check_time_after = check_server = check_client = check_cell
        = check_group = check_addr = FALSE;
  
--- 177,183 ----
      *status = aud_s_ok;
      *ard = NULL;
  
!     check_evt = check_outcome = check_authz_status = check_time = check_time_before
        = check_time_after = check_server = check_client = check_cell
        = check_group = check_addr = FALSE;
  
***************
*** 205,210 ****
--- 223,231 ----
        } else if (strncmp(local_predicate, "TIME:<", strlen("TIME:<")) == 0) {
            utc_mkasctime(&before_time, local_predicate + strlen("TIME:<"));
            check_time_before = TRUE;
+       } else if (strncmp(local_predicate, "TIME:=", strlen("TIME:=")) == 0) {
+           utc_mkasctime(&at_time, local_predicate + strlen("TIME:="));
+           check_time = TRUE;
        } else if (strncmp(local_predicate, "SERVER:", strlen("SERVER:")) == 0) {
            uuid_from_string((unsigned_char_t *)local_predicate + strlen("SERVER:"), &server_uuid, status);
            check_server = TRUE;
***************
*** 252,257 ****
--- 273,282 ----
        DCE_SVC_DEBUG((aud_svc_handle, aud_s_msgs, svc_c_debug1,
            "dce_aud_next: Check time after\n"));
      }
+     if (check_time) {
+       DCE_SVC_DEBUG((aud_svc_handle, aud_s_msgs, svc_c_debug1,
+           "dce_aud_next: Check at time\n"));
+     }
      if (check_server) {
        DCE_SVC_DEBUG((aud_svc_handle, aud_s_msgs, svc_c_debug1,
            "dce_aud_next: Check server\n"));
***************
*** 391,396 ****
--- 416,428 ----
      if (check_time_after) {
        utc_cmpintervaltime(&time_relation, &header->time, &after_time);
        if (time_relation == utc_lessThan) {
+           goto next_record;
+       }
+     }
+     if (check_time) {
+       utc_cmpintervaltime(&time_relation, &header->time, &at_time);
+       if ((time_relation != utc_equalTo) && 
+           (time_relation != utc_indeterminate)) {
            goto next_record;
        }
      }

[02/19/96 public]
The complete fix for all predicate values have been submitted in 13312.
Please cancel this OT as a DUP. Thanks.

[2/19/96 public]

13312 does not take care of the case where predicate is "TIME=value" or "TIME:=".
Also are  "TIME:<" ,"TIME=<" and "TIME<" are same? Does this apppy to > and = as
well? Could you clarify this?

[2/19/96 public]
To my knowledge, the operator colon ":"  meant "equal to" and it has been using
in some DCE 1.1 applications.  Therefore, I don't want to remove or change it to
"=". I instead added to recognize the equal sign "=", too.  That meant:

  o : or = means equal to
  o < means less than
  o > means greater than
  o :> or => means greater than or equal to
  o :< or =< means less than or equal to

Since we don't know exactly what time the event is recorded in advance,
"TIME=value" or "TIME:value" is not practical search.  So, I treated 
TIME a little bit difference from the others to cover all operators, i.e 

  o TIME<value
  o TIME>value
  o TIME:<value or TIME=<value (cover the "equal to")
  o TIME:>value or TIME=>value (cover the "equal to") 

Once this is merged, I'll ask to change the man page for TIME.

[02/19/96 public]
This is the first time I can recall hearing : used for =.
As for syntax, I think <= and >= are the more-common notations.

[2/19/96 public]

>[trant 2/19/96 public]
>Since we don't know exactly what time the event is recorded in advance, 
>"TIME=value" or "TIME:value" is not practical search.  So, I treated 
>TIME a little bit difference from the others to cover all operators, i.e 

It is possible to know the time event is recorded. One can store the time
when an event is recorded in the first pass and use this time to position 
at the record that time in the next pass.  Infact one of Transarc's customer 
is doing this. I think "TIME=value" is practical.

[2/20/96 public]
That's what previous onwer and I thought about the exactly time search. Since
we don't know exactly time in advance, using =< (before) or => (after) make 
more sense than = (at). 

Do you know why the customer wants to use "dcecp audtrail show" to record 
the time then use it to search in the next pass ??? What advantages ??? 

By the way, if you look at EVENT, SERVER, OUTCOME, STATUS, CLIENT, CELL, GROUP,
and ADDR attribute, the only valid operator is : (in codes) and = (in man pages). 
However, they meant the same, i.e "equal to". I don't know the history behind
them. But I was told to leave : as it is and add = to match the man pages.

I am afraid that your suggestion "TIME:=" is not proper syntax. ":=" is not 
meant "equal to" because it is not consistent with "equal to" operator of the
other attributes.

[2/20/96 public]

It can be used to monitor an audit trail. When you reach the end of the event file note down the time and close the audit trail file.  When you want to start
again use the time noted down to advance the pointer to previous last rec..
and continue processing again.

[2/20/96 public]
If this is the case, would it be better to use dce_aud_prev()???. Its syntax is 
exactly the same as dce_aud_next().  The only difference is that next returns
the next record whereas prev() returns the previous one. I supplied dce_aud_prev()
via OT 11175. You may want to ovoid opening/closing the Audit file so often. It'll  
impact the performance when the file is getting big.

[2/20/96 public]
OK. I am happy with dce_aud_prev()/dce_aud_next() combination. Thanks.
canceling this OT.



CR Number                     : 13138
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : aud
Subcomponent Name             : auditd & libaudit
Short Description             : missing sec_rgy_site_close
Reported Date                 : 10/3/95
Found in Baseline             : 1.1
Found Date                    : 10/3/95
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 13024
Fix By Baseline               : 1.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[10/3/95 public]

While investigating on memory leak in DCE, we found the leaks
in several Audit codes.  The leaks are caused by missing API
sec_rgy_site_close() and not freeing the variables at the end.

[10/3/95 public]

Is this OT talking about the same thing as 13024? If you have additional
fixes please put it under OT 13024. Please mark this a dup of 13024
if you don't mind putting fixes in that OT. Thanks.

[10/4/95 public]
Yeah, this is a dup of 13024.  I will put the fixes in 13024.



CR Number                     : 13105
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : kdc
Short Description             : kinit -f crashes secd.
Reported Date                 : 9/7/95
Found in Baseline             : 1.1
Found Date                    : 9/7/95
Severity                      : B
Priority                      : 0
Status                        : dup
Duplicate Of                  : 12909
Fix By Baseline               : 1.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[9/7/95 public]

kinit -f crashes secd. 
This is because arguments to against_flag_policy_tgs() in security/krb5/kdc/kdc_util.c are incorrect.

Suggested  fix:
*** 12.3        1995/05/15 21:50:05
--- kdc_util.c  1995/09/07 14:28:39
***************
*** 1747,1755 ****
       * Check local policy
       */
  #ifdef OSF_DCE
!     errcode = against_flag_policy_tgs(request, server, ticket, status);
  #else
!     errcode = against_local_policy_tgs(request, server, ticket, status);
  #endif
      if (errcode)
        return errcode;
--- 1755,1763 ----
       * Check local policy
       */
  #ifdef OSF_DCE
!     errcode = against_flag_policy_tgs(request, ticket);
  #else
!     errcode = against_local_policy_tgs(request, ticket);
  #endif
      if (errcode)
        return errcode;



CR Number                     : 13027
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : sec
Subcomponent Name             : rs
Short Description             : Free problems and memory leaks in rpriv_triggers
Reported Date                 : 6/28/95
Found in Baseline             : 1.1wp
Found Date                    : 8/7/95
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 12774
Fix By Baseline               : 1.2
Fixed In Baseline             : 
Affected File(s)              : 
security/server/rs/rpriv_attr.c
Sensitivity                   : public

[8/7/95 public]

In the rpriv triggers function there are 2 problems.  If the call to
priv_attr_trig_alloc_delegate_ids() fails then the function just returns and
does not free the processed variable.  The second problem is that inside
a for loop at the bottom of the function they call free(processed) on each 
iteration of the for loop.  I would assume that they should free this outside
of the loop before they fall off the end of the function.

========================================================================
src/security/server/rs/rpriv_attr.c     Revision 1.1.6.1
========================================================================
***************
*** 379,384 ****
--- 379,385 ----
      }

      if (BAD_STATUS(st_p) || done) {
+       free(processed);
        return;
      }

***************
*** 422,429 ****
                }
            }
          }
-     free (processed);
      }
  }


  /* r p r i v _ a t t r _ g e t _ e f f e c t i v e
--- 423,430 ----
                }
            }
          }
      }
+     free (processed);
  }

  /* r p r i v _ a t t r _ g e t _ e f f e c t i v e

[8/7/95 public]

This a duplicate of 12774.



CR Number                     : 13017
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : sec
Subcomponent Name             : server
Short Description             : Unable to establish delegation context
Reported Date                 : 8/4/95
Found in Baseline             : 1.1wp
Found Date                    : 6/12/95
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 12770
Fix By Baseline               : 1.2
Fixed In Baseline             : 
Affected File(s)              : 
src/security/server/rs/rpriv_util.c
src/security/server/rs/rpriv_v1_1_mgrs.c
Sensitivity                   : public

[8/4/95 public]

The 2 routines in question are parse_delegation_token() and 
rpriv_util_get_ps_eblock().  The declarations are:


PRIVATE  void  parse_delegation_token (
    sec_encrypted_bytes_t  *delegation_token,  /* [in] */
    krb5_encrypt_block     *skey_eblock,       /* [in] */
    unsigned32             *token_expiration,  /* [out] */
    sec_id_seal_t          *seal,              /* [out] */
    error_status_t         *stp                /* [out] */
)


*****NOTE: Pre Warranty-Patch version *****
extern  void  rpriv_util_get_ps_eblock (
    krb5_enctype         etype,      /* [in] */
    krb5_kvno            req_kvno,   /* [in] */
    krb5_encrypt_block   *ps_eblock, /* [out] */
    krb5_kvno            *ps_kvno,   /* [out] */
    error_status_t       *stp        /* [out] */
)
{
        .
        .               
    <large local variable omitted>
    <other locals omitted>
        .
        .
    krb5_keyblock         ps_key;      <<-- NOTE: local var


parse_delegation_token() calls rpriv_util_get_ps_eblock() passing
a pointer to ps_eblock.  The problem is that in 
rpriv_util_get_ps_eblock(), at the end of the routine, it sets 
ps_eblock->key to &ps_key (using the routine krb5_process_key(), otherwise
known as mit_des_process_key()):  

    krb5_use_cstype(ps_eblock, etype);
    *stp = krb5_process_key(ps_eblock, &ps_key);
    if (!STATUS_OK(stp)) {
        memset(ps_key.contents, 0, ps_key.length);
        free(ps_key.contents);
    }

This means that the parent routine, parse_delegation_token(), 
now has a local data structure (ps_eblock) which has a 
field (ps_eblock.key) that points to a piece of data that
was local to a rpriv_util_get_ps_eblock().  Of course, after
rpriv_util_get_ps_eblock() returns, then that block of mem on the stack
that *WAS* ps_key is going to be blown away if the stack grows enough
between the time rpriv_util_get_ps_eblock() returns and the last time
in parse_delegation_token that ps_eblock is used.  Unfortunately, 
parse_delegation_token calls rpc_ss_allocate() before it calls
mit_des_decrypt_func(), which gets a pointer to ps_eblock passed in
and uses ps_eblock->key to try generate a checksum to verify the 
decrypt operation.  This is where the failure is detected.
The success or failure of the routine really, in essence, depends upon
how far down the stack ps_key gets allocated, and how deep the stack
grows between the time rpriv_util_get_ps_eblock() returns and the next
call to a function that uses ps_eblock.key.  In the unoptimized case,
ps_eblock is still OK before the call to rpc_ss_allocate() and is hosed
afterward.  In the optimized case, ps_eblock remains OK.

=============================================================
src/security/server/rs/rpriv_util.c
=============================================================
***************
*** 526,535 ****
      int                   num_db_entries = 1;
      krb5_boolean          dup;   /* duplicate principal entries? */
      krb5_db_entry         ptgt_entry;
!     krb5_keyblock         ps_key;

!     memset(&ps_key, 0, sizeof(ps_key));

      /* get the principal data for the local realm */
      dce_cf_get_cell_name((char **) &cell_name, stp);

--- 526,540 ----
      int                   num_db_entries = 1;
      krb5_boolean          dup;   /* duplicate principal entries? */
      krb5_db_entry         ptgt_entry;
!     krb5_keyblock         *ps_key;

!     if (!(ps_key=malloc(sizeof(krb5_keyblock)))) {
!         *stp=sec_s_no_memory;
!         return;
!     }

+     memset(ps_key, 0, sizeof(ps_key));
+
      /* get the principal data for the local realm */
      dce_cf_get_cell_name((char **) &cell_name, stp);

***************
*** 553,568 ****
      }

      *ps_kvno = ptgt_entry.kvno;
!     *stp = KDB_CONVERT_KEY_OUTOF_DB(&ptgt_entry.key, &ps_key);

      /* done with ptgt_entry, in any case */
      krb5_db_free_principal(&ptgt_entry, num_db_entries);

      krb5_use_cstype(ps_eblock, etype);
!     *stp = krb5_process_key(ps_eblock, &ps_key);
      if (!STATUS_OK(stp)) {
!       memset(ps_key.contents, 0, ps_key.length);
!       free(ps_key.contents);
      }
  }
  /* r p r i v _ u t i l _ g e t _ k r b _ r e q _ i n f o
--- 558,573 ----
      }

      *ps_kvno = ptgt_entry.kvno;
!     *stp = KDB_CONVERT_KEY_OUTOF_DB(&ptgt_entry.key, ps_key);

      /* done with ptgt_entry, in any case */
      krb5_db_free_principal(&ptgt_entry, num_db_entries);

      krb5_use_cstype(ps_eblock, etype);
!     *stp = krb5_process_key(ps_eblock, ps_key);
      if (!STATUS_OK(stp)) {
!       memset(ps_key->contents, 0, ps_key->length);
!       free(ps_key->contents);
      }
  }
  /* r p r i v _ u t i l _ g e t _ k r b _ r e q _ i n f o
***************
*** 1471,1476 ****
--- 1476,1482 ----
                                &ps_eblock,
                                0);
            krb5_finish_key(&ps_eblock);
+           free(ps_eblock.key);
        }
        if (STATUS_OK(stp)) {
            TOKEN_VNO(token_bytes) = 0;


=============================================================
src/security/server/rs/rpriv_v1_1_mgrs.c
=============================================================
***************
*** 294,299 ****
--- 294,301 ----
      if (!STATUS_OK(stp)) {
        return;
      }
+
+     free(ps_eblock.key);

      /*
       * scratch now contains a 4-byte big-endian timestamp, followed

[8/28/95 public]

This looks like a dup of 12770. Unless HP objects, I'll assume that
the fix proposed in 12770 overrides this one.

[10/3/95 public]

After merging the fixes proposed by 12770 and this defect 13017 (as shown
in OT 12770 report), its concluded that this defect is not total dup of 12770.
Since 12770 now shows additional change proposed by this defect, I'm leaving
this as dup of 12770.



CR Number                     : 13013
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : klist
Short Description             : klist performance poor if
creds expired
Reported Date                 : 8/3/95
Found in Baseline             : 1.1
Found Date                    : 8/3/95
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 12930
Fix By Baseline               : 1.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[8/3/95 public]

The performance of klist is extremely poor when the credentials
have expired.  This is not a problem on 1.0.3.  In 1.1, the calls
to sec__id_gen_name for some reason result in rca_site_bind
being called many dozens of times.  In 1.0.3 rca_site_bind gets called
perhaps two or three times.  

Part of the 1.1 problem is that rca_site_bind gets called twice inside 
a deep stack, that probably involves loops on multiple protocols.
First, rca_site_bind gets called by rca_create_default_context,
and eventually calls down to rpc_binding_set_auth_info, and 
sec_priv_get_eptgt, which in turn calls rca_site_bind yet again.

This is a problem for klist, but it might point to a general problem
with rca_site_bind.  This would be more serious.

[8/3/95 public]

I also saw klist taking extremely long time on 1.1wp+ build when I was
testing 'dce_login -r' command option. As described this happens when
the credentials have expired.

[8/3/95 public]
We were seeing these same problems until we fixed a bad merge to some Kerberos
code.  The fix to the merge has been documented in OT 12930 for a while now,
so I'm dup'ing this CR to 12930.



CR Number                     : 13001
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 12791, 13002
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : sec
Subcomponent Name             : 
Short Description             : Trap/Illegal instr in read_context_raw
Reported Date                 : 8/2/95
Found in Baseline             : 1.1wp
Found Date                    : 6/12/95
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 13002
Fix By Baseline               : 1.2
Fixed In Baseline             : 1.1maint
Affected File(s)              : security/client/login/sec_login_pvt.c
Sensitivity                   : public

[8/2/95 public]

The problem is that sec_login_pvt_free_login_context calls free_krb_info before
it calls sec__id_free_cache, but sec_login_pvt_gen_export_token is calling
krbg_cc_get_name, which really is a macro that uses the krb_info field to
find the get_name function, i.e. lcp->krb_info.cache->ops->get_name
Since the krb_info structure was wiped out by free_krb_info, the ops pointer is
null, and we end up dereferencing several null pointers to come up with an
address of zero for get_name, and when we call to address zero, we get the
illegal instruction.

There were still some problems in the DCE code relating to the problem
where we were branching to 0 in read_context_raw.  In the function
read_context_raw we should check if(KRB_INFO(lcp).cache == NULL)
and if so set status to sec_login_s_no_current_context and 
return

=============================================================
src/security/client/login/sec_login_pvt.c
=============================================================
***************
*** 1209,1216 ****
  {
      assert (lcp->refcount == 0);
      if (lcp != NULL) {
-         free_identity(&lcp->identity);
-         free_krb_info(&lcp->krb_info);
          if (lcp->context_name)
              free(lcp->context_name);
          if (lcp->namecache_name)
--- 1209,1214 ----
***************
*** 1217,1222 ****
--- 1215,1223 ----
              free(lcp->namecache_name);
          if (lcp->namecache)
              sec__id_free_cache(lcp);
+
+         free_identity(&lcp->identity);
+         free_krb_info(&lcp->krb_info);

        /* v1.1 info */
        sec_encode_v1_1_lc_info_free(free, &lcp->v1_1_info);
***************
*** 1801,1806 ****
--- 1802,1813 ----
      CLEAR_STATUS(stp);
      if (varying) *varying = NULL;
      if (varying2) *varying2 = NULL;
+
+     if(KRB_INFO(lcp).cache == NULL)
+     {
+            SET_STATUS(stp, sec_login_s_no_current_context);
+            return;
+     }

      dfd = open(DATAFILE_NAME(datafile, KRB_INFO(lcp).cache), O_RDONLY, 0);
      free(datafile);

[11/03/95 public]
This one is actually related to 13002. For the 1.1maint, I want to fix both
with one patch and I am going to do it for 13002.

[11/13/95 public]
I am using 13002 as a place holder for 12791, 13001, and 13002. So, I am
marking this one as a dup of 13002.



CR Number                     : 12987
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 12879
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : cds
Subcomponent Name             : cdsd
Short Description             : cdsd: message catalog corrupts 
checkpoint file.
Reported Date                 : 7/25/95
Found in Baseline             : 1.0
Found Date                    : 6/23/95
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 12879
Fix By Baseline               : 1.2
Fixed In Baseline             : 1.1maint
Affected File(s)              : db_btree.c
Sensitivity                   : public

[8/22/95 public]

BEWARE: the fix included in this defect report is truncated by the ot_bugs
command. If you want to see the whole fix, use the ot -u command.

[8/2/95 public]

The following is from David Wright at Hitachi.  He believes that
OT 12879 (database index corruption after creates/deletes) will also
be fixed since the problem described in that OT is a subset of the
full problem he has submitted a fix for here.  It is not just empty
buckets that are problematic, but any time the index entry has a
value greater than any in the bucket it points to, there is trouble.


(from David Wright)
 DESCRIPTION:
 The cdsd daemon got into an mostly unusable state when a message catalog 
 corrupted the checkpoint file. 
 
 NOTE: After killing the cdsd, subsequent attempts to restart it failed with
 the following message:
 	# /opt/dcelocal/bin/cdsd 
 	Insufficient local resources (dce / cds)
 	Insufficient local resources (dce / cds)
 
 REPRODUCIBLE: Unknown
 
 TEST SOFTWARE DESCRIPTION:
 The DCE clients, ra, jazz, blues, doolie, and sybil_ne0 ran the dacl system
 tests for ~22.5 hours against sybil_ne0's CDS server. After stopping all
 of the tests on the workstations, I attempted to look into the namespace
 and the request hung. CDSBROWSER couldn't deal with expanding the namespace, 
 as well. 
 
 In the background, jazz was almost performing recursive searches of the
 namespace infinitely.
 
 DESCRIPTION OF HARDWARE WHERE BUG OCCURRED: Hitachi Mainframe VM - sybil_ne0
   NOTE: This system was running HI-OSF/1-M 1.3.0.1.bld952 with all layered
   products installed; i.e.:
 	VxFS
 	VxVM
 	VxVA
 	EpochServ-M
 	as well as DCE, of course.
 
 DESCRIPTION OF WHERE TEST SUCCESSFULLY RAN: n/a
Related-file::Added 950708 by wright:: problem analysis
 This took me a lot longer than it should have, but in any case, the
 problem is occurring because one of the directory buckets is not
 sorted.  So the code is advancing through the bucket, hits the
 out-of-order entry X, then falls back a couple of entries (to find the
 entry that follows X).
 
 All the stuck threads have tracebacks that look like this:
 
 0x2467a1b8: db_btree_locate_entry_bkt+0x24(0x252cec08, 0x251f0008, 0x2508fc08, 0x2467a4bc, 0x2467a4c4)
 0x2467a440: entry_read_next+0x146(0x252cec08, 0x0)
 0x2467a4d0: db_entry_read_next+0x3a(0x252cec08)
 0x2467a538: build_name_set+0x538(0x252cec08, 0x2467a720, 0x2467ad9c, 0x2467ae9d, 0x0, 0x3dd1, 0x0, 0x256b4230, 0x2467afa4, 0x2467a688, 0x0)
 0x2467a5e8: ta_enumerate+0x28a(0x2467a720, 0x256b4008, 0x2467ad9c, 0x2467ae9d, 0x0, 0x3fd8, 0x3, 0x2467afa4, 0x0)
 0x2467a698: cds_EnumerateChildren+0x14a(0x252d3288, 0x2467b2cc, 0x2467bb00, 0x2467bc04, 0x3fd8, 0x24038ae0, 0x2467bd10, 0x2467bd14)
 0x2467afb0: op14_ssr+0x2fa(0x252d3288, 0x252cf008, 0x2467be4c, 0x2402d67c, 0x252cf234, 0x131c790, 0x2467be9c)
 0x2467bdc0: rpc__cn_call_executor+0xa88(0x252cf008, 0x0)
 0x2467bea0: cthread_call_executor+0x35e(0x240134a4)
 0x2467bf28: _pthread_body+0x74(0x2403d108)
 
 
 The real question is how a bucket could be out of order; the bogus
 entry isn't even in the right bucket (it should be in the preceding
 bucket).  Either something overwrote an entry (not likely) or the
 bucket was somehow not constructed properly.  Either an entry was
 inserted into the wrong bucket, or a bucket split or coalesce was done
 wrong, I suppose.  There's a lot of code involved here.
 
 Anyway, this problem can be detected and cdsd can abort; I'll just
 insert an interation counter into build_name_set and if the counter
 gets too large, cdsd aborts.  10,000 ought to provide enough room.
 
Related-file::Added 950708 by wright:: more analysis
 Yeesh, it's worse than I thought.  The out-of-order entries can get
 into the checkpoint file, and I believe that cdsd just reads them
 straight back in, so it never detects the problem.  Thus, aborting on
 detecting a loop isn't much of a solution; restarting cdsd won't
 restore the situation to normalcy.
 
 So then you have a corrupted database with no way to recover.
 Ideally, we'd like to avoid the problem altogether; failing that, it'd
 be good to either have a checkpoint file repair program, or have cdsd
 detect bogus entries on input and discard them.  That's not a perfect
 solution, since it causes the name space to change without warning,
 but at least the name space would be consistent.
 
Related-file::Added 950714 by wright:: Problem analysis
 OK, here's my take on what causes the problem.  It's a problem of
 b-tree maintenance.  Specifically, there are two things that the
 b-tree code allows to happen, but should not.  (We're talking about
 the b-trees that are maintained, one per directory, to hold the
 contents of the directory.)
 
 1)  Data buckets can become empty (node_count == 0).  If there's an
 index node referencing the bucket, it is not at all clear what value
 should be in the index node.  Or, to put it another way, if a bucket
 becomes empty, it should be deleted.
 
 2)  Actually, the foregoing is a special case of a larger problem.
 Suppose a data bucket B's last entry is deleted, and there is an index
 entry pointing to B.  The index entry is now dubious, since its key
 contains a value larger than any value present in the data bucket.  If
 you do this kind of thing a few times, it's entirely possible that
 you'll wind up with a bad situation.  Specifically, suppose the bucket
 following B is split and a new index entry added for the
 smaller-valued resultant.  It's entirely possible that the key for
 this new bucket is smaller than the one for B, which will result in
 the index block now being unsorted.  This is Very Bad. 
 
 So the solution, as best I can see, is to fix up the index as needed
 when the final entry in a data bucket is deleted.  It's a pain to do,
 because the bucket from which the entry is deleted might not be
 directly indexed, and data buckets do not have upward pointers to
 their corresponding index buckets.  I've adopted the ham-handed
 approach of rechecking the entire index, which actually isn't all that
 bad as long as the database isn't that large and deletions are
 infrequent, both of which are things that should be true of CDS.
 
Related-file::Added 950718 by wright:: /build/hiosfm/RCS/dce/src/directory/cds/server/./db_btree.c,v 7.3
 /build/hiosfm/RCS/dce/src/directory/cds/server/./db_btree.c,v 7.3
 wright 1995/07/18 14:44:56 +521 -61
 Reason:  OSDqa11878 cdsd: message catalog corrupts checkpoint file
 Major fixes to btree maintenance, delete zero-entry blocks and keep
 index consistent with final entry in bucket.
 
     *** /tmp/ci.1147..db_btree.c.1188.1	Tue Jul 18 10:44:59 1995
     --- /tmp/db_btree.c.1188.2	Tue Jul 18 10:44:59 1995
     ***************
     *** 18,27 ****
     --- 18,32 ----
        * src directory for the full copyright text.
        */
       /*
        * HISTORY
        * $Log:	c012987,v $
# Revision 1.5  96/01/24  18:54:09  root
# changed fields: Interest List CC  Status  Duplicate Of  Fixed In Baseline  Responsible Engr.  Resp. Engrs Company   new/changed/deleted note(s) [jcarroll 01/24/96 public]
# 
# Revision 1.4  95/11/18  11:29:11  root
# changed fields: Interest List CC  
# 
# Revision 1.3  95/08/23  16:40:41  root
# changed fields:  new/changed/deleted note(s) [parul 8/23/95 public]
# 
# Revision 1.2  95/08/22  16:42:33  root
# changed fields:  new/changed/deleted note(s) [monzillo 8/22/95 public]
# 
# Revision 1.1  95/08/02  13:40:02  root
# new CR
# 
     +  * Revision 7.3  1995/07/18  14:44:56  wright
     +  * Reason:  OSDqa11878 cdsd: message catalog corrupts checkpoint file
     +  * Major fixes to btree maintenance, delete zero-entry blocks and keep
     +  * index consistent with final entry in bucket.
     +  *
        * Revision 7.2  1993/10/27  00:47:45  wright
        * Incorporate 1.0.3 change.
        *
        * Revision 1.1.7.1  1993/10/12  14:57:02  peckham
        * 	CR#7940: btree corruption in split_bucket_for_continuation
     ***************
     *** 243,255 ****
     --- 248,278 ----
       	if (newbkt_p->node_prev_p)					\
       	    newbkt_p->node_prev_p->node_next_p = newbkt_p;		\
       	bkt_p->node_prev_p = newbkt_p;					\
       }
       
     + #define unlink(bkt_p)                           \
     + {\
     +         node_header_t   *next, *prev;           \
     +         prev = bkt_p->node_prev_p;              \
     +         next = bkt_p->node_next_p;              \
     + 	if (next) next->node_prev_p = prev;     \
     + 	if (prev) prev->node_next_p = next;     \
     + }
     + 
       /*
        * Local prototypes
        */
     + #ifdef hitm
     + static void bomb _((
     +     int));
     + 
     + static void
     + rebuild_index _((
     +     db_stream_t *stream_p));
     + #endif
     + 
       static int
       split_points _((
           node_header_t	*bkt_p,
           unsigned int	*point1_p,
           unsigned int	*point2_p,
     ***************
     *** 285,295 ****
     --- 308,322 ----
       new_root _((
           file_info_t		*file_p,
           dir_hash_entry_t	*hash_p,
           entry_insert_ctx_t	*insert_ctx_p));
       
     + #ifdef hitm
     + static int
     + #else
       static void
     + #endif
       purge_data_bucket _((
           node_header_t	*bkt_p,
           Timestamp_t		*allupto_p));
       
       static dns_status_t
     ***************
     *** 334,344 ****
       void
       node_check (bkt_p)
           node_header_t	*bkt_p;
       {
           int space = bkt_p->node_blocks*BLOCK_SIZE;
     ! 
           switch (bkt_p->node_type) {
           case DIRECTORY_BUCKET:
       	{
       	directory_bucket_t *dir_p = (directory_bucket_t *)bkt_p;
       
     --- 361,371 ----
       void
       node_check (bkt_p)
           node_header_t	*bkt_p;
       {
           int space = bkt_p->node_blocks*BLOCK_SIZE;
     !     
           switch (bkt_p->node_type) {
           case DIRECTORY_BUCKET:
       	{
       	directory_bucket_t *dir_p = (directory_bucket_t *)bkt_p;
       
     ***************
     *** 352,361 ****
     --- 379,391 ----
           case INDEX_BUCKET:
       	{
       	register byte_t *next_p =
       	    (byte_t *)&bkt_p->node_rec_dsc[bkt_p->node_count];
       	register int i;
     + #if defined(hitm) && defined(ORDER_CK)
     +         int j;
     + #endif
       
       	for (i=0; i<bkt_p->node_count; i++) {
       	    rec_descriptor_t *rec_p = &bkt_p->node_rec_dsc[i];
       	    entry_key_t *key_p =
       		    (entry_key_t *)SKIP_bytes(bkt_p, rec_p->rec_offset);
     ***************
     *** 374,392 ****
       	    case 255:
       		break;
       	    default:
       		abort();
       	    }
     ! 	    switch (key_p->key_sort[0]) {
     ! 	    case BINARY_SORT:
     ! 	    case ASCII_SORT:
     ! 	    case TYPED_SORT:
     ! 	    case 255:
     ! 		break;
     ! 	    default:
     ! 		abort();
     ! 	    }
       	    switch (bkt_p->node_type) {
       	    case DATA_BUCKET:
       	    case PSEUDO_BUCKET:
       		set_p = (DBSet_t *)DATA_entry_data_record(key_p);
       		if (next_p < (byte_t *)set_p) abort();
     --- 404,414 ----
       	    case 255:
       		break;
       	    default:
       		abort();
       	    }
     ! 
       	    switch (bkt_p->node_type) {
       	    case DATA_BUCKET:
       	    case PSEUDO_BUCKET:
       		set_p = (DBSet_t *)DATA_entry_data_record(key_p);
       		if (next_p < (byte_t *)set_p) abort();
     ***************
     *** 397,410 ****
     --- 419,462 ----
       		break;
       	    case INDEX_BUCKET:
       		if (next_p < SKIP_AttributeName(key_p->key_name)) abort();
       		break;
       	    }
     + 
     + 	    switch (key_p->key_sort[0]) {
     + 	    case BINARY_SORT:
     + 	    case ASCII_SORT:
     + 	    case TYPED_SORT:
     + #if defined(hitm) && defined(ORDER_CK)
     +                 j = bkt_p->node_type;
     +                 if (i && (j == DATA_BUCKET || j == INDEX_BUCKET)) {
     + 
     +                     if (check_order(bkt_p, i) == 0) {
     +                         bomb(i);
     +                     }
     +                 }
     + #endif
     + 	    case 255:
     + 		break;
     + 	    default:
     + 		abort();
     + 	    }
       	}
       	}
       	break;
     + #ifdef hitm
     +     case LOCK_BLOCK:
     +     case STREAM_BLOCK:
     +     case CLEARINGHOUSE_BLOCK:
     +     case HASH_BLOCK:
     +         break;
     + 
     +     default:
     +         bomb(-1);
     + #endif
           }
     +     return;
       }
       #else
       #define node_check(rec_p) (rec_p)
       #endif
       
     ***************
     *** 644,654 ****
           node_check(newbkt_p);
       }
       
       /*
        * insert_record
     !  *	Insert data into a bucket.  It will fit.
        *	rec_p contains the attribute set to be appended
        *	to the key_p.
        *
        * Input:
        *	bkt_p = pointer to bucket
     --- 696,706 ----
           node_check(newbkt_p);
       }
       
       /*
        * insert_record
     !  *	Insert data into a bucket, if it will fit.
        *	rec_p contains the attribute set to be appended
        *	to the key_p.
        *
        * Input:
        *	bkt_p = pointer to bucket
     ***************
     *** 855,864 ****
     --- 907,1021 ----
           bkt_p->node_space = (bkt_p->node_blocks*BLOCK_SIZE)
       	- (rd_p->rec_offset + rd_p->rec_length);
           node_check(bkt_p);
           return(0);
       }
     + #ifdef hitm
     + 
     + /* bomb
     +  *      die quickly and coredump
     +  *
     +  */
     + static void
     + bomb(int i)
     + {
     + #include <signal.h>
     +         
     +         struct sigaction sigactn;
     +         
     +         sigactn.sa_handler = SIG_DFL;
     +         sigemptyset(&sigactn.sa_mask);
     +         sigactn.sa_flags   = 0;
     + 
     +         sigaction(SIGQUIT, &sigactn, NULL);
     +         
     +         kill(getpid(), SIGQUIT);
     +         while (1) pthread_yield();
     + }
     + #ifdef ORDER_CK
     + 
     + /* zero
     +  *      empty function that provides a convenient breakpoint
     +  *
     +  */
     + static void
     + zero(node_header_t *p)
     + {
     +         return;
     + }
     + 
     + /* check_order
     +  *	Check two adjacent items in a bucket to see if they are in
     +  *	increasing order
     +  *
     +  * Input:
     +  *	rec_p = pointer to a key bucket
     +  *	i     = latter item to check (compare to i-1); i > 0
     +  *
     +  * Output:
     +  *	none
     +  *
     +  * Value:
     +  *	0 - not in order
     +  *	1 - in order
     +  *
     +  */
     + static int
     + check_order (rec_p, i)
     +     node_header_t	*rec_p;
     +     int                 i;
     + {
     +     entry_key_t *lo_key_p;
     +     entry_key_t *hi_key_p;
     +     SimpleName_t *lo_name_p;
     +     SimpleName_t *hi_name_p;
     +     int          status;
     + 
     + 
     +     lo_key_p = (entry_key_t *)INDEX_node_rec(rec_p, i-1);
     +     hi_key_p = (entry_key_t *)INDEX_node_rec(rec_p, i);
     + 
     +     lo_name_p = (SimpleName_t *)lo_key_p->key_name;
     +     hi_name_p = (SimpleName_t *)hi_key_p->key_name;
     + 
     +     if (EQ_byte(lo_key_p->key_type, hi_key_p->key_type))
     + 	{
     +         if (EQ_byte(lo_key_p->key_sort, hi_key_p->key_sort))
     + 	    {
     + 
     + 	    if (LEN_SimpleName(lo_key_p->key_name) ==
     + 	        LEN_SimpleName(hi_key_p->key_name))
     + 		status = dns_bcmp_lexical((char *)lo_name_p->sn_name,
     + 			(char *)hi_name_p->sn_name, EXT8(lo_name_p->sn_length));
     + 	    else if (EXT8(lo_name_p->sn_length) < EXT8(hi_name_p->sn_length))
     + 		{
     + 		status = dns_bcmp_lexical((char *)lo_name_p->sn_name,
     + 			 (char *)hi_name_p->sn_name, EXT8(lo_name_p->sn_length));
     +                 if (status == EQUIV) status = BEFORE;
     + 		}
     + 	    else
     + 		{
     + 		status = dns_bcmp_lexical((char *)lo_name_p->sn_name,
     + 		       (char *)hi_name_p->sn_name, EXT8(hi_name_p->sn_length));
     +                 if (status == EQUIV) status = AFTER;
     + 		}
     + 	    }
     +         else if (LT_byte(lo_key_p->key_sort, hi_key_p->key_sort))
     + 	    status = BEFORE;
     +         else status = AFTER;
     +         }
     +     else if (LT_byte(lo_key_p->key_type, hi_key_p->key_type))
     + 	status = BEFORE;
     +     else status = AFTER;
     + 
     +     if (status == BEFORE)
     +         return(1);
     +     else
     +         return(0);
     + }
     + #endif
     + #endif
       
       /*
        * find_entry_pos
        *	Search a bucket and return the position the first key
        *	greater then or equal to the input key
     ***************
     *** 936,952 ****
           	else if (LT_byte(key_p->key_type, cur_key_p->key_type))
       	    status = BEFORE;
       	else status = AFTER;
       
       
     !         if (status == AFTER)         /* Name is greater then current position */
                   {
                   lower = curpos;
                   curpos += (upper-lower+1)/2;
                   }
               else if (status == BEFORE)
     !             {                   /* name is less then current position */
                   upper =curpos;
                   curpos -= (upper-lower+1)/2;
                   }
               else /* Equal */
                   {
     --- 1093,1109 ----
           	else if (LT_byte(key_p->key_type, cur_key_p->key_type))
       	    status = BEFORE;
       	else status = AFTER;
       
       
     !         if (status == AFTER)         /* Name is greater than current position */
                   {
                   lower = curpos;
                   curpos += (upper-lower+1)/2;
                   }
               else if (status == BEFORE)
     !             {                        /* name is less than current position */
                   upper =curpos;
                   curpos -= (upper-lower+1)/2;
                   }
               else /* Equal */
                   {
     ***************
     *** 996,1006 ****
           DEB_ASCII_BUF_file_info(fileBuf)
           DEB_ASCII_BUF_node_header(expandBuf)
           DEB_ASCII_BUF_node_header(bktBuf)
           node_header_t *next_p;
           node_header_t *split1_bkt_p = NULL_node_header;
     !     node_header_t *split2_bkt_p;
           entry_key_t *key_p;
           unsigned int split1, split2;
           dns_status_t status;
       
           DEBUG_EVENT(entry_db_btree_split_bucket,
     --- 1153,1163 ----
           DEB_ASCII_BUF_file_info(fileBuf)
           DEB_ASCII_BUF_node_header(expandBuf)
           DEB_ASCII_BUF_node_header(bktBuf)
           node_header_t *next_p;
           node_header_t *split1_bkt_p = NULL_node_header;
     !     node_header_t *split2_bkt_p = NULL_node_header;     /* hitm addition */
           entry_key_t *key_p;
           unsigned int split1, split2;
           dns_status_t status;
       
           DEBUG_EVENT(entry_db_btree_split_bucket,
     ***************
     *** 1007,1017 ****
       	(" >db_btree:split_bucket(%s,%p,%p,%p)\n",
       	 deb_ascii_file_info(fileBuf,file_p),
       	 deb_ascii_node_header(expandBuf,expand_p),
       	 deb_ascii_node_header(bktBuf,bkt_p), ctx_p));
       
     !     node_check(expand_p);
           node_check(bkt_p);
          /* Need to do some splitting, determine split points */
           ctx_p->insert_type = split_points(expand_p,
       		&split1, &split2, bkt_p->node_blocks*BLOCK_SIZE);
       
     --- 1164,1174 ----
       	(" >db_btree:split_bucket(%s,%p,%p,%p)\n",
       	 deb_ascii_file_info(fileBuf,file_p),
       	 deb_ascii_node_header(expandBuf,expand_p),
       	 deb_ascii_node_header(bktBuf,bkt_p), ctx_p));
       
     !     /* node_check(expand_p); */ /* hitm -- split_points does this */
           node_check(bkt_p);
          /* Need to do some splitting, determine split points */
           ctx_p->insert_type = split_points(expand_p,
       		&split1, &split2, bkt_p->node_blocks*BLOCK_SIZE);
       
     ***************
     *** 1077,1087 ****
           /* Link buckets horizontally */
           link_after(bkt_p, split2_bkt_p);
       
           if (ctx_p->insert_type == INSERT_2_KEY)
       	link_after(bkt_p, split1_bkt_p);
     ! 
           status = DNS_SUCCESS;
       
       leave_split_bucket:
           dns_free((char *)expand_p);
       
     --- 1234,1252 ----
           /* Link buckets horizontally */
           link_after(bkt_p, split2_bkt_p);
       
           if (ctx_p->insert_type == INSERT_2_KEY)
       	link_after(bkt_p, split1_bkt_p);
     ! #ifdef hitm
     !     if (split1_bkt_p) {
     !         node_check(split1_bkt_p);
     !     }
     !     if (split2_bkt_p) {
     !         node_check(split2_bkt_p);
     !     }
     !     node_check(bkt_p);
     ! #endif
           status = DNS_SUCCESS;
       
       leave_split_bucket:
           dns_free((char *)expand_p);
       
     ***************
     *** 1141,1151 ****
       
           if (0 < insert_record(root_bkt_p, 1,
       		&insert_ctx_p->insert_right, NULL_DBSet))
       	abort();
       
     !     node_check(root_bkt_p);
           /* Update root index bucket vbn in directory bucket */
           hash_p->dir_entry_p = root_bkt_p;
       
       }
       
     --- 1306,1316 ----
       
           if (0 < insert_record(root_bkt_p, 1,
       		&insert_ctx_p->insert_right, NULL_DBSet))
       	abort();
       
     !     /* node_check(root_bkt_p); */ /* hitm -- insert_record did this */
           /* Update root index bucket vbn in directory bucket */
           hash_p->dir_entry_p = root_bkt_p;
       
       }
       
     ***************
     *** 1156,1182 ****
        * Input:
        *	bkt_p 		pointer to bucket to purge
        *	allupto_p	pointer to allupto timestamp
        *
        */
       static void
       purge_data_bucket (bkt_p, allupto_p)
           node_header_t	*bkt_p;
           Timestamp_t		*allupto_p;
       {
           DEB_ASCII_BUF_node_header(bktBuf)
           rec_descriptor_t *rd_p;
           unsigned int len;
           int offset, pos;
       
           DEBUG_EVENT(entry_db_btree_purge_data_bucket,
       	(" >db_btree:purge_data_bucket(%s,%p)\n",
       	 deb_ascii_node_header(bktBuf,bkt_p), allupto_p));
       
           node_check(bkt_p);
           if (!allupto_p) return;
     ! 
           if (!bkt_p->node_count)
       	DEBUG_EVENT(error_db_btree,
       	    ("E db_btree:purge_data_bucket(%s,%p) node_count is zero.\n",
       	     deb_ascii_node_header(bktBuf,bkt_p), allupto_p));
       
     --- 1321,1357 ----
        * Input:
        *	bkt_p 		pointer to bucket to purge
        *	allupto_p	pointer to allupto timestamp
        *
        */
     + #ifdef hitm
     + static int
     + #else
       static void
     + #endif
       purge_data_bucket (bkt_p, allupto_p)
           node_header_t	*bkt_p;
           Timestamp_t		*allupto_p;
       {
           DEB_ASCII_BUF_node_header(bktBuf)
           rec_descriptor_t *rd_p;
           unsigned int len;
           int offset, pos;
     + #ifdef hitm
     +     int purged_last = 0;
     + #endif
       
           DEBUG_EVENT(entry_db_btree_purge_data_bucket,
       	(" >db_btree:purge_data_bucket(%s,%p)\n",
       	 deb_ascii_node_header(bktBuf,bkt_p), allupto_p));
       
           node_check(bkt_p);
     + #ifdef hitm
     +     if (!allupto_p) return(0);
     + #else
           if (!allupto_p) return;
     ! #endif
           if (!bkt_p->node_count)
       	DEBUG_EVENT(error_db_btree,
       	    ("E db_btree:purge_data_bucket(%s,%p) node_count is zero.\n",
       	     deb_ascii_node_header(bktBuf,bkt_p), allupto_p));
       
     ***************
     *** 1212,1231 ****
       	    MOVE_bytes(INDEX_node_rec(bkt_p, pos+1), INDEX_node_rec(bkt_p, pos),
       		(bkt_p->node_rec_dsc[bkt_p->node_count-1].rec_offset +
       		bkt_p->node_rec_dsc[bkt_p->node_count-1].rec_length) -
       		bkt_p->node_rec_dsc[pos+1].rec_offset);
       	    }
     ! 
       
       	/* Remove descriptor */
       	MOVE_bytes(INDEX_node_rec_dsc(bkt_p, pos+1),
       		INDEX_node_rec_dsc(bkt_p, pos),
       	 	(bkt_p->node_rec_dsc[bkt_p->node_count-1].rec_offset +
       		bkt_p->node_rec_dsc[bkt_p->node_count-1].rec_length) - len
       		- DIFF_bytes(INDEX_node_rec_dsc(bkt_p, pos+1), bkt_p));
       
       	--bkt_p->node_count;
       	for (offset=0; offset < pos; ++offset)
       	    bkt_p->node_rec_dsc[offset].rec_offset -= sizeof(rec_descriptor_t);
       
       	for (offset=pos; offset < bkt_p->node_count; ++offset)
       	    bkt_p->node_rec_dsc[offset].rec_offset -=
     --- 1387,1411 ----
       	    MOVE_bytes(INDEX_node_rec(bkt_p, pos+1), INDEX_node_rec(bkt_p, pos),
       		(bkt_p->node_rec_dsc[bkt_p->node_count-1].rec_offset +
       		bkt_p->node_rec_dsc[bkt_p->node_count-1].rec_length) -
       		bkt_p->node_rec_dsc[pos+1].rec_offset);
       	    }
     ! #ifdef hitm
     !         else purged_last = 1;
     ! #endif
       
       	/* Remove descriptor */
       	MOVE_bytes(INDEX_node_rec_dsc(bkt_p, pos+1),
       		INDEX_node_rec_dsc(bkt_p, pos),
       	 	(bkt_p->node_rec_dsc[bkt_p->node_count-1].rec_offset +
       		bkt_p->node_rec_dsc[bkt_p->node_count-1].rec_length) - len
       		- DIFF_bytes(INDEX_node_rec_dsc(bkt_p, pos+1), bkt_p));
       
       	--bkt_p->node_count;
     + #if defined(hitm) && defined(ORDER_CK)
     +         if (bkt_p->node_count == (unsigned long)0) zero(bkt_p);
     + #endif
       	for (offset=0; offset < pos; ++offset)
       	    bkt_p->node_rec_dsc[offset].rec_offset -= sizeof(rec_descriptor_t);
       
       	for (offset=pos; offset < bkt_p->node_count; ++offset)
       	    bkt_p->node_rec_dsc[offset].rec_offset -=
     ***************
     *** 1235,1244 ****
     --- 1415,1427 ----
       
           rd_p = &bkt_p->node_rec_dsc[bkt_p->node_count-1];
           bkt_p->node_space = (bkt_p->node_blocks*BLOCK_SIZE)
       	- (rd_p->rec_offset + rd_p->rec_length);
           node_check(bkt_p);
     + #ifdef hitm
     +     return(purged_last);
     + #endif
       }
       
       /*
        * split_bucket_for_continuation
        *	An entry has grown large enough to require a continuation bucket
     ***************
     *** 1255,1265 ****
     --- 1438,1452 ----
           int			pos;
           entry_insert_ctx_t	*ctx_p;
       {
           DEB_ASCII_BUF_file_info(fileBuf)
           DEB_ASCII_BUF_node_header(bktBuf)
     + #ifdef hitm
     +     node_header_t *new_bkt_p, *split1_bkt_p = NULL_node_header, *split2_bkt_p;
     + #else
           node_header_t *new_bkt_p, *split1_bkt_p, *split2_bkt_p;
     + #endif
           entry_key_t *data_p;
           DBSet_t *set_p;
           int size, overhead, split1, split2;
           int new_size, split1_size = 0, split2_size = 0;
           dns_status_t status;
     ***************
     *** 1392,1401 ****
     --- 1579,1597 ----
           link_after(new_bkt_p, split2_bkt_p);
       
           if (ctx_p->insert_type == INSERT_2_KEY)
       	link_after(new_bkt_p, split1_bkt_p);
       
     + #ifdef hitm
     +     if (split1_bkt_p) {
     +         node_check(split1_bkt_p);
     +     }
     +     if (split2_bkt_p) {
     +         node_check(split2_bkt_p);
     +     }
     + #endif
     + 
           node_check(new_bkt_p);
           dns_free((char *)bkt_p);
           status = DNS_SUCCESS;
       
       leave_split_bucket_for_continuation:
     ***************
     *** 1428,1438 ****
           DEBUG_EVENT(entry_db_btree_insert_keys,
       	(" >db_btree:insert_keys(%s,%s,%p)\n",
       	 deb_ascii_file_info(fileBuf,file_p),
       	 deb_ascii_node_header(bktBuf,bkt_p), ctx_p));
       
     !     node_check(bkt_p);
           /* Make sure we have the correct bucket */
           find_entry_pos(bkt_p, &ctx_p->insert_right, &pos);
           while (bkt_p->node_count <= pos)
       	{
       	bkt_p = bkt_p->node_next_p;
     --- 1624,1634 ----
           DEBUG_EVENT(entry_db_btree_insert_keys,
       	(" >db_btree:insert_keys(%s,%s,%p)\n",
       	 deb_ascii_file_info(fileBuf,file_p),
       	 deb_ascii_node_header(bktBuf,bkt_p), ctx_p));
       
     !     /* node_check(bkt_p); *//* hitm -- find_entry_pos will do this */
           /* Make sure we have the correct bucket */
           find_entry_pos(bkt_p, &ctx_p->insert_right, &pos);
           while (bkt_p->node_count <= pos)
       	{
       	bkt_p = bkt_p->node_next_p;
     ***************
     *** 1661,1671 ****
       	(" >db_btree:insert_data(%s,%s,%s,%p)\n",
       	 deb_ascii_db_stream(streamBuf,stream_p),
       	 deb_ascii_node_header(bktBuf,bkt_p),
       	 deb_ascii_entry_key(entry_dataBuf,entry_data_p), insert_ctx_p));
       
     !     node_check(bkt_p);
           /*
            * It is possible that a new bucket did not make it into the
            * index structure.  If this is the case, we may have to read
            * adjacent buckets to find the right position for the new data.
            */
     --- 1857,1867 ----
       	(" >db_btree:insert_data(%s,%s,%s,%p)\n",
       	 deb_ascii_db_stream(streamBuf,stream_p),
       	 deb_ascii_node_header(bktBuf,bkt_p),
       	 deb_ascii_entry_key(entry_dataBuf,entry_data_p), insert_ctx_p));
       
     !     /* node_check(bkt_p); */ /* hitm -- find_entry_pos will do this */
           /*
            * It is possible that a new bucket did not make it into the
            * index structure.  If this is the case, we may have to read
            * adjacent buckets to find the right position for the new data.
            */
     ***************
     *** 1834,1858 ****
           file_info_t *file_p = stream_p->db_file_p;
           DBSet_t *set_p = (DBSet_t *)stream_p->db_entry.data_p;
           node_header_t *next_p, *expand_p;
           unsigned int pos, new_size;
           dns_status_t status;
       
           DEBUG_EVENT(entry_db_btree_replace_data,
       	(" >db_btree:replace_data(%s,%p,%s,%p)\n",
       	 deb_ascii_db_stream(streamBuf,stream_p),
       	 deb_ascii_node_header(bktBuf,bkt_p),
       	 deb_ascii_entry_key(ekeyBuf,ekey_p), insert_ctx_p));
       
     !     node_check(bkt_p);
           /* Purge out deleted records from this bucket */
           purge_data_bucket(bkt_p, insert_ctx_p->insert_allupto_p);
       
           /*
            * It is possible that a new bucket did not make it into the
            * index structure.  If this is the case, we may have to read
            * adjacent buckets to find right position for the new data.
            */
       
           status = find_entry_pos(bkt_p, ekey_p, &pos);
           while (bkt_p->node_count <= pos)
       	{
     --- 2030,2074 ----
           file_info_t *file_p = stream_p->db_file_p;
           DBSet_t *set_p = (DBSet_t *)stream_p->db_entry.data_p;
           node_header_t *next_p, *expand_p;
           unsigned int pos, new_size;
           dns_status_t status;
     + #ifdef hitm
     +     int do_rebuild;
     + #endif
       
           DEBUG_EVENT(entry_db_btree_replace_data,
       	(" >db_btree:replace_data(%s,%p,%s,%p)\n",
       	 deb_ascii_db_stream(streamBuf,stream_p),
       	 deb_ascii_node_header(bktBuf,bkt_p),
       	 deb_ascii_entry_key(ekeyBuf,ekey_p), insert_ctx_p));
       
     !     /* node_check(bkt_p); */ /* not needed, purge_data_bucket does it */
           /* Purge out deleted records from this bucket */
     + #ifdef hitm
     +     do_rebuild = purge_data_bucket(bkt_p, insert_ctx_p->insert_allupto_p);
     + 
     +     /* if purge_data_bucket removed the last entry in bkt_p (this subsumes
     +      * the case where it emptied bkt_p), rebuild the index.  empty
     +      * nodes are subject to deletion, so advance bkt_p until we find
     +      * a node that is nonempty (the last bucket is always nonempty)
     +      */
     + 
     +     while (bkt_p->node_count == 0)
     +             bkt_p = bkt_p->node_next_p;
     +     if (do_rebuild)
     +             rebuild_index(stream_p);
     + #else
           purge_data_bucket(bkt_p, insert_ctx_p->insert_allupto_p);
     + #endif
       
           /*
            * It is possible that a new bucket did not make it into the
            * index structure.  If this is the case, we may have to read
            * adjacent buckets to find right position for the new data.
     +      * Also, find_entry_pos considers empty buckets to be non-matching,
     +      * so if purge_data_bucket emptied bkt_p, we must search onward.
            */
       
           status = find_entry_pos(bkt_p, ekey_p, &pos);
           while (bkt_p->node_count <= pos)
       	{
     ***************
     *** 2281,2291 ****
       
       	return(status);
       
       	}
       
     !     node_check(bkt_p);
           status = insert_data(stream_p, bkt_p, entry_data_p, insert_ctx_p);
           i[parul 8/23/95 public]

If you are planning on picking up this fix, please check OT 12879 first. 
The reason is DEC is working on fix for OT 12879 and they believe that
this fix may not be the correct one.

[01/24/96 public]

Marking this as a duplicate of OT 12879, which was fixed in 1.1maint
using Alan Peckham's fix.



CR Number                     : 12965
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dcecp
Subcomponent Name             : 
Short Description             : Group list only allows 1024
Reported Date                 : 7/21/95
Found in Baseline             : 1.1
Found Date                    : 7/21/95
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 12822
Fix By Baseline               : 1.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[7/21/95 public]
It was noted that when issuing the "dcecp -c group list" command that
it can only handle 1024 members in the list.  I have found that the code
is hardcoding the max_members and the output list to be 1024.
This causes problems for users that have more than 1024 members in a 
group.  The memory should be dynamically allocated to handle as many
members as neccessary.

[7/21/95 public]
Check OT12822.  It describes the same problem, and
includes a fix (which works well).



CR Number                     : 12953
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : secd/tgs
Short Description             : call to
against_flag_policy_tgs with wrong parameters
Reported Date                 : 7/16/95
Found in Baseline             : 1.1wp
Found Date                    : 7/16/95
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 12909
Fix By Baseline               : 1.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[7/16/95 public]

In     src/security/krb5/kdc/kdc_util.c
        against_flag_policy_tgs() used with wrong parameters.


From the Tandem ticket:

> Within the function validate_tgs_request(), within file kdc_util.c.
> At the very end of the function.
> - - - -
>     /*
>      * Check local policy
>      */
> #ifdef OSF_DCE
>     errcode = against_flag_policy_tgs(request, server, ticket, status);
> #else
> - - - -
> 
> This does not match the code in policy.c
> - - - -
> krb5_boolean
> against_flag_policy_tgs(request, ticket)
> const register krb5_kdc_req *request;
> const register krb5_ticket *ticket;
> {
> - - -


The obvious fix of eliminating the spurious parameters (server & status)
seems at first examination the right one.  At the cost of stating the 
obvious, notice that it is not only a matter of the call being made with
extra parameters, so the code as is CANNOT work.



CR Number                     : 12950
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : 
Short Description             : rgy_edit fails with expired creds (warranty patch code)
Reported Date                 : 7/13/95
Found in Baseline             : 1.1wp
Found Date                    : 7/13/95
Severity                      : C
Priority                      : 1
Status                        : dup
Duplicate Of                  : 12930
Fix By Baseline               : 1.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[7/13/95 public]
Since incorporating the warranty patch code, rgy_edit won't
work if the invoker's creds are expired; it fails with 
"registry server unavailable" rather than establishing an 
unauthenticated binding. 

The problem stems from the fact that the security binding code is
now getting a KRB5_CC_NOTFOUND (translated to "Matching credential
not found") error back from rpc_binding_set_auth_info() -- it used
to get rpc_s_auth_tkt_expired which the binding code is written
to handle.

The relevent code path: 

<client code>
  rca_setup_handle
    rpc_binding_set_auth_info
      rpc__krb_bnd_set_auth
        rpc__krb_get_tkt
          sec_krb_get_cred
            krb5_get_credentials_dce
              krb5_get_cred_from_kdc
                krb5_fcc_retrieve

krb5_fcc_retrieve returns KRB5_CC_NOTFOUND which is bubbled all the
way back up.  The difference in current behavior (vs pre-WP
behavior) is due to changes in krb5_get_cred_from_kdc 
(src/security/krb5/lib/krb/gc_frm_kd.c).  One thing that changed is 
that krb5_get_cred_from_kdc no longer returns 
KRB5KRB_AP_ERR_TKT_EXPIRED ('cause a valid, expired TGT is never found?).  
This error code is translated into rpc_s_auth_tkt_expired in 
sec_krb_get_cred (src/security/utils/sec_authn.c).  Another thing 
that changed is that there are calls to krb5_cc_retrieve_cred that don't 
continue if KRB5_CC_NOTFOUND is returned.  In fact, the call at line 253 
is the one that returns KRB5_CC_NOTFOUND and leads to failure.

Got a fix for this one?



CR Number                     : 12941
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : bld
Subcomponent Name             : 
Short Description             : target-specific libs should be lastin sec_salvage_db/Makefile
Reported Date                 : 6/29/95
Found in Baseline             : 1.1
Found Date                    : 6/29/95
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 12979
Fix By Baseline               : 1.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[6/29/95 public]

 Apparently only the server/bin/Makefile has been fixed, but
 -llm still appears after target machine libs in 
 sec_salvage_db/Makefile


                          DCE Problem Report
                  =================================


Submitter Information 
----------------------

Submitter Name:           rusman
Organization:             Hitachi Computer Products (America), Inc. 
Email Address:            osd.dce@hi.com rusman@hi.com 
Phone:                    617-890-0444 
DCE License Number:       1616-MDCE-92
Licensee's Defect Number: OSDqa09446


Hardware/Software Configuration
--------------------------------

Offering and Version:   DCEOSF 
Component (Module):      
Client Hardware:        see below 
Client Software:        see below 
Server Hardware:        see below 
Server Software:        see below 
Compiler:               n/a

Problem Description
--------------------

Severity Level: Severe

Date of First Occurrence: 09/30/94

One Line Description:
   OSDqa09446 target-specific libs should be last

Full Description:

Related-file:::: Problem
 DESCRIPTION:
 
 In security/server/bin/Makefile, and 
    security/server/sec_salvage_db/Makefile
 
 ${${TARGET_MACHINE}_LIBS} should be at the end of the LIBs list.
 We believe this should always be the rule.  In our case, it is required
 because we need to use libc_r before libc, and various other libraries due 
 to our use of kernel threads.

[2/6/96 public]
Duplicate OT 12979. Updated 12979 so marked this dup of that.



CR Number                     : 12931
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : other
S/W Ref Platform              : other
Component Name                : rpc
Subcomponent Name             : IDL
Short Description             : Marshalling problems in RPC
Reported Date                 : 6/23/95
Found in Baseline             : 1.1
Found Date                    : 6/22/95
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 12885
Fix By Baseline               : 
Fixed In Baseline             : 
Affected File(s)              : cnxfer.c cncthd.c cncall.c
Sensitivity                   : public

[6/24/95 public]
We're  seeing marshalling problems in an RPC program which sends a long byte
stream across over TCP, with security. 

This is the abbreviated IDL file: 

typedef struct {
wire_recordFormat_t      format;
[ptr,length_is(dataLength),
size_is(bufferLength)] /* wire_pointer_t */ byte * buffer; /* XXX */
unsigned long           bufferLength;
unsigned long           dataLength;
unsigned long           numExternalFields;
[ptr, size_is(numExternalFields)] 
wire_externalField_t *externalFieldsArrayP;
} wire_record_t;
...


typedef struct { 
unsigned short version ;
...
unsigned long numWrites ;
[ptr , size_is (numWrites ) ] wire_record_t *writeRecordArrayP ; 
...
} wire_batchInRequest_t ;

...

wire_status_t _svr_NTBatch(
[in] handle_t h,
[ptr,in] wire_batchInRequest_t *batchInP
);


The problem occurs when marshalling the writeRecordArrayP pointer, when more than a certain number
of entries (11) are used.


The length and the size of the byte stream that is sent in the buffer field of batchinP is 
283. [ Both dataLength and bufferLength are 283] 

The problem occurs when the client and server are run over TCP (they work fine over
UDP). The client receives a fault packet back from the server. 

Here is what I've been able to detect from looking at the problem

When marshalling the 283 byte array, the client puts the Z-values , i.e. the
maximum count [ In this case, 283] and then the lower and upper range limits 
[0 and 283 in this case], and then the actual value of the array. This is
how IDL marshalling of a conformany, varying undimensional array is done.

Now, after putting down 283 bytes, the marshalling code, wants to put down the
[ maximum count, offset, actual count] for the next array. This needs to be
4 byte aligned, so an extra byte of padding is used before the max count is
put down. 

hence, the encoded stream looks like this

... [ 283 bytes of data] [1 byte of padding] [max count, offset, actual count = 12 bytes][ 283 bytes
of data][1 byte of padding][max count, offset, actual count] ....

The iovectors that are built up on the client side are thus of sizes 13 bytes [ 1 byte pad + 3 longs[,
[ 283 bytes], 13 bytes, 283 bytes .... 

When the array size is greater than 11 or so, the byte stream is broken up and sent in
the form of separate packets. This breaking occurs at a 283 byte boundary. 

Thus we have [283 byte data] ||| [ 13 bytes ] 

The data in the packet is thus unaligned and is not on a 4 byte boundary. The auth
trailer actually pads this out to 4 bytes and sticks on the trailer and sends it out. 

On the receive side, the auth trailer is removed and the padding is thrown away, and the
data is again not aligned. 


After consuming an array element the server unmarshalling code calls  rpc_ss_ndr_unmar_Z_values
to unmarshal the expected Z values in the input stream. This works fine until you reach the end
of the packet. At that point, the code calls IDL_UNMAR_LONG(), which in turn
calls IDL_UNMAR_ALIGNED_SCALAR( on a 4 byte boundary), which in turn calls 
IDL_UNMAR_ALIGN_MP() to align  on a 4 byte boundary. 

#define IDL_UNMAR_ALIGN_MP(IDL_msp, alignment)\
{ \
int advance;\
advance = (idl_byte *)\
(((IDL_msp->IDL_mp - (idl_byte *)0) + (alignment-1)) & ~(alignment-1)) \
- IDL_msp->IDL_mp; \
IDL_msp->IDL_mp += advance; \
IDL_msp->IDL_left_in_buff -= advance;\
}
At this point, IDL_left_in_buff is 0, and decrementing it by 1 sets it to a 0xfffffe

#define IDL_UNMAR_ALIGNED_SCALAR( marshalling_macro, size, type, param_addr ) \
{ \
IDL_UNMAR_ALIGN_MP( IDL_msp, size ); \
rpc_ss_ndr_unmar_check_buffer( IDL_msp ); \
...

}

IDL_UNMAR_ALIGNED_SCALAR "calls" rpc_ss_ndr_unmar_check_buffer(), which ONLY
calls rpc_call_receive() to get a new buffer if IDL_left_in_buff is zero, which
isn't true anymore. Hence, it can't get any more data and sends back a fault packet 
to the client. 

This seems easy to fix, just modify IDL_UNMAR_ALIGN_MP() to not decrement
IDL_left_in_buff, if IDL_left_in_buff = 0. 

If this is fixed, a second problem shows up in the second packet. 

The data in the second packet is 13 bytes = 1 byte of pad, max count, offset, 
actual count. However, the starting byte of this is already aligned on a 4 byte
boundary, thus the unmarshaller doesn't skip over it as it does when it encounters
it in the middle of a packet. hence, it starts reading one byte out of alignment
and quickly core dumps. 

This problem also shows up when data lengths of 285, 286 etc. are used. Only those
lengths divisible by 4 don't cause a problem. 

It seems that this should be fixed on the client side, and that the client should
reset the IDL_mp_start_offset field after a  packet has been sent out and assume 4 byte 
alignment to begin with when starting to marshal  a new packet. 

However, from looking at the client marshalling code, and all the iovectors still present
when a packet is sent out, it seems that a lot of the remaining data has already
been marshalled and is present in the IDL_msp->IDL_iovec fields at the time the
first packet is sent. Thus the data is already marshalled, and is not sent at that
point, and its not clear to me how you would realign it, since at that time you
don't really have much information on the marshalled-but-not-sent data. 

A second possibility might be for the server unmarshaller side to keep track of how 
many bytes it needs to align itself at the end of a packet and skip over that many
bytes at the begining of the the next packet. However, this may mean the data in the
second packet is misaligned all the way through the packet , and this could cause
severe performance problems and maybe even BUS errors on some architectures.

[6/23/95 public]

This is a dup of CR #12885. It is a bug in the CN fragmentation code, not
in the un/marshalling code. Yes, the fix should be made in a sender, not a
receiver, since it's violating an alignment rule. Also, the receiver should
reject such a fragment to prevent a coredump caused by the buggy sender.



CR Number                     : 12922
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dced
Subcomponent Name             : hostdata forking
Short Description             : race conditions when forking
Reported Date                 : 6/18/95
Found in Baseline             : 1.1
Found Date                    : 6/18/95
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 12837
Fix By Baseline               : 1.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[6/18/95 public]

1) The first condition

> The first problem is that the information returned by dced_waitpid
> could be wrong.  The reason is that the parent calls dced_fork, then
> almost immediately calls dced_waitpid.  If several threads are doing
> this, the first child that exits will awaken all the threads, which
> will all find entries for themselves in the table, but only one of
> them will have had status filled in.  Nevertheless, all will return.
 
would happen when multiple hostdata_create or hostdata_set requests
come in at the same time.

2) The second condition is in the server exec

> The second problem is that if one thread calls dced_fork successfully,
> the child could terminate before the parent has added the child's pid
> to the sx_pids.pids.list.  If the signal_catcher thread then runs, it
> won't find the child in the list and thus won't be able to store its
> return status.  It also won't do the broadcast on the condition, so
> the dced_waitpid would sit forever.

   and would be only likely to happen if the execed server dies right
   away (which is a bit unlikely).

3) I am adding this of my own.  The postprocs list needs to be protected
   by a lock (or mutex), otherwise concurrent hd_read_postprocessors
   will manipulate it at the same time.
   This could happen for instance when servicing simultaneous hostdata
   create or write calls.  Of course it is a matter of timing, and probably
   unlikely on most machines.  



My last comment to the following mail message is matter of aesthetics.
I would call the .valid field something like .valid_status as it only
refers to the .status field.




---------------------------------------------------------------------

From osd.dce@hi.com  Thu Apr 27 09:47:38 1995
Received: from postman.osf.org by osf.osf.org (5.65/OSF 1.0)
	id AA02582; Thu, 27 Apr 1995 09:47:38 -0400
Received: from loki.hi.com (loki.Hi.COM [140.243.30.55]) by postman.osf.org
(8.6.9/8.6.x) with SMTP
	id JAA26956 for <dce-defect@osf.org>; Thu, 27 Apr 1995 09:47:34
-0400
Received: from OSDpts.hi.com by loki.hi.com (4.1/SMI-4.1.hi-2)
	id AA22905; Thu, 27 Apr 95 09:51:09 EDT
From: osd.dce@hi.com (DCE Defect)
Received: by OSDpts.hi.com (1.38.193.4/Spike-2.0)
	id AA17967; Thu, 27 Apr 1995 09:53:40 -0400
Date: Thu, 27 Apr 1995 09:53:40 -0400
Message-Id: <9504271353.AA17967@OSDpts.hi.com>
To: dce-defect@osf.org

                          DCE Problem Report
                  =================================


Submitter Information 
----------------------

Submitter Name:           wright
Organization:             Hitachi Computer Products (America), Inc. 
Email Address:            osd.dce@hi.com wright@hi.com 
Phone:                    617-890-0444 
DCE License Number:       1616-MDCE-92
Licensee's Defect Number: OSDqa10910


Hardware/Software Configuration
--------------------------------

Offering and Version:   DCER1.1 
Component (Module):     sximpl.h, sxops.c 
Client Hardware:        see below 
Client Software:        see below 
Server Hardware:        see below 
Server Software:        see below 
Compiler:               n/a

Problem Description
--------------------

Severity Level: Severe

Date of First Occurrence: 03/16/95

One Line Description:
   OSDqa10910 sneaky potential deadlock in hostdata forking

Full Description:

Related-file:::: Problem
 DESCRIPTION:  Via code inspection, I discovered two problems in the
 dced_fork management.  
 
 The first problem is that the information returned by dced_waitpid
 could be wrong.  The reason is that the parent calls dced_fork, then
 almost immediately calls dced_waitpid.  If several threads are doing
 this, the first child that exits will awaken all the threads, which
 will all find entries for themselves in the table, but only one of
 them will have had status filled in.  Nevertheless, all will return.
 
 The second problem is that if one thread calls dced_fork successfully,
 the child could terminate before the parent has added the child's pid
 to the sx_pids.pids.list.  If the signal_catcher thread then runs, it
 won't find the child in the list and thus won't be able to store its
 return status.  It also won't do the broadcast on the condition, so
 the dced_waitpid would sit forever.
 
 
 REPRODUCIBLE:  Not without great difficulty.
 
 
 TEST SOFTWARE DESCRIPTION:
 
 
 DESCRIPTION OF HARDWARE WHERE BUG OCCURRED:
 
 
 DESCRIPTION OF WHERE TEST SUCCESSFULLY RAN:
 
Related-file::Added 950316 by wright::
/build/hiosfm/RCS/dce1.1/src/admin/dced/server/./sximpl.h,v 8.2
 /build/hiosfm/RCS/dce1.1/src/admin/dced/server/./sximpl.h,v 8.2
 wright 1995/03/16 22:44:37 +3 -2
 Reason:  OSDqa10910 sneaky potential deadlock in hostdata forking
 Revise locking and add "valid" field to sx_pid_status_s_t struct
 to avoid deadlocks and bogus return values.
 
     *** /tmp/ci.24437..sximpl.h.24471.1	Thu Mar 16 17:44:40 1995
     --- /tmp/sximpl.h.24471.2	Thu Mar 16 17:44:40 1995
     ***************
     *** 45,54 ****
     --- 45,55 ----
       #include <scimpl.h>
       
       typedef struct sx_pid_status_s_t {
           pid_t		pid;
           int			status;
     +     int                 valid;
       } sx_pid_status_t;
       
       typedef struct sx_pid_status_list_s_t {
           unsigned32		count;
           sx_pid_status_t	*list;
 
Related-file::Added 950316 by wright::
/build/hiosfm/RCS/dce1.1/src/admin/dced/server/./sxops.c,v 8.3
 /build/hiosfm/RCS/dce1.1/src/admin/dced/server/./sxops.c,v 8.3
 wright 1995/03/16 22:44:44 +15 -7
 Reason:  OSDqa10910 sneaky potential deadlock in hostdata forking
 Revise locking and add "valid" field to sx_pid_status_s_t struct
 to avoid deadlocks and bogus return values.
 
     *** /tmp/ci.24437..sxops.c.24497.1	Thu Mar 16 17:44:46 1995
     --- /tmp/sxops.c.24497.2	Thu Mar 16 17:44:46 1995
     ***************
     *** 194,224 ****
       {
           extern char         **environ;
           pid_t		p;
           int			i;
       
           p = fork();
           if (p == -1) {
       	*st = dced_s_postprocessor_spawn_fail;
       	return;
           }
           if (p == 0) {
       	execve(av[0], av, environ);
       	_exit(1);
           }
       
           /* Add this PID to our process table. */
     -     dce_lock_justwrite(sx_pids.lock, st);
           for (i = 0; i < sx_pids.pids.count; i++)
       	if (sx_pids.pids.list[i].pid == 0)
       	    break;
           if (i == sx_pids.pids.count) {
       	sx_pids.pids.count += 20;
       	sx_pids.pids.list = realloc(sx_pids.pids.list,
       		sx_pids.pids.count * sizeof *sx_pids.pids.list);
           }
           sx_pids.pids.list[i].pid = *pp = p;
           dce_lock_unlock(sx_pids.lock, st);
           *st = error_status_ok;
       }
       
       void
     --- 194,228 ----
       {
           extern char         **environ;
           pid_t		p;
           int			i;
       
     +     dce_lock_justwrite(sx_pids.lock, st);
     + 
           p = fork();
           if (p == -1) {
     +         dce_lock_unlock(sx_pids.lock, st);
       	*st = dced_s_postprocessor_spawn_fail;
       	return;
           }
           if (p == 0) {
     +         dce_lock_unlock(sx_pids.lock, st);
       	execve(av[0], av, environ);
       	_exit(1);
           }
       
           /* Add this PID to our process table. */
           for (i = 0; i < sx_pids.pids.count; i++)
       	if (sx_pids.pids.list[i].pid == 0)
       	    break;
           if (i == sx_pids.pids.count) {
       	sx_pids.pids.count += 20;
       	sx_pids.pids.list = realloc(sx_pids.pids.list,
       		sx_pids.pids.count * sizeof *sx_pids.pids.list);
           }
           sx_pids.pids.list[i].pid = *pp = p;
     +     sx_pids.pids.list[i].valid = 0;
           dce_lock_unlock(sx_pids.lock, st);
           *st = error_status_ok;
       }
       
       void
     ***************
     *** 228,251 ****
           error_status_t	*st
       )
       {
           unsigned32		i;
       
           for ( ; ; ) {
     - 	pthread_mutex_lock(&sx_pids.m);
     - 	pthread_cond_wait(&sx_pids.cv, &sx_pids.m);
       	dce_lock_justwrite(sx_pids.lock, st);
       	for (i = 0; i < sx_pids.pids.count; i++)
     ! 	    if (sx_pids.pids.list[i].pid == pid) {
       		*status = sx_pids.pids.list[i].status;
       		sx_pids.pids.list[i].pid = 0;
       		dce_lock_unlock(sx_pids.lock, st);
       		pthread_mutex_unlock(&sx_pids.m);
       		return;
       	    }
       	dce_lock_unlock(sx_pids.lock, st);
     ! 	pthread_mutex_unlock(&sx_pids.m);
           }
       }
       
       
       /*
______________________________________________________________________ */
     --- 232,256 ----
           error_status_t	*st
       )
       {
           unsigned32		i;
       
     +     pthread_mutex_lock(&sx_pids.m);
     + 
           for ( ; ; ) {
       	dce_lock_justwrite(sx_pids.lock, st);
       	for (i = 0; i < sx_pids.pids.count; i++)
     ! 	    if (sx_pids.pids.list[i].pid == pid &&
     !                 sx_pids.pids.list[i].valid) {
       		*status = sx_pids.pids.list[i].status;
       		sx_pids.pids.list[i].pid = 0;
       		dce_lock_unlock(sx_pids.lock, st);
       		pthread_mutex_unlock(&sx_pids.m);
       		return;
       	    }
       	dce_lock_unlock(sx_pids.lock, st);
     ! 	pthread_cond_wait(&sx_pids.cv, &sx_pids.m);
           }
       }
       
       
       /*
______________________________________________________________________ */
     ***************
     *** 314,331 ****
     --- 319,339 ----
       		break;
       
       	if (i == 0) {
       	    /* Must be a hostdata postprocessor. */
       	    dce_lock_unlock(sx_table.lock, &st);
     +             pthread_mutex_lock(&sx_pids.m);
       	    dce_lock_justwrite(sx_pids.lock, &st);
       	    for (i = 0; i < sx_pids.pids.count; i++)
       		if (sx_pids.pids.list[i].pid == pid) {
       		    sx_pids.pids.list[i].status = wait_stat;
     + 		    sx_pids.pids.list[i].valid = 1;
       		    pthread_cond_broadcast(&sx_pids.cv);
       		    break;
       		}
       	    dce_lock_unlock(sx_pids.lock, &st);
     +             pthread_mutex_unlock(&sx_pids.m);
       	    continue;
       	}
       
       	/* We were asked to shut this guy down, so do so. */
       	if (sp->flags & server_c_exec__exiting) {
 
Related-file:::: Resolution 
 DESCRIPTION OF BUG FIX:  First, added "valid" field to
 sx_pid_status_s_t struct.  This is zeroed when a pid is added to the
 entry, and set to 1 when a waitpid return status is added to the
 entry.  Second, changed locking in dced_fork to take the lock before
 doing the fork, so the signal_catcher thread can't sneak in ahead of
 adding the entry to the table.  Third, changed locking in dced_waitpid
 to check the table before sleeping.  Finally, changed locking in
 srvrexec__reap to acquire sx_pids.m before accessing the table, so the
 cond_signal will interlock properly with dced_waitpid.
  
  
 REGRESSION TEST SCENARIO:
  
  
 RCSDIFFS (either inserted manually or via Fci):

[6/18/95 public]

I had forgotten to fill the CC list.  Done

[8/1/95 public]

This is a duplicate of OT 12837.



CR Number                     : 12907
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : client
Short Description             : epacs memory leak
Reported Date                 : 6/6/95
Found in Baseline             : 1.1
Found Date                    : 6/6/95
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 13034
Fix By Baseline               : 1.2
Fixed In Baseline             : 
Affected File(s)              : security/client/login/sec_login_pvt.c
Sensitivity                   : public

[6/6/95 public]

A support customer has discovered a memory leak in the function
sec_login_pvt_initiate_chain:

> PRIVATE void sec_login_pvt_initiate_chain(
>     sec_login_context_t         *lcp,
>     sec_id_delegation_type_t    dlg_type,
>     sec_id_restriction_set_t    *dlg_rstrs,
>     sec_id_restriction_set_t    *tgt_rstrs,
>     sec_id_opt_req_t            *opt_rstrs,
>     sec_id_opt_req_t            *req_rstrs,
>     sec_id_compatibility_mode_t compat_mode,
>     sec_bytes_t                 *epac_chain,
>     error_status_t              *stp
>     )
> 
>     sec_id_epac_t       epac;
>     sec_id_epac_set_t   epac_set;
>     sec_id_epac_data_t  epac_data, nepac_data;
> 
>     /* Decode the original EPAC chain pickle */
>     sec_id_epac_set_decode((void *(*)(unsigned32))malloc, free,
>         EPAC_CHAIN(lcp).num_bytes, EPAC_CHAIN(lcp).bytes, &epac_set, stp);
> - - - - - - - - - - - - - - - - - - - - - - -
> epac_set.epacs points to memory allocated via sec_id_epac_set_decode.
> This memory is lost later in this same routine by the statement:
>  "epac_set.epacs = &epac"
> - - - - - - - - - - - - - - - - - - - - - - -
>     epac_set.epacs = &epac;
>     sec_id_epac_set_encode((void *(*)(unsigned32))malloc, free, &epac_set,
>         &epac_chain->num_bytes,&epac_chain->bytes, stp);
> 
>     sec_encode_epac_set_free(free, &epac_set);
> - - - - - - - - - - - - - - - - - - - - - - -
> This call ^^^^ to free memory attempts to free memory which is not part
> of the heap, but is part of the stack, the culprit being the statement:
>  "epac_set.epacs = &epac"

This also prevents the call to sec_encode_epac_set_free() from freeing
the sec_id_epac_t struct to which epac_set.epacs originally pointed.

A possible fix would be to replace the lines:

    epac.seals = NULL;
    epac_set.num_epacs = 1;
    epac_set.epacs = &epac;
    sec_id_epac_set_encode((void *(*)(unsigned32))malloc, free, &epac_set,
        &epac_chain->num_bytes,&epac_chain->bytes, stp);

    sec_encode_epac_set_free(free, &epac_set);

with:

    epac.seals = NULL;
    sec_encode_epac_set_free(free, &epac_set);
    epac_set.num_epacs = 1;
    epac_set.epacs = &epac;
    sec_id_epac_set_encode((void *(*)(unsigned32))malloc, free, &epac_set,
        &epac_chain->num_bytes,&epac_chain->bytes, stp);

    epac_set.num_epacs = 0;
    epac_set.epacs = NULL;

Note that this fix has _not_ been tested; it is merely offered as a 
potential solution.

[6/26/95 public]

The same problem occurs in the function sec_login_pvt_insert_attrs.
The fix is identical.

[10/2/95 public]
Dup of 13034. The fix proposed here is not correct. See the other OT.



CR Number                     : 12884
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : krb
Short Description             : extra calls to free() create havoc
Reported Date                 : 5/23/95
Found in Baseline             : 1.1
Found Date                    : 5/23/95
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 13034
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : security/client/login/sec_login_pvt.c, krb5/lib/krb/copy_athctr.c, copy_tick.c
Sensitivity                   : public

[5/23/95 public]
 Callers of krb5_copy_keyblock() in security/krb5/lib/krb/copy_key.c
 should NOT free that target of the copy, if failure is returned.
 
 We have identified the following files which incorrectly do so:
        security/client/login/sec_login_pvt.c,
                krb5/lib/krb/copy_athctr.c, copy_tick.c
 
 The fact that we saw this problem is due to the way in which 
 sec_login_pvt_get_and_process_krb_tgt() calls krb5_process_as_reply()
 with reply_random_key  (i.e. the keyseed, to krb5_process_as_reply) set
 to all 0's.  When skey_keyproc() in client/login/sec_login_pvt.c is called
 with this structure, the subsequent call to  krb_copy_keyblock fails
 (malloc length 0), and who-knows-what gets free'd based upon the original
 value of an uninitialized stack variable. (For us, it was most often
 as_reply->client, so we pretty quicky got nailed when we modified 
 krb5_free_keyblock to set nasty values into the keyblock when freed.)
 
 REPRODUCIBLE:
 Yes - we tended to see the problem by repeatedly bringing the daemons
 up and down.
 
Related-file::Added 950404 by rusman::
/build/hiosfm/RCS/dce1.1/src/security/client/login/./sec_login_pvt.c,v 8.3
 /build/hiosfm/RCS/dce1.1/src/security/client/login/./sec_login_pvt.c,v 8.3
 rusman 1995/04/04 15:15:58 +8 -2
 Reason:  OSDqa11097 extra calls to free() create havoc
 in skey_keyproc, avoid extra free()
 
     *** /tmp/ci.2402..sec_login_pvt.c.2449.1   Tue Apr  4 11:16:14 1995
     --- /tmp/sec_login_pvt.c.2449.2    Tue Apr  4 11:16:15 1995
     ***************
     *** 3287,3307 ****
     --- 3287,3313 ----
            krb5_keyblock      **key,
            krb5_const_pointer keyseed,
            krb5_pa_data       **padata
         )
       {
     + #ifndef hitm
           krb5_error_code retval = 0;
     + #endif
       
           if (!valid_keytype(type))
               return KRB5_PROG_ETYPE_NOSUPP;
       
     + #if hitm
     +     return(krb5_copy_keyblock(keyseed, key));
     + #else
           retval = krb5_copy_keyblock(keyseed, key);
           if (retval) {
               free((krb5_keyblock *) *key);
           }
       
           return retval;
     + #endif
       }
       
       
       /* s e c _ l o g i n _ p v t _ g e t _ l r g y _ l o g i n _ i n f o
        *
 
Related-file::Added 950404 by rusman::
/build/hiosfm/RCS/dce1.1/src/security/krb5/lib/krb/./copy_athctr.c,v 8.2
 /build/hiosfm/RCS/dce1.1/src/security/krb5/lib/krb/./copy_athctr.c,v 8.2
 rusman 1995/04/04 15:17:50 +4 -2
 Reason:  OSDqa11097 extra calls to free() create havoc
 avoid extra call to free() after failure of krb5_copy_keyblock()
 
     *** /tmp/ci.2483..copy_athctr.c.2521.1     Tue Apr  4 11:17:55 1995
     --- /tmp/copy_athctr.c.2521.2      Tue Apr  4 11:17:56 1995
     ***************
     *** 99,109 ****
     --- 99,111 ----
           }
           
           if (authfrom->subkey) {
            if (retval = krb5_copy_keyblock(authfrom->subkey,
                                            &tempto->subkey)) {
     + #ifndef hitm
                    xfree(tempto->subkey);
     + #endif
                    krb5_free_checksum(tempto->checksum);
                    krb5_free_principal(tempto->client);    
                    xfree(tempto);
                    return retval;
            }
 
Related-file::Added 950404 by rusman::
/build/hiosfm/RCS/dce1.1/src/security/krb5/lib/krb/./copy_tick.c,v 8.2
 /build/hiosfm/RCS/dce1.1/src/security/krb5/lib/krb/./copy_tick.c,v 8.2
 rusman 1995/04/04 15:18:05 +4 -2
 Reason:  OSDqa11097 extra calls to free() create havoc
 avoid extra call to free() after failure of krb5_copy_keyblock()
 
     *** /tmp/ci.2483..copy_tick.c.2545.1       Tue Apr  4 11:18:07 1995
     --- /tmp/copy_tick.c.2545.2        Tue Apr  4 11:18:07 1995
     ***************
     *** 89,99 ****
     --- 89,101 ----
           if (!(tempto = (krb5_enc_tkt_part *)malloc(sizeof(*tempto))))
        return ENOMEM;
           *tempto = *partfrom;
           if (retval = krb5_copy_keyblock(partfrom->session,
                                    &tempto->session)) {
     + #ifndef hitm
        xfree(tempto->session);
     + #endif
        xfree(tempto);
        return retval;
           }
           if (retval = krb5_copy_principal(partfrom->client,
&tempto->client)) {
        krb5_free_keyblock(tempto->session);
 
Related-file:::: Resolution 
 DESCRIPTION OF BUG FIX:
  
 When krb5_copy_keyblock() fails, there is no cleanup required
 pertaining to the possible target of the copy.

[9/6/95 public]

Duplicate of 13034. 13034 also reports an additional memory leak not
mentioned here.



CR Number                     : 12833
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dced
Subcomponent Name             : hostdata / db
Short Description             : control api: client frees data twice
Reported Date                 : 3/31/95
Found in Baseline             : 1.1
Found Date                    : 3/31/95
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 12828
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[3/31/95 public]
Thanks to Purify for yelling about this one...

This problem may be dced or the backing database.

In admin/dced/server/hdops.c:hostdata_get_list(), dce_db_fetch() returns a
structure that can (and often does) have the data.storage_tag and data.name
members pointing to the same piece of memory. The client has no way of
knowing this and always frees these members individually, resulting in
multiple frees of the same memory. This structure is free'd in
admin/dced/api/dced_util.c:entry_list_free_ptrs().

This problem can be easily reproduced by doing a 'dcecp> hostdata catalog'.

Below shows the contents of id_d.data immediately after a dce_db_fetch() in
hostdata_get_list in dced.

>p id_d.data
data = struct dced_entry_s_t {
    id = struct uuid_t {
        time_low = 1527660;
        time_mid = 28362;
        time_hi_and_version = 7530;
        clock_seq_hi_and_reserved = 191;
        clock_seq_low = 144;
        node = 0x40320bf2;
    };
    name = 0x403c9a40;
    description = 0x403c9a70;
    storage_tag = 0x403c9a40;
}

Note that the .name and .storage_tag members point to the same memory. RPC,
helpful as ever, preserves this over the wire and the client frees the data
twice.

[04/04/95 public]
Is this a dup of 12828?

[04/04/95 public]
Yep. The fix that you put in CR12828... will this catch all occurances of
where aliasing pointers are going to bite us? ie. Do you do this elsewhere
that we may get into trouble with?

[04/05/95 public]
Possible.  storage_tag aliasing is the most likely culprit, but I
can't guarantee that there is no other pointer-copying going on.



CR Number                     : 12802
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : cds
Subcomponent Name             : cdsd
Short Description             : dcecp clearinghouse initiate -checkpoint hangs
Reported Date                 : 2/23/95
Found in Baseline             : 1.1
Found Date                    : 2/23/95
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 12182
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1maint
Affected File(s)              : 
Diff supplied by              : 
Diff release                  : 
Sensitivity                   : public

[2/23/95 public]
"dcecp clearinghouse initiate /.:/xxx_ch -checkpoint" hangs.  A preliminary
investigation revealed that the checkpoint thread was getting started, but
the thread was waiting for the writer count to go to zero.  When I get a
fix, I'll post it here.

--Roger

[12/12/95 public]
This OT is a duplicate of OT 12812.  A viable fix was posted there and
has been available for some time.  I can't close this since it is not
integrated into any baseline (it is not in 1.1-maint nor 1.2.1 core).

[10/8/96 public]

  Fix was submitted to 1.1 maintenance tree as the fix to OT12812.

[12/6/96 public]

duplicate of CLOSED OT 12182.



CR Number                     : 12792
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 9614
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : rpc
Subcomponent Name             : dg
Short Description             : Client fails with 'reject unkown'
when using authenication level 6 with multiple binding handles.
Reported Date                 : 2/8/95
Found in Baseline             : 1.0
Found Date                    : 2/8/95
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 9614
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b17
Affected File(s)              : 
Sensitivity                   : public

[2/8/95 public]
Client will fail with status 'unknown reject' when using multiple binding   
handles and authentication level 6.  The client will not fail when using
authentication levels 1-5 or one binding handle. 
The basic scenario of the client application is given below:
				.
			.
			.
		rpc_binding_set_auth_info(handle1,....)
		server_call(handle1,.....)
		rpc_binding_set_auth_info(handle2,....)
		server_call(handle2,.....) 
		st=unknown reject
			.
			.
			.
After investigating the problem, the server fails in the rpc__dg_execute_call
during the execution of rpc__krb_dg_recv_ck.  It seems the _recv_ck is being 
executed twice in the executor thread on the same packet: once in 
rpc__dg_call_receive_int and in rpc__dg_execute_call after a WAY validate.
The question arises if the client should be allowed to use multiple bindings
within the same process when using authentication level 6.  If so, then
why would rpc runtime try to decrypt the packet body twice for level 6 or 
even _recv_ck twice for levels 1-6.

[2/8/95 public]

Fixed in dce1.1. See OT9614.



CR Number                     : 12791
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 13001, 13002
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : 
Short Description             : dlgstr001 core dumps: sec_login_pvt_free_login_context SEGV
Reported Date                 : 2/7/95
Found in Baseline             : 1.0.3, 1.1
Found Date                    : 2/7/95
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 13002
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1maint
Affected File(s)              : security/client/login/sec_login_pvt.c
Sensitivity                   : public

[2/7/95 public]

The sec_login_pvt_free_login_context() routine frees storage associated
with a login context.  A free_identity(lcp->identity) is followed by
a sec__id_free_cache(lcp).  In turn, however, sec__id_free_cache() calls down
into sec_login_pvt_get_namecache(), sec_login_export_context() and
sec_login_pvt_check_exp(), which references the null pointer lcp->identity.

I tried to swap the order of free_identity() and sec__id_free_cache()
so that lcp->identity would be valid, but this caused other problems.
So I modified sec_login_pvt_check_exp() to only do the test if lcp->
identity is valid.  This eliminates the segv, but sec_login_export_context()
fails later on in sec_login_pvt_gen_export_token().  

This has come up while testing delegation.  Obviously, this code works in
other cases where sec_login_free_login_context() is called.  But I don't
understand it.  Why does sec__id_free_cache have to call sec_login_pvt_
get_namecache, which does a fair amount of initialization and may even 
return the default context handle?

[2/10/95 public]

I've duplicated the SEGV problem on a reference platform (OSF/1 Release 
1.2 on a 486).  The SEGV happens in dlg_intermediary in dlg_test_access 
(i.e. run dlg_client with no arguments).  When you remove the 
sec_login_purge_context at the end of this routine, the problem goes away.

The dlgstr001 test has been around for a while.  Why would others miss 
this failure?  Well the SEGV only happens when you're running the CN 
(tcp) RPC protocol.  And the "dlg_client" test reports success anyway, 
so if that's what you're looking at, you may go away happy.  The SEGV 
is over on the dlg_intermediary side, and after a minute or so. 

To summarize the problem from what I know now: sec_login_purge_context 
will core dump if your context came from a sec_login_become_delegate 
and you're running over the CN protocol.

[11/01/95 public]
Please see OT 13001 and 13002 for more details.

This is happening for both CN and DG, except for DG case, you have to wait 
for about 30 minutes before the server will core dump, and I don't think
whether sec_login_purge_context() is called or not is relavant.

What happens is: for CN case, when the call finishes (manager code is done),
the association is done and the call thread is brough down. This involves
clean up the krb info which eventually calls sec_login_pvt_free_login_context.
For the DG case, since there is no association, what happens is there is a
timer for each call thread and when the timer fn is called (there is no 
activity for so long, about 20 to 30 minutes), the call thread is brough down.
Same operation for cleaning up krb info.

The fix in OT 13001 and 13002 is to move sec__id_free_cache() call in front of
calls to free identity and krb_info and fix the problem in other part to make
it work. The reason that sec__id_free_cache(), which comes with overhead, is
called is because the cache stuff is defined, privately, in a C code and
sec__id_free_cache() is the only public fn you can call. Of course, making
some private fn to be public would help.

[11/01/95 public]

Thanx for answering this OT.  I had made a note that the 13002 patch might
fix the problem reported here.  We just re-ran the the dlg test last week, 
and we did not encounter the SEGV.

n

[11/03/95 public]
Marked this as dup of 13002. Will submit fix for 13002 (to 1.1maint) soon.



CR Number                     : 12766
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : aud
Subcomponent Name             : libaudit
Short Description             : Need local audit trail accessable from multiple processes
Reported Date                 : 12/12/94
Found in Baseline             : 1.1
Found Date                    : 12/12/94
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 11472
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[12/12/94 public]

Refer to CR 11372.

This is an enhancement request for the capability of multiple processes 
to be able to write to a local audit trail file.  (The central audit trail
file is too big for some layered processes.)



CR Number                     : 12709
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : krb5
Short Description             : Login using preauth KRB5 timestamps and account with non-default pepper fails.
Reported Date                 : 10/24/94
Found in Baseline             : 1.1b21
Found Date                    : 10/24/94
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 13305
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[10/24/94 public]

If client logs in using the KRB5 preauth timestamps protocol and
their account has a non-default pepper field, the login will fail.

Probably not a showstopper because unless DCED secval is down or 
is in an unstable state, this protocol will not be used by 1.1 clients.

Fix is to have secd return the correct pepper and client to retry
by generating a new DES key using the correct pepper.

[10/24/94 public]

This protocol is used by dced itself.
Can there be a connection between this CR and CR 12627, where
validate_first seems to get stuck for hours ?

[10/24/94 public]

I doubt it. dced validates with strong (non-plaintext) keys,
so I think that having a non-default pepper would not matter.

[4/30/96 public]

Duplicate of 13305. A fix is scheduled for 1.2.2.



CR Number                     : 12702
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : dcecp
Subcomponent Name             : 
Short Description             : intermittent "cdscache create" errors
Reported Date                 : 10/21/94
Found in Baseline             : 1.1b21
Found Date                    : 10/21/94
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 12550
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[10/21/94 public]
"dcecp -c cdscache create" occasionally needs to be executed more than once
before it works.  Since this doesn't happen with "cdscp define cached server"
and the errors suggest some kind of uninitialized variable or command arg
parsing problem, reported against dcecp -- but maybe it's just pilot error,
or something already fixed...  A particularly bad case requiring six attempts:

xy> dcecp -c cdscache create -binding "ncadg_ip_udp:15.21.249.8[]" cream
Error: Invalid network address
xy> dcecp -c cdscache create -binding "ncadg_ip_udp:15.21.249.8[]" cream
Error: Invalid network address
xy> dcecp -c cdscache create -binding "ncadg_ip_udp:15.21.249.8[]" cream
Error: Invalid RPC protocol sequence
xy> dcecp -c cdscache create -binding "ncadg_ip_udp:15.21.249.8[]" cream
Error: Invalid RPC protocol sequence
xy> dcecp -c cdscache create -binding "ncadg_ip_udp:15.21.249.8[]" cream
Error: Invalid network address
xy> dcecp -c cdscache create -binding "ncadg_ip_udp:15.21.249.8[]" cream

xy>



CR Number                     : 12674
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 12061, 12714
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dced
Subcomponent Name             : 
Short Description             : dcdrel002 fails
Reported Date                 : 10/19/94
Found in Baseline             : 1.1b23
Found Date                    : 10/19/94
Severity                      : B
Priority                      : 0
Status                        : dup
Duplicate Of                  : 12714
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[10/19/94 public]

The system test dcdrel002 fails. It happens with BL-22 and
BL-23. The errors are:

1- From the journal file

 bronze(hpux)    dcdrel002:             pass = 0, fail = 1
 "run.dced -l 1 -m bronze dcdrel002" completed at 10/19/94-17:31:44
/opt/dcelocal/bin complete: Oct 19 02:58 Failures under
/dcetest/dcelocal/status/system/dcdrel002.bronze.941019172353
There were 2 ERRORs and/or FAILures total in the 1 failed iterations.  
Here's the breakdown:
    1 - FAIL
    1 - results: dcdrel002: FATAL: Command failed
when it should not have. (Directory must be empty to be deleted)

2- from /tmp/dcdrel002.results

root@bronze> more dcdrel002.results
FATAL messages in /tmp/dcdrel002.bronze.log:
dcdrel002: FATAL: Server not stopped according to "server show"
dcdrel002: FATAL: Server not stopped according to "server show"
dcdrel002: FATAL: dcdrel002_client:
rpc_ns_binding_import_next(/.:/hosts/bronze/systest/dcdrel002_server.26049-req-restart):
No more bindings
dcdrel002: FATAL: dcdrel002_client:
rpc_ns_binding_import_next(/.:/hosts/bronze/systest/dcdrel002_server.26049-rpc-restart):
No more bindings
dcdrel002: FATAL: server ping
/.:/hosts/bronze/systest/dcdrel002_server.26049-req-restart
dcdrel002: FATAL: Command returned 0 when 1 was expected
dcdrel002: FATAL: server ping
/.:/hosts/bronze/systest/dcdrel002_server.26049-rpc-restart
dcdrel002: FATAL: Command returned 0 when 1 was expected
dcdrel002: FATAL: Cannot find a matching object.
dcdrel002: FATAL: Cannot find a matching object.
dcdrel002: FATAL: server ping
/.:/hosts/bronze/systest/dcdrel002_server.26049-req
dcdrel002: FATAL: Command returned 1 when 0 was expected
dcdrel002: FATAL: server ping
/.:/hosts/bronze/systest/dcdrel002_server.26049-rpc
dcdrel002: FATAL: Command returned 1 when 0 was expected
dcdrel002: FATAL: directory delete /.:/hosts/bronze/systest
dcdrel002: FATAL: Command failed when it should not have. (Directory must
be empty to be deleted)

3. from /tmp/dcdrel002.bronze.log

root@bronze> more dcdrel002.bronze.log
dcdrel002: Starting Test
dcdrel002: Executing directory create /.:/hosts/bronze/systest
dcdrel002: Executing acl modify /.:/hosts/bronze/systest -change
{{any_other rwdtcia}}
dcdrel002: Executing server create
/.:/hosts/bronze/config/server/dcdrel002_server.26049-req -attribute { 
        {program
/dcetest/dcelocal/test/tet/system/dced/ts/rel/dcdrel002_server}  
        {arguments /.:/hosts/bronze/systest/dcdrel002_server.26049-req} 
        {starton explicit} 
        {entryname /.:/hosts/bronze/systest/dcdrel002_server.26049-req}
        { services 
            {interface 00032b04-f3f0-1e0e-9ea7-0000c0dc0d4b,1.0}}
        }
dcdrel002: Executing server create
/.:/hosts/bronze/config/server/dcdrel002_server.26049-rpc -attribute { 
        {program
/dcetest/dcelocal/test/tet/system/dced/ts/rel/dcdrel002_server}  
        {arguments /.:/hosts/bronze/systest/dcdrel002_server.26049-rpc} 
        {starton auto explicit} 
        {entryname /.:/hosts/bronze/systest/dcdrel002_server.26049-rpc} 
        { services 
            {interface 00032b04-f3f0-1e0e-9ea7-0000c0dc0d4b,1.0}}
        }
dcdrel002: Executing server create
/.:/hosts/bronze/config/server/dcdrel002_server.26049-req-restart
-attribute { 
        {program
/dcetest/dcelocal/test/tet/system/dced/ts/rel/dcdrel002_server}  
        {arguments
/.:/hosts/bronze/systest/dcdrel002_server.26049-req-restart} 
        {starton {explicit failure} } 
        {entryname
/.:/hosts/bronze/systest/dcdrel002_server.26049-req-restart} 
        { services 
            {interface 00032b04-f3f0-1e0e-9ea7-0000c0dc0d4b,1.0}}
        }
dcdrel002: Executing server create
/.:/hosts/bronze/config/server/dcdrel002_server.26049-rpc-restart
-attribute { 
        {program
/dcetest/dcelocal/test/tet/system/dced/ts/rel/dcdrel002_server}  
        {arguments
/.:/hosts/bronze/systest/dcdrel002_server.26049-rpc-restart} 
        {starton {auto failure explicit} } 
        {entryname
/.:/hosts/bronze/systest/dcdrel002_server.26049-rpc-restart} 
        { services 
             {interface 00032b04-f3f0-1e0e-9ea7-0000c0dc0d4b,1.0}} 
        }
dcdrel002: Executing server start
/.:/hosts/bronze/config/server/dcdrel002_server.26049-req
dcdrel002: Executing server start
/.:/hosts/bronze/config/server/dcdrel002_server.26049-rpc
dcdrel002: Executing server start
/.:/hosts/bronze/config/server/dcdrel002_server.26049-req-restart
dcdrel002: Executing server start
/.:/hosts/bronze/config/server/dcdrel002_server.26049-rpc-restart
dcdrel002: Executing server ping
/.:/hosts/bronze/systest/dcdrel002_server.26049-req
dcdrel002: Executing server ping
/.:/hosts/bronze/systest/dcdrel002_server.26049-rpc
dcdrel002: Executing server ping
/.:/hosts/bronze/systest/dcdrel002_server.26049-req-restart
dcdrel002: Executing server ping
/.:/hosts/bronze/systest/dcdrel002_server.26049-rpc-restart
dcdrel002: Executing exec
/dcetest/dcelocal/test/tet/system/dced/ts/rel/dcdrel002_client ping_op
/.:/hosts/bronze/systest/dcdrel002_server.26049-req
dcdrel002: Executing exec
/dcetest/dcelocal/test/tet/system/dced/ts/rel/dcdrel002_client ping_op
/.:/hosts/bronze/systest/dcdrel002_server.26049-rpc
dcdrel002: Executing exec
/dcetest/dcelocal/test/tet/system/dced/ts/rel/dcdrel002_client ping_op
/.:/hosts/bronze/systest/dcdrel002_server.26049-req-restart
dcdrel002: Executing exec
/dcetest/dcelocal/test/tet/system/dced/ts/rel/dcdrel002_client ping_op
/.:/hosts/bronze/systest/dcdrel002_server.26049-rpc-restart
dcdrel002: Executing server stop
/.:/hosts/bronze/config/server/dcdrel002_server.26049-rpc
dcdrel002: Executing server stop
/.:/hosts/bronze/config/server/dcdrel002_server.26049-rpc-restart
dcdrel002: Executing server show
/.:/hosts/bronze/config/server/dcdrel002_server.26049-rpc -exec
dcdrel002: FATAL: Server not stopped according to "server show"
dcdrel002: Executing server show
/.:/hosts/bronze/config/server/dcdrel002_server.26049-rpc-restart -exec
dcdrel002: FATAL: Server not stopped according to "server show"
dcdrel002: Executing exec
/dcetest/dcelocal/test/tet/system/dced/ts/rel/dcdrel002_client ping_op
/.:/hosts/bronze/systest/dcdrel002_server.26049-rpc
dcdrel002: Executing exec
/dcetest/dcelocal/test/tet/system/dced/ts/rel/dcdrel002_client ping_op 
/.:/hosts/bronze/systest/dcdrel002_server.26049-rpc-restart
dcdrel002: Executing server show
/.:/hosts/bronze/config/server/dcdrel002_server.26049-rpc -exec
dcdrel002: Executing server show
/.:/hosts/bronze/config/server/dcdrel002_server.26049-rpc-restart -exec
dcdrel002: Executing exec
/dcetest/dcelocal/test/tet/system/dced/ts/rel/dcdrel002_client stop_bad_op
/.:/hosts/bronze/systest/dcdrel002_server.26049-req-restart
dcdrel002: Executing exec
/dcetest/dcelocal/test/tet/system/dced/ts/rel/dcdrel002_client stop_bad_op
/.:/hosts/bronze/systest/dcdrel002_server.26049-rpc-restart
dcdrel002: Executing exec
/dcetest/dcelocal/test/tet/system/dced/ts/rel/dcdrel002_client ping_op
/.:/hosts/bronze/systest/dcdrel002_server.26049-req-restart
dcdrel002: FATAL: dcdrel002_client:
rpc_ns_binding_import_next(/.:/hosts/bronze/systest/dcdrel002_server.26049-req-restart):
No more bindings
dcdrel002_client failed
dcdrel002: Executing exec
/dcetest/dcelocal/test/tet/system/dced/ts/rel/dcdrel002_client ping_op
/.:/hosts/bronze/systest/dcdrel002_server.26049-rpc-restart
dcdrel002: FATAL: dcdrel002_client:
rpc_ns_binding_import_next(/.:/hosts/bronze/systest/dcdrel002_server.26049-rpc-restart):
No more bindings
dcdrel002_client failed
dcdrel002: Executing server ping
/.:/hosts/bronze/systest/dcdrel002_server.26049-req-restart
dcdrel002: FATAL: server ping
/.:/hosts/bronze/systest/dcdrel002_server.26049-req-restart
dcdrel002: FATAL: Command returned 0 when 1 was expected
dcdrel002: Executing server ping
/.:/hosts/bronze/systest/dcdrel002_server.26049-rpc-restart
dcdrel002: FATAL: server ping
/.:/hosts/bronze/systest/dcdrel002_server.26049-rpc-restart
dcdrel002: FATAL: Command returned 0 when 1 was expected
dcdrel002: Executing server stop
/.:/hosts/bronze/config/server/dcdrel002_server.26049-req
dcdrel002: Executing server stop
/.:/hosts/bronze/config/server/dcdrel002_server.26049-rpc
dcdrel002: Executing server stop
/.:/hosts/bronze/config/server/dcdrel002_server.26049-req-restart
dcdrel002: FATAL: Cannot find a matching object.
dcdrel002: Executing server delete
/.:/hosts/bronze/config/server/dcdrel002_server.26049-req
dcdrel002: Executing server delete
/.:/hosts/bronze/config/server/dcdrel002_server.26049-rpc
dcdrel002: Executing server delete
/.:/hosts/bronze/config/server/dcdrel002_server.26049-req-restart
dcdrel002: Executing server delete
/.:/hosts/bronze/config/server/dcdrel002_server.26049-rpc-restart
dcdrel002: Executing directory delete /.:/hosts/bronze/systest
dcdrel002: FATAL: directory delete /.:/hosts/bronze/systest
dcdrel002: FATAL: Command failed when it should not have. (Directory must
be empty to be deleted)dcdrel002: Executing systest cleanup procedure
dcdrel002: Executing server stop
/.:/hosts/bronze/config/server/dcdrel002_server.26049-req -method hard
dcdrel002: Executing server delete
/.:/hosts/bronze/config/server/dcdrel002_server.26049-req
dcdrel002: Returned Error: Cannot find a matching object.
dcdrel002: cleanup: Could not remove
/.:/hosts/bronze/config/server/dcdrel002_server.26049-req
dcdrel002: Executing object delete
/.:/hosts/bronze/systest/dcdrel002_server.26049-req
dcdrel002: Executing server stop
/.:/hosts/bronze/config/server/dcdrel002_server.26049-rpc -method hard
dcdrel002: Executing server delete
/.:/hosts/bronze/config/server/dcdrel002_server.26049-rpc
dcdrel002: Returned Error: Cannot find a matching object.
dcdrel002: cleanup: Could not remove
/.:/hosts/bronze/config/server/dcdrel002_server.26049-rpc
dcdrel002: Executing object delete
/.:/hosts/bronze/systest/dcdrel002_server.26049-rpc
dcdrel002: Executing server stop
/.:/hosts/bronze/config/server/dcdrel002_server.26049-req-restart -method
hard
dcdrel002: Returned Error: Cannot find a matching object.
dcdrel002: cleanup: Could not stop
/.:/hosts/bronze/config/server/dcdrel002_server.26049-req-restart (may not
be running)
dcdrel002: Executing server delete
/.:/hosts/bronze/config/server/dcdrel002_server.26049-rpc-restart
dcdrel002: Returned Error: Cannot find a matching object.
dcdrel002: cleanup: Could not remove
/.:/hosts/bronze/config/server/dcdrel002_server.26049-rpc-restart
dcdrel002: Executing object delete
/.:/hosts/bronze/systest/dcdrel002_server.26049-rpc-restart
dcdrel002: Executing directory delete /.:/hosts/bronze/systest

[10/24/94 public]

While there may be some remaining problems with the test, the basic
problems are dced problems. There are actually several separate
problems occuring here. I've split out one of them to OT #12714. 
Rich has indicated that some will be fixed when he completes his
fixes to OT #12061. It is possible that other problems will surface
in this test once those are fixed. I'm switching this from a test
CR to a code CR.

[10/25/94 public]

To clarify the situation w.r.t. dcdrel002 testing and srvrconf
and srvrexec, I'm duping this to CRs 12061 and 12714 (and also 12061,
but the system doesn't allow multiple entries in the "Duplicate
of" field). If it becomes clear that there is an additional problem 
not covered by those CRs, a new CR will be opened to identify it.



CR Number                     : 12648
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : i486
S/W Ref Platform              : osf1
Component Name                : dced
Subcomponent Name             : dced
Short Description             : Smoketest failed to start dced in dce_config
Reported Date                 : 10/18/94
Found in Baseline             : 1.1
Found Date                    : 10/18/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 12647
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[10/18/94 public]

S:****** Initializing dced...
1994-10-18-08:34:08.727+00:00I----- dced FATAL dhd general main.c 476 0xa44de9fc
Initialization (initialize secval data) failed, status=0x113db0ed.
ERROR:   dced -i failed to start.
1994-10-18-08:34:09.947+00:00I----- dced ERROR dhd general main.c 781 0xa44de9fc
Process (pid 671) exited with status 0400
ERROR:    failed to start.
S:****** The current highest UNIX ID for persons on this node is 12351.



CR Number                     : 12642
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 12343
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : login
Short Description             : Extended login points not enabled
Reported Date                 : 10/17/94
Found in Baseline             : 1.1b21
Found Date                    : 10/17/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 12526
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[10/17/94 public]
This is a placeholder for the extended login audit points.



CR Number                     : 12606
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 12805
Project Name                  : dce
H/W Ref Platform              : i486
S/W Ref Platform              : osf1
Component Name                : dced
Subcomponent Name             : 
Short Description             : dcdrel001 core dumps dced
Reported Date                 : 10/12/94
Found in Baseline             : 1.1b21
Found Date                    : 10/12/94
Severity                      : B
Priority                      : 0
Status                        : dup
Duplicate Of                  : 12805
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.2.1
Affected File(s)              : dced
Sensitivity                   : public

[10/12/94 public]

BL-21
CONFIG:
HPUX: secd, dtsd, NTP provider	
OSF1: cdsd, dtsd		
OSF1: client, dtsd		
OSF1: client, secd replica		
HPUX: client, secd replica


I ran dcdrel001 on 4 nodes and found that on one of the OSF1 machines
dced core dumped. I have the core dump if someone wants to take a look.
I have not had time to do it myself. (We are running the test again)

The were other erros, here is the output of the log (which needs more
investigation)

root@needle> run_summary.ksh dcdrel001.needle.941011183302
  needle(hpux)    dcdrel001:             pass = 1, fail = 42
 "run.dced -t 15 -m west dce3 alan needle dcdrel001"
  completed at 10/12/94-09:43:29
  /opt/dcelocal/bin complete: Oct 7 02:58
  Failures under
	/dcetest/dcelocal/results/system/dcdrel001.needle.941011183302
  There were 189 ERRORs and/or FAILures total in the 42 failed iterations.
  Here's the breakdown:
  42 - FAIL
   1 - results: FATAL 00:12:08: Communicationsfailure (dce / rpc)
   1 - results: FATAL 00:42:58: Communications failure (dce / rpc)
   1 - results: FATAL 00:55:26: Communications failure (dce / rpc)
   1 - results: FATAL 01:48:34: Attempt to setup server failed
   1 - results: FATAL 02:40:24: Communications failure (dce / rpc)
   1 - results: FATAL 03:02:52: Communications failure (dce / rpc)
   1 - results: FATAL 03:47:49: Communications failure (dce / rpc)
   1 - results: FATAL 04:05:51: Communications failure (dce / rpc)
   1 - results: FATAL 04:29:13: Communications failure (dce / rpc)
   1 - results: FATAL 04:31:52: Communications failure (dce / rpc)
   1 - results: FATAL 04:32:13: Communications failure (dce / rpc)
   1 - results: FATAL 04:52:10: Communications failure (dce / rpc)
   1 - results: FATAL 05:36:01: Communications failure (dce / rpc)
   1 - results: FATAL 05:39:25: Communications failure (dce / rpc)
   2 - results: FATAL 05:45:05: RPC daemon communications failure (dce / rpc)
   1 - results: FATAL 07:50:43: Attempt to setup server failed
   1 - results: FATAL 09:35:19: Communications failure (dce / rpc)
   1 - results: FATAL 18:37:19: Communications failure (dce / rpc)
   1 - results: FATAL 19:59:12: Attempt to setup server failed
   1 - results: FATAL 20:44:43: Communications failure (dce / rpc)
   1 - results: FATAL 20:44:56: Communications failure (dce / rpc)
   1 - results: FATAL 20:45:00: Communications failure (dce / rpc)
   1 - results: FATAL 21:06:14: Communications failure (dce / rpc)
   1 - results: FATAL 21:23:45: Attempt to setup server failed
   1 - results: FATAL 21:46:21: Communications failure (dce / rpc)
   1 - results: FATAL 22:10:09: Communications failure (dce / rpc)
   1 - results: FATAL 22:25:02: Attempt to setup server failed
 118 - results: FATAL: certified login failed

[10/13/94 public]
Yeah, I'd like to know what else was running on that host (could someone
have eaten all the swap space?) and I want to look at the core file to get
a backtrace.

[10/13/94 public]

I recreated the problem running the dcdrel001 tests overnight on the following
cell:

BUILD: BL21

HP-UX: secd dtsd
OSF/1: cdsd dtsd
OSF/1: client dtsd ntp_provider

The tests were run from the HP, the dced core occurred on the OSF/1 machine
that was running the cds server.

[10/14/94 public]

Rich had me run dced in the debugger on the OSF/1 nodes, so of course we
got a dced core dump on the HP. 

The following is the trace:

 0 memcpy@libc + 0x00000008 (hp-ux export stub)
 1 rpc__naf_tower_flrs_to_addr@li + 0x00000050 (0x4, 0x400f75a0, 0x400f74ac, 0x404d9ec0)
 2 rpc_tower_to_binding@libdce + 0x00000088 (0x4, 0x400f7518, 0x400f74ac, 0x400f74ac)
 3 ping_server (ep = 0x405420d8, timeout = 3, status = 0x400f74ac)    [/project/dce/build/dce1.1-snap/src/admin/dced/server/oeops.c: 398]
 4 ep_ping1 (arg = 0x40015590)    [/project/dce/build/dce1.1-snap/src/admin/dced/server/oeops.c: 466]
 5 cma__thread_base@libdce + 0x0000021c (0x40033c18, 0, 0, 0)
 6 cma__thread_start1@libdce + 0x0000004c (0x40033c18, 0, 0, 0)
 7 cma__thread_start0@libdce + 0x00000008 (0x40033c18, 0, 0, 0)

[10/20/94 public]
It's always the same backstrace, but I don't see any bugs in ping_server.
I'm still looking but am not optimistic.

[4/5/95 public]

CR 12805 apparently deals with the same problem.  A fix from HP is posted
there.

[11/27/95 public]

Marked as dup as indicated in the notes here and in OT 12805.

[12/19/95 public]
Fixed in DCE 1.2.1 - along with 12805
Closed



CR Number                     : 12583
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : cds
Subcomponent Name             : 
Short Description             : cdsalias create <primary cellname> cores cdsd
Reported Date                 : 10/11/94
Found in Baseline             : 1.1b20
Found Date                    : 10/11/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 12222
Fix By Baseline               : 
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[10/11/94 public]

(In baseline bl-20.4)

In trying to setup a hierarchical relationship between a parent
and child cell, I took the simplified approach of creating a 
cell which has the desired name of the child to begin with. 
After setting up intercell access (via gdad/DNS) and permissions
on the root directories of both cells, I tried "cdsalias connect", 
which now appears to not take any arguments. 

This returned the error 

    Error: There is no existing primary alias for the local cell.

Indeed, the following showed this to be true:

    dcecp> cdsalias cat /.:
    {CDS_CellAliases {}}

Therefore, I attempted to create one, erroneously using the
cdsalias set command:

    dcecp> cdsalias set /.../oceans.qadce.osf.org/streams
    Error: The name provided was not an alias or the current cell name.

Therefore, I attempted to create the existing name as an alias:

    dcecp> cdsalias create /.../oceans.qadce.osf.org/streams
    Error: Connection closed

At this point, cdsd had core dumped.

dcecp> cdsalias cat /.:
Error: Requested entry does not exist

xdb on the core shows:

Child died due to: segmentation violation

0 add_cell_alias + 0x000007d8 (0x402c9f90, 0x402c9f8c, 0x402c9f8c, 0x4001e36c)
1 deb_ascii_ObjUID@libdce + 0x0000019c (0x402c970c, 0x402c8c5c, 0x1,
  0x402c9d7c)
2 cp_AddCellname + 0x00000190 (0x403ef978, 0x402c8844, 0x52, 0x402c8c5c)
3 op0_ssr + 0x000001b4 (0x403ef978, 0x4041f988, 0x402c851c, 0x400f21b8)
4 rpc__cn_call_executor@libdce + 0x000007c8 (0x4041f988, 0, 0, 0)
5 cthread_call_executor@libdce + 0x000002d4 (0x400ba898, 0x7af3a2c0,
  0x4004ad30, 0x13)
6 cma__thread_base@libdce + 0x0000021c (0x4004ad30, 0, 0, 0)
7 cma__thread_start1@libdce + 0x0000004c (0x4004ad30, 0, 0, 0)
8 cma__thread_start0@libdce + 0x00000008 (0x4004ad30, 0, 0, 0)
9 add_cell_alias + 0x000007d8 (0, 0, 0, 0)

[10/12/94 public]
Just because you entered a dcecp command and something bad happened doesn't
mean the code is in dcecp.  Particularly when cdsd core dumps.  :-)

[10/13/94 public]
I'm a bit suspicious of th eabove trace. While cp_AddCellname does in fact call
deb_ascii_ObjUid the later has no reason to call add_cell_alias. I checked the
code and sure enough it doesn't. I'm going to assign this to Roger to look
at.

[10/13/94 public]
I'm separating out the initial problem with "cdsalias connect" to a new CR.
Note that the issue in this CR appears to have been issueing "cdsalias create"
on a cell with no aliases, using as argument the existing name of the cell.

[10/13/94 public]
The only issue addressed by this ot now is the core dump. I beliwve this
is an unaligned uuid_p problem in deb_ascii_Obj_UUID and will fix it myself,
aauming I'm correct. The rest of this ot is now covered by 12622.

[10/17/94 public]
The alignment problem is  a dup of 12222. Will be fixed today hopefully.



CR Number                     : 12557
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 12548
Project Name                  : dce
H/W Ref Platform              : i486,hppa
S/W Ref Platform              : osf1,hpux
Component Name                : gds
Subcomponent Name             : gdssetup
Short Description             : HYP: gdssetup test failures
Reported Date                 : 10/7/94
Found in Baseline             : 1.1
Found Date                    : 10/7/94
Severity                      : B
Priority                      : 0
Status                        : dup
Duplicate Of                  : 12548
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[10/7/94 public]

Using binaries from 10/5:

GDSSETUP: TEST CASE lib/valid/sv_domnodef1 -> FAILED 
GDSSETUP: TEST CASE lib/valid/sv_domnodef2 -> FAILED 
GDSSETUP: TEST CASE lib/valid/sv_domnodef3 -> FAILED 
GDSSETUP: TEST CASE lib/valid/sv_domnodef4 -> FAILED 
GDSSETUP: TEST CASE lib/valid/sv_domnodef5 -> FAILED 
GDSSETUP: TEST CASE lib/valid/sv_domnodef6 -> FAILED 
GDSSETUP: TEST CASE lib/valid/sv_domnodef1_inter -> FAILED 
GDSSETUP: TEST CASE lib/valid/sv_domnodef2_inter -> FAILED 
GDSSETUP: TEST CASE lib/valid/sv_domnodef3_inter -> FAILED 
GDSSETUP: TEST CASE lib/valid/sv_domnodef4_inter -> FAILED 
GDSSETUP: TEST CASE lib/valid/sv_domnodef5_inter -> FAILED 
GDSSETUP: TEST CASE lib/valid/sv_domnodef6_inter -> FAILED 
"FINISHED all TESTS using <gdssetup>"
TCC End

-----------------------------------------------------------

Total PASSED =  179
Total FAILED =  12

[10/7/94 public]
Journals and logs are in the AFS cell.

[10/07/94 public]
OK - this is the same problem as 12548 because:

In the journal file you see i.e.:

---> Start of  lib/valid/sv_domnodef1.log

ERROR
 gc_t_modify /CN=schema -addattr TST=941006113217Z 
    A miscellaneous error occurred while interacting with the Directory Service.ERROR

So the gdssetup couldn't modify the schema - what is exactly the problem
of 12548. It seems to be a DSA problem.



CR Number                     : 12556
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dcecp
Subcomponent Name             : acl
Short Description             : can not add any_other acl with tcl syntax
Reported Date                 : 10/7/94
Found in Baseline             : 1.1b20
Found Date                    : 10/7/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 12549
Fix By Baseline               : 
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[10/7/94 public]

When trying to set acls on DFS objects I get:

dcecp> acl mod /:/ -add {any_other rx}
Error: Invalid ACL entry.

but if I use traditional string syntax it works:

dcecp> acl mod /:/ -add any_other:rx         
dcecp> acl show /:/
{mask_obj rwx-id}
{user_obj rwxcid}
{group_obj rwx-id}
{other_obj rwx-id}
{any_other r-x---}
dcecp> 

Am I doing something wrong?  or is this a defect?

[10/7/94 public]
Looks like a dup of the last CR to be fixed in the 1.1 tree.  Try it with
the latest bits and see, glad to reopen if necessary.

[10/7/94 public]
Glad I fixed CR12549. This is a dup.



CR Number                     : 12542
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : 
Short Description             : /opt/dcelocal/bin/bos: failed to add group 'subsys/dce/dfs-admin
Reported Date                 : 10/6/94
Found in Baseline             : 1.1
Found Date                    : 10/6/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 12536
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[10/6/94 public]

Platform - HPUX
Host - budapest
test - multimachine smoketest

Multimachine smoketest is hung - waiting to check for a Ubik sync site in  hosts/budapest

Earlier dcecp core smoketest had failed on sif.  I don't know if this is related
to OT 12536

extract from /u1/RAT_tools/do_test.dfs.log

S:****** Configuring DTS Local Server...
S:****** Stopping sec_client service...
dcecp -c secval deactivate {ncacn_ip_tcp:130.105.5.88[135]} FAILS: Err
or: permission not valid for this acl
S:****** Starting sec_client service...
dcecp -c secval activate {ncacn_ip_tcp:130.105.5.88[135]} FAILS: Error
: permission not valid for this acl
S:****** Starting dtsd...
1994-10-06-09:58:24.657-04:00I----- dtsd ERROR dts dtserror dtss_servi
ce_main.c 786 0x7aff9298
Error retrieving security configuration information: No currently esta
blished network identity for which context exists (dce / sec)
S:****** Starting dtstimed...
S:****** This node is now a DTS local server.
S:****** Configuring DFS Fileset Location Database Server...
S:****** Modifying the registry database for DFS operation...
S:****** Loading kernel extensions...
initializing Episode:  syscall return value = 0
S:****** Modifying the registry database for DFS server operation...

>>> group member added


>>> group member added

Current site is: registry server at /.../sif_cell/subsys/dce/sec/maste
r
Domain changed to: group
Current site is: registry server at /.../sif_cell/subsys/dce/sec/maste
r
Domain changed to: group
S:****** Starting bosserver...
/opt/dcelocal/bin/bos: failed to add group 'subsys/dce/dfs-admin' (une
xpected internal error; check bosserver log (dfs / bbs))
/opt/dcelocal/bin/bos: failed to add group 'subsys/dce/dfs-admin' (you
 are not authorized for this operation (dfs / bbs))
/opt/dcelocal/bin/bos: failed to create new server instance flserver o
f type 'simple' (you are not authorized for this operation (dfs / bbs)
)
Checking for a Ubik sync site in  hosts/budapest
udebug: failed to obtain ubik server information; Communications failu
re (dce / rpc)
Checking for a Ubik sync site in  hosts/budapest
udebug: failed to obtain ubik server information; Communications failu
re (dce / rpc)
Checking for a Ubik sync site in  hosts/budapest
udebug: failed to obtain ubik server information; Communications failu
re (dce / rpc)

[10/06/94 public]
It is a dup -- can't stop/start secval to update machine identity so
things fail.  Marked as such.



CR Number                     : 12541
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 9336
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : rpc
Subcomponent Name             : 
Short Description             : VM used up if pipe writer faster than reader
Reported Date                 : 10/6/94
Found in Baseline             : 1.1
Found Date                    : 10/6/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 9336
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[10/6/94 public]
When I was discussing the content of OT 12540, someone on the DCE tech
call mentioned that there's a separate architectural problem with DCE
RPC pipes; I don't know if it's limited to DG pipes or what.  The
issue is that if a pipe sender is faster than the receiver, the
received pipe data is buffered in memory with no throttle-back
indication to the sender.  The issue is potentially quite serious; DFS
uses a single pipe in order to transfer the contents of an entire
fileset, which can easily be in the 1 GB size range.  Even if it were
acceptable to bloat a receiving process's memory image by the contents
of a pipe, the receiving process could well exhaust available memory
to the breaking point in trying to do so.

[10/6/94 public]
As SEiichi correctly notes, this is a dup of CR 9336.
I said that CN had this problem, not DG.



CR Number                     : 12448
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dced
Subcomponent Name             : 
Short Description             : servers created with {starton failure} aren't restarted after failure exit
Reported Date                 : 9/30/94
Found in Baseline             : 1.1b20
Found Date                    : 9/30/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 12442
Fix By Baseline               : 
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[9/30/94 public]

DCDREL002 specifies 2 servers with the {starton failure} attribute,
starts them via dced, and then causes them to exit with failure
status. It waits 60 seconds and then tries to access them via
dcecp "server ping" and via an rpc call. Both attempts to access
them fail.

[9/3/94 public]
Reported and (partially) fixed today.

(Rick: Check the CR (12442) to be sure I'm right.)

[10/02/94 public]
You're right -- believed fixed as of Friday night's build.



CR Number                     : 12428
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : aud
Subcomponent Name             : 
Short Description             : cannot access /opt/dce/bin/auditd: No such file or directory
Reported Date                 : 9/30/94
Found in Baseline             : 1.1
Found Date                    : 9/30/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 12487
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[9/30/94 public]

This could be related to OT 12427.  I am opening an OT just in case it is not.

Platform - HPUX
Machine - budapest
test - multi-machine smoketest

extract from /u1/RAT_tools/do_test.dfs.log on budapest

+ ./dce_config -c /u1/RAT_tools/mult_mach_configs/budapest_secr_cdsr_ds.cmd -e /
u1/RAT_tools/mult_mach_configs/budapest_secr_cdsr_ds.env -i


S:****** Attempting to remove all remnants of previous DCE installations for
         all components...
S:****** Successfully removed all remnants of previous DCE installations for
         all components.
                installing sec_create_db secd pwd_strengthd ...
                installing dced cdsadv cdsclerk dtsd auditd dtstimed...
                installing dts_null_provider dts_ntp_provider...
                installing rpccp uuidgen cdscp getcellname getip...
                installing acl_edit dce_login rgy_edit dtscp dcecp...
                installing svcdumplog dcecf_postproc...
                installing sec_admin passwd_import passwd_export...
                installing kinit klist kdestroy...
cp: cannot access /opt/dce/bin/auditd: No such file or directory
Can't create file /opt/dcelocal/bin/auditd

[09/30/94 public]
This is most definitely a duplicate of 12427.  Since libaudit did not build
cleanly, is was not placed into the install tree and dce_config could not
install it.



CR Number                     : 12400
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dcecp
Subcomponent Name             : hostdata
Short Description             : hostdata show svc_routing
Reported Date                 : 9/28/94
Found in Baseline             : 1.1b19
Found Date                    : 9/28/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 11926
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[9/28/94 public]
On my 486 one machine cell named /.../dcecp_cell.osf.org/blue, the 
following command dumps core.

dcecp> hostdata show svc_routing

Program received signal 11, Segmentation fault
0x415a5a in print_attrs (Cannot access memory at address 0x4f525f43.

The trace is only marginally helpful

(gdb) where
#0  0x415a5a in print_attrs (Cannot access memory at address 0x4f525f43.

All the other hostdata objects 'show' fine.

[9/28/94 public]
What is this svc_routing? Could you please include it here? It dumps core 
in rgy_utils.c.

[9/29/94 public]
I just found it in the output of hostdata cat. You tell me what it is.

dcecp> hostdata cat
/.../dcecp_cell.osf.org/blue/hosts/claire/config/hostdata/dce_cf.db
/.../dcecp_cell.osf.org/blue/hosts/claire/config/hostdata/cell_name
/.../dcecp_cell.osf.org/blue/hosts/claire/config/hostdata/pe_site
/.../dcecp_cell.osf.org/blue/hosts/claire/config/hostdata/host_name
/.../dcecp_cell.osf.org/blue/hosts/claire/config/hostdata/cell_aliases
/.../dcecp_cell.osf.org/blue/hosts/claire/config/hostdata/post_processors
/.../dcecp_cell.osf.org/blue/hosts/claire/config/hostdata/svc_routing



CR Number                     : 12390
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : 
Short Description             : fts aggrinfo output jumbled
Reported Date                 : 9/28/94
Found in Baseline             : 1.1
Found Date                    : 9/28/94
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 12328
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[9/28/94 public]

platform - RIOS 
machine - mudslide
test - multi-machine smoke test

extract from /u1/RAT_tools/mult_mach_configs/run_test.dfs.out:

 ... Exiting cell_registration    
        Entering check_uids ...    
        ... Exiting check_uids    
        Entering check_aggr_data ...    
        check_aggr_data[29]: :: 0403-057 Syntax error  
        ... Exiting check_aggr_data    
        Entering users_filesets ....    
        fts create -ftname dfs_1.fs -server budapest -aggregate

It seems like the test passed except for the syntax error.  In that case,
one might lower the severity/priority.

Also, there seems to be an error in the test script and Annie Poh says
she is fixing it.

[9/28/94 public]
There are extra newlines in the fts aggrinfo output.  The
DFS read write all test trys to parse the output of aggrinfo
using awk.  The extra newlines cause a failure.  Assigned to Ruby.



CR Number                     : 12367
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dcecp
Subcomponent Name             : cds
Short Description             : "clearinghouse create" failing in functional tests
Reported Date                 : 9/27/94
Found in Baseline             : 1.1b18
Found Date                    : 9/27/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 12355
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[9/27/94 public]

When John runs the entire suite of dcecp FVTs, directory_merge_14_P
fails in its setup phase:

520|0 1 25245 1 46|directory_merge_14_P: Check that -clearinghouse option works.
520|0 1 25245 1 47|Command failed: {clearinghouse create /.:/test_ch}
520|0 1 25245 1 48|Command returned: {Binding incomplete (no object ID and no endpoint)}
520|0 1 25245 1 49|Test aborted.
220|0 1 2 18:05:00|UNRESOLVED

I am unable to reproduce this by running either the directory_merge
tests in isolation or the the whole "directory" set of tests. I have
never seen "clearinghouse create" fail in this manner. I don't know if
this situation is being created by preceding tests (the clearinghouse
tests come after the directory tests) or if there's a configuration
difference, or what.

[9/27/94 public]

I note that all the clearinghouse positive tests failed in the same
way. I've changed the short description and assigned this to Kevin.

[9/27/94 public]

This is a cds problem.



CR Number                     : 12331
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dcecp
Subcomponent Name             : era
Short Description             : xattr cat /.:/sec/xattrschema/era gives unexpected output
Reported Date                 : 9/24/94
Found in Baseline             : 1.1b18
Found Date                    : 9/24/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 12324
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[9/24/94 public]

I mistakenly typed 'cat' instead of 'show' to look at an ERA.  Seems
like I should get an error, instead got strange output with names of other
existing ERAS added to my attr:

dcecp> xattr cat /.:/sec/xattrschema/myattr
/.../marthal_home_cell.osf.org/sec/xattrschema/myattr/pre_auth_req
/.../marthal_home_cell.osf.org/sec/xattrschema/myattr/pwd_val_type
/.../marthal_home_cell.osf.org/sec/xattrschema/myattr/pwd_mgmt_binding
/.../marthal_home_cell.osf.org/sec/xattrschema/myattr/X500_DN
/.../marthal_home_cell.osf.org/sec/xattrschema/myattr/X500_DSA_Admin
/.../marthal_home_cell.osf.org/sec/xattrschema/myattr/disable_time_interval
/.../marthal_home_cell.osf.org/sec/xattrschema/myattr/max_invalid_attempts
/.../marthal_home_cell.osf.org/sec/xattrschema/myattr/passwd_override
/.../marthal_home_cell.osf.org/sec/xattrschema/myattr/test_any
/.../marthal_home_cell.osf.org/sec/xattrschema/myattr/test_void
/.../marthal_home_cell.osf.org/sec/xattrschema/myattr/test_printstring
/.../marthal_home_cell.osf.org/sec/xattrschema/myattr/test_printstring_array
/.../marthal_home_cell.osf.org/sec/xattrschema/myattr/test_integer
/.../marthal_home_cell.osf.org/sec/xattrschema/myattr/test_bytes
/.../marthal_home_cell.osf.org/sec/xattrschema/myattr/test_confidential_bytes
/.../marthal_home_cell.osf.org/sec/xattrschema/myattr/test_i18n_data
/.../marthal_home_cell.osf.org/sec/xattrschema/myattr/test_uuid
/.../marthal_home_cell.osf.org/sec/xattrschema/myattr/test_attr_set
/.../marthal_home_cell.osf.org/sec/xattrschema/myattr/test_binding
/.../marthal_home_cell.osf.org/sec/xattrschema/myattr/myattr
dcecp> xattr show /.:/sec/xattrschema/myattr
{aclmgr
 {{principal {{query r} {update rfu} {test r} {delete Dm}}}
  {group {{query r} {update rm} {test rt} {delete Dm}}}
  {organization {{query r} {update rm} {test rt} {delete Dm}}}}}
{annotation {}}
{applydefs no}
{encoding printstring}
{intercell reject}
{multivalued yes}
{reserved no}
{scope {}}
{trigbind {none {}}}
{trigtype none}
{unique no}
{uuid 13c5d452-d7bd-11cd-9104-0000c0b7df56}
dcecp> xattr cat /.:/sec/xattrschema
/.../marthal_home_cell.osf.org/sec/xattrschema/pre_auth_req
/.../marthal_home_cell.osf.org/sec/xattrschema/pwd_val_type
/.../marthal_home_cell.osf.org/sec/xattrschema/pwd_mgmt_binding
/.../marthal_home_cell.osf.org/sec/xattrschema/X500_DN
/.../marthal_home_cell.osf.org/sec/xattrschema/X500_DSA_Admin
/.../marthal_home_cell.osf.org/sec/xattrschema/disable_time_interval
/.../marthal_home_cell.osf.org/sec/xattrschema/max_invalid_attempts
/.../marthal_home_cell.osf.org/sec/xattrschema/passwd_override
/.../marthal_home_cell.osf.org/sec/xattrschema/test_any
/.../marthal_home_cell.osf.org/sec/xattrschema/test_void
/.../marthal_home_cell.osf.org/sec/xattrschema/test_printstring
/.../marthal_home_cell.osf.org/sec/xattrschema/test_printstring_array
/.../marthal_home_cell.osf.org/sec/xattrschema/test_integer
/.../marthal_home_cell.osf.org/sec/xattrschema/test_bytes
/.../marthal_home_cell.osf.org/sec/xattrschema/test_confidential_bytes
/.../marthal_home_cell.osf.org/sec/xattrschema/test_i18n_data
/.../marthal_home_cell.osf.org/sec/xattrschema/test_uuid
/.../marthal_home_cell.osf.org/sec/xattrschema/test_attr_set
/.../marthal_home_cell.osf.org/sec/xattrschema/test_binding
/.../marthal_home_cell.osf.org/sec/xattrschema/myattr

[9/24/94 public]
The reason is simple that sec uses only one attr schema object now
and ignores to check because it'll make no difference on server side. 
This is the same treatment used by dced server and Jim at HP opened 
an OT against dced schema server (OT#12324) too. 
In this case, dcecp does "right" thing not to check the attr schema object
name because schema server is the one who knows name.

[9/26/94 public]
The "bug" if it is that is on the dced server side and is represented by CR
12324 as ping said.  I'm still trying to figure out if it's in fact a bug.
See that CR for details.



CR Number                     : 12320
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000,i486
S/W Ref Platform              : aix,osf1
Component Name                : dcecp
Subcomponent Name             : dcecp
Short Description             : dcecp smoketest fails
Reported Date                 : 9/23/94
Found in Baseline             : 1.1
Found Date                    : 9/23/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 12319
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : do_automatic_test
Sensitivity                   : public

[9/23/94 public]

The dcecp smoketest fails on the RIOS and AT486.  I'm creating a new
OT because the dcecp build problem's fixed (OT 12312) so I'll cancel
my update to 12312 about the smoketest.

(The HPUX core smoketest hasn't finished yet due to possible network
delays.)

[9/23/94 public]

Fixed incorrect OT# reference.

[9/23/94 public]
Dup of 12319.



CR Number                     : 12313
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : 
Short Description             : set context fails
Reported Date                 : 9/23/94
Found in Baseline             : 1.1b17
Found Date                    : 9/23/94
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 12311
Fix By Baseline               : 
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[9/23/94 public]

Moving data from 11913:
Running fts tests 12 + 14 in the DFS CHO cell on bl-16 produced:

Removing filesets...
Fileset 0,,123 on aggregate m3.aggr2 server /.:/hosts/dce11 deleted
AFS_SetContext(cobbler.osf.org) fails: who are you failed (dce / rpc)
Error in delete: who are you failed (dce / rpc)
AFS_SetContext(cobbler.osf.org) fails: who are you failed (dce / rpc)
Error in delete: who are you failed (dce / rpc)
Fileset 0,,134 on aggregate m3.aggr2 server /.:/hosts/dce11 deleted
fts delmount: error removing mount point for /.../cho_cell.qadce.osf.org/fs/test
/ft4.5377: Connection timed out

Reproduced with bl-17 - (This portion of the fts tests is testing
quotas so "disk quota exceeded" messages are GOOD :-)

dfs: rpc errors (code 382312711) from the fx server 130.105.5.22 in cell cobbler
_cell.qadce.osf.org
dfs: server disk quota exceeded
dfs: server disk quota exceeded
dfs: rpc errors (code 382312543) from the fx server 130.105.202.28 in cell cobbl
er_cell.qadce.osf.org
dfs: server disk quota exceeded
dfs: set context failed: code 691089613
dfs: lost contact with the fx server 130.105.202.28 in cell cobbler_cell.qadce.o
sf.org
dfs: file server 130.105.202.28 in cell cobbler_cell.qadce.osf.org back up!
dfs: server disk quota exceeded
dfs: server disk quota exceeded
dfs: rpc errors (code 382312543) from the fx server 130.105.201.7 in cell cobble
r_cell.qadce.osf.org
dfs: set auth binding failed (code 382312711); running unauthenticated.
dfs: server disk quota exceeded
dfs: server disk quota exceeded
dfs: set context failed: code 691089613
dfs: lost contact with the fx server 130.105.201.7 in cell cobbler_cell.qadce.os
f.org
dfs: file server 130.105.201.7 in cell cobbler_cell.qadce.osf.org back up!
dfs: server disk quota exceeded
dfs: server disk quota exceeded
dfs: server disk quota exceeded
dfs: server disk quota exceeded

where:
stcode_hp 382312711
382312711 (decimal), 16c9a107 (hex): Helper process catatonic (dce / rpc)

stcode_hp 691089613
691089613 (decimal), 293130cd (hex): status 0x293130cd (dfs / xvl)

stcode_hp 382312543
382312543 (decimal), 16c9a05f (hex): Who are you failed (dce / rpc)

We suspect these errors are the result of general performance problems
so this CR is only a 1 and mainly a placeholder to document symptoms.
DFS performance problems are being tracked by CR 12281.
The specific symptom of dfsbind spinning is being tracked by CR 12311.
The fact that the fts tests 12 + 14 don't pass is CR 11708.

I will be turning off auditing in my DFS cells this weekend. Any additional
ideas for improving/evaluating performance welcome.

[9/23/94 public]
Dup'ing per burati request - these symptoms are believed to be the
direct result of dfsbind spinning (CR 12311)



CR Number                     : 12301
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : sevicability
Short Description             : messages with a severity level
of "notice" are not output
Reported Date                 : 9/22/94
Found in Baseline             : 1.1
Found Date                    : 9/22/94
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 12280
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[9/22/94 public]

 Sams file messages with severities of "warning" are dropped. The routing
for the warning severity level must be initialized to fix this problem.



CR Number                     : 12287
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dced
Subcomponent Name             : sx
Short Description             : dced core dumped when a server stops
Reported Date                 : 9/21/94
Found in Baseline             : 1.1b18
Found Date                    : 9/21/94
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 12102
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b19
Affected File(s)              : sxops.c
Sensitivity                   : public

[9/21/94 public]

Using the nightly build from 9/20-21 (todays).

I was running a dtsd via srvrconf on a 486, I did a dts stop
from dcecp and dced core dumped.

Trace isn't too helpfull:
Core was generated by `dced'.
Program terminated with signal 11, Segmentation fault.
#0  0xa40408b5 in acl_db ()

[main/run stuff]

(gdb) where
#0  0xa40408b5 in strcmp ()
Cannot access memory at address 0xc603ed40.

[9/21/94 public]
This is more general.  When you stop any server "server stop xxx",
dced dumps core.  And it didn't even stop the thing.
(I just saw this today and was narrowing it down.)

[9/21/94 public]
Just FYI, "server stop xxx" means stoping a server by "rpc" which,
as far as I know, doesn't work yet (OT#12061). To kill a server,
you can do "server stop xxx -method hard" and it should work.

[9/21/94 public]
Just for another datapoint, Tom Jordahl and I have been using "server stop 
xxx -method soft" often over the past several days, and it works fine.

[9/21/94 public]
it isn't the command that is killing dced.
I used 'dts stop' to shut it down, I would guess that something
went bad when the process exited without going through dced...

[9/21/94 public]

Another data point: I had no trouble with "server stop xxx -method
soft" last week when I was testing with "dummy" servers: the processes
stopped, and the servers disappeared from
/.:/hosts/<host>/config/srvrexec, just as they're supposed to. (I
think this even worked if I killed the server processes by hand.) But
the last couple of days, I've been trying this with a real dtsd and
cdsadv on a client machine, and dced died somewhere during the
sequence (I didn't have my eyes glued to the window where I'd started
dced, so I don't know exactly what caused it to die).

[9/21/94 public]
Submitted potential fix for NB.  Retry and update.



CR Number                     : 12284
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dced
Subcomponent Name             : srvrconf
Short Description             : server delete core dumps on 486
Reported Date                 : 9/21/94
Found in Baseline             : 1.1b18
Found Date                    : 9/21/94
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 12102
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b19
Affected File(s)              : scops.c scimpl.h
Sensitivity                   : public

[9/21/94 public]

server delete core dumps in serverconf FVT's (486).  Noticed while
investogated server start core dump OT.  Am investigating for more
info....

[9/21/94 public]
Submitted potential fix for NB.



CR Number                     : 12236
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : sec
Subcomponent Name             : secd
Short Description             : secd core dumped w/in 6 hours
Reported Date                 : 9/19/94
Found in Baseline             : 1.1b18
Found Date                    : 9/19/94
Severity                      : C
Priority                      : 1
Status                        : dup
Duplicate Of                  : 11722
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[9/19/94 public]

Put the RIOS back into the DFS CHO cell ... didn't get far ...

root@cobbler> ls -l ./var/security/core
-rw-rw-rw-   1 root     bin      5189323 Sep 17 00:16 ./var/security/core

root@cobbler> ls -l dce_cf.db
-rw-r--r--   1 root     bin           60 Sep 16 18:21 dce_cf.db

ie. secd coredumped w/in 6 hours of configuring the cell. NO TESTS
WERE USED TO CREATE THIS COREDUMP - that is, the cell was and had been
idle since it was configured. Unfortunately, (despite/because?
of) the changes to libdce.a in 1.1b18, the core dump was not usable:

root@cobbler> dbx /opt/dcelocal/bin/secd ./var/security/core
dbx version 3.1 for AIX.
Type 'help' for help.
./var/security/core does not contain a stack (core ignored)
reading symbolic information ...

DFS CHO config is:

 1 RIOS X 3 HP
 m1 (R) = security server, dts server, flserver, fileserver (native and lfs)
 m2 (H) = cds server, dts server, flserver, fileserver (native and lfs)
 m3 (H) = dts server, flserver, fileserver (native and lfs)
 m4 (H) = client-only

[9/19/94 public]
I have a cell which I ran cds killer on without any problems. secd has
been active for more than 18 hours.

[9/19/94 public]
Thanks for the update - good datapoint - unclear whether it matters but
just for clarity, is your cell ALSO a SPLIT SERVER cell like mine? ie.
secd and cdsd on separate machines (and in my case, separate platforms)?

[9/19/94 public]
I have two cells, a single machine cell and a 2 machine cell. Neither
cell has had secd dump core. The secd on the spilt server has been running
for over 18 hours. I hope to have a full core dump working soon.

[9/20/94 public]
I rebooted the cell yesterday and again left the cell idle overnight - no
problems ... I had problems with secd crashing on RIOS a couple of months
ago and this pattern seems to be familiar ie. rebooted cell okay but newly
config'd secd on RIOS doesn't live as long - can't think of what would be
unique except the registry manipulations that dce_config does ... ideas
(and a full core dump working!) more than welcome.

[9/22/94 public]
As Howard pointed out, since rebooting is a workaround (an expensive one
for system test but still a workaround) severity is a C. I'm also dropping
priority to a 1 since, if I'm correct and rebooting IS a workaround, this
will not block system test.

[10/3/94 public]
Dup'ing to 11722 - the problems with secd on RIOS (whether master or replica)
began awhile ago - they have not been seen recently BUT the RIOS platform
is not being used for dce1.1 core servers much either. The problem with
unreadable RIOS core files has been solved so if hit again, useful data
will hopefully come of it. I hope to be using the RIOS as a secd master
this weekend - maybe there'll be something for the unintegrated tree ...



CR Number                     : 12235
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : 
Short Description             : acl_edit test fails
Reported Date                 : 9/17/94
Found in Baseline             : 1.1b17
Found Date                    : 9/17/94
Severity                      : C
Priority                      : 3
Status                        : dup
Duplicate Of                  : 12012
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
			test/security/api/moretests/acl_edit.sh
Sensitivity                   : public

[9/17/94 public]

The output of acl_edit appears to have changed and the test case is
expecting a different value. In the file moretests/acl_edit.sh in the
function do_c, the following lines exist:

        acl_edit $MASK_TEST_OBJ -m user:root:crwx 2> /tmp/acl_edit.out
        read error_line </tmp/acl_edit.out
        REP=`cat /tmp/acl_edit.out | sed -e "s/ERROR.*/ERROR/"`
        check_status "$REP" "ERROR" 1 "acl_edit -m user:root:crwx"

The output in /tmp/acl_edit.out is the following:

ERROR: SEC_ACL_EDIT - would unintentionally grant permissions via recalculated m
ask
 (dce / sad)


Therefore, the value of REP is "ERROR (dce /sad)", which is incorrect.
The following code corrects this problem:

        acl_edit $MASK_TEST_OBJ -m user:root:crwx 2> /tmp/acl_edit.out
        read error_line </tmp/acl_edit.out
        read error_line </tmp/acl_edit.out
        REP=`echo $error_line | awk -F":" '{print $1}'`
        check_status "$REP" "ERROR" 1 "acl_edit -m user:root:crwx"

[ sekhar 9/19/94 public ]

This is a dup of 12012 which is already fixed in bl18.

So submitting the above fix will only cause the test to 
fail again in bl18.

Also, I checked the acl_edit.sh in the 1.1 source tree but could not 
find the line 

    read error_line </tmp/acl_edit.out  

anywhere .

[9/17/94 public]
I have not done a bsubmit on the file. There should have been only one
line with "read error_line", my mistake. However, this change will
always work regardless of the number of lines that are in the output
file. I will leave the code as it is without this change.



CR Number                     : 12189
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : i486
S/W Ref Platform              : osf1
Component Name                : sec
Subcomponent Name             : krb
Short Description             : rpc.sec.2 test clients fail with Credentials cache I/O operation error
Reported Date                 : 9/14/94
Found in Baseline             : 1.1b17
Found Date                    : 9/14/94
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 12070
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[9/14/94 public]

Two of 9 test clients failed with error  0x141290bd
 Credentials cache I/O operation failed XXX (dce / krb)
running rpc.sec.2 tests.

The test clients were both on OSF/1 using tcp protocol.  The third client
on the machine, also running tcp didn't fail.  The priority may change, 
depending on how reproducible this is. 

NB: baseline 17

Cell:

HPUX: cdsd secd dtsd
OSF1: client dtsd
OSF1; client dtsd ntp provider

[9/14/94 public]

Should have added that the clients failed after 7 hours.



CR Number                     : 12149
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : 
Short Description             : Can't make authenticated RPCs after cellname change.
Reported Date                 : 9/12/94
Found in Baseline             : 1.1b17
Found Date                    : 9/12/94
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 12150
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[9/12/94 public]
root@absolut /$ dce_shutdown
1994-09-12-16:47:58.617-04:00I----- auditd ERROR aud general dmn_rpc_manager.c 962 0x40022268
Client has no permission to execute operation

The shutdown hung for a while and auditd was not stopped.  I had configured
a 1.1b17 cell, I had added an alias and had just set it to be the primary
name.  (the sec, cds and dce_cf.db portions).  I was trying to stop and
restart the cell to see if things would work and the stop hung in auditing.

[09/14/94 public]
From the error message, it seems that dce_shutdown did not have the
permission to execute the dcecp "aud stop" command.  It needs to be
root, (or at least be part of the "audit-admin" group I think).
It should have same permissions as dce_config I think.  Does it?

[9/14/94 public]
I was logged in as root and I was NOT dce_login'ed.

[9/14/94 public]
Howard, is this repeatable?  I have been able to start and stop with
dce_config the auditd many times using BL-17. Also, if you did a complete
config with a bl-17 dce_config, the cell-admin is part of the audit-admin
group.  So, you should be able to start and stop auditd as either
cell-admin or as root.

[9/14/94 public]
Folks you seemed to have missed what I described above as the scenario:

> I had configured a 1.1b17 cell, I had added an alias and had just set it to
> be the primary name.  (the sec, cds and dce_cf.db portions).  I was trying
> to stop and restart the cell to see if things would work and the stop hung
> in auditing.

Have you tried to add an alias and change the primary name of the cell?

Note that the cellalias script while submitted and installed still has some
problems so you need to do the stuff there by hand.

I'm going to try to get to this stuff again today, so I'll see if I can
reproduce.

[09/14/94 public]
Looking into dce_shutdown, the command is indeed "dcecp -c aud stop", so the
first line of defense is dcecp: to figure out whether the hang is in dcecp, or
auditd causes dcecp to hang, which causes dce_shutdown to hang... so I am shifting
this to dcecp for the time being.
When auditd issues the message "no permission to execute operation", it returns this
status back to dcecp.

[9/14/94 public]
I traced this down into the acl library. acleval.c:dce_acl_inq_client_creds().

The problem is that rpc_binding_inq_auth_caller() is returning
rpc_s_binding_has_no_auth. Again, this is only when a cell alias had
been created and the primary name of the cell is being changed (the
dce_cf.db file has been changed but things haven't been restarted, so
the cell/machine is in a weird state).  Is there a problem trying an
authenticated RPC in this state?  Rich?

[09/14/94 public]
I think John's analysis is right, and that this is either a non-bug or
an RPC/SEC problem.  I flipped a coin and RPC "won" :-)

[9/15/94 public]

I bet that dcecp is making an unauthenticated rpc to dced because
rpc_s_binding_has_no_auth happens only when the client binding has no auth
info. aud_bind_to_server()::aud_util.c sets authn_protocol to
rpc_c_authn_none if there is no login context. Probably, when the primary
name of the cell got changed, the host lost its login context?

[09/15/94 public]
I wonder if this is related to OT CR 12150?

[9/15/94 public]
Howard, do a klist as root before and after the attempt to shutdown.  Both
cases should show valid credentials.  If not, look to see if the
/opt/dcelocal/var/security/creds/*fff* files are there.

[9/15/94 public]
Forget that, the dce_shutdown script removes all contents of the creds
directory (it does this after killing daemons).  So, after shutdown no
creds.  Still, verify that klist after setting cell_alias to primary 
and before shutdown is valid.

[9/15/94 public]
I think people are missing the obvious here.
dce_shutdown does not do a dce_login as cell admin (I removed that)
so it might not have permissions to shutdown audit.

I *know* it doesn't have permissions to use sec_admin/dcecp
to shutdown secd.

If you want to do this 'nicely' (aka no kill), you should dce_login
as cell_admin before running dce_shutdown.  Its a trade-off
since prompting for cell admins password every time you shutdown
is a pain (and we are the primary users of these scripts).

In any case, this really isn't an excuse for dcecp hanging.

[9/15/94 public]
Nope.  John and I had tried this last night by hand and we've gotten to a
real error.  Just to be clear:

 * the hang was probably dced hanging, see CR 12150
 * this defect is that auditing didn't shut down
 * I was running as root and not dce_login'ed
 * The interesting thing was that I was changing the primary name of the cell.
 * John and I brought up a cell, added an alias (sec,cds,dce_cf.db).
 * then we stopped and restarted and everything was fine.
 * Then I changed the primary name of the cell (sec,cds, and dce_cf.db).
 * We found that if you change the cellname in dce_cf.db you can't START
   audit.  If you leave the name alone you can start it, if while its
   running you change the name, you can't stop it.  By stop it I mean being
   logged in as root (not dce_login'ed) and using "aud stop" in dcecp.  Now
   if you change the name in dce_cf.db back, you can stop. 
 * Ergo, changing the name of dce_cf.db means you can't stop auditing.
 * Why? we traced it into auditd and into the acl manager.  When doing the
   check the acl manager thinks we're unauthenticated as a result of
   rpc_binding_inq_auth_caller() returning rpc_s_binding_has_no_auth.
 
Now to respond to tatsu_s I don't think we're making an unauth call
(remember it works if you go and edit dce_cf.db back, so we are running the
same code).  It's something that changing the dce_cf.db file is breaking
rpc_binding_inq_auth_caller.

I just changed this back to comp=rpc for the above reasons.  I ran my
reasoning by rsalz and he agreed.  I don't really want to spend time moving
this CR back and forth so if you don't think in there, let me know.

[9/15/94 public]

But, you havn't verified that dcecp is making an auth rpc. I would suggest
to check it by calling rpc_binding_inq_auth_info(dcp_aud_binding_h,...) in
dcecp. I can't do it here.

[09/15/94 public]
Just to add some more info, this is the ACL that auditd manages:

dce1.1# acl_edit /.:/hosts/kazoo/audit-server
sec_acl_edit> l
# SEC_ACL for /.:/hosts/kazoo/audit-server:
# Default cell = /.../torolab.ibm.com
unauthenticated:-r--
user:hosts/kazoo/self:crw-
group:subsys/dce/audit-admin:crwl
any_other:-r--
sec_acl_edit> 

Regarding the change of cellname which caused auditd not to START, it could be 
that you need to remove the acl file: /opt/dcelocal/var/audit/adm/acl, as
dce_config does today?

[9/16/94 public]
Ok. Several things are happening here...

For all the work below, all operations are run as root (machine principal).

klist in this state shows:
# klist
DCE Identity Information:
        Global Principal: <Unable to generate principal name>
        Cell:      9c0d9802-d16b-11cd-86d1-080009251352 <cell name unknown>
        Principal: 000030a2-d16b-21cd-8600-080009251352 <principal name unknown>
        Group:     0000000c-d16b-21cd-8601-080009251352 <group name unknown>
        Local Groups:
                0000000c-d16b-21cd-8601-080009251352 <group name unknown>
                000013f1-d16b-21cd-8c01-080009251352 <group name unknown>

Identity Info Expires: 94/09/17:00:04:29
Account Expires:       never
Passwd Expires:        never

Kerberos Ticket Information:
Ticket cache: /opt/dcelocal/var/security/creds/dcecred_ffffffff
Default principal: hosts/absolut/self@absolut_cell
Server: krbtgt/absolut_cell@absolut_cell
        valid 94/09/16:14:04:29 to 94/09/17:00:04:29
Server: dce-rgy@absolut_cell
        valid 94/09/16:14:04:29 to 94/09/17:00:04:29
Server: dce-ptgt@absolut_cell
        valid 94/09/16:14:04:35 to 94/09/16:16:04:35
Client: dce-ptgt@absolut_cell   Server: krbtgt/absolut_cell@absolut_cell
        valid 94/09/16:14:04:36 to 94/09/16:16:04:35
Client: dce-ptgt@absolut_cell   Server: dce-rgy@absolut_cell
        valid 94/09/16:14:04:37 to 94/09/16:16:04:35
Client: dce-ptgt@absolut_cell   Server: hosts/absolut/self@absolut_cell
        valid 94/09/16:14:04:38 to 94/09/16:16:04:35
Client: dce-ptgt@absolut_cell   Server: dce-rgy@absolut_cell
        valid 94/09/16:14:05:04 to 94/09/16:16:04:35
Client: dce-ptgt@absolut_cell   Server: dce-rgy@absolut_cell
        valid 94/09/16:14:05:08 to 94/09/16:16:04:35
Client: dce-ptgt@absolut_cell   Server: hosts/absolut/cds-server@absolut_cell
        valid 94/09/16:14:05:09 to 94/09/16:16:04:35
Client: dce-ptgt@absolut_cell   Server: hosts/absolut/cds-server@absolut_cell
        valid 94/09/16:14:05:09 to 94/09/16:16:04:35
Client: dce-ptgt@absolut_cell   Server: hosts/absolut/cds-server@absolut_cell
        valid 94/09/16:14:05:10 to 94/09/16:16:04:35
Client: dce-ptgt@absolut_cell   Server: dce-rgy@absolut_cell
        valid 94/09/16:14:05:12 to 94/09/16:16:04:35
Client: dce-ptgt@absolut_cell   Server: hosts/absolut/cds-server@absolut_cell
        valid 94/09/16:14:05:12 to 94/09/16:16:04:35
Client: dce-ptgt@absolut_cell   Server: hosts/absolut/self@absolut_cell
        valid 94/09/16:14:05:33 to 94/09/16:16:04:35
Client: dce-ptgt@absolut_cell   Server: dce-rgy@absolut_cell
        valid 94/09/16:14:11:56 to 94/09/16:16:04:35
Client: dce-ptgt@absolut_cell   Server: hosts/absolut/self@absolut_cell
        valid 94/09/16:14:12:09 to 94/09/16:16:04:35

Notice that the principal and group names can't be resolved at the top.

Starting dcecp in this state, dcecp tries to inherit the existing login
context. This fails when sec_rgy_cell_bind(binding to "/.:") fails with
"Registry server unavailable". This seems to be bug #1.

Starting dcecp in the state where the dce_cf.db file is in the state
where the primary has not been switched works (as expected). Switching
around the dce_cf.db file and then continuing dcecp, dcecp fails while
getting a binding handle to the audit daemon in rpc_binding_set_auth_info
with "Registry server unavailable." again. Bug #2?

Starting dcecp in the same state, but not switching the dce_cf.db file
around until after it has acquired a binding handle to auditd. I inserted
a call to rpc_binding_inq_auth_info() just before the RPC to stop
the audit daemon. I swaped aroung the dce_cf.db file before this call.
The rpc_binding_inq_auth_info() call succeeded and returned the information
that I expected (pkt_privacy and friends). Continuing from there, the
audit daemon DID stop.

It seems that if you build the binding handle under the 'old' cell
naming scheme, the servers call to the acl manager library will work.
The call to rpc_binding_inq_auth_caller() mentioned above seems to
work if the binding handle is built with the original naming scheme, 
but fails once the primary name has been changed.

[9/16/94 public]
I've made this statement to those involved, but for the record:
DCE RPC does not read the dce_cf.db in any way.  Thus, if somethings
fails (such as rpc_binding_inq_auth_caller()) when you change this
file, you should find something (security comes to mind) which *does*
open and read this file.

Adding security to the CC list in the expectation that this bug will
be reassigned to them 'real soon' now.

[10/5/94 public]
Given the above comments about klist and dcecp, I'd say that neither of them
could get an authenticated RPC to work at that point either, so there's no
reason to expect that dcecp could do an authenticated RPC to auditd.  This
is probably dependent on the other cellname alias CRs.  Given that klist
couldn't do an authenticated sec_id_gen_name to get the cell or principal or
group names and trying to start dcecp authenticated gave registry server
unavailable, I've changed the description to more accurately describe the
problem.  BTW: Maybe this is obvious after years of suggesting it, but just
in case:  Every time you hit a problem with "registry server unavailable"
you should try setting DEBUG_SEC (env var) to 3 and try again so you can
see what underlying error really caused the problem.

[10/5/94 public]
This only just caught my eye.  Rich asked long ago "I wonder if this is
related to OT CR 12150?"  Yes, auth rpc ways (among other things) don't
work after you've changed your cell alias.  Assuming there's agreement
that it isn't really a problem for audit to hang while shutting down when
the substrate fails (just as it's ok for dced to "hang" in this name change
scenario), this is just a duplicate.



CR Number                     : 12147
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 7990
Project Name                  : dce
H/W Ref Platform              : other
S/W Ref Platform              : other
Component Name                : rpc
Subcomponent Name             : RPC, SEC
Short Description             : pthread cancels are dangerous
Reported Date                 : 9/12/94
Found in Baseline             : 1.0.3
Found Date                    : 9/12/94
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 7990
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[9/12/94 public]
..
 It should be noted that this design problem reaches across 102, 102a,
103, and 103a; it may well be present in v1.1)
..
 We've seen several instances of customer applications getting wedged,
all of which have one common demoninator: the application gets wedged
in a deadlock because the rpc runtime and/or security credential
managers are waiting on a mutex or cond-var that was left locked when
the locking thread was cancelled from above, cancelled by the
application's logic which has no way of knowing that the targeted thread
has entered the DCE library and is busy within cancel-frail locking
scopes.
 We addressed the most common form of this with the attached delta, but
did not release this as a patch because it is only one aspect of the
larger problem -- there need to be similar TRY-blocks added judiciously
in many places throughout the runtime. Never MIND the complications this
issue can add when you consider what happens if a thread gets cancelled
while it has a credential file cursor walking a cred file without
OPENCLOSE mode active, and/or open for write (with a posix lock on the
file).
 We hazard to make these changes on our own for two reasons:
this is not a platform-isolated issue, it is widespread for all of DCE;
also the widespread changes drive us quite far from the 1.0.X code base
and will cimplicate our merge with 1.1. The second points raises the
third reason that we donot attack this locally: if it doesn't get fixed
by the OSF, V1.1 will continue to exhibit this weakness / design
shortfall.
 I attach, for the technical explanation, the difference file for a fix
/ instrumentation of the most common occurrence of this problem.
-------------------------------------------------------
-------------------------------------------------------------------------------
Changes to rpc/runtime/krbclt.c in open delta travis-tp12603-beware-of-exceptions-while-setting-binding-auth:
===================================================================
RCS file: /afs/tr/proj/alpine/dev/rcs/rpc/runtime/RCS/krbclt.c,v
retrieving revision 9.1
diff -cbt -r9.1 rpc/runtime/krbclt.c
*** 9.1	1993/06/19 02:21:07
--- rpc/runtime/krbclt.c	1994/07/29 17:19:20
***************
*** 1,3 ****
--- 1,14 ----
+ /*-
+  * @TRANSARC_COPYRIGHT@
+  *
+  * $TALog$
+  * $EndTALog$
+  */
+ 
+ #if !defined(_NOIDENT) && !defined(lint)
+ static char *TARCSId = "$Id: c012147,v 1.8 94/09/15 10:35:34 root Exp $";
+ #endif
+ 
  /*
   * @OSF_COPYRIGHT@
   * COPYRIGHT NOTICE
***************
*** 152,157 ****
--- 163,170 ----
  {
      int st, i;
      rpc_krb_info_p_t krb_info;
+     int outer_cancel_state;
+     boolean32 discard;
  
      RPC_MEM_ALLOC (krb_info, rpc_krb_info_p_t, sizeof(*krb_info),
                     rpc_c_mem_util, rpc_c_mem_waitok);
***************
*** 161,166 ****
--- 174,185 ----
      RPC_MUTEX_INIT(krb_info->lock);
      RPC_COND_INIT(krb_info->cond, krb_info->lock);
      
+     outer_cancel_state = pthread_setcancel(CANCEL_OFF);
+     RPC_DBG_PRINTF(rpc_e_dbg_cma_thread, 2,
+                    (">>>>>%s:%d: cancellation state at entry: (%s)\n",
+                     outer_cancel_state == CANCEL_ON ? "on" : "off"));
+  TRY {
+ 
      RPC_KRB_INFO_LOCK(krb_info);
      
      if ((authz_prot != rpc_c_authz_name) &&
***************
*** 221,227 ****
--- 240,285 ----
      st = rpc_s_ok;
  poison:
      *infop = (rpc_auth_info_p_t) &krb_info->auth_info;
+ 
+   } CATCH_ALL {
+     /*  We caught an unhandled exception. Display
+      *  the exception itself, clean the state, then
+      *  reraise the exception.
+      */
+     RPC_DBG_PRINTF(rpc_e_dbg_cma_thread, 2, (">>>>>\n"));
+     RPC_DBG_PRINTF(rpc_e_dbg_cma_thread, 2,
+                    (">>>>>%s:%d: uncaught exception,", __FILE__, __LINE__));
+     exc_report(THIS_CATCH);
+     /*  See if anyone below us turned cancellation back on (no-no). */
+     RPC_DBG_PRINTF(rpc_e_dbg_cma_thread, 2,
+                    (">>>>>restoring cancelability to state at entry (%s)\n",
+                     outer_cancel_state == CANCEL_ON ? "on" : "off"));
+     if (pthread_set_cancel(outer_cancel_state) == CANCEL_ON) {
+       RPC_DBG_PRINTF(rpc_e_dbg_cma_thread, 2,
+                      (">>>>>cancellation was found ON, check subroutines!\n"));
+     }
+     RPC_DBG_PRINTF(rpc_e_dbg_cma_thread, 2, (">>>>>dropping lock\n"));
+     /*  This next line is an invasion of the RPC_KRB_INFO_LOCK()
+      *  macro, but it guarantees that we can do an unconditional
+      *  unlock of the (presumed fast) mutex.
+      */
+     RPC_TRY_LOCK(krb_info->lock, &discard);
+     RPC_KRB_INFO_UNLOCK(krb_info);
+ 
+     RPC_DBG_PRINTF(rpc_e_dbg_cma_thread, 2, (">>>>>reraising exception\n"));
+     RPC_DBG_PRINTF(rpc_e_dbg_cma_thread, 2, (">>>>>\n"));
+     RERAISE;
+   } FINALLY {
      RPC_KRB_INFO_UNLOCK(krb_info);
+   }
+   ENDTRY;
+ 
+     /*  See if anyone below us turned cancellation back on (no-no). */
+     if (pthread_set_cancel(outer_cancel_state) == CANCEL_ON) {
+       RPC_DBG_PRINTF(rpc_e_dbg_cma_thread, 2,
+                      (">>>>>%s:%d:at exit from rpc__krb_bnd_set_auth(), cancellation was found ON, check subroutines!\n",
+                       __FILE__, __LINE__));
+     }
      krb_info->status = st;
      *stp = st;
      return;
-------------------------------------------------------------------------------
Changes to rpc/runtime/krbdgclt.c in open delta travis-tp12603-beware-of-exceptions-while-setting-binding-auth:
===================================================================
RCS file: /afs/tr/proj/alpine/dev/rcs/rpc/runtime/RCS/krbdgclt.c,v
retrieving revision 9.2
diff -cbt -r9.2 rpc/runtime/krbdgclt.c
*** 9.2	1993/06/22 21:44:12
--- rpc/runtime/krbdgclt.c	1994/07/29 17:19:35
***************
*** 1,3 ****
--- 1,14 ----
+ /*-
+  * @TRANSARC_COPYRIGHT@
+  *
+  * $TALog$
+  * $EndTALog$
+  */
+ 
+ #if !defined(_NOIDENT) && !defined(lint)
+ static char *TARCSId = "$Id: c012147,v 1.8 94/09/15 10:35:34 root Exp $";
+ #endif
+ 
  /*
   * @OSF_COPYRIGHT@
   * COPYRIGHT NOTICE
***************
*** 109,116 ****
--- 120,132 ----
      rpc_krb_info_p_t krb_info = (rpc_krb_info_p_t)info;
      rpc_krb_key_p_t krb_key = (rpc_krb_key_p_t)key; 
      unsigned32 st = rpc_s_ok;
+     int outer_cancel_state;
+     boolean32 discard;
  
      /* !!! this needs revision for locking */
+     /* !!! This has been modified since the above comment was made
+      *     to protect the lock-range against cancellations.
+      */
      
  #ifdef FORCE_KEY_CHANGE
      static int ncalls = 0;
***************
*** 139,144 ****
--- 155,166 ----
      }
  #endif
  
+     outer_cancel_state = pthread_setcancel(CANCEL_OFF);
+     RPC_DBG_PRINTF(rpc_e_dbg_cma_thread, 2,
+                    (">>>>>%s:%d: cancellation state at entry: (%s)\n",
+                     outer_cancel_state == CANCEL_ON ? "on" : "off"));
+  TRY {
+ 
      /* write-lock krb_info */
      RPC_KRB_INFO_LOCK(krb_info);
  
***************
*** 171,179 ****
--- 193,238 ----
  out:
      *stp = st;
  
+   } CATCH_ALL {
+     /*  We caught an unhandled exception. Display
+      *  the exception itself, clean the state, then
+      *  reraise the exception.
+      */
+     RPC_DBG_PRINTF(rpc_e_dbg_cma_thread, 2, (">>>>>\n"));
+     RPC_DBG_PRINTF(rpc_e_dbg_cma_thread, 2,
+                    (">>>>>%s:%d: uncaught exception,", __FILE__, __LINE__));
+     exc_report(THIS_CATCH);
+     /*  See if anyone below us turned cancellation back on (no-no). */
+     RPC_DBG_PRINTF(rpc_e_dbg_cma_thread, 2,
+                    (">>>>>restoring cancelability to state at entry (%s)\n",
+                     outer_cancel_state == CANCEL_ON ? "on" : "off"));
+     if (pthread_set_cancel(outer_cancel_state) == CANCEL_ON) {
+       RPC_DBG_PRINTF(rpc_e_dbg_cma_thread, 2,
+                      (">>>>>cancellation was found ON, check subroutines!\n"));
+     }
+     RPC_DBG_PRINTF(rpc_e_dbg_cma_thread, 2, (">>>>>dropping lock\n"));
+     /*  This next line is an invasion of the RPC_KRB_INFO_LOCK()
+      *  macro, but it guarantees that we can do an unconditional
+      *  unlock of the (presumed fast) mutex.
+      */
+     RPC_TRY_LOCK(krb_info->lock, &discard);
+     RPC_KRB_INFO_UNLOCK(krb_info);
+ 
+     RPC_DBG_PRINTF(rpc_e_dbg_cma_thread, 2, (">>>>>reraising exception\n"));
+     RPC_DBG_PRINTF(rpc_e_dbg_cma_thread, 2, (">>>>>\n"));
+     RERAISE;
+   } FINALLY {
      /* unlock krb_info */
      RPC_KRB_INFO_UNLOCK(krb_info);
+   }
+   ENDTRY;
  
+     /*  See if anyone below us turned cancellation back on (no-no). */
+    if (pthread_set_cancel(outer_cancel_state) == CANCEL_ON) {
+       RPC_DBG_PRINTF(rpc_e_dbg_cma_thread, 2,
+                      (">>>>>%s:%d: at exit from rpc__krb_dg_pre_call(), cancellation was found ON, check subroutines!\n",
+                       __FILE__, __LINE__));
+     }
  }
-------------------------------------------------------------------------------

[9/12/94 public]
Yuck, that fix is ugly.
It's also incorrect; as you can't just assume that the krb_info is in a
consistant state if you're blown out of the water by a cancel while the
lock is held.
I believe the correct fix is to disable async cancellability in RPC before
entering any of the security-specific code.

[9/12/94 public]
Assuming that sec_*() functions called by rpc runtime don't have any
(synchronous) cancellation point or handle the cancellation points
properly, we can just disable the asynchronous cancellability in
rpc_binding_set_auth_info()::comauth.c (and maybe in
rpc_server_register_auth_info()?).
The asynchronous cancellability is disabled in the client stub. Thus, as
long as the above assumptions are correct, no problem exists in the client
stub. (rpc__krb_dg_pre_call() never get cancelled.)
In the server side, the general cancellability is disabled in the call
executor thread. It gets enabled by the server stub just before calling
into the server manager routine and then disabled again after returning
from the server manager routine. However, I see no
RPC_SS_THREADS_RESTORE_GENERAL() in CATCH_ALL path. This needs to be fixed
in the IDL compiler. Also, the asynchronous cancellability state should be
save/restored in the server stub. So, with the IDL compiler fix, like the
client stub, no problem will exist in the server runtime.
I believe that we already have a TRY/CATCH block at the right places in the
rpc runtime. Of course, if my assumptions about sec_*() are wrong, we are
in trouble... In any case, the originally suggested fix is not correct as
Bill said.

[9/13/94 public]
Aren't we just talking about compensating for a programming error?
As I recall, the pthreads spec says that you should never call into 
a routine/service with async cancelability enabled unless that routine
explicitly claims to be be async-cancel safe.
The RPC runtime does not claim to be async-cancel safe.  (Nor does the C
library.  Are we going to disable async cancelability in malloc so that
it doesn't get blasted while it's in some inconsistent state?)
Also, the RPC runtime tries to detect posted cancels in a timely
manner by periodically calling pthread_testcancel().  There should be no
reason why the application needs to enable async cancels while calling
into RPC.

[9/13/94 public]
See CR 7990 for the IDL compiler fix.

[9/13/94 public]
And thanks to Seiichi (tatsu_s) for whipping off the idl compiler
fix for us.  I am in process of fixing 7990, and I am dup'ing
this defect to it.
Transarc, does all this sound good to you?

[9/14/94 public]
  This all seems to leave the issue of general cancelability
unaddressed. I want to go and brush up on that before I conclude here. I
may be wrong, and shouldn't venture this question before doing my
homework, but isn't almost any call into security w.r.t. credentials
going to hit a large number of general cancellation points (read(), for
example)?
  Like I say, I am still refreshing my memory on general cancellation
and may come up with more (or more appropriate) questions tomorrow.

[9/15/94 public]

I can't speak for the security code, but the RPC runtime has exception
handlers set up for each cancelation point it calls into.



CR Number                     : 12129
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : acl_edit
Short Description             : acl_edit mem fault during dce_config of cds on the hp platform
Reported Date                 : 9/12/94
Found in Baseline             : 1.1
Found Date                    : 9/12/94
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 12131
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[9/12/94 public]

SYSTEM:		HPUX
HOST:		budapest
TEST:		core smoketest

contents of  dcecp.out

RPC
CDS
PGO
ACL

contents of do_automatic_test.log

invoking dcecp smoke test
acl object not found
dcecp returned value is: ACL
DONE


contents of do_automatic_test.log for multimachine test
 
core smoke test did not configure on budapest (ERRORS in dce_config), multi-mach
ine test failed on budapest

[9/12/94 public]
In analyzing the problem, it looked like cdsd did not come up correctly.
dce_config reports the following:

S:****** Starting cdsadv...
S:****** Starting cdsd...
/mnt/opt/dce1.1/etc/dce_config: 2731 Memory fault
/mnt/opt/dce1.1/etc/dce_config: 2741 Bus error
ERROR:   acl_edit - setting ACLs on /.:
           Message from ecl_edit:


The systesm has a capacity of 87%.  So, there are some space available
still.

Because of the above failures, the dcecp test failed with 
"acl object not found" as expected.

[ rrizzo 9/12/94 public ]

John Dugas has looked at the problem and he says it looks like a change to
"acl_edit" in security now causes the way "dce_config" works to fail.  So
I'm reassigning this OT to security.

[9/12/94 public]
This CR shows similar symptoms as 12131 where acl_edit fails in the middle
of the cds server configuration. The output above is from dce_config.log
which is different than the stdout info; i.e. stdout also prints the line:

S:****** Setting ACLs for all new namespace entries...

It might be a memory corruption problem in which case the error could
happen anywhere during dce_config. In case of the CR 12131 cdsd was up when
acl_edit fails.

[9/13/94 public]

TEST:		core Smoketest
HOST:		budapest



output from run_commands.log

invoking dcecp smoke test
Entry not found
dcecp returned value is: LOG
DONE

output from sif:/tmp/dce_config.log

D:         Executing: acl_edit /.:/subsys/HP/sample-apps -m any_other:rwtdica
           -m unauthenticated:rwti
DEBUG:     Executing: chk_acl_edit(acl_edit - setting ACLs on new namespace
           entries.)
DEBUG:     Executing: err_exit(acl_edit - setting ACLs on new namespace
           entries.
             Message from acl_edit:
             )
ERROR:   acl_edit - setting ACLs on new namespace entries.
           Message from acl_edit:

[9/13/94 public]
Since I've been told that this is really acl_edit dying during config, not
cdsd, I've fixed the short description field to accurately report the problem
and avoid confusion when reading through the OT summaries.

[9/14/94 public]
See ot12131 for description.



CR Number                     : 12124
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : dced
Subcomponent Name             : server
Short Description             : dced core dumps during
srvrconf_create() on hpux
Reported Date                 : 9/9/94
Found in Baseline             : 1.1b17
Found Date                    : 9/9/94
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 12102
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b19
Affected File(s)              : scops.c scimpl.h
Sensitivity                   : public

[9/9/94 public]

during execution of test assertion for dced_server_create() api,
dced core dumps with the following trace.
No problems on 486/osf.


 0 strlen@libc + 0x00000008 (hp-ux export stub)
 1 TMEM@libdce + 0x00221e74 (0x4023a284, 0x48, 0x40239bbc, 0x4000a2fc)
 2 TMEM@libdce + 0x0021bcb8 (0x40009764, 0x48, 0x40239bbc, 0x4000a2fc)
 3 TMEM@libdce + 0x0021a254 (0xf, 0x19c, 0x40239bbc, 0x402fbf58)
 4 TMEM@libdce + 0x00214be8 (0x2, 0xe8, 0x40239e30, 0x402fbf58)
 5 dced_server_convert (h = 0x402fbbf0, data = 0x40239bbc, st = 0x40239970)    [dced_convert_cstub.c: 2618]
 6 TMEM@libdce + 0x002319ac (0x4009aa88, 0x40239c50, 0x10, 0x40239bbc)
 7 TMEM@libdce + 0x00231d48 (0x4009aa88, 0x40239c50, 0x40239bbc, 0x40239970)
 8 srvrconf_create (h = 0x402f87c0, server = 0x402398f8, st = 0x40239970)    [/project/dce/build/dce1.1-snap/src/admin/dced/server/scops.c: 162]
 9 op2_ssr (h = 0x402f87c0, IDL_call_h = 0x402f2e70, IDL_elt_p = 0x4023953c, IDL_drep_p = 0x40239520, IDL_transfer_syntax_p = 0x7af3ab60, IDL_mgr_epv = 0x4000f110, IDL_status_p = 0x40239528)    [srvrconf_sstub.c: 2010]

[9/14/94 public]

I was surprised when i could create the server entry with last night's
build. I was elated when I could do it again. Then third time - dced
crashes with the ususal stack - what a pain in the neck it is to bring up
a cell, particularly when dced crashes!

[9/21/94 public]
Prasad, the file in question has changed several times in the past week.
Would it be easy of you to try to duplicate this with last night's build?

(Yesterday, I could create and start a server, but I used very few params
or args...)

[9/21/94 public]
Rob, can you try and let John know the results.

[9/21/94 public]
Submitted potential fix for NB.



CR Number                     : 12100
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : utils
Subcomponent Name             : svc
Short Description             : "NL_CAT_LOCALE" undefined.
Reported Date                 : 9/8/94
Found in Baseline             : 1.1
Found Date                    : 9/8/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 12098
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[9/8/94 public]


hostname zagreb (HPUX)

Here is the extract from the build log build.log.09-07-94 in the
directory /u1/RAT_tools/logs/HPUX

c89 -c    -D_SHARED_LIBRARIES  +z  -DNO_CATALOG_SUFFIX +w1 -D__hppa -Dhp9000s800 -Dhp9000s700 -D__hp9000s800 -D__hp9000s700 -DHPUX -D__hpux -Dunix +DA1.0 -D_HPUX_SOURCE    -I. -I/u3/devobj/sb/nb_ux/src/dce/utils/svc -I/project/dce/build/dce1.1-snap/src/dce/utils/svc   -I/u3/devobj/sb/nb_ux/export/hp800/usr/include -I/project/dce/build/dce1.1-snap/export/hp800/usr/include    /project/dce/build/dce1.1-snap/src/dce/utils/svc/msginqcma.c
cc: "/project/dce/build/dce1.1-snap/src/dce/utils/svc/msginqcma.c", line 59: error 1588: "NL_CAT_LOCALE" undefined.
cc: "/project/dce/build/dce1.1-snap/src/dce/utils/svc/msginqcma.c", line 59: warning 563: Argument #2 is not the correct type.
*** Error code 1



CR Number                     : 12085
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dcecp
Subcomponent Name             : server
Short Description             : intermittent "Communications failure" errors
Reported Date                 : 9/7/94
Found in Baseline             : 1.1b16
Found Date                    : 9/7/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 12075
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[9/7/94 public]

Since I installed the build of 9/6/94 (contains fix to CR 12027),
attempts to run any of the "server" commands (cat, show, start)
frequently return an error of "Communications failure". The same
command repeated a few seconds or minutes later will sometimes
succeed, but once it starts doing this the failures outnumber the
successes. For instance, the "host start" script I'm working on does
the following:

  server cat

[each server in returned list]

  server show
  server start

Sometimes the "cat" fails, sometimes the "show", and sometimes the
"start".



CR Number                     : 12080
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dced
Subcomponent Name             : test/api
Short Description             : dced_binding_set_auth_info
(#1) fails.
Reported Date                 : 9/7/94
Found in Baseline             : 1.1b17
Found Date                    : 9/7/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 12071
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : binding_set_auth.c
Sensitivity                   : public

[9/7/94 public]

assertion 1 for dced_bind_set_auth_info fails.
assertion 3 for dced_binding_from_rpc_binding fails.

[9/11/94 public]
May be caused by same problem as 12071 which will be fixed in tonights NB,
retry on Tuesday and mark dup if problem goes away.

[9/7/94 public]

Verified with the latest nightly build - this problem does not
happen. Making this a dup to 12071.

Still I want to submit to minor fix to a test function.



CR Number                     : 12074
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : rpc
Subcomponent Name             : 
Short Description             : Illegal state transition in CN client association state machine
Reported Date                 : 9/7/94
Found in Baseline             : 1.1b16
Found Date                    : 9/7/94
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 8157
Fix By Baseline               : 
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[9/7/94 public]

Using bl16.3, during weekend testing running DCDREL001, the
following output was seen at the terminal on an HP system running
as a DCE client in a 4-node cell:

  Failed to retrieve server binding from the namespace: Name service
  unavailable (dce / rpc)
  Failed to retrieve server binding from the namespace: Name service
  unavailable (dce / rpc)
  Failed to retrieve server binding from the namespace: Name service
  unavailable (dce / rpc)

There were about 20 of those messages, followed by:

  Illegal state transition detected in CN client association state
  machine [cur_state: INIT_WAIT, cur_event: REQ, assoc: 403d7058]

In spite of these messages, DCE still appeared to be functioning on
this node- it ran the simple "dce.ps" script successfully.

Illegal state transition detected in CN client association state
machine [cur_state
: INIT_WAIT, cur_event: REQ, assoc: 403d7058]

[9/7/94 public]

Prasad pointed out that this is now a "feature" in the RPC RTL, 
to handle a networking problem on the HP-UX by providing a warning 
message and handling the situation rather than crashing.

[9/7/94 public]

What strikes me is the fact that the message goes to the terminal. I bet
that this warning message is coming from dced (endpoint mapper) and it's
not disassociating itself from the stderr (terminal) when it becomes the
daemon. That means we can't start dced by remsh and if the terminal window
goes away the serviceability messages will be lost (unless someone changes
the default routing for dced).

[09/07/94 public]
Yeah, dced doesn't yet use full SVC and disassociate itself.
We are fixing this (OT CR 11725).  However, that doesn't explain
why the RPC runtime is printing out a message to stderr...

[9/7/94 public]

The "Illegal state transition ..." warning message is printed by
dce_svc_printf() and I believe that its default routing is STDERR. Of
course, you can argue that the rpc runtime shouldn't print it. :-) Anyway,
it only happens with HP-UX and BSD 4.4 (real one) networking code and it's
illegal. :)



CR Number                     : 12063
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : dcecp
Subcomponent Name             : era
Short Description             : prin modify -remove core dumps
Reported Date                 : 9/6/94
Found in Baseline             : 1.1b16
Found Date                    : 9/6/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 11978
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b17
Affected File(s)              : 
Sensitivity                   : public

[9/6/94 public]
Found using systest erarel001 and recreated by hand, with bl-16.3.
Core dump only seems to happen when principal is part of an
account, as follows:

dcecp> xattr show /.:/sec/xattrschema/mytstattr
{aclmgr
 {{principal {{query r} {update rfu} {test r} {delete Dm}}}
  {group {{query r} {update rm} {test rt} {delete Dm}}}
  {org {{query r} {update rm} {test rt} {delete Dm}}}}}
{annotation {}}
{applydefs no}
{encoding printstring}
{intercell reject}
{multivalued yes}
{reserved no}
{scope {}}
{trigbind {none {}}}
{trigtype none}
{unique no}
{uuid 0927dbce-c9be-11cd-8f90-08000925a586}
dcecp> acc create foo2 -group none -org none -password foo2pw 
Enter Your Password: 
dcecp> prin show foo2
{fullname {}}
{uid 14412}
{uuid 0000384c-c9be-21cd-8f00-08000925a586}
{alias no}
{quota unlimited}
{groups none}
dcecp> prin modify foo2 -add {mytstattr val1}
dcecp> prin show foo2
{fullname {}}
{uid 14412}
{uuid 0000384c-c9be-21cd-8f00-08000925a586}
{alias no}
{quota unlimited}
{groups none}
{mytstattr val1}
dcecp> prin modify foo2 -remove mytstattr
Segmentation fault

==== using {mytstattr} has same effect ===

TRACE INFO:
>t
 0 strcpy@libc + 0x00000008 (hp-ux export stub)
 1 sec_attr_util_alloc_copy@libdc + 0x0000016c (0x7af37caa, 0x7b035788, 0x7b035d28, 0x7b036b80)
 2 modify_era_info (interp = 0x400bddf0, modify_type = 3, in_count = 1, remove_by_type = 1, in_attrs = 0x7b035788, era_info =   00000000, exist_count = 1, exist_attrs = 0x7b03656c, out_count = 0x7b036518, out_attrs = 0x7b035a58, delete_count = 0x7b03651c, del_attrs = 0x7b035d28)    [/project/dce/build/dce1.1-snap/src/admin/dcecp/rgy_utils.c: 3853]
 3 check_era_info (interp = 0x400bddf0, domain = 0, name = 0x7b0350d4, in_attrs = 0x7b035788, attr_info = 0x7b035750, out_attrs = 0x7b035a58, del_attrs = 0x7b035d28)    [/project/dce/build/dce1.1-snap/src/admin/dcecp/rgy_utils.c: 3213]
 4 principal_modify (clientData =   00000000, interp = 0x400bddf0, argc = 2, argv = 0x7b0346e0)    [/project/dce/build/dce1.1-snap/src/admin/dcecp/rgy.c: 1129]
 5 dcp_principal (clientData =   00000000, interp = 0x400bddf0, argc = 4, argv = 0x7b034770)    [/project/dce/build/dce1.1-snap/src/admin/dcecp/commands.c: 1104]
 6 Tcl_Eval + 0x000009f0 (0x400bddf0, 0x7b034388, 0x7b034560, 0x7b034520)
 7 Tcl_UplevelCmd + 0x0000023c (0, 0x400bddf0, 0x1, 0x7b034464)
 8 Tcl_Eval + 0x000009f0 (0x400bddf0, 0x7b033ee6, 0, 0x40)
 9 TclParseNestedCmd + 0x0000005c (0x400bddf0, 0x7b033ee6, 0, 0x7b034228)
10 TclParseWords + 0x000002ac (0x400bddf0, 0x7b033ede, 0, 0x8)
11 Tcl_Eval + 0x000003a4 (0x400bddf0, 0x7b033ed8, 0x7b0340a0, 0x7b033f88)
12 Tcl_IfCmd + 0x000003d8 (0, 0x400bddf0, 0x3, 0x7b033fa0)
13 Tcl_Eval + 0x000009f0 (0x400bddf0, 0x40181a0c, 0x7b033e60, 0x7b033d48)
14 Tcl_IfCmd + 0x000003d8 (0, 0x400bddf0, 0x3, 0x7b033d60)
15 Tcl_Eval + 0x000009f0 (0x400bddf0, 0x400c1ae0, 0x40111c08, 0)
16 InterpProc + 0x00000530 (0x400c1ac8, 0x400bddf0, 0, 0x7b033a60)
17 Tcl_Eval + 0x000009f0 (0x400bddf0, 0x7b033338, 0x7b033928, 0x1)
18 Tcl_RecordAndEval + 0x0000026c (0x400bddf0, 0x7b033338, 0, 0x1)
19 main (argc = 1, argv = 0x7b0332f8)    [/project/dce/build/dce1.1-snap/src/admin/dcecp/main.c: 421]

[9/6/94 public]
Just finished fishing around for CR I remembered referring to 
sec_attr_util_alloc_copy function.  Looks like this is a dup of 11978?



CR Number                     : 12056
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : 
Short Description             : "ls /:" timeout and set context failure
Reported Date                 : 9/6/94
Found in Baseline             : 1.1b14
Found Date                    : 9/6/94
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 11070
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[9/6/94 public]
 
Multiple bugs:
 
Bug 1. "ls /:" took more than five minutes and timeout. 
Bug 2. TKN_InitTokenState failed to reach the call back routine,
STKN_InitTokenState. 
 
It has happened predictably many times --- at some point after my
"dce-build" test(7 hours 40 minutes long).
 
I got this bug again this moring after my nightly "DCE-build" test.
 
The "ls /:" command got a RPC timeout warning after more than
five minutes of waiting. The dfstrace dump showed the following 
key events:
 
1. VL_GetVolByName took five minutes with return code 0.
 
   In the meantime "flserver" spent 75% and "fxd" 25% of the CPU
   time. But, the command failed with RPC timeout warning.
 
2. AFS_SetContext got called twice or three times with flag=3 and 
   failed with 655257602( TKN_ERR_NEW_NEEDS_RESET). 
 
3. AFS_SetContext called again with flag 7 and failed with 572616706(
   FSHS_ERR_FATALCONN).
 
4. Steps 2-3 repeated again. 
 
++++++++++++++++++++++++++++++++++++++
DFS Trace Dump -
 
   Date: Tue Sep  6 11:41:40 1994
 
Found 2 logs.
 
Contents of log disk:
 
Contents of log cmfx:
Log wrapped; data missing.
time 279.190009, pid 4022376: running Ping Servers 
time 279.190012, pid 4022376: Ping Servers queuing at time 2e6c7917 
time 279.190014, pid 4022376: Ping Servers done at time 2e6c7917 
time 284.200004, pid 4018900: in PeriodicKA 
time 284.200005, pid 4018900: in RunTokens 
time 284.200006, pid 4018900: runtkn done, 0 active 
time 284.200008, pid 4018900: checkflservers checking 1 servers 
time 284.200018, pid 4022376: running write through dslots 
time 284.200025, pid 4022376: running major renewlazyreps 
time 284.200026, pid 4022376: Renewlazyreps starts 0 subjobs 
time 284.200033, pid 4024272: servertokenmgt running 1 subops 
time 284.200034, pid 4023956: flushactivescaches starting 0 concurrent storebacks 
time 284.200050, pid 4025536: in cm_FlushQueuedServerTokens for server 23e890c 
time 308.140001, pid 4011632: cm_lookup 242800c dce10_cell.osf.org 
time 308.140003, pid 4011632: Trybind on name = dce10_cell.osf.org 
time 308.140004, pid 4011632: cm_lookup 2428144 fs 
time 308.140006, pid 4011632: Trybind on name = fs 
time 309.640001, pid 4011632: Trybind: read helper returns avpp  7ffe71e8, replyCode 0 
time 309.640002, pid 4011632: cm_NewCell dce10_cell.osf.org 
time 309.640003, pid 4011632: getvolbyname looking for volume root.dfs 
time 309.640004, pid 4011632: cm_ConnByMHosts server type 10000 
time 309.640005, pid 4011632: cm_ConnByHost server type 0x10000, serverp 23e890c 
time 309.640006, pid 4011632: cm_ConnByHost: creating conn type 0x10000, conn 204778c 
time 309.640007, pid 4011632: cm_ConnByHost using conn 204778c, service 0x10000 
time 309.640008, pid 4011632: begin VL_GetVolByName 
time 314.210009, pid 4022376: flushactivescaches starting 0 concurrent storebacks 
time 332.220009, pid 4022376: running Check Down Servers 
time 336.210000, pid 4019848: GetTime 
time 336.210001, pid 4019848: fshs_GetPrincipal START 
time 336.210002, pid 4019848: fshs_GetHost, cookie 230298c 
time 336.210003, pid 4019848: fshs_FindHost, cookie 230298c 
time 336.210004, pid 4019848: find a prime host 2400094 
time 336.210006, pid 4019848: find a host in fast path 2400094 
time 336.210007, pid 4019848: fshs_FindPrincipal .. 
time 336.210008, pid 4019848: found a princ 245900c ref 1 
time 336.210010, pid 4019848: find a princ (fast path) 245900c, ref 1 
time 336.210011, pid 4019848: fshs_GetPrincipal END 245900c, ref 1 
time 336.210013, pid 4019848: fshs_PutPrincipal 245900c ref 1 
time 336.210014, pid 4019848: GetTime returns 0 
time 339.230009, pid 4022376: running Ping Servers 
time 339.230012, pid 4022376: Ping Servers queuing at time 2e6c7953 
time 339.230014, pid 4022376: Ping Servers done at time 2e6c7953 
time 344.240010, pid 4022376: running write through dslots 
time 344.240017, pid 4022376: running major renewlazyreps 
time 344.240018, pid 4022376: Renewlazyreps starts 0 subjobs 
time 344.240025, pid 4024272: servertokenmgt running 1 subops 
time 344.240026, pid 4023956: flushactivescaches starting 0 concurrent storebacks 
time 344.240042, pid 4025536: in cm_FlushQueuedServerTokens for server 23e890c 
time 374.250009, pid 4022376: flushactivescaches starting 0 concurrent storebacks 
time 399.260009, pid 4022376: running Ping Servers 
time 399.260012, pid 4022376: Ping Servers queuing at time 2e6c798f 
time 399.260014, pid 4022376: Ping Servers done at time 2e6c798f 
time 404.270004, pid 4018900: in PeriodicKA 
time 404.270005, pid 4018900: in RunTokens 
time 404.270006, pid 4018900: runtkn done, 0 active 
time 404.270008, pid 4018900: checkflservers checking 1 servers 
time 404.270018, pid 4022376: running write through dslots 
time 404.270025, pid 4022376: running major renewlazyreps 
time 404.270026, pid 4022376: Renewlazyreps starts 0 subjobs 
time 404.270033, pid 4024272: servertokenmgt running 1 subops 
time 404.270034, pid 4023956: flushactivescaches starting 0 concurrent storebacks 
time 404.270050, pid 4025536: in cm_FlushQueuedServerTokens for server 23e890c 
time 426.270000, pid 4019848: GetTime 
time 426.270001, pid 4019848: fshs_GetPrincipal START 
time 426.270002, pid 4019848: fshs_GetHost, cookie 219968c 
time 426.270003, pid 4019848: fshs_FindHost, cookie 219968c 
time 426.270004, pid 4019848: find a prime host 2400094 
time 426.270006, pid 4019848: find a host in fast path 2400094 
time 426.270007, pid 4019848: fshs_FindPrincipal .. 
time 426.270008, pid 4019848: found a princ 245900c ref 1 
time 426.270010, pid 4019848: find a princ (fast path) 245900c, ref 1 
time 426.270011, pid 4019848: fshs_GetPrincipal END 245900c, ref 1 
time 426.270013, pid 4019848: fshs_PutPrincipal 245900c ref 1 
time 426.270014, pid 4019848: GetTime returns 0 
time 434.280009, pid 4022376: flushactivescaches starting 0 concurrent storebacks 
time 459.290009, pid 4022376: running Ping Servers 
time 459.290012, pid 4022376: Ping Servers queuing at time 2e6c79cb 
time 459.290014, pid 4022376: Ping Servers done at time 2e6c79cb 
time 464.300010, pid 4022376: running write through dslots 
time 464.300017, pid 4022376: running major renewlazyreps 
time 464.300018, pid 4022376: Renewlazyreps starts 0 subjobs 
time 464.300025, pid 4024272: servertokenmgt running 1 subops 
time 464.300026, pid 4023956: flushactivescaches starting 0 concurrent storebacks 
time 464.300042, pid 4025536: in cm_FlushQueuedServerTokens for server 23e890c 
time 494.310009, pid 4022376: flushactivescaches starting 0 concurrent storebacks 
time 512.320009, pid 4022376: running Check Down Servers 
time 518.540001, pid 4019848: GetTime 
time 518.540002, pid 4019848: fshs_GetPrincipal START 
time 518.540003, pid 4019848: fshs_GetHost, cookie 21a3b8c 
time 518.540004, pid 4019848: fshs_FindHost, cookie 21a3b8c 
time 518.540005, pid 4019848: find a prime host 2400094 
time 518.540007, pid 4019848: find a host in fast path 2400094 
time 518.540008, pid 4019848: fshs_FindPrincipal .. 
time 518.540009, pid 4019848: found a princ 245900c ref 1 
time 518.540011, pid 4019848: find a princ (fast path) 245900c, ref 1 
time 518.540012, pid 4019848: fshs_GetPrincipal END 245900c, ref 1 
time 518.540014, pid 4019848: fshs_PutPrincipal 245900c ref 1 
time 518.540015, pid 4019848: GetTime returns 0 
time 519.330011, pid 4022376: running Ping Servers 
time 519.330014, pid 4022376: Ping Servers queuing at time 2e6c7a07 
time 519.330016, pid 4022376: Ping Servers done at time 2e6c7a07 
time 524.340004, pid 4018900: in PeriodicKA 
time 524.340005, pid 4018900: in RunTokens 
time 524.340006, pid 4018900: runtkn done, 0 active 
time 524.340008, pid 4018900: checkflservers checking 1 servers 
time 524.340018, pid 4022376: running write through dslots 
time 524.340025, pid 4022376: running major renewlazyreps 
time 524.340026, pid 4022376: Renewlazyreps starts 0 subjobs 
time 524.340033, pid 4024272: servertokenmgt running 1 subops 
time 524.340034, pid 4023956: flushactivescaches starting 0 concurrent storebacks 
time 524.340050, pid 4025536: in cm_FlushQueuedServerTokens for server 23e890c 
time 554.350009, pid 4022376: flushactivescaches starting 0 concurrent storebacks 
time 577.360004, pid 4018900: fshs_HostCheckDaemon .. 
time 577.360005, pid 4018900: fshs_Enumerate START 
time 577.360007, pid 4018900: fshs_CheckHost START 240000c 
time 577.360008, pid 4018900: fshs_GCPrinc from host 240000c 
time 577.360009, pid 4018900: fshs_CheckHost END 
time 577.360011, pid 4018900: fshs_CheckHost START 2400094 
time 577.360012, pid 4018900: fshs_GCPrinc from host 2400094 
time 577.360013, pid 4018900: fshs_CheckHost END 
time 577.360014, pid 4018900: fshs_UpdateHostList called 
time 577.360015, pid 4018900: fshs_Enumerate END 
time 577.360027, pid 4022376: Refresh Tokens at time 2e6c7a41, opcount 0 
time 577.360029, pid 4022376: Refresh Tokens done at time 2e6c7a41 
time 579.370009, pid 4022376: running Ping Servers 
time 579.370012, pid 4022376: Ping Servers queuing at time 2e6c7a43 
time 579.370014, pid 4022376: Ping Servers done at time 2e6c7a43 
time 584.380010, pid 0: current time: Tue Sep  6 10:18:48 1994 
time 584.380010, pid 4022376: running write through dslots 
time 584.380017, pid 4022376: running major renewlazyreps 
time 584.380018, pid 4022376: Renewlazyreps starts 0 subjobs 
time 584.380025, pid 4024272: servertokenmgt running 1 subops 
time 584.380026, pid 4023956: flushactivescaches starting 0 concurrent storebacks 
time 584.380042, pid 4025536: in cm_FlushQueuedServerTokens for server 23e890c 
time 608.610000, pid 4019848: GetTime 
time 608.610001, pid 4019848: fshs_GetPrincipal START 
time 608.610002, pid 4019848: fshs_GetHost, cookie 23f8ecc 
time 608.610003, pid 4019848: fshs_FindHost, cookie 23f8ecc 
time 608.610004, pid 4019848: find a prime host 2400094 
time 608.610006, pid 4019848: find a host in fast path 2400094 
time 608.610007, pid 4019848: fshs_FindPrincipal .. 
time 608.610008, pid 4019848: found a princ 245900c ref 1 
time 608.610010, pid 4019848: find a princ (fast path) 245900c, ref 1 
time 608.610011, pid 4019848: fshs_GetPrincipal END 245900c, ref 1 
time 608.610013, pid 4019848: fshs_PutPrincipal 245900c ref 1 
time 608.610014, pid 4019848: GetTime returns 0 
time 610.530000, pid 4011632: end VL_GetVolByName, code 0 
time 610.530001, pid 4011632: cm_Analyze: conn 204778c, code 0, user 0 
time 610.530004, pid 4011632: Install vol entry for volume ID 1 
time 610.530008, pid 4011632: cm_ConnByMHosts server type 20000 
time 610.530010, pid 4011632: cm_ConnByHost server type 0x20000, serverp 217f50c 
time 610.530011, pid 4011632: cm_ConnByHost: creating conn type 0x20000, conn 204774c 
time 610.530012, pid 4011632: cm_ConnByHost using conn 204774c, service 0x20000 
time 610.750001, pid 4011632: get TGT time 0 for pag 0 
time 610.750002, pid 4011632: cm_ConnByHost: setting UUID 51b026/7a621e6c/8a430800/9215366 in connp 204774c 
time 610.750003, pid 4011632: cm_ConnByHost: passing other UUID 2bcebb/bd881e6b/8a430800/9215366 for connp 204774c 
time 610.750004, pid 4011632: start AFS_SetContext conn 204774c srv level 0x20000 
time 610.910001, pid 4019848: in AFS_SetContext, Flag 3 
time 610.910002, pid 4019848: fshs_GetHost, cookie 21168cc 
time 610.910003, pid 4019848: fshs_FindHost, cookie 21168cc 
time 610.910004, pid 4019848: cannot find a host in fast path 
time 610.910005, pid 4019848: fshs_FindHost, cookie 21168cc 
time 610.910007, pid 4019848: fshs_CreateHost: creating host 240011c, primary=1, flags=0x3; host states now 0x3 
time 610.910008, pid 4019848:     and host 240011c has fshost flags of 0x320 
time 610.920000, pid 4019848: fshs_CreateHost: returning 655257602 
time 610.920001, pid 4011632: end AFS_SetContext code 655257602 
time 610.920002, pid 4011632: cm_ConnAndReset: conn 0x204774c, server 0x217f50c, service 0x20000 
time 610.920003, pid 4011632: start recheck AFS_SetContext: conn 204774c srv level 0x20000 
time 612.530000, pid 4019848: in AFS_SetContext, Flag 3 
time 612.530001, pid 4019848: fshs_GetHost, cookie 21168cc 
time 612.530002, pid 4019848: fshs_FindHost, cookie 21168cc 
time 612.530003, pid 4019848: find a prime host 240011c 
time 612.530005, pid 4019848: fshs_GetHost: host 240011c, states 0x3, flags 0x320: forcing null return 
time 612.530006, pid 4019848: fshs_FindHost, cookie 21168cc 
time 612.530007, pid 4019848: find a prime host 240011c 
time 612.530008, pid 4019848: fshs_CreateHost: returning 655257602 
time 612.530009, pid 4011632: end recheck AFS_SetContext: code 655257602 
time 612.530010, pid 4011632: cm_ConnAndReset: conn 0x204774c, server 0x217f50c: reset 0 tokens 
time 612.530011, pid 4011632: cm_ConnAndReset: conn 0x204774c, service 0x20000: calling AFS_SetContext 
time 612.530013, pid 4019848: in AFS_SetContext, Flag 7 
time 612.530014, pid 4019848: fshs_GetHost, cookie 21168cc 
time 612.530015, pid 4019848: fshs_FindHost, cookie 21168cc 
time 612.530016, pid 4019848: find a prime host 240011c 
time 612.530018, pid 4019848: fshs_GetHost: host 240011c, states 0x3, flags 0x320: forcing null return 
time 612.530019, pid 4019848: fshs_FindHost, cookie 21168cc 
time 612.530020, pid 4019848: find a prime host 240011c 
time 612.530021, pid 4019848: fshs_CreateHost: clearing host 0x240011c 
time 612.530022, pid 4019848: fshs_CreateHost: calling TKN_InitTokenState on host 0x240011c 
time 612.530023, pid 4019848: tokenint_InitTokenState host 240011c 
time 612.530024, pid 4019848: fshs_GetTSRCode: host 240011c, returning 0xc 
time 614.390009, pid 4022376: flushactivescaches starting 0 concurrent storebacks 
time 639.400009, pid 4022376: running Ping Servers 
time 639.400012, pid 4022376: Ping Servers queuing at time 2e6c7a7f 
time 639.400014, pid 4022376: Ping Servers done at time 2e6c7a7f 
time 644.410004, pid 4018900: in PeriodicKA 
time 644.410005, pid 4018900: in RunTokens 
time 644.410006, pid 4018900: runtkn done, 0 active 
time 644.410008, pid 4018900: checkflservers checking 1 servers 
time 644.410018, pid 4022376: running write through dslots 
time 644.410025, pid 4022376: running major renewlazyreps 
time 644.410026, pid 4022376: Renewlazyreps starts 0 subjobs 
time 644.410034, pid 4024272: servertokenmgt running 2 subops 
time 644.410035, pid 4023956: flushactivescaches starting 0 concurrent storebacks 
time 644.410052, pid 4025536: in cm_FlushQueuedServerTokens for server 217f50c 
time 644.410057, pid 4025220: in cm_FlushQueuedServerTokens for server 23e890c 
time 674.420009, pid 4022376: flushactivescaches starting 0 concurrent storebacks 
time 692.430009, pid 4022376: running Check Down Servers 
time 698.670000, pid 4019532: GetTime 
time 698.670001, pid 4019532: fshs_GetPrincipal START 
time 698.670002, pid 4019532: fshs_GetHost, cookie 2116a8c 
time 698.670003, pid 4019532: fshs_FindHost, cookie 2116a8c 
time 698.670004, pid 4019532: find a prime host 2400094 
time 698.670006, pid 4019532: find a host in fast path 2400094 
time 698.670007, pid 4019532: fshs_FindPrincipal .. 
time 698.670008, pid 4019532: found a princ 245900c ref 1 
time 698.670010, pid 4019532: find a princ (fast path) 245900c, ref 1 
time 698.670011, pid 4019532: fshs_GetPrincipal END 245900c, ref 1 
time 698.670013, pid 4019532: fshs_PutPrincipal 245900c ref 1 
time 698.670014, pid 4019532: GetTime returns 0 
time 704.440010, pid 4022376: running write through dslots 
time 704.440017, pid 4022376: running major renewlazyreps 
time 704.440018, pid 4022376: Renewlazyreps starts 0 subjobs 
time 704.440026, pid 4024272: servertokenmgt running 2 subops 
time 704.440027, pid 4023956: flushactivescaches starting 0 concurrent storebacks 
time 704.440044, pid 4025536: in cm_FlushQueuedServerTokens for server 217f50c 
time 704.440049, pid 4025220: in cm_FlushQueuedServerTokens for server 23e890c 
time 734.450009, pid 4022376: flushactivescaches starting 0 concurrent storebacks 
time 759.460009, pid 4022376: running Ping Servers 
time 759.460012, pid 4022376: Ping Servers queuing at time 2e6c7af7 
time 759.460014, pid 4022376: Ping Servers done at time 2e6c7af7 
time 764.470004, pid 4018900: in PeriodicKA 
time 764.470005, pid 4018900: in RunTokens 
time 764.470006, pid 4018900: runtkn done, 0 active 
time 764.470008, pid 4018900: checkflservers checking 1 servers 
time 764.470018, pid 4022376: running write through dslots 
time 764.470025, pid 4022376: running major renewlazyreps 
time 764.470026, pid 4022376: Renewlazyreps starts 0 subjobs 
time 764.470034, pid 4024272: servertokenmgt running 2 subops 
time 764.470035, pid 4023956: flushactivescaches starting 0 concurrent storebacks 
time 764.470052, pid 4025536: in cm_FlushQueuedServerTokens for server 217f50c 
time 764.470057, pid 4025220: in cm_FlushQueuedServerTokens for server 23e890c 
time 765.530000, pid 4019848: fshs_CreateHost: host 240011c TKN_InitTokenState returned 382312556 
time 765.530001, pid 4019848: fshs_CreateHost: returning 572616706 
time 765.530002, pid 4011632: cm_ConnAndReset: conn 0x204774c: AFS_SetContext result is 572616706 
time 765.530003, pid 4011632: server 217f50c just marked down 
time 765.530005, pid 4011632: mark conn bad for pag -1 
time 765.530006, pid 4011632: stomping binding 204774c 
time 765.530008, pid 4011632: cm_ConnByMHosts: found  0-th server down 
time 765.530009, pid 4011632: cm_ConnByMHosts: all filesets bad 
time 765.530010, pid 4011632: cm_Analyze: conn 0, code -1, user 0 
time 765.530011, pid 4011632: checkerror returning code 238 
time 788.750000, pid 4019848: GetTime 
time 788.750001, pid 4019848: fshs_GetPrincipal START 
time 788.750002, pid 4019848: fshs_GetHost, cookie 2199a8c 
time 788.750003, pid 4019848: fshs_FindHost, cookie 2199a8c 
time 788.750004, pid 4019848: find a prime host 2400094 
time 788.750006, pid 4019848: find a host in fast path 2400094 
time 788.750007, pid 4019848: fshs_FindPrincipal .. 
time 788.750008, pid 4019848: found a princ 245900c ref 1 
time 788.750010, pid 4019848: find a princ (fast path) 245900c, ref 1 
time 788.750011, pid 4019848: fshs_GetPrincipal END 245900c, ref 1 
time 788.750013, pid 4019848: fshs_PutPrincipal 245900c ref 1 
time 788.750014, pid 4019848: GetTime returns 0 
time 794.480009, pid 4022376: flushactivescaches starting 0 concurrent storebacks 
time 824.490013, pid 4022376: running write through dslots 
time 824.490020, pid 4022376: running major renewlazyreps 
time 824.490021, pid 4022376: Renewlazyreps starts 0 subjobs 
time 824.490029, pid 4024272: servertokenmgt running 2 subops 
time 824.490030, pid 4023956: flushactivescaches starting 0 concurrent storebacks 
time 824.490047, pid 4025536: in cm_FlushQueuedServerTokens for server 217f50c 
time 824.490052, pid 4025220: in cm_FlushQueuedServerTokens for server 23e890c 
time 854.500009, pid 4022376: flushactivescaches starting 0 concurrent storebacks 
time 857.950001, pid 4019848: in AFS_SetContext, Flag 3 
time 857.950002, pid 4019848: fshs_GetHost, cookie 2116a8c 
time 857.950003, pid 4019848: fshs_FindHost, cookie 2116a8c 
time 857.950004, pid 4019848: find a prime host 2400094 
time 857.950006, pid 4019848: find a host in fast path 2400094 
time 857.950007, pid 4019848: fshs_GetPrincipal START 
time 857.950008, pid 4019848: fshs_GetHost, cookie 2116a8c 
time 857.950009, pid 4019848: fshs_FindHost, cookie 2116a8c 
time 857.950010, pid 4019848: find a prime host 2400094 
time 857.950012, pid 4019848: find a host in fast path 2400094 
time 857.950013, pid 4019848: fshs_FindPrincipal .. 
time 857.950014, pid 4019848: found a princ 245900c ref 1 
time 857.950016, pid 4019848: find a princ (fast path) 245900c, ref 1 
time 857.950017, pid 4019848: fshs_GetPrincipal END 245900c, ref 1 
time 857.950018, pid 4019848: fshs_PutPrincipal 245900c ref 1 
time 857.960000, pid 4019848: GetToken fid 5366acd9.1.2.0 type 0x2000, id 0.0, flags 0x89 
time 857.960001, pid 4019848: fshs_GetPrincipal START 
time 857.960002, pid 4019848: fshs_GetHost, cookie 2116b8c 
time 857.960003, pid 4019848: fshs_FindHost, cookie 2116b8c 
time 857.960004, pid 4019848: find a prime host 2400094 
time 857.960006, pid 4019848: find a host in fast path 2400094 
time 857.960007, pid 4019848: fshs_FindPrincipal .. 
time 857.960008, pid 4019848: found a princ 245900c ref 1 
time 857.960010, pid 4019848: find a princ (fast path) 245900c, ref 1 
time 857.960011, pid 4019848: fshs_GetPrincipal END 245900c, ref 1 
time 857.960020, pid 4019848: fshs_PutPrincipal 245900c ref 1 
time 857.960021, pid 4019848: GetToken returns id 778812738.53944, rights 0x0.2000, code 0 
time 872.510009, pid 4022376: running Check Down Servers 
time 877.520004, pid 4018900: fshs_HostCheckDaemon .. 
time 877.520005, pid 4018900: fshs_Enumerate START 
time 877.520007, pid 4018900: fshs_CheckHost START 240000c 
time 877.520008, pid 4018900: fshs_GCPrinc from host 240000c 
time 877.520009, pid 4018900: fshs_CheckHost END 
time 877.520011, pid 4018900: fshs_CheckHost START 2400094 
time 877.520012, pid 4018900: fshs_GCPrinc from host 2400094 
time 877.520013, pid 4018900: fshs_CheckHost END 
time 877.520015, pid 4018900: fshs_CheckHost START 240011c 
time 877.520016, pid 4018900: fshs_CheckHost END 
time 877.520017, pid 4018900: fshs_UpdateHostList called 
time 877.520018, pid 4018900: fshs_GCHost 240011c ref 0 
time 877.520019, pid 4018900: GC a prime host 
time 877.520020, pid 4018900: fshs_FreeHost 240011c 
time 877.520021, pid 4018900: fshs_Enumerate END 
time 877.520034, pid 4022376: Refresh Tokens at time 2e6c7b6d, opcount 0 
time 877.520036, pid 4022376: Refresh Tokens done at time 2e6c7b6d 
time 877.520044, pid 4024272: GC conns 0x0 
time 877.520046, pid 4024272: GC conns 0x0 
time 877.520047, pid 4024272: stomping binding 204778c 
time 879.530009, pid 4022376: running Ping Servers 
time 879.530012, pid 4022376: Ping Servers queuing at time 2e6c7b6f 
time 879.530014, pid 4022376: Ping Servers done at time 2e6c7b6f 
time 884.540004, pid 4018900: in PeriodicKA 
time 884.540005, pid 4018900: in RunTokens 
time 884.540006, pid 4018900: runtkn done, 0 active 
time 884.540008, pid 4018900: checkflservers checking 1 servers 
time 884.540018, pid 4022376: running write through dslots 
time 884.540025, pid 4022376: running major renewlazyreps 
time 884.540026, pid 4022376: Renewlazyreps starts 0 subjobs 
time 884.540034, pid 4024272: servertokenmgt running 2 subops 
time 884.540035, pid 4023956: flushactivescaches starting 0 concurrent storebacks 
time 884.540052, pid 4025536: in cm_FlushQueuedServerTokens for server 217f50c 
time 884.540057, pid 4025220: in cm_FlushQueuedServerTokens for server 23e890c 
time 914.550009, pid 4022376: flushactivescaches starting 0 concurrent storebacks 
time 944.560010, pid 4022376: running write through dslots 
time 944.560017, pid 4022376: running major renewlazyreps 
time 944.560018, pid 4022376: Renewlazyreps starts 0 subjobs 
time 944.560026, pid 4024272: servertokenmgt running 2 subops 
time 944.560027, pid 4023956: flushactivescaches starting 0 concurrent storebacks 
time 944.560044, pid 4025536: in cm_FlushQueuedServerTokens for server 217f50c 
time 944.560049, pid 4025220: in cm_FlushQueuedServerTokens for server 23e890c 
time 945.570009, pid 4022376: running Check Down Servers 
time 945.570020, pid 4025536: checkdownservers server 217f50c 
time 945.570022, pid 4025536: cm_ConnByHost server type 0x20000, serverp 217f50c 
time 945.570023, pid 4025536: cm_ConnByHost: creating conn type 0x20000, conn 204778c 
time 945.570024, pid 4025536: cm_ConnByHost using conn 204778c, service 0x20000 
time 945.570028, pid 4025536: get TGT time 0 for pag 0 
time 945.570029, pid 4025536: cm_ConnByHost: setting UUID 51b026/7a621e6c/8a430800/9215366 in connp 204778c 
time 945.570030, pid 4025536: cm_ConnByHost: passing other UUID 2bcebb/bd881e6b/8a430800/9215366 for connp 204778c 
time 945.570031, pid 4025536: start AFS_SetContext conn 204778c srv level 0x20000 
time 945.740001, pid 4019848: in AFS_SetContext, Flag 3 
time 945.740002, pid 4019848: fshs_GetHost, cookie 23f8d8c 
time 945.740003, pid 4019848: fshs_FindHost, cookie 23f8d8c 
time 945.740004, pid 4019848: cannot find a host in fast path 
time 945.740005, pid 4019848: fshs_FindHost, cookie 23f8d8c 
time 945.740007, pid 4019848: fshs_CreateHost: creating host 240011c, primary=1, flags=0x3; host states now 0x3 
time 945.740008, pid 4019848:     and host 240011c has fshost flags of 0x320 
time 945.740009, pid 4019848: fshs_CreateHost: returning 655257602 
time 945.740010, pid 4025536: end AFS_SetContext code 655257602 
time 945.740011, pid 4025536: cm_ConnAndReset: conn 0x204778c, server 0x217f50c, service 0x20000 
time 945.740012, pid 4025536: start recheck AFS_SetContext: conn 204778c srv level 0x20000 
time 945.740014, pid 4019848: in AFS_SetContext, Flag 3 
time 945.740015, pid 4019848: fshs_GetHost, cookie 23f8d8c 
time 945.740016, pid 4019848: fshs_FindHost, cookie 23f8d8c 
time 945.740017, pid 4019848: find a prime host 240011c 
time 945.740019, pid 4019848: fshs_GetHost: host 240011c, states 0x3, flags 0x320: forcing null return 
time 945.740020, pid 4019848: fshs_FindHost, cookie 23f8d8c 
time 945.740021, pid 4019848: find a prime host 240011c 
time 945.740022, pid 4019848: fshs_CreateHost: returning 655257602 
time 945.740023, pid 4025536: end recheck AFS_SetContext: code 655257602 
time 945.740024, pid 4025536: cm_ConnAndReset: conn 0x204778c, server 0x217f50c: reset 0 tokens 
time 945.740025, pid 4025536: cm_ConnAndReset: conn 0x204778c, service 0x20000: calling AFS_SetContext 
time 945.750000, pid 4019848: in AFS_SetContext, Flag 7 
time 945.750001, pid 4019848: fshs_GetHost, cookie 23f8d8c 
time 945.750002, pid 4019848: fshs_FindHost, cookie 23f8d8c 
time 945.750003, pid 4019848: find a prime host 240011c 
time 945.750005, pid 4019848: fshs_GetHost: host 240011c, states 0x3, flags 0x320: forcing null return 
time 945.750006, pid 4019848: fshs_FindHost, cookie 23f8d8c 
time 945.750007, pid 4019848: find a prime host 240011c 
time 945.750008, pid 4019848: fshs_CreateHost: clearing host 0x240011c 
time 945.750009, pid 4019848: fshs_CreateHost: calling TKN_InitTokenState on host 0x240011c 
time 945.750010, pid 4019848: tokenint_InitTokenState host 240011c 
time 945.750011, pid 4019848: fshs_GetTSRCode: host 240011c, returning 0xc 
time 948.040000, pid 4019532: GetTime 
time 948.040001, pid 4019532: fshs_GetPrincipal START 
time 948.040002, pid 4019532: fshs_GetHost, cookie 21a3f0c 
time 948.040003, pid 4019532: fshs_FindHost, cookie 21a3f0c 
time 948.040004, pid 4019532: find a prime host 2400094 
time 948.040006, pid 4019532: find a host in fast path 2400094 
time 948.040007, pid 4019532: fshs_FindPrincipal .. 
time 948.040008, pid 4019532: found a princ 245900c ref 1 
time 948.040010, pid 4019532: find a princ (fast path) 245900c, ref 1 
time 948.040011, pid 4019532: fshs_GetPrincipal END 245900c, ref 1 
time 948.040013, pid 4019532: fshs_PutPrincipal 245900c ref 1 
time 948.040014, pid 4019532: GetTime returns 0 
time 974.580009, pid 4024272: flushactivescaches starting 0 concurrent storebacks 
time 999.590009, pid 4024272: running Ping Servers 
time 999.590012, pid 4024272: Ping Servers queuing at time 2e6c7be7 
time 999.590014, pid 4024272: Ping Servers done at time 2e6c7be7 
time 1004.600004, pid 4018900: in PeriodicKA 
time 1004.600005, pid 4018900: in RunTokens 
time 1004.600006, pid 4018900: runtkn done, 0 active 
time 1004.600008, pid 4018900: checkflservers checking 1 servers 
time 1004.600017, pid 4024272: running write through dslots 
time 1004.600022, pid 4024272: flushactivescaches starting 0 concurrent storebacks 
time 1004.600028, pid 4024272: running major renewlazyreps 
time 1004.600029, pid 4024272: Renewlazyreps starts 0 subjobs 
time 1004.600037, pid 4023956: servertokenmgt running 2 subops 
time 1004.600049, pid 4025220: in cm_FlushQueuedServerTokens for server 217f50c 
time 1004.600054, pid 4024904: in cm_FlushQueuedServerTokens for server 23e890c 
time 10.610009, pid 4024272: flushactivescaches starting 0 concurrent storebacks 
time 14.090000, pid 4019532: GetTime 
time 14.090001, pid 4019532: fshs_GetPrincipal START 
time 14.090002, pid 4019532: fshs_GetHost, cookie 21a3f0c 
time 14.090003, pid 4019532: fshs_FindHost, cookie 21a3f0c 
time 14.090004, pid 4019532: find a prime host 2400094 
time 14.090006, pid 4019532: find a host in fast path 2400094 
time 14.090007, pid 4019532: fshs_FindPrincipal .. 
time 14.090008, pid 4019532: found a princ 245900c ref 1 
time 14.090010, pid 4019532: find a princ (fast path) 245900c, ref 1 
time 14.090011, pid 4019532: fshs_GetPrincipal END 245900c, ref 1 
time 14.090013, pid 4019532: fshs_PutPrincipal 245900c ref 1 
time 14.090014, pid 4019532: GetTime returns 0 
time 40.620009, pid 4024272: running write through dslots 
time 40.620014, pid 4024272: flushactivescaches starting 0 concurrent storebacks 
time 40.620020, pid 4024272: running major renewlazyreps 
time 40.620021, pid 4024272: Renewlazyreps starts 0 subjobs 
time 40.620029, pid 4023956: servertokenmgt running 2 subops 
time 40.620041, pid 4025220: in cm_FlushQueuedServerTokens for server 217f50c 
time 40.620046, pid 4024904: in cm_FlushQueuedServerTokens for server 23e890c 
time 70.630009, pid 4024272: flushactivescaches starting 0 concurrent storebacks 
time 74.530000, pid 4019848: fshs_CreateHost: host 240011c TKN_InitTokenState returned 382312556 
time 74.530001, pid 4019848: fshs_CreateHost: returning 572616706 
time 74.530002, pid 4025536: cm_ConnAndReset: conn 0x204778c: AFS_SetContext result is 572616706 
time 74.550000, pid 4025536: server 217f50c just marked down 
time 74.550002, pid 4025536: mark conn bad for pag -1 
time 74.550003, pid 4025536: stomping binding 204778c 
time 95.660011, pid 4022376: running Ping Servers 
time 95.660014, pid 4022376: Ping Servers queuing at time 2e6c7c5f 
time 95.660016, pid 4022376: Ping Servers done at time 2e6c7c5f

[hsiao 9/6/94 ] 
 
I forgot to mention some important infos. The cell is 
a two HP nodes cell, dce10 as cds/sec/dfs server, toaster
as client. The problem happens most of the time
in the server node --- only once in the client.
 
The build is "-O" build based on bl-14. 
 
It seems to me that problem is resource related - 
likely memory.
 
Once, I rebooted dce10 and its dfs and did NOT run the
"DCE-build" test or any other test. At the end of an 18 hours 
operation the "ls /:" still worked.
[09/06 public]
 
Another import info: IP address and port are always correct
before the TKN_InitTokenState call.
[09/08 public]
 
After my nightly DCE-build the bug happens as usual ---
"ls /:" got RPC timeout and AFS_SetContext failed. 
 
ALL DFS user space servers are normal:
 
***bos status -server /.:/hosts/dce10***
Instance flserver, currently running normally.
Instance bakserver, currently running normally.
Instance ftserver, currently running normally.
Instance repserver, currently running normally.
 
***fts lsfldb***
root.dfs  
        readWrite   ID 0,,1  valid
        readOnly    ID 0,,2  invalid
        backup      ID 0,,3  invalid
number of sites: 1
   server           flags     aggr   siteAge principal      owner               
dce10.osf.org       RW       /u4     0:00:00 hosts/dce10    <nil>               
----------------------
Total FLDB entries that were successfully enumerated: 1 (0 failed; 0 wrong aggr type)

[09/12/94 public]
 
Lower the severity/priority to B2.
 
With 16.3 default build I have done four "DCE build", since
last Thursday, but "ls /:" still works with no RPC timeout.
So, I'll lower the severity/priority from A1 to B2 for now.

[9/12/94 public]
This is probably a dup of 11070.

[09/12/94 public]

I agree with Craig based on my Krpc traces and the OT notes to 11070.



CR Number                     : 12053
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 11687
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : sec
Subcomponent Name             : secd
Short Description             : secd core dumps, file table overflow
Reported Date                 : 9/6/94
Found in Baseline             : 1.1b16
Found Date                    : 9/6/94
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 11687
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[9/6/94 public]

Using bl-16.3, secd core dumped after 3 days, 5 hours with the following trace:

0 _kill@libc + 0x00000008 (hp-ux export stub)
1 _raise@libc + 0x00000024 (0x6, 0x4036fc24, 0x8, 0x2d2d2d00)
2 _abort@libc + 0x00000078 (0x400012f8, 0x4036fb78, 0x1, 0x4036fb24)
3 dce_svc_printf_withfile@libdce + 0x000005a0 (0x7afadfa0, 0x4001b60c, 0x1d4, 0x4001b64c)
4 rsdb_save + 0x0000027c (0x400062e0, 0x4036f470, 0x4036f470, 0)
5 rsdb_checkpt + 0x00000114 (0x4, 0x2, 0x4036f470, 0x400061f0)
6 rsdb_checkpt_task + 0x000001b8 (0, 0x7af521b0, 0x402039c8, 0x15)
7 cma__thread_base@libdce + 0x0000021c (0x402039c8, 0, 0, 0)
8 cma__thread_start1@libdce + 0x0000004c (0x402039c8, 0, 0, 0)

Technically, secd passed the "48 hour" requirement ... but I've logged
this as a "1" mainly because it is not clear secd is the culprit - there
was a resource problem of some kind that rendered ALL the server machines
in the cell (all were HPs and all were running DFS as well as core)
useless even for base OS commands like ls/ps/shutdown ... (error 23,
File table overflow, was a common theme as was "command not found")

Note that secd.log's timestamp was very close to the time of the core
dump:

-rw-rw-rw-   1 root     sys      10388316 Sep  4 22:01 core
-rw-r--r--   1 root     sys          111 Sep  4 21:58 secd.log

and reported:
PC_CN_AUTH_VFY_CLIENT_REQ on server failed: Clock skew too great (dce / krb)
errno text : File table overflow

I had 3 local dts servers so I don't know if the "Clock skew" error is
valid or not.

Future test runs will include a script (ple_ps) to capture system stats
throughout the run.

[9/6/94 public]
The dts servers may have been in a hosed state because of the resource
problems too.  The 'date' command shouldn't have the resource problems that
the ls/ps/shutdown commands did and would be able to tell you if the time
on each machine is within 5 minutes of the time on each of the other machines
in the cell.  If you do ls or ps and pipe to more and hit resource problems,
sometimes just not piping to more will get it to work.  If it gets into that
state again, try /etc/swapinfo -t (on HPUX, as root) to see how much swap
space is left (it should be able to run even if you're out of swap space and
can't get ls to run).  That secd core file isn't very big given the amount
of memory leaks that we believe are still hanging around.  Was the file
system full (on HPUX: bdf /) and that's possibly an incomplete core file?

[9/6/94 public]
Thanks for the info - Doublechecked and there was plenty of space so it doesn't
look like the core file was truncated:

root@dce13> bdf -t hfs
Filesystem           kbytes    used   avail capacity Mounted on
/dev/dsk/c201d6s0    320406  271979   16386    94%   /
/dev/dsk/c201d5s0    319866  170495  117384    59%   /u0

unfortunately, even avoiding pipes isn't enough (I still
have one hosed HP if you have more ideas). Here's what happens:

root@dce11> id   
/bin/ksh: id:  not found
root@dce11> whoami
/bin/ksh: whoami:  not found
root@dce11> klist
/bin/ksh: klist:  not found
root@dce11> <ctl-d>  (to get out of shell)
root@dce11> id
uid=0() gid=3()
root@dce11> /etc/swapinfo -t
	  Kb      Kb      Kb   PCT  START/      Kb
	  TYPE   AVAIL    USED    FREE  USED   LIMIT RESERVE  PRI  NAME
	  dev    74604   23236   51368   31%  341280       -    0  7,0x201600
	  dev    75835      59   75776    0%  340740       -    1  7,0x201500
	  hold       0   51744  -51744
	  tot   150439   75039   75400   50%       -       0    -
root@dce11> Routine bind(2) failed on childsocket '/opt/dcelocal/var/adm/directory/cds/dssS-2144674269' : errno = 23.
root@dce11> Unable to start execution of the child: errno = 23.
root@dce11> Unable to start execution of the child: errno = 23.
Failed to retrieve server binding from the namespace: Implementation specific error (dce / cds)
Failure retrieving profile entry from host: status 0x0000ff03 (? / aap)
LAN profile not found
Can't retrieve DCE cell name from configuration DB: status 0x0000ff03 (? / aap)
Too few servers (1), need 3 servers

secval Host Principal key management failure
Unknown message number 0x141290bd

BTW:
./stcode_hp 0x141290bd
336761021 (decimal), 141290bd (hex): Credentials cache I/O operation failed XXX (dce / krb)

Cds is clearly not happy - but again, who's the culprit? The "Can't retrieve DCE cell name" is
a known bug that's been fixed - workaround is to add a "cellaliases /blah" line to
/opt/dcelocal/dce_cf.db so that's okay ...

When I try to continue to get more info:

root@dce11> pwd
ksh: pwd: permission denied
root@dce11> cd /
root@dce11> ps -ef|grep cds
ksh: grep:  not found
ksh: ps:  not found
root@dce11> ps -ef
ksh: ps:  not found
root@dce11> top
top: can't open termcap file
last pid:     6;  load averages:  5.09,  5.06,  5.04    12:26:54
41 processes:  40 sleeping, 1 running

Memory: Real: 9328K/9804K act/tot  Virtual: 47348K/52604K act/tot  Free: 384K

  PID USERNAME PRI NICE   SIZE   RES STATE   TIME   WCPU    CPU COMMAND
    1275      0     5    0   296K   72K sleep   0:01  3.88%  2.71% ksh
   24007      0    28    0   308K  268K run     0:00 13.00%  0.63% top
   10927      0     1    0  8160K 1980K sleep  14:54  0.27%  0.27% bakserver
   10926      0     1    0  8132K 1928K sleep  14:34  0.24%  0.24% flserver
      49      0   -26    0    40K   60K sleep   3:59  0.09%  0.09% syncer
     109      0     1    0    84K   16K sleep   0:04  0.05%  0.05% <inetd>
    1274      0     1    0    68K   20K sleep   0:00  0.03%  0.03% <telnetd>
       1      0    15    0   216K    0K sleep   0:02  0.02%  0.02% <init>
      97      0     1    0     0K    0K sleep   0:02  0.01%  0.01% <biod>
     150      0     1    0    64K   64K sleep   0:09  0.01%  0.01% syslogd
    2751      0     1    0  6136K 1016K sleep  19:19  0.01%  0.01% dced
      85      0     1    0   180K    0K sleep   1:30  0.00%  0.00% <portmap>
      96      0     1    0     0K    0K sleep   0:02  0.00%  0.00% <biod>
     153      0    15    0   176K  136K sleep   0:06  0.00%  0.00% DIAGMON
     152      0     3    0   148K    0K sleep   0:00  0.00%  0.00% <getty>

Yup - it's a dfs cell - that's why I'm resp. engr. for now ... Added Rob Baum to
the interest list since the secval routines for maintaining the host principal self
tickets seem to have fallen down on the job too ... not a very focussed CR but I'll
cancel and open separate ones when things are more clear ...

[9/6/94 public]
I'm guessing the "Credentials cache IO operation failed"  would probably 
result from the sec_key_ routines if there was a problem of too many open
files on the system.  The secval is therefore probably falling down for the
same reason as everyone else.

[ sekhar 9/6/94 public ]

This similar to the problem in OT 11687 .

As I noted in OT 11687, there is one place in security code where 
the file descriptors are not being freed . The problem is that in the
function  sec_login_pvt_get_trusted_preauth() in the file sec_login_pvt.c
creat() is called , but the file descriptor is never freed.
I have fixed this and will be submitting it today.

[ sekhar 9/7/94 public ]

I just submitted the fixes for OT 11687 .

Also , in my comments dated 9/6/94 , in the  line

    "creat() is called , but the file descriptor is never freed."

free should read as closed .



CR Number                     : 12031
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dced
Subcomponent Name             : 
Short Description             : All RPC endpoints for an interface are deleted even though only 1 string binding is specified.
Reported Date                 : 9/2/94
Found in Baseline             : 1.1b16
Found Date                    : 9/2/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 12075
Fix By Baseline               : 
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[9/2/94 public]

I only wanted to delete the RPC endpoint for a connection-oriented
protocol sequence.  Note that the interface used supported both the
connection-oriented and the connectionless protocols.

However, when I invoked the following command, all RPC endpoints
for the interface were deleted! 

dcecp> endpoint delete -i <interface> -b {ncacn_ip_tcp netaddr endpoint}

[9/2/94 public]
I can't reproduce this:

dcecp> endp cr -i {afbcceec-6c33-11cd-b7ca-080009251352 1.0} -b {ncadg_ip_udp 130.105.4.33 1234}
dcecp> endp cr -i {afbcceec-6c33-11cd-b7ca-080009251352 1.0} -b {ncacn_ip_tcp 130.105.4.33 5678}
dcecp> endp show -i {afbcceec-6c33-11cd-b7ca-080009251352 1.0}
{{interface {afbcceec-6c33-11cd-b7ca-080009251352 1.0}}
 {binding {ncadg_ip_udp 130.105.4.33 1234}}}

{{interface {afbcceec-6c33-11cd-b7ca-080009251352 1.0}}
 {binding {ncacn_ip_tcp 130.105.4.33 5678}}}
dcecp> endp del -i {afbcceec-6c33-11cd-b7ca-080009251352 1.0} -b {ncacn_ip_tcp 130.105.4.33 5678}
dcecp> endp show -i {afbcceec-6c33-11cd-b7ca-080009251352 1.0}
{{interface {afbcceec-6c33-11cd-b7ca-080009251352 1.0}}
 {binding {ncadg_ip_udp 130.105.4.33 1234}}}

Could you try to reconfirm this, and cancel it if you can't? I'm
running last night's build, but I'm not aware that anything in this
area has changed recently.

[9/2/94 public]
Try it with an endpoint for dced (port 135).  If the problem occurs with
that, then reassign to dced.

[9/2/94 public]

I tried the same steps as Robert and it worked.  However, I tried
this on dced and on a DCE user registry and all RPC endpoints were
deleted. So it's not just related to "dced".

I take that back. I just tried it on a DCE user registry again and
it worked. Try it on dced.

[9/2/94 public]

Well, all I can tell (using gdb) is that endpoint_delete is making a
single call to rpc_mgmt_ep_unregister(), passing it the binding handle
for the one specified binding (as returned by
rpc_binding_from_string_binding()), and that one call is removing the
endpoints for both bindings. I don't know if this is dced's fault or
rpc's.

[9/2/94 public]
sounds like dced's.  Particularly since it is only for the endpoints to
dced itself and not for other servers.  Rich...

[09/12/94 public]
If I understand this correctly, dced is killing its own endpoints?
If not, please un-mark this as a dup.



CR Number                     : 12026
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : cds
Subcomponent Name             : 
Short Description             : sec_acl_get_access returns -------
Reported Date                 : 9/2/94
Found in Baseline             : 1.1b16
Found Date                    : 9/2/94
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 12013
Fix By Baseline               : 
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[9/2/94 public]

Both acl_edit's "get_access" and dcecp's "acl check" return all null
access for CDS directories and objects, irrespective of what the ACL
actually says for the invoking principal (as revealed by acl_edit
"list" or dcecp "acl show").

[9/2/94 public]

When checking ACL permissions of invoker on CDS objects only, 
a permission set of all dashes is returned.



CR Number                     : 12025
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : i486
S/W Ref Platform              : osf1
Component Name                : cds
Subcomponent Name             : 
Short Description             : Assertion failures in cdsd
Reported Date                 : 9/2/94
Found in Baseline             : 1.1b16
Found Date                    : 9/2/94
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 12004
Fix By Baseline               : 
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[9/2/94 public]


This is with the nightly build of 9/1/94.

Running the dcecp "directory merge" FVTs, after all the tests had run,
I saw the following:

1994-09-02-11:39:08.799-04:00I----- cdsd(15405) FATAL cds adver dceassert.c 63 0x005d3a78
Assertion "(status == DNS_SUCCESS)" failed in "/project/dce/build/dce1.1-snap/src/directory/cds/server/db_directory.c"file> line <1347

[9/6/94 public]
After putting some things back in dce_config that we took out last week
12004 ends up failing in exactly this assertion during a secondary cdsd
configuration. We know what is happening and Janet is looking at what to
do about it. See my update of 12004 this morning.



CR Number                     : 12019
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000,hppa
S/W Ref Platform              : aix,hpux
Component Name                : gds
Subcomponent Name             : /test/directory/gds/mavrostest
Short Description             : missing include test.h
Reported Date                 : 9/2/94
Found in Baseline             : 1.1
Found Date                    : 9/2/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 12018
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[9/2/94 public]

[ /test/directory/gds/mavrostest at 23:40 (PM) Thursday ]
makepath mavrostest/. && cd mavrostest &&  exec make MAKEFILE_PASS=BASIC     build_all
c89 -c    -D_SHARED_LIBRARIES    -D__hppa -Dhp9000s800 -Dhp9000s700 -D__hp9000s800 -D__hp9000s700 -DHPUX -D__hpux -Dunix +DA1.0 -D_HPUX_SOURCE    -I. -I/u3/devobj/sb/nb_ux/src/test/directory/gds/mavrostest -I/project/dce/build/dce1.1-snap/src/test/directory/gds/mavrostest   -I/u3/devobj/sb/nb_ux/export/hp800/usr/include -I/project/dce/build/dce1.1-snap/export/hp800/usr/include    /project/dce/build/dce1.1-snap/src/test/directory/gds/mavrostest/test_mvr.c
test_mvr.c: 58: Unable to find include file 'test.h'.
*** Error code 1
c89 -c    -D_SHARED_LIBRARIES    -D__hppa -Dhp9000s800 -Dhp9000s700 -D__hp9000s800 -D__hp9000s700 -DHPUX -D__hpux -Dunix +DA1.0 -D_HPUX_SOURCE    -I. -I/u3/devobj/sb/nb_ux/src/test/directory/gds/mavrostest -I/project/dce/build/dce1.1-snap/src/test/directory/gds/mavrostest   -I/u3/devobj/sb/nb_ux/export/hp800/usr/include -I/project/dce/build/dce1.1-snap/export/hp800/usr/include    /project/dce/build/dce1.1-snap/src/test/directory/gds/mavrostest/import1.c
import1.c: 38: Unable to find include file 'test.h'.
*** Error code 1
c89 -c    -D_SHARED_LIBRARIES    -D__hppa -Dhp9000s800 -Dhp9000s700 -D__hp9000s800 -D__hp9000s700 -DHPUX -D__hpux -Dunix +DA1.0 -D_HPUX_SOURCE    -I. -I/u3/devobj/sb/nb_ux/src/test/directory/gds/mavrostest -I/project/dce/build/dce1.1-snap/src/test/directory/gds/mavrostest   -I/u3/devobj/sb/nb_ux/export/hp800/usr/include -I/project/dce/build/dce1.1-snap/export/hp800/usr/include    /project/dce/build/dce1.1-snap/src/test/directory/gds/mavrostest/attrdec.c
attrdec.c: 34: Unable to find include file 'test.h'.
*** Error code 1

[9/2/94 public]
Dupped.  Hah!  Beat you to the punch by about 30 secs.!  ;-)



CR Number                     : 12011
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : i486
S/W Ref Platform              : osf1
Component Name                : gds
Subcomponent Name             : gdsdirinfo
Short Description             : gdsdirinfo returns shmget() error
Reported Date                 : 9/1/94
Found in Baseline             : 1.1b16
Found Date                    : 9/1/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 11047
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[9/1/94 public]

Invoking gdsdirinfo on OSF/1 returns the following message:

1994-09-01-16:20:25.415-04:00I1.158 gdsdirinfo FATAL gds ipc d23util.c 257 0xa44d2d88
A shmget system call has failed (key = 1141165127, access mode = 666, errno = 2).

I'm using yesterday afternoon's build, essentially NB0830 with security fixes.

[9/1/94 public]
Dupped to an earlier defect.



CR Number                     : 12009
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : acl_edit
Short Description             : acl_edit functional tests 11 & 12 fail
Reported Date                 : 9/1/94
Found in Baseline             : 1.1b17
Found Date                    : 9/1/94
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 12012
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[9/1/94 public]

Acl_edit functional tests 11 & 12 fail with the following error :

ERROR: SEC_ACL_EDIT - would unintentionally grant permissions via recalculated mask
 (dce / sad)

The tests currently mask this error because serviceability puts a newline
in error messages for security administration programs (an OT is
currently being opened by sekhar to address this). So the tests may
actually report the tests as passing when they really aren't. Our
functional tests for HP-UX report them as failed, but apparently
when run at OSF they are reported as passed.

[9/1/94 public]

Just found out that this may not be a problem - the test may be
checking that the error above is expected. It is difficult to tell
because of the serviceability bug mentioned above so I recommend 
leaving this open until that is fixed and we can verify that this 
test passes.

[ sekhar 9/1/94 public ]

Marked this CR as being dependent on 12012 which addresses the
issue of newline for admin programs .

[ sekhar 9/9/94 public ]

I just verified that once 12012 is fixed, acl_edit test no longer fails.

Marked this as a dup of 12012 which contains more information on what
the problem/fix is.



CR Number                     : 12008
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : dfsd
Short Description             : PID#4681 ERROR dsd general afsd.c
Reported Date                 : 9/1/94
Found in Baseline             : 1.1
Found Date                    : 9/1/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 12006
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[9/1/94 public]


Fileset 0,,1 created on aggregate lfs_aggr1 of budapest
S:****** Starting dfsbind...
S:****** Starting fxd...
S:****** Configuring DFS Client...
S:****** Loading kernel extensions...
Too few servers (2), need 3 servers
S:****** Starting dfsd...
1994-09-01-12:50:44.889-04:00I----- PID#4681 ERROR dsd general afsd.c 1255 0x7affbbb0
dfsd: start sweeping disk cache files .... 
1994-09-01-12:51:33.352-04:00I----- PID#4681 ERROR dsd general afsd.c 1324 0x7affbbb0
dfsd: All DFS daemons started.
S:****** Exiting from dce_config.
WARNING: The password for the "cell_admin none none" user is a well-known 
         default value.  Since this is a security hole, it is recommended that 
         the password be changed immediately after exiting this script by using
         "dce_login", then the "rgy_edit change" command.
+ cd /u1/RAT_tools



CR Number                     : 12007
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : cds
Subcomponent Name             : 
Short Description             : rgy_edit cell fails when using DNS access if pe_site file isn't modified
Reported Date                 : 9/1/94
Found in Baseline             : 1.1b16
Found Date                    : 9/1/94
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 12208
Fix By Baseline               : 
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[9/1/94 public]

Using last night's build, I installed two cells on HP-UX systems.
I entered the binding data into the named datafile for both
cells, then took gdad down and restarted it in both cells. 
Then I tried using "rgy_edit cell" to setup intercell
authentication. This failed with the error:

 ?(rgy_edit) Incomplete cell add - Registry server unavailable 
 (Registry Edit Kernel) (dce / sad)

Then I tried using "cdscp define cached server" to define the
clearinghouse binding in one cell to the other cell, and again
tried "rgy_edit cell". This time it succeeded.

So I repeated the first step, setting up two new cells again
from scratch, updating DNS, and restarting the gdad's. I
repeated "rgy_edit cell" and it failed as in the previous 
attempt. 

Then I edited the pe_site file on each node to include the security
bindings from the other cell's pe_site file, and repeated the 
"rgy_edit cell" command. This time rgy_edit cell succeeded, using
gdad/DNS.

Is this two bugs or one?

[9/2/94 public]
The only expaination for this is  either gdad is broken or the dns
data base is incorrect therefore I will assign this to cds and assign it to
myself to determine what's going on. It is not currently blocking anyone 
however, so I will get to it when other problems settle down.

[9/7/94 public]
No longer reproducable. Something between bl16-3 and now may have fixed it.

[9/13/94 public]
This problem still exists in BL17. Apparently the fact that this problem
was seen between two HP nodes is significant. I setup 4 cells using BL17-
2 HP and 2 OSF. I could establish intercell access from the HP to the OSF
cells, but not between the two HP cells.i (Same error message as originally
reported.) After editing the pe_site files on the two HP systems rgy_edit 
cell worked fine.

[9/19/94 public]
A new bug has been opened against security for this problem. This is a 
dup of that.



CR Number                     : 11984
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dcecp
Subcomponent Name             : generic schema
Short Description             : Can only create one generic schema attribute
Reported Date                 : 8/31/94
Found in Baseline             : 1.1b16
Found Date                    : 8/31/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 11840
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[8/31/94 public]

During testing of the 'xattrschema create' command for generic
schema attributes, I can only create one generic schema attribute.
All subsequent create commands give an error.

   dcecp> xattrschema catalog /.:/hosts/oddball/config/xattrschema -simplename
   hostdata/filecontents
   hostdata/bincontents
   xattrschema/dtsconfig
   xattrschema/additional_environ

   dcecp> xattrschema create /.:/hosts/oddball/config/xattrschema/test_blech_1 -encoding integer -aclmgr {group r r r r}

   dcecp> xattrschema catalog /.:/hosts/oddball/config/xattrschema -simplename
   hostdata/filecontents
   test_blech_1
   hostdata/bincontents
   xattrschema/dtsconfig
   xattrschema/additional_environ

   dcecp> xattrschema create /.:/hosts/oddball/config/xattrschema/test_blech_2 -encoding integer -aclmgr {group r r r r}
   Error: Cannot create object; already exists

[8/31/94 public]

I was in the middle of opening another bug with the description "create of generic schema
should provide uuid if one is not specified" when it dawned that possible this is the
problem here.

   dcecp> xattrschema show /.:/hosts/oddball/config/xattrschema/test_blech_1
   {aclmgr {group {{query r} {update r} {test r} {delete r}}}}
   {annotation {}}
   {applydefs no}
   {encoding integer}
   {intercell reject}
   {multivalued yes}
   {reserved no}
   {scope {}}
   {trigbind {}}
   {trigtype none}
   {unique no}
   {uuid 00000000-0000-0000-0000-000000000000}

But if you create a new attribute in the security schema, using the same create line as
above, a uuid is assigned to you if you do not specify one.  The generic schema create
should work the same way.  So if you cannot afford a uuid, the generic schema should
appoint one for you.

[8/31/94 public]
Actually it has nothing to do with generic schema i/f. It's due to the dced 
schema server implementation problem. This is a dup of CR11840.

[9/1/94 public]
Funny, I thought I'd heard this problem was reported, but when I scanned
thru the bugs for dcecp, I couldn't find it.  No wonder!  Sorry, Ping.

Either way, please note that when a schema entry is created in the generic
schema it should be assigned a uuid if one is not specified.  Thanks.

[9/1/94 public]
The reason that generic schema i/f doesn't check and create uuid for
a schema entry to be created is to keep consistent with sec_rgy_schema i/f
implementation, besides other than uuid there are a number of fields in
schema entry need server side to check so it is make much more sense to
leave the valiadation work to the server side. It's also what sec schema
server implementation does.



CR Number                     : 11946
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : cds
Subcomponent Name             : 
Short Description             : can't configure
Reported Date                 : 8/29/94
Found in Baseline             : 1.1b16
Found Date                    : 8/29/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 11964
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[8/29/94 public]
I'm trying to install the nightly of 8/28:

S:****** Configuring CDS Server...
S:****** Check for active sec_client service...
S:****** Starting cdsadv...
S:****** Starting cdsd...
S:****** Setting ACLs for all new namespace entries...
ERROR: Connection request rejected (dce / rpc)
Unable to bind to object /.:/sec-v1
ERROR:   acl_edit - setting ACLs on new namespace entries.
           Message from acl_edit:
           ERROR: Communications failure (dce / rpc)
         Unable to bind to object /.:/cell-profile
         ERROR: Connection request rejected (dce / rpc)
         Unable to bind to object /.:/lan-profile
         ERROR: Connection request rejected (dce / rpc)
         Unable to bind to object /.:/absolut_ch
         ERROR: Connection request rejected (dce / rpc)
         Unable to bind to object /.:/absolut_ch
         ERROR: Connection request rejected (dce / rpc)
         Unable to bind to object /.:/hosts
         ERROR: Connection request rejected (dce / rpc)
         Unable to bind to object /.:/hosts/absolut
         ERROR: Connection request rejected (dce / rpc)
         Unable to bind to object /.:/sec
         ERROR: Connection request rejected (dce / rpc)
         Unable to bind to object /.:/hosts/absolut/self
         ERROR: Connection request rejected (dce / rpc)
         Unable to bind to object /.:/hosts/absolut/cds-clerk
         ERROR: Connection request rejected (dce / rpc)
         Unable to bind to object /.:/hosts/absolut/cds-server
         ERROR: Connection request rejected (dce / rpc)
         Unable to bind to object /.:/hosts/absolut/cds-gda
         ERROR: Connection request rejected (dce / rpc)
         Unable to bind to object /.:/hosts/absolut/profile
         ERROR: Connection request rejected (dce / rpc)
         Unable to bind to object /.:/subsys/HP/sample-apps
        Press <RETURN> to continue, CTRL-C to exit
root@absolut dce1.1/etc$ psdce
    root 19967     1  0 15:51:07 ?        0:11 secd -bootstrap
    root 20006     1  0 15:51:36 ?        0:01 sec_clientd
    root 20320     1  0 15:52:51 ?        0:03 cdsadv
    root 20331 20320  0 15:52:59 ?        0:28 /opt/dcelocal/bin/cdsclerk
    root 19913     1  0 15:50:47 ?        0:09 dced -sb

This has happened twice.  cdsd is not running, but...

root@absolut dce1.1/etc$ /opt/dcelocal/bin/cdsd -a
root@absolut dce1.1/etc$ psdce
    root 19967     1  0 15:51:07 ?        0:14 secd -bootstrap
    root 20006     1  0 15:51:36 ?        0:01 sec_clientd
    root 20320     1  0 15:52:51 ?        0:03 cdsadv
    root 20772     1  0 16:27:24 ?        0:11 /opt/dcelocal/bin/cdsd -a
    root 20331 20320  0 15:52:59 ?        0:38 /opt/dcelocal/bin/cdsclerk
    root 19913     1  0 15:50:47 ?        0:11 dced -sb

of course now I have to do the rest of the config by hand... :-(



CR Number                     : 11941
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 10924
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : sec
Subcomponent Name             : secd
Short Description             : secd master dumps core after
60 hours
Reported Date                 : 8/29/94
Found in Baseline             : 1.1b16
Found Date                    : 8/29/94
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 10924
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[8/29/94 public]

Build: BL-16
Configuration:

	HPUX: DCE 1.1 secd, dtsd
	OSF1: DCE 1.1 cdsd, dtsd
	OSF1: DCE 1.1 client, dtsd, NTP provider
	OSF1: DCE 1.1 client
	RIOS: DCE 1.0.3 client


secd dumped core after 60 hours (whence B 2). The svc log recorded the
following error:

root@west> cat secd.log
1994-08-29-05:45:49.923-04:00I2.867 secd FATAL sec rs_rsdb rs_acct.c 925
0x40200288
Fatal exception while holding read-intend-write database lock

The core trace gave the following:

root@west> ls -s core
206976 core

trace 
======


0 _kill@libc + 0x00000008 (hp-ux export stub)
 1 _raise@libc + 0x00000024 (0x25, 0x40282fa4, 0x1d, 0x38363700)
 2 _abort@libc + 0x00000078 (0x400011a0, 0x40282ef8, 0x1, 0x40282ea4)
 3 dce_svc_printf_withfile@libdce + 0x000005a0 (0x7afad7b0, 0x40015efc,
0x39d, 0x40015f3c)
 4 rs_acct_replace + 0x00000b90 (0x4598cf50, 0x40280868, 0x4028146c, 0x6)
 5 op4_ssr + 0x000002bc (0x4598cf50, 0x40c49c80, 0x4028051c, 0x401fa310)
 6 rpc__cn_call_executor@libdce + 0x000007c8 (0x40c49c80, 0, 0, 0)
 7 cthread_call_executor@libdce + 0x000002d4 (0x401fb488, 0x7af53230,
0x40200288, 0xe)
 8 cma__thread_base@libdce + 0x0000021c (0x40200288, 0, 0, 0)
 9 cma__thread_start1@libdce + 0x0000004c (0x40200288, 0, 0, 0)
10 cma__thread_start0@libdce + 0x00000008 (0x40200288, 0, 0, 0)
11 cma__thread_start0@libdce + 0x00000008 (0x40200288, 0, 0, 0)
12 cma__thread_start0@libdce + 0x00000008 (0x40200288, 0, 0, 0)
13 cma__thread_start0@libdce + 0x00000008 (0x40200288, 0, 0, 0)
14 cma__thread_start0@libdce + 0x00000008 (0x40200288, 0, 0, 0)
15 cma__thread_start0@libdce + 0x00000008 (0x40200288, 0, 0, 0)
16 cma__thread_start0@libdce + 0x00000008 (0x40200288, 0, 0, 0)

[8/29/94 public]
Given that the above core file is 206976 blocks, which is about 106MB,
I'd say it's possible that the machine ran out of swap space at about this
time, so I've added 10924 (secd memory leak CR) to the interdependency field
above.  If you can bring secd back up with this database (ie: just restart
secd), then that account replace would get replayed with the same data, and
if it works this time then it's likely that it was a resource issue that
caused it to fail the first time.   BTW, if you can bring secd back up with
this database, please do a ps -el to see how big it is (the SZ field is in
blocks too and the blocksize is 512).  If the core image size reported by
ps -el is *much* smaller than 105MB (206976 blocks) then a fair amount of it
could be attributed to memory leaks (a good amount would have been from
deleted entries in the balanced tree that don't get cleaned up if not reused
until a secd  restart and a good amount would have been cached information
by the RnPC runtime on the last N client contexts that had called it...).

[8/29/94 public]

Well, I did not re-start secd alone, I re-started the cell because it was not
doing well when I got here this morning. 
Here is the size of secd as recorded by the ps -el command:

  F S   UID   PID  PPID  C PRI NI     ADDR   SZ    WCHAN TTY      TIME COMDOB
  1 S     0 22244     1  0 154 10  20f9540 2113   23b180 ?        4:29 secd

I found the principal entries in the registry database- about 50 or so.

[9/6/94 public]
Given that secd restarted with a normal size and didn't die when restarting,
I'd say that the data in the database is fine and that it was the fact that
secd was over 106MB that killed it.  Since 10924 has been open for a while
to fix secd memory leaks (and we've found a few that we're fixing now), I've
dup'd this to 10924.



CR Number                     : 11912
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : dts
Subcomponent Name             : dtsd
Short Description             : dtsd core dumping on HP
Reported Date                 : 8/26/94
Found in Baseline             : 1.1b16
Found Date                    : 8/26/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 11925
Fix By Baseline               : 
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[8/26/94 public]
bl-16
CHO cell (ie. 4 machine cell, 3 local servers - 2H, 1R, 1 clerk - H)

Copyright Hewlett-Packard Co. 1985,1987-1992. All Rights Reserved.
<<<< XDB Version A.09.01 HP-UX >>>>
Core file from:  dtsd
Child died due to: segmentation violation
Procedures:      0
Files: 0
>trace
 File: unknown    Procedure: free@libc + 0x00000008    Line: unknown
  0 free@libc + 0x00000008 (hp-ux export stub)
  1 TMEM@libdce + 0x00095d18 (0xe, 0x4002f180, 0x7af3125c, 0x802e1803)
  2 free@libc + 0x00000224 (0x483f0010, 0x400966e0, 0x40404e9c, 0)
  3 TMEM@libdce + 0x004e2a14 (0x40524ea8, 0x3, 0x40404e60, 0x4002f180)
  4 TMEM@libdce + 0x004e2de4 (0x40524600, 0xe, 0x1, 0x40524ea8)
  5 TMEM@libdce + 0x004e2c04 (0x40524600, 0x40524ea8, 0x405241c0, 0x40521ee8)
  6 TMEM@libdce + 0x004e3b18 (0x40524508, 0x40524600, 0x40404d60, 0x404b7350)
  7 TMEM@libdce + 0x004d48a8 (0x10, 0x40096660, 0x404b7350, 0x40404ce0)
  8 TMEM@libdce + 0x003008ec (0x40095d10, 0x404af8e8, 0x5, 0x2)
  9 TMEM@libdce + 0x0019d014 (0x404af820, 0x3, 0, 0)
  10 TMEM@libdce + 0x001a3268 (0x404af820, 0x40404764, 0x40404764, 0)
  11 TMEM@libdce + 0x00131c8c (0x404570f8, 0, 0x400012f0, 0x1)
  12 TMEM@libdce + 0x0010a89c (0x404570f8, 0, 0x400012f0, 0x1)
  13 ServerRequestTime + 0x00000144 (0x404570f8, 0x4052a5d0, 0x4040449c, 0x404044a0)
  14 GetTimeFromServerRPC + 0x00000194 (0x4052a5b8, 0x7af50230, 0x4002f180, 0x9ff)
  15 TMEM@libdce + 0x000d376c (0x4002f180, 0, 0, 0)

	    etc. (no other named calls in trace)

    Comments from cbrooks:
    I have seen this (intermittently) on the HP when the cell has been restarted. 
    It may be related to the user-space implementation of utc_adjtime().
    Whatever it is, it's ugly - I was trying to debug this yesterday but 
    I couldn't restart my dtsd - kept hanging in a sec_rgy_site_open() call...

[8/26/94 public]
New and better trace this time! Again, this is bl-16.

 0 priv_krb_util_concat_authdata@ + 0x0000011c (0x40513b98, 0, 0x403b7f0c, 0x403b7f08)
 1 krb5_get_cred_via_tgt@libdce + 0x000009ec (0x403b7df0, 0, 0x403b0001, 0x403b0002)
 2 krb5_get_cred_from_kdc@libdce + 0x0000097c (0x40096668, 0x403e5438, 0x403b7d60, 0x403e5438)

 3 krb5_get_credentials@libdce + 0x00000178 (0x10, 0x40096668, 0x403e5438, 0x403b7ce0)
 4 sec_krb_get_cred@libdce + 0x00000268 (0x40095d18, 0x400b8b40, 0x5, 0x2)
 5 rpc__krb_get_tkt@libdce + 0x000003d8 (0x40121fe8, 0x3, 0, 0)
 6 rpc__krb_cn_cred_refresh@libdc + 0x000004a0 (0x40121fe8, 0x403b7764, 0x403b7764, 0)
 7 rpc__cn_call_start@libdce + 0x0000018c (0x404fbf30, 0, 0x400012f0, 0x1)
 8 rpc_call_start@libdce + 0x0000025c (0x404fbf30, 0, 0x400012f0, 0x1)
 9 ServerRequestTime + 0x00000144 (0x404fbf30, 0x40517050, 0x403b749c, 0x403b74a10 GetTimeFromServerRPC + 0x00000194 (0x40517038, 0x7af50230, 0x4002de60, 0x1245)
11 cma__thread_base@libdce + 0x0000021c (0x4002de60, 0, 0, 0)
12 cma__thread_start1@libdce + 0x0000004c (0x4002de60, 0, 0, 0)
13 cma__thread_start0@libdce + 0x00000008 (0x4002de60, 0, 0, 0)
14 priv_krb_util_concat_authdata@ + 0x0000011c (0, 0, 0, 0)
15 _end + 0x0001d288 (Address not found (UE302)

[8/29/94 public]
Looks like a smoking gun pointed at security...
This may be a duplicate of another cred refresh bug I seem to remember.
Added the security people to the CC list and hopefully they will comment.

[8/29/94 public]
The traceback above looks similar to the CR 11925 where it fails in the
routine priv_krb_util_concat_authdata(). This is probably the same problem.
I'm duping it to CR 11925 for now.



CR Number                     : 11908
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : sec
Subcomponent Name             : /security/server/bin
Short Description             : Unsatisfied symbols
Reported Date                 : 8/26/94
Found in Baseline             : 1.1
Found Date                    : 8/26/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 11906
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[8/26/94 public]
[ /security/server/bin at 21:44 (PM) Thursday ]
makepath bin/. && cd bin &&  exec make MAKEFILE_PASS=BASIC     build_all
bin: created directory
c89 -c    -D_SHARED_LIBRARIES   -DOSF_DCE -DDCESHARED_PATH=\"/opt/dce\" -DDCELOCAL_PATH=\"/opt/dcelocal\" -D_BSD -DBSD -DRS_REP_NAUTH -DPOSIX_FILE_LOCKS -DPOSIX_TERMIOS -DDCE_AUD_POINTS -D__hppa -Dhp9000s800 -Dhp9000s700 -D__hp9000s800 -D__hp9000s700 -DHPUX -D__hpux -Dunix +DA1.0 -D_HPUX_SOURCE    -I. -I/u3/devobj/sb/nb_ux/src/security/server/bin -I/project/dce/build/dce1.1-snap/src/security/server/bin  -I../../h -I/u3/devobj/sb/nb_ux/src/security/h -I/project/dce/build/dce1.1-snap/src/security/h -I../../idl -I/u3/devobj/sb/nb_ux/src/security/idl -I/project/dce/build/dce1.1-snap/src/security/idl -I../rs -I/u3/devobj/sb/nb_ux/src/security/server/rs -I/project/dce/build/dce1.1-snap/src/security/server/rs -I/u3/devobj/sb/nb_ux/export/hp800/usr/include -I/project/dce/build/dce1.1-snap/export/hp800/usr/include    /project/dce/build/dce1.1-snap/src/security/server/rs/rs_main.c
c89 -c    -D_SHARED_LIBRARIES   -DOSF_DCE -DDCESHARED_PATH=\"/opt/dce\" -DDCELOCAL_PATH=\"/opt/dcelocal\" -D_BSD -DBSD -DRS_REP_NAUTH -DPOSIX_FILE_LOCKS -DPOSIX_TERMIOS -DDCE_AUD_POINTS -D__hppa -Dhp9000s800 -Dhp9000s700 -D__hp9000s800 -D__hp9000s700 -DHPUX -D__hpux -Dunix +DA1.0 -D_HPUX_SOURCE    -I. -I/u3/devobj/sb/nb_ux/src/security/server/bin -I/project/dce/build/dce1.1-snap/src/security/server/bin  -I../../h -I/u3/devobj/sb/nb_ux/src/security/h -I/project/dce/build/dce1.1-snap/src/security/h -I../../idl -I/u3/devobj/sb/nb_ux/src/security/idl -I/project/dce/build/dce1.1-snap/src/security/idl -I../rs -I/u3/devobj/sb/nb_ux/src/security/server/rs -I/project/dce/build/dce1.1-snap/src/security/server/rs -I/u3/devobj/sb/nb_ux/export/hp800/usr/include -I/project/dce/build/dce1.1-snap/export/hp800/usr/include    /project/dce/build/dce1.1-snap/src/security/server/bin/rgy_create.c
c89   -g   -z -Wl,-Bimmediate,-Bnonfatal,-a,default,+b,/lib:/usr/lib     -L/u3/devobj/sb/nb_ux/export/hp800/usr/shlib -L/project/dce/build/dce1.1-snap/export/hp800/usr/shlib -L/usr/shlib -L/u3/devobj/sb/nb_ux/export/hp800/usr/lib     -L/project/dce/build/dce1.1-snap/export/hp800/usr/lib   -o secd.X rs_main.o  -L../../krb5/kdc -L../../krb5/lib/kdb -L../rsdb -L../rrs -L../../utils -L../../audit/libaudit -L../lm -L../rs -lrs -lkrb5kdc -lkdb -lrsdb -lrrs -lsecutil -laudit -ldce -lrss  -llm  
/bin/ld: Unsatisfied symbols:
   sec_key_mgmt_set_key (code)
*** Error code 1



CR Number                     : 11881
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : utils
Subcomponent Name             : dcecf
Short Description             : getcellname core dumps
Reported Date                 : 8/25/94
Found in Baseline             : 1.1
Found Date                    : 8/25/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 11879
Fix By Baseline               : 
Fixed In Baseline             : 
Affected File(s)              : dcecf.c
Sensitivity                   : public

[8/25/94 public]

In todays build, getcellname core dumps:
..(no debugging symbols found)...
Core was generated by `getcellname'.
Program terminated with signal 11, Segmentation fault.
(gdb) where
#0  0xa4173357 in dce_cf__load_cache (-1073744884)
#1  0xa4173bcd in dce_cf_get_cell_name ()

[tom public]

This is also where dced dies:
(gdb) kill
Kill the inferior process? (y or n) In Local core dump file,
#0  0xa4173357 in dce_cf__load_cache (-1073744876)
(gdb) where
#0  0xa4173357 in dce_cf__load_cache (-1073744876)
#1  0xa4173bcd in dce_cf_get_cell_name (4406676, -1073744876)
#2  0x405dff in init_global_data (st=0xbffff414)
    at /project/dce/build/dce1.1-snap/src/admin/dced/server/misc.c:165
#3  0x4003c9 in main (ac=2, av=0xbffff448)
    at /project/dce/build/dce1.1-snap/src/admin/dced/server/main.c:307



CR Number                     : 11863
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : DFS Smoketest
Short Description             : system panics during dfs test
Reported Date                 : 8/24/94
Found in Baseline             : 1.1
Found Date                    : 8/24/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 11861
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[8/24/94 public]

SYSTEM HOST:		budapest
SYSTEM TYPE:		hppa
OS:			HPUX
TEST:			single machine cell, dfs Smoketest
PROBLEM:		System OS panics then core dumps
POSSIBLE CAUSE:		appears to die on cd /:

CONFIGURATION:		sif = sec and cds master, dts server
			budapest = sec replica, cds replica, dts server, dfs server
CORE FILES:		none


LOG: 			contents of budapest/tmp/dce_config.log

DEBUG:     Executing: menu99()
S:****** Exiting from dce_config.
WARNING: The password for the "cell_admin none none" user is a well-known 
         default value.  Since this is a security hole, it is recommended that 
         the password be changed immediately after exiting this script by using
         "dce_login", then the "rgy_edit change" command.
D:         Executing: rm -f /usr/bin/dce_login_noexec


LOG:			contents of budapest:/u1/RAT_tools/run_commands.dfs script

# sleep for tsr 
sleep 240
echo "cd /:"
cd /:
if [ "$?" != "0" ]; then
        echo "cd /: FAILED!"
fi


LOG:			contents of  budapest:/u1/RAT_tools/run_commands.dfs.log

Total FLDB entries that were successfully enumerated: 1 (0 failed; 0 wrong aggr
type)
+ [ 0 != 0 ]
+ sleep 240


LOG:			contents of budapest:/u1/RAT_tools/do_test.dfs.log


Too few servers (2), need 3 servers
S:****** Modifying the registry database for DFS operation...
S:****** Loading kernel extensions...
initializing Episode:  syscall return value = 0
S:****** Modifying the registry database for DFS server operation...
1994-08-24-12:19:12.380-04:00I----- dtsd WARNING dts config logevent_v_ultrix.c 269 0x7aff8968
Too few servers (2), need 3 servers



CR Number                     : 11837
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : gds
Subcomponent Name             : gdssetup
Short Description             : gdssetup core dumps
Reported Date                 : 8/23/94
Found in Baseline             : 1.1
Found Date                    : 8/23/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 11797
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[8/23/94 public]
GDSSETUP: TEST CASE lib/valid/max_psap -> FAILED 
GDSSETUP: TEST CASE lib/valid/sv_domdef1_inter -> FAILED 
GDSSETUP: TEST CASE lib/valid/sv_domdef2_inter -> FAILED 
GDSSETUP: TEST CASE lib/valid/sv_nodom1_inter -> FAILED 
520|0 1 20365 1 264|<gdssetup> gave exit code: 139 (core.last was dumped)

---> Start of  lib/valid/max_psap.log

ERROR
 gc_t_modify/C=de/O=dbp/OU=dap11/CN=dsa/CN=dsa-m3 -attribute OCL=DSA;APE PSA={TS=Server,NA='TCP/IP!inter
net=127.0.0.1+port=30031'                                  no} UP=dsa-m3 
Format error - "PSA={TS=Server,NA='TCP/IP!internet=127.0.0.1+port=30031'                                
  no}" : Error position <91>.
ERROR
CONFIGURATION of GDS ...
INITIALISATION and ADMINISTRATION of GDS ...




---> Start of  lib/valid/sv_domdef1_inter.log

Additional-DSA name<1>> /C=de/O=dbp/OU=dap11/CN=dsa/CN=dsa-m5
PSAP address <1>> TS=Server,NA='TCP/IP!internet=127.0.0.1+port=30051'
Additional-DSA name<2>> 
Default-DSA name<2>> /C=de/O=dbp/OU=dap11/CN=dsa/CN=dsa-m6
PSAP address <2>> TS=Server,NA='TCP/IP!internet=127.0.0.1+port=30061'
Default-DSA name<3>> 
The naming part /C=de/O=dbp/OU=dap11/CN=dsa/CN=dsa-m3 of the DSA is already in the contact DSA.
/C=de already exists and overwrite not sets. Attributes will remain unchanged.
/C=de/O=dbp already exists and overwrite not sets. Attributes will remain unchanged.
/C=de/O=dbp/OU=dap11 already exists and overwrite not sets. Attributes will remain unchanged.
/C=de/O=dbp/OU=dap11/CN=dsa already exists and overwrite not sets. Attributes will remain unchanged.
ERROR
gc_t_read (null)
    A miscellaneous error occurred while interacting with the Directory Service.
ERROR
Dir-id> Config-type(C/S)> No-of-clients> No-of-servers> Security method> CONFIGURATION of GDS ...
Client address> Local-DSA name> PSAP address> Contact-DSA name> PSAP address> Use default schema (yes/no
)> Local schema is master (yes/no)> The first default DSA is also the local DSA (yes/no)> DSA password> 
INITIALISATION and ADMINISTRATION of GDS ...


---> Start of  lib/valid/sv_domdef1_inter.cleanup.log

Error: The specified name does not match the name of any object in the directory.




---> Start of  lib/valid/sv_domdef2_inter.log

Additional-DSA name<1>> /C=de/O=dbp/OU=dap11/CN=dsa/CN=dsa-m5
PSAP address <1>> TS=Server,NA='TCP/IP!internet=127.0.0.1+port=30051'
Additional-DSA name<2>> 
Default-DSA name<2>> /C=de/O=dbp/OU=dap11/CN=dsa/CN=dsa-m6
PSAP address <2>> TS=Server,NA='TCP/IP!internet=127.0.0.1+port=30061'
Default-DSA name<3>> 
ERROR
 gc_t_modify/C=de/O=sni -attribute OCL=ORG;TOP MK={/C=de/O=sni/OU=buba/CN=dsa/CN=dsa-m3} 
A bad argument was supplied.
ERROR
Dir-id> Config-type(C/S)> No-of-clients> No-of-servers> Security method> CONFIGURATION of GDS ...
Client address> Local-DSA name> PSAP address> Contact-DSA name> PSAP address> Use default schema (yes/no
)> Local schema is master (yes/no)> The first default DSA is also the local DSA (yes/no)> DSA password> 
INITIALISATION and ADMINISTRATION of GDS ...
Sleep for 60 sec.
Sleep for 60 sec.
 
---> Start of  lib/valid/sv_domdef2_inter.cleanup.log

Error: Some part of the directory is currently not available.


---> Start of  lib/valid/sv_nodom1_inter.log

Additional-DSA name<1>> 
Default-DSA name<2>> /C=de/O=dbp/OU=dap11/CN=dsa/CN=dsa-m5
PSAP address <2>> TS=Server,NA='TCP/IP!internet=127.0.0.1+port=30051'
Default-DSA name<3>> dsa-m3
PSAP address <3>> 

---> Start of  lib/valid/sv_nodom1_inter.cleanup.log

Error: Some part of the directory is currently not available.

Here's the stack trace from the gdssetup core file:
(gdb) backtrace
#0  0xa404089b in gsu_dce_printf_string ()
#1  0xd7 in ?? (4837688, -1543233096, 3)
#2  0x407952 in main ()
#3  0x40150d in main ()
#4  0x40086c in main (1, -1073745140, -1073745132, -1073744872)
#5  0x4000cb in __start (Cannot access memory at address 0x1.



CR Number                     : 11836
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dced
Subcomponent Name             : xattr
Short Description             : dced dies when renaming an era is tried
Reported Date                 : 8/23/94
Found in Baseline             : 1.1b16
Found Date                    : 8/23/94
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 11840
Fix By Baseline               : 
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[8/23/94 public]

I was trying to rename an era in the generic schema, when dced seemed
to have core-dumped. The core file in /opt/dcelocal/var/dced when examined
by xdb gives the following traceback: 

Copyright Hewlett-Packard Co. 1985,1987-1992. All Rights Reserved.
<<<< XDB Version A.09.01 HP-UX >>>>
Core file from:  dced
Child died due to: segmentation violation
Procedures:    315
Files: 32
>t
 0 strcpy@libc + 0x00000008 (hp-ux export stub)
 1 TMEM@libdce + 0x0023bfec (0, 0x400ac0b8, 0x7b0338c0, 0x7b033828)
 2 name_cache_schema_init (db = 0x400ac098, cache = 0x40123008, st = 0x7b033828)    [/project/dce/build/dc
1.1-snap/src/admin/dced/server/misc.c: 472]
 3 init_caches (st = 0x7b033828)    [/project/dce/build/dce1.1-snap/src/admin/dced/server/misc.c: 683]
 4 main (ac = 1, av = 0x7b03363c)    [/project/dce/build/dce1.1-snap/src/admin/dced/server/main.c: 319]
 
==========================
The command that I was trying was:

dcecp> xattrschema rename /.:/hosts/sanatan/config/xattrschema/someint -to junkint

The rename code segment is as folllows:

if (strcmp((char *)schema_name, (char *)DEFAULT_RGY_SCHEMA_NAME) == 0) {
     /*
      * Use the default registry call.
      */
      sec_rgy_attr_sch_lookup_by_name(rgy_context,
                                      (sec_attr_component_name_t)schema_name,
                                      (idl_char *)schema_attr_name,
                                      &schema_entry_orig,
                                      &status);
      DCP_CHECK_SEC_ERROR(status);
      schema_entry.attr_id = schema_entry_orig.attr_id;
      sec_rgy_attr_sch_update_entry(rgy_context,
                                    (sec_attr_component_name_t)schema_name,
                                     modify_parts,
                                     &schema_entry,
                                     &status);
      DCP_CHECK_SEC_ERROR(status);
   }
   else {
      printf("reaching in non-default schema part\n");
      set_attr_schema_binding((dce_attr_component_name_t) schema_name, &status);
      printf("found binding handle %x, status %x\n", attr_schema_binding_handle, status);
      DCP_CHECK_SEC_ERROR(status);
      /*
       * Given the schema attribute name,
       * look up the schema attribute id.
       */
      dce_attr_sch_lookup_by_name(attr_schema_binding_handle,
                                (idl_char *)schema_attr_name,
                                (dce_attr_schema_entry_t *) &schema_entry_orig,
                                &status);
      printf("dce_attr_sch_lookup_by_name over, status %x\n", status);
      DCP_CHECK_SEC_ERROR(status);
      schema_entry.attr_id = schema_entry_orig.attr_id;
      dce_attr_sch_update_entry(attr_schema_binding_handle,
                               (dce_attr_schema_entry_parts_t) modify_parts,
                               (dce_attr_schema_entry_t *) &schema_entry,
                               &status);
      printf("done with dce_attr_sch_update_entry, status %x \n", status);
      DCP_CHECK_SEC_ERROR(status);
   }

[8/24/94 public]
dced core dumped, it's a dced bug.
cores are severity A
Made a P2 but perhaps could be higher.

[9/1/94 public]
This works fine on both platforms.
(Perhaps related to CR 11840?)

[9/02/94 public]
The command "xattrschema rename" might work fine, because I fixed a bug 
in my code that was causing dced to die. Specifically, I was sending to dced
a null name in schema_entry. When I fixed the bug, rename started working OK
but I think the bug in dced is still there. dced must ensure that the input
passed is valid before processing it.

[9/02/94 public]
Based on what you say above, this ot is a dup of CR11840.



CR Number                     : 11815
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : 
Short Description             : Account Lifespan Policy
Effectively Limits Life of Cell
Reported Date                 : 8/22/94
Found in Baseline             : 1.1
Found Date                    : 8/22/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 11370
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[8/22/94 public]

The account lifespan policy applies to all accounts in a cell.  And when
this cell-wide policy and the account expiration date differ, the
stricter lifespan applies.  Unfortunately, this policy applies to
all accounts in a cell, including the accounts used by dce, such as
dce-rgy.  But when the dce-rgy account expires, the registry becomes
unavailable when the cell is restarted, and the cell is basically broken.
Only running secd in locksmith mode can recover it.

Setting the account lifespan to anything other than "forever" 
effectively limits the life of the cell to that value.  This is because
there is no way to overrride this policy in an individual account that
really needs to exist forever in order for the cell to function.

[8/23/94 public]
I've marked this as interdependent on 11370, since I believe mdf will wind up
fixing this problem as a side effect of fixing that one.  If so, and he thinks
that this one is already described enough in that CR, then he should just go
ahead and make this a 'dup' of 11370.  If this has to be fixed separately, then
don't dup it and ask mob to reassign it to somebody with time to look into it.



CR Number                     : 11812
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : i486
S/W Ref Platform              : osf1
Component Name                : sec
Subcomponent Name             : secd
Short Description             : secd coredumps and gets FATAL malloc error
Reported Date                 : 8/22/94
Found in Baseline             : 1.1b15
Found Date                    : 8/22/94
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 10924
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[8/22/94 public]
I was running some sec systests over the weekend (dcesepol, 
dcesestr and dceseact each from a different node in 3-node cell)
and about 8 hours into the run secd crashed.  
I was running b15 with OSF/1 sec/cds server, HP sec replica,
and OSf/1 client.  At about the same time of the crash, the
following FATAL svc message was logged:

1994-08-20-05:13:47.829+00:00I15.420 secd FATAL sec rs_rsdb balanced_trees.c 202 0x005b95f0 unable to allocate memory.


pgstat -i shows adequate, I believe, swap space:

edgar /opt/dcelocal/var/adm/logs K# pgstat
Paging Statistics (page size of 4096 bytes):
Paging File  Pri,clsize Used  Total %    Calls:In    Calls:Out Unav.,Init,Write
Global Info:   -,-        -      -       90453:24036   4943:11810 91055, 0, 0
/dev/sd0b      4,4      4972  36864 13%   7041:7041   11494:11494  14658, -, -


Core was generated by `secd'.
Program terminated with signal 6, IOT/Abort trap.
#0  0xa403fea4 in tgs_key ()
(gdb) break main
Breakpoint 1 at 0x40014a
(gdb) run
Starting program: /opt/dcelocal/bin/secd 

Breakpoint 1, 0x40014a in main ()
(gdb) kill
Kill the inferior process? (y or n) y
In Local core dump file,
#0  0xa403fea4 in kill ()
(gdb) where
#0  0xa403fea4 in kill ()
Cannot access memory at address 0xc606bd44.
(gdb)

[ mdf 8/23/94 public ]

How big was the core file, also was there any trace back information?

[8/23/94 public]
By the way, I got this again last night.  The core file's pretty big:
edgar /opt/dcelocal/var/security K# ls -l core*
-rw-r--r--   1 root     bin             24219460 Aug 23 03:19 core
-rw-r--r--   1 root     bin             24205552 Aug 20 01:15 core.sv

(core.sv is original, core is newest)

Using gdb on the 486 w/ osf/1, that's the only info I could get from the core file.
I also got the same FATAL message last night.

[8/23/94 public]
Hmm, if you had 36mb of swap available after it had crashed and the tests
were no longer running, that means that you had less than 12mb of swap available
for any tests and other processes running on that node while secd was up.
While 24mb sounds *big* for secd and may be related to another CR or two open
against security memory leaks, 36mb sounds like too little swap for a server
machine (I believe HP recommends 100MB of swap on server machines, just to be
safe).  If you can run this with more swap space available and it works, then
this is a non-problem and the abnormally large size of secd will be addressed
in the other (memory leak) CRs.

[8/23/94 public]
The pgstat was a bit misleading.  There's actually 147Mb, since the page size
is 4K:
edgar / K# pgstat -k 
Paging Statistics (page size of 4096 bytes):
Paging File  Pri,clsize Used  Total %    Calls:In    Calls:Out Unav.,Init,Write
Global Info:   -,-        -      -      198005:30413   7302:18107 224364, 0, 0
/dev/sd0b      4,4     20416K 147456K 13%  11503:11503  17791:17791  32184, -, -

[8/25/94 public]
I reconfigured my cell yesterday to use a different machine (still osf/1) as
sec and cds server.  Running bl-16 and using dced's secval vs. sec_clientd.  
Started 3 sec systests (dcesestr, dcesepol, dceseacl) on each of 3 nodes in 
cell.  After about 10 hours I got the same secd crash with the same FATAL 
message.  Tet journals show various activities taking place where errors 
occurred: 
1) acl_edit to remove "f" permission from sec/group/seaclcliyosemite0group for 
   seaclcliyosemite1
2) Attempting to add account for person sestriledgaryosemite0p
3) Attempting to delete objects from database

[8/29/94 public]
Just fyi, I reconfigured my cell to make the sec/cds master on the HP.
The tests ran successfully for 15hrs in that config. Still bl-16.

[8/29/94 public]
I am trying to narrow down what to look at:

    So the only trace back information is that kill() was called? 

    Any serviceablity messages? 

    Also these tests worked previous to 8/21/94?

[8/31/94 public]
  I think the only real info is:
  Program terminated with signal 6, IOT/Abort trap.
  #0  0xa403fea4 in tgs_key ()

  I don't have the svc logs anymore, or the cores, but from what I remember 
  they were normal 2 hr checkpoints and then the FATAL message mentioned
  above, coinciding with the crash.

  It looks like a run I did on August 17th, with bl-14.3, also had a 
  secd crash after ~8hrs.

Can I do something else to get some more info?  Would it help if you
had the core file?

[9/1/94 public]
I ran in to this, again on the 486.

Single machine cell, configured from the 8/30-31 nightly (after rebuild).
I was running the rtandidl auth rpc tests, after running all the other
rtandidl tests.  I passed all the tests using tcp, but while repeating
them using udp, secd core dumped.

The rtandidl auth tests place much stress on security.

The secd.log file contains:
root@surf# cat secd.log
unable to allocate memory.

The core file:
root@surf# ls -l core
-rw-r--r--   1 root     bin             24169860 Aug 31 20:19 core
root@surf# ls -s core
47264 core
root@surf# du -sk core
23632   core

The back trace is not helpfull:
(gdb) b main
Breakpoint 1 at 0x40015a
(gdb) r 
Starting program: /usr/bin/secd 
Breakpoint 1, 0x40015a in main ()
(gdb) kill
Kill the inferior process? (y or n) In Local core dump file,
#0  0xa403fea4 in kill ()
(gdb) where
#0  0xa403fea4 in kill ()
Cannot access memory at address 0xc606fd40.

I have the core file saved as instructed by Mike Burati.

[9/1/94 public]
Text from Mike Burati, (could you run the following on the core file 
and add the results to this report)?

  Here's the info requested on browsing a huge core file...
  Since a core file with a correctly running process will be fairly small,
  you can assume that by browsing everything over 10MB in a huge core file
  should allow you to catch any repetitive memory usage that should have been
  free'd (assuming it's recognizable eg ascii...).

  For example, if you do the commands listed below, starting at 10Mb (skip
  1000 blocks) and then look at 20Mb (skip 2000), 30Mb, 40Mb and 50Mb, and
  see the same thing (ie: Schema entry) repeated over and over again at each
  of those places in the core file, then you can bet that someone was allocating
  a schema entry and not freeing it when it was done.  If it's something that
  only occurs once or twice in a core file that big, then it's probably not
  the problem you're looking for.
  
  Dump input file = core, blocksize = 100, skip first 1000 blocks, pipe it to
  od with -c conversion (to character)...
  
  dd if=core bs=100 skip=1000 | od -c | more
  (or you can od it with a hex option if you are good at recognizing patterns
  in hex :-)  (or, since strings is easier to read than od -c)

  dd if=core bs=100 skip=1000 | strings | more

Thanks Michael.

[9/1/94 public]
It strikes me as kind of odd that secd would die with a malloc error (ie:
malloc returned NULL) on the 486 at about 24MB every time, even with different
people running different tests and thus presumably having differing amounts
of swap space left, especially when secd goes up over 100MB (becuase of mem
leaks) on the other platforms before you see this problem.  Is there some
kind of per process memory limit of 24MB in your OSF/1 configuration?

[9/1/94 public]
You really need an OSF/1 machine....

root@surf# limit
cputime         unlimited
filesize        unlimited
datasize        16384 kbytes
stacksize       2048 kbytes
coredumpsize    unlimited
memoryuse       unlimited
descriptors     1024 files
addressspace    unlimited

I don't see much that would cause a 24 Meg limit, although the datasize
of 16Meg is a little small (you usually have to bump stack and data
up to build a libdce with any debugging).

Just a note: I placed the core file in the afs cell for you
guys to look at it.  The dd/od commands generates megabytes of info.

[9/1/94 public]
The limits on one machine where I had the crash are the same as Tom's;
the other one had 'datasize unlimited' and 'descriptors 256';

[9/1/94 public]
Well, I don't understand the crash on the datasize unlimited machine
(actually, they are not crashes; secd calls malloc, it returns NULL and
secd purposely forces a crash so that you'll have a core file to figure
out what was happening when it ran out of memory), but a datasize limit
of 16MB will definitely cause this problem with secd until we get rid of
the memory leaks.

We just found one set of leaks in error cases in process_as_req() in
do_as_req.c (not calling cleanup() macro in all error conditions) and 
actually a place where it free()s the same memory twice (for both cname and
sname) at the bottom of that routine (once in cleanup() once via direct
calls to free()).  Sean Mullan will submit a fixed do_as_req.c tomorrow.
(this is only a small leak and should only happen on errors, so we'll have
to leave the CR open til we find the real leaks).

[9/2/94 public]

I cleaned up the memory leaks and duplicate frees in process_as_req() but
haven't built on 486 yet. Will submit a request on Tuesday hopefully.

[9/7/94 public]
This is another memory leak bug, so we're dup'ing it to that.  That
bug will be raised in priority.



CR Number                     : 11809
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 11807
Project Name                  : dce
H/W Ref Platform              : i486
S/W Ref Platform              : osf1
Component Name                : dced
Subcomponent Name             : 
Short Description             : dced exits during startup
Reported Date                 : 8/22/94
Found in Baseline             : 1.1b15
Found Date                    : 8/22/94
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 11807
Fix By Baseline               : 
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[8/22/94 public]

After the crash reported in OT #11807, I took down the remaining
components of dce on the two nodes where dced had crashed and
restarted then using /etc/rc.dce. The terminal output was as
follows:

	/opt/dcelocal/bin/dced
dced (pid 1866) exited with status 0213
	/opt/dcelocal/bin/sec_clientd

	and then startup hung.

There is a corresponding core dump for dced, as follows:

Core was generated by `dced'.
Program terminated with signal 11, Segmentation fault.
#0  0x40676b in srvr_hash_table_add (ht=0x432668, up=0x4a49a8, value=0xbffff3a8, 
    st=0xbffff548) at
    /project/dce/build/dce1.1-snap/src/admin/dced/server/misc.c:533
Source file is more recent than executable.

At this point I got bl15 mounted, and added it to the search list for the
 sources.:
(gdb) directory /project/dce/build/dce1.1-baseline/bl-15/src/admin/dced/server
Source directories searched:
/project/dce/build/dce1.1-baseline/bl-15/src/admin/dced/server:$cdir:$cwd

(gdb) bt
#0  0x40676b in srvr_hash_table_add (ht=0x432668, up=0x4a49a8, value=0xbffff3a8, 
    st=0xbffff548) at
    /project/dce/build/dce1.1-snap/src/admin/dced/server/misc.c:533
#1  0x4068cf in srvr_hash_build (t=0x432cc0, ht=0x432668, st=0xbffff548)
    at /project/dce/build/dce1.1-snap/src/admin/dced/server/misc.c:579
#2  0x406c1e in name_cache_server_init (db=0x4ab510, cache=0x4ac998, t=0x432cc0, 
    ht=0x432668, st=0xbffff548)
    at /project/dce/build/dce1.1-snap/src/admin/dced/server/misc.c:643
#3  0x406df3 in init_caches (st=0xbffff548)
    at /project/dce/build/dce1.1-snap/src/admin/dced/server/misc.c:685
#4  0x4004fc in main (ac=1, av=0xbffff57c)
    at /project/dce/build/dce1.1-snap/src/admin/dced/server/main.c:318

[8/22/94 public]

With the system in the state it was left in after dced crashed during
startup, I reran dced with the -d option, under gdb. It exited as 
follows:

(gdb) run -d
Starting program: /u1/opt/dcelocal/bin/dced -d
Failed opening Hostdata.db.
Unknown message number 0x1460100a
Program exited with code 01.

In dcelibmsg.h this status code shows up as db_s_open_failed_enoent.

[08/22/94 public]
When you use the "-d" flag you must be in the /opt/dcelocal/var/dced
directory first.

[8/22/94 public]
Is this crashing because the database was trashed by CR 11807?  (this may
be a dup or cancel...)  It does not crash under "normal" circumstances.
Downgrading priority.

[8/22/94 public]
Started dced under gdb on one of the 486 platforms, with -d option. 
Under gdb it came up successfully, and rc.dce then ran okay.

[08/26/94 public]
Can we cancel this?

[08/28/94 public]
After reading this more carefully:  this is a dup of 11807.
In 11807 a server is created, dced stores it in the database, and
then rebuilds its hash tables; this last step died.  In this OT,
it comes up, reads the database and rebuilds its hash tables and
then dies.  Dup.



CR Number                     : 11808
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : secd
Short Description             : secd dumps when starting dce
Reported Date                 : 8/22/94
Found in Baseline             : 1.1b14
Found Date                    : 8/22/94
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 11700
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[8/22/94 public]
secd dumps core when starting dce.  Seemed OK when doing a dce_config, tho.
This is the setup:
	last night's build (Sunday)
	486
	single-machine cell
	config'ed just sec & cds
Procedure:
	install and config with last night's bld
	shut down dce
	/etc/rc.dce
	ls -l /opt/dcelocal/var/security/core

Looks like uninitialized svc handle. Stack trace:
(gdb) whe
#0  0xa429dc87 in dce_svc__debug (0, 4, 1, 4906482)
#1  0x4adf31 in dce_aud_start_with_pac (event=275, pac=0x709c50, address=0x0, 
    options=0, outcome=4294967295, ard=0x69fd44, status=0x69fd2c)
    at /project/dce/build/dce1.1-snap/src/security/audit/libaudit/evt_write.c:316
#2  0x4ae178 in dce_aud_start_with_name (event=275, 
    client=0x559d10 "/.../padded/hosts/acme/self", address=0x0, options=0, 
    outcome=0, ard=0x69fd44, status=0x69fd2c)
    at /project/dce/build/dce1.1-snap/src/security/audit/libaudit/evt_write.c:378
#3  0x4adafc in dce_aud_start (event=275, binding=0x7014a8, options=0, 
    outcome=0, ard=0x69fd44, stp=0x69fd2c)
    at /project/dce/build/dce1.1-snap/src/security/audit/libaudit/evt_write.c:181

[08/22/94 public]
Yeah it does look like that.  This is why creating a global variable
via DCE_SVC_DEFINE_HANDLE is often more useful then calling
dce_svc_register in an init routine.



CR Number                     : 11805
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : i486
S/W Ref Platform              : osf1
Component Name                : sec
Subcomponent Name             : 
Short Description             : dtsd core dump with sec routines
on stack
Reported Date                 : 8/22/94
Found in Baseline             : 1.1b15
Found Date                    : 8/22/94
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 11798
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[8/22/94 public]

dtsd core dumped over the weekend, after running for about 36 hours.
There were system tests running overnight, but none were active at
the time of the core.

Build: 1.1b15 (NB 0818)

Cell:
HPUX: cdsd, secd, dtsd
OSF1: client, dtsd	(machine where core dump occurred)
OSF1: client, dtsd, ntp provider

gdb trace:

#0  0xa4324320 in priv_krb_util_gen_v1_1_ccache_authdata
    (-1540065060, -1541937140, 6276872, 1, 0, 4423392, 6277192)
#1  0xa431e992 in sec_priv_get_eptgt_internal
    (4915520, 7362568, 1, 2, 1, 0, 6277192)
#2  0xa431eb0e in sec_priv_get_eptgt (4915520, 7362568, 1, 2, 0, 6277192)
#3  0xa435c9de in sec_login_util_get_krb_ptgt (4915520, 7362568, 1, 2, 6277192)
#4  0xa4342300 in sec_krb_get_cred (4915520, 4911024, 5, 2, 5256132, 6277260)
#5  0xa423b890 in rpc__krb_get_tkt (5256048)
#6  0xa424053c in rpc__krb_cn_cred_refresh (5256048, 6278384)
#7  0xa41ef9ec in rpc__cn_call_start (7402216, 0, 4382872, 1, 6278480, 6278384)
#8  0xa41d413c in rpc_call_start ()

[8/29/94 public]
This traceback looks the same at the lower 4 levels as 11798 (which was
sec_clientd, not dtsd), which also died after 36 hours in the same tests.
I've dup'd this to 11798.



CR Number                     : 11749
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : /file/episode/utils
Short Description             : Unsatisfied symbols
Reported Date                 : 8/18/94
Found in Baseline             : 1.1
Found Date                    : 8/18/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 11747
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[8/18/94 public]
[ /file/episode/utils at 23:08 (PM) Wednesday ]
makepath utils/. && cd utils &&  exec make MAKEFILE_PASS=BASIC     build_all
utils: created directory
c89 -c    -D_SHARED_LIBRARIES   -DAFS_DEBUG -DDCESHARED_PATH=\"/opt/dce\" -DDCELOCAL_PATH=\"/opt/dcelocal\" -D__hppa -Dhp9000s800 -Dhp9000s700 -D__hp9000s800 -D__hp9000s700 -DHPUX -D__hpux -Dunix +DA1.0 -D_HPUX_SOURCE    -I- -I. -I/u3/devobj/sb/nb_ux/src/file/episode/utils -I/project/dce/build/dce1.1-snap/src/file/episode/utils  -I/u3/devobj/sb/nb_ux/export/hp800/usr/include -I/project/dce/build/dce1.1-snap/export/hp800/usr/include    /project/dce/build/dce1.1-snap/src/file/episode/utils/epimount.c
c89 -c    -D_SHARED_LIBRARIES   -DAFS_DEBUG -DDCESHARED_PATH=\"/opt/dce\" -DDCELOCAL_PATH=\"/opt/dcelocal\" -D__hppa -Dhp9000s800 -Dhp9000s700 -D__hp9000s800 -D__hp9000s700 -DHPUX -D__hpux -Dunix +DA1.0 -D_HPUX_SOURCE    -I- -I. -I/u3/devobj/sb/nb_ux/src/file/episode/utils -I/project/dce/build/dce1.1-snap/src/file/episode/utils  -I/u3/devobj/sb/nb_ux/export/hp800/usr/include -I/project/dce/build/dce1.1-snap/export/hp800/usr/include    /project/dce/build/dce1.1-snap/src/file/episode/utils/epiunmount.c
c89 -c    -D_SHARED_LIBRARIES   -DAFS_DEBUG -DDCESHARED_PATH=\"/opt/dce\" -DDCELOCAL_PATH=\"/opt/dcelocal\" -D__hppa -Dhp9000s800 -Dhp9000s700 -D__hp9000s800 -D__hp9000s700 -DHPUX -D__hpux -Dunix +DA1.0 -D_HPUX_SOURCE    -I- -I. -I/u3/devobj/sb/nb_ux/src/file/episode/utils -I/project/dce/build/dce1.1-snap/src/file/episode/utils  -I/u3/devobj/sb/nb_ux/export/hp800/usr/include -I/project/dce/build/dce1.1-snap/export/hp800/usr/include    /project/dce/build/dce1.1-snap/src/file/episode/utils/epiinit.c
c89   -g   -z -Wl,-Bimmediate,-Bnonfatal,-a,default,+b,/lib:/usr/lib    -L. -L/u3/devobj/sb/nb_ux/src/file/episode/utils -L/project/dce/build/dce1.1-snap/src/file/episode/utils -L/u3/devobj/sb/nb_ux/export/hp800/usr/shlib -L/project/dce/build/dce1.1-snap/export/hp800/usr/shlib -L/usr/shlib -L/u3/devobj/sb/nb_ux/export/hp800/usr/lib     -L/project/dce/build/dce1.1-snap/export/hp800/usr/lib   -o epimount.X epimount.o  -lftutil -lafssys -licl -losi -lcom_err  -ldce -lBSD  
/bin/ld: Unsatisfied symbols:
   ftu_GetRawDeviceName (code)
   _ftu_Unmount (code)
   _ftu_Mount (code)
*** Error code 1



CR Number                     : 11748
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000,hppa
S/W Ref Platform              : aix,hpux
Component Name                : dfs
Subcomponent Name             : /file/icl
Short Description             : Can't find library for -lncompat
Reported Date                 : 8/18/94
Found in Baseline             : 1.1
Found Date                    : 8/18/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 11747
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[8/18/94 public]

[ /file/icl at 22:50 (PM) Wednesday ]
makepath icl/. && cd icl &&  exec make MAKEFILE_PASS=BASIC     build_all
c89 -c    -D_SHARED_LIBRARIES   -DAFS_DEBUG -DDCESHARED_PATH=\"/opt/dce\" -DDCELOCAL_PATH=\"/opt/dcelocal\" -DICL_DEFAULT_ENABLED -D__hppa -Dhp9000s800 -Dhp9000s700 -D__hp9000s800 -D__hp9000s700 -DHPUX -D__hpux -Dunix +DA1.0 -D_HPUX_SOURCE    -I- -I. -I/u3/devobj/sb/nb_ux/src/file/icl -I/project/dce/build/dce1.1-snap/src/file/icl  -I/u3/devobj/sb/nb_ux/export/hp800/usr/include -I/project/dce/build/dce1.1-snap/export/hp800/usr/include    /project/dce/build/dce1.1-snap/src/file/icl/icl_dumpCommand.c
c89   -g   -z -Wl,-Bimmediate,-Bnonfatal,-a,default,+b,/lib:/usr/lib     -L/u3/devobj/sb/nb_ux/export/hp800/usr/shlib -L/project/dce/build/dce1.1-snap/export/hp800/usr/shlib -L/usr/shlib -L/u3/devobj/sb/nb_ux/export/hp800/usr/lib     -L/project/dce/build/dce1.1-snap/export/hp800/usr/lib   -o dfstrace.X icl_dumpCommand.o  -licl -ldacl -ldauth -ldacllfs  -ldacl -ldauth -ldacllfs -lncompat  -lafssys -lcom_err -lcmd -licl -losi -ldce -lBSD  
/bin/ld: Can't find library for -lncompat
*** Error code 1



CR Number                     : 11727
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dced
Subcomponent Name             : secval
Short Description             : dced secval should be the default, not sec_clientd.
Reported Date                 : 8/16/94
Found in Baseline             : 1.1b14
Found Date                    : 8/16/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 11656
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[8/16/94 public]

dced secval services should completely replace sec_clientd by default.  To
make this happen at this stage, minor changes will be amde to dcecp, dced
& dce_config.

[8/2/94 public]
Way ahead of you, Rob...



CR Number                     : 11706
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dcecp
Subcomponent Name             : dcecp smoketest
Short Description             : probably died in PGO but not ACL
Reported Date                 : 8/15/94
Found in Baseline             : 1.1
Found Date                    : 8/15/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 11698
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[8/15/94 public]

Failed on all three smoketest platforms (budapest,sif,mudaslide)
Dcecp file dcecp.out contains the following

RPC
CDS
PGO

This means it either died in PGO and didn't start the ACL test

[8/15/94 public]
Yeah, it fails in the PGO tests.  This is a dup of 11698. 

To get around this in the smoketest comment out the following line:
#account modify /.:/kevins -shell /bin/sh



CR Number                     : 11689
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa,i486
S/W Ref Platform              : osf1,hpux
Component Name                : dfs
Subcomponent Name             : opt/dcelocal/ext/kload
Short Description             : kload failed
Reported Date                 : 8/15/94
Found in Baseline             : 1.1
Found Date                    : 8/15/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 11684
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[8/15/94 public]

TEST:		single cell single machine test
SYSTEM:		budapest
TEST PHASE:	dce_config


output from /tmp/dce_config.log


S:****** Loading kernel extensions...
D:         Executing: /opt/dcelocal/ext/kload -N dce_krpc
DEBUG:     Executing: err_exit("/opt/dcelocal/ext/kload -N dce_krpc" failed.
           Continuing will assume you have done the kload by hand.)
ERROR:   "/opt/dcelocal/ext/kload -N dce_krpc" failed.  Continuing will assume
         you have done the kload by hand.
DEBUG:     Executing: menu99()
S:****** Exiting from dce_config.
WARNING: The password for the "cell_admin none none" user is a well-known
         default value.  Since this is a security hole, it is recommended that
         the password be changed immediately after exiting this script by using
         "dce_login", then the "rgy_edit change" command.
D:         Executing: rm -f /usr/bin/dce_login_noexec

output from budapest /u1/RAT_tools/run_commands.dfs.log

+ /u1/opt/dcelocal/bin/fts lsfldb 
Could not access the FLDB for attributes
Error: no servers appear to be up (dfs / ubk)
+ [ 1 != 0 ] 
+ echo fts lsfldb FAILED! 
fts lsfldb FAILED!
+ sleep 240 
+ echo cd /: 
cd /:
+ cd /: 
/u1/RAT_tools/run_commands.dfs: /:: bad directory



output from /u1/RAT_tools/do_test.dfs.log


:****** Configuring DFS Fileset Location Database Server...
1994-08-15-08:11:31.280-04:00I----- dtsd WARNING dts config logevent_v_ultrix.c 265 0x7aff8410
Too few servers (2), need 3 servers
S:****** Modifying the registry database for DFS operation...
S:****** Loading kernel extensions...
/bin/ld: Unsatisfied symbols:
   malloc (code)
Error 0
Unable to create (/bin/ld) /opt/dcelocal/ext/dce_krpc.tmp
ERROR:   "/opt/dcelocal/ext/kload -N dce_krpc" failed.  Continuing will assume 
         you have done the kload by hand.
S:****** Configuring DFS Client...
S:****** Loading kernel extensions...
/bin/ld: Unsatisfied symbols:
   malloc (code)
Error 0
Unable to create (/bin/ld) /opt/dcelocal/ext/dce_krpc.tmp
ERROR:   "/opt/dcelocal/ext/kload -N dce_krpc" failed.  Continuing will assume 
         you have done the kload by hand.
S:****** Exiting from dce_config.

[8/15/94 public]
This is a dup of 11684.



CR Number                     : 11677
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : cds
Subcomponent Name             : cdsd
Short Description             : cdsd internal bug check caused by non-thread safe code
Reported Date                 : 8/12/94
Found in Baseline             : 1.1
Found Date                    : 8/12/94
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 6428
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[8/12/94 public]

The bugcheck was caused by a piece of code which is not
thread safe.  When a race condition occurred among
multiple competing threads, a timestamp recorded in
one thread may be interpreted as "went backward"
because by the time that thread was granted a cdsd server
lock, the global variable "lasttime" may already be updated
by other competing threads.  The fix is to get system
local time inside the critical region surrounded by
SERVER_LOCK ... SERVER_END_LOCK so that the local time
is guaranteed to be more recent than the global "lasttime".

The following are the diff's of the recommended fixes in the file
    directory/cds/server/uid_lib.c :
314,317d332
<     /* Get time in UTC */
<     sys_time_to_utc(NULL, &now);
<     ODD_time_quad(now);
<
331a347,350
>
>     /* Get time in UTC */
>     sys_time_to_utc(NULL, &now);
>     ODD_time_quad(now);

[8/15/94 public]
Wow. This a dup and a fix for our oldest cds bug. Many thanks. Will close
6428. Have built and tested it. Will submit in a day or so along with the
drop from Janet Mccann. Both this and that drop were tested together.



CR Number                     : 11633
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : i486
S/W Ref Platform              : osf1
Component Name                : dcecp
Subcomponent Name             : /admin/dcecp
Short Description             : `build_all' not remade because of errors
Reported Date                 : 8/10/94
Found in Baseline             : 1.1
Found Date                    : 8/10/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 11631
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[8/10/94 public]


Possible makefile problem??

[ ./security/client/admin/acl_edit/Makefile ]

[ /admin/dcecp at 23:34 (PM) Tuesday ]
makepath admin/dcecp/. && cd admin/dcecp &&  exec make MAKEFILE_PASS=THIRD     build_all
`build_all' not remade because of errors.
*** Error code 1

[8/10/94 public]
This is a dup of 11631.  When ODE encounters an error it reports it at the
time it occurs.  It ALSO reports at the end of the pass that the entire
pass did not complete succesfully.  dcecp happens to be at the end of the
pass so it looks like errors in dcecp, but it's not.



CR Number                     : 11625
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : ./security/krb5/lib/crc-32/crc-test
Short Description             : ./security/krb5/lib/crc-32/crc-test is empty
Reported Date                 : 8/9/94
Found in Baseline             : 1.1
Found Date                    : 8/9/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 10840
Fix By Baseline               : 
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[8/9/94 public]

Any reason why ./security/krb5/lib/crc-32/crc-test is empty ? 

I am running copyright scanning on this file and am wondering 
whether OSF copyright information should be in it as the ODE
comment leader is set to '# ' indicating that there will be
comments in this file.  

This is needed for BETA1.  Please respond ASAP.

thanks
annie

[8/9/94 public]
This is an exact duplicate of OT CR 10840 that you also opened, so I'm making
this a dup of that CR.  No, the file isn't necessary, but this is one of the
least important things that we have to do in the next couple of weeks so don't
expect to see anything happen too fast unless RobB or Max does it for us.



CR Number                     : 11599
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : secd
Short Description             : secd SVC message about CDS not available during startup should not be error level since it is expected.
Reported Date                 : 8/8/94
Found in Baseline             : 1.1b14
Found Date                    : 8/8/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 11608
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[8/8/94 public]

During config, secd prints a SVC error level message indicating that 
the name service is not available.  This is guaranteed to come out
at least once do to startup ordering.  This output should be removed
or the SVC level should be changed from error to something else.  
The msg is output in ./security/server/rs/rn_ns.c at line 1197.



CR Number                     : 11582
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 10571,11513
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : utils
Subcomponent Name             : svc
Short Description             : routing not validated until usage
Reported Date                 : 8/7/94
Found in Baseline             : 1.1
Found Date                    : 8/7/94
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 10571
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[8/7/94 public]

Routes are not validated until usage. So a bad route is not detected
until it is actually used.  So for e.g. if secd is started as follows

     secd -w ERROR:blah:-- illegal_option

secd does the following :

     dce_svc_routing(...)  /* sets the route - even though illegal */

Next when secd tries to log a ERROR message using dce_svc_printf()
for the illegal option , the ERROR message is never logged.
( because the route for ERROR was changed even though it is illegal).

[08/07/94 public]
This is deliberate and part of the "lazy evaluation" model.
The SVC code cannot verify component names (they get registered at runtime)
I did not want to open files needlessly (too expensive if, say, no
fatal message is ever generated), etc.  While it could verify a simple
"blah" not being a valid routing type, it can't verify the filename
in teh face of chdir's and setuid's.



CR Number                     : 11576
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : cds
Subcomponent Name             : dcsd
Short Description             : cdsd core dumps during DFS Smoketests
Reported Date                 : 8/5/94
Found in Baseline             : 1.1
Found Date                    : 8/5/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 11574
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[8/5/94 public]


cdsd core file is in  /opt/dcelocal/var/directory/cds/adm/cdsd/core



S:****** Configuring additional CDS Server...
S:****** Starting cdsd...
ERROR:   cdscp - creating clearinghouse /.:/mudslide_CH.
  Message from cdscp:
  connection closed (dce / rpc)
        Press <RETURN> to continue, CTRL-C to exit:  
   Initializing the name space for additional CDS server...

>>> binding information and objects exported


>>> binding information and objects exported

        Modifying acls on /.:/mudslide_CH
ERROR: communications failure (dce / rpc)
Unable to bind to object /.:/mudslide_CH
        Modifying acls on /.:/hosts/mudslide/cds-server
        Modifying acls on /.:/hosts/mudslide/cds-gda

[8/8/94 public]
Peter and Gail inadvertantly opened the same bug. Dup'ing this one
to 11574.



CR Number                     : 11553
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : secd
Short Description             : secd should assume ok if pwd_val_type schema does not exist
Reported Date                 : 8/3/94
Found in Baseline             : 1.1b13
Found Date                    : 8/3/94
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 10823
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : rs_pwd_mgmt.c
Sensitivity                   : public

[8/3/94 public]

If secd looks up the well known ERA pwd_val_type and the schema
entry does not exist, it should accept this error as ok and assume
the user does not have a password management policy.

[08/19/94 public]

Duplicate of OT 10823.



CR Number                     : 11550
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 11419
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : secd, seal
Short Description             : Something in the state of
security, rpc, or cds prevents dtsd from contacting other dtsd servers in the cell.
Reported Date                 : 8/3/94
Found in Baseline             : 1.1b13
Found Date                    : 8/3/94
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 11419
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b15
Affected File(s)              : lots in Greg's 8/18 submission
Sensitivity                   : public

[8/3/94 public]

One of the DCE components (cds, sec, or rcp) persintently gets 
into a state which prevents a DTS server or clerk to contact 
successfully other DTS servers in the cell. This problem is
intermittent. (The cause of this problem could helps us understand
other problems we are seeing with DCE while running tests).

Here is an example cell configuration where the problem has been
occurring, and for which I can make logs available for examination.

Build: BL-13
Cell configuration:

(soldier)  RIOS:  secd, dtsd
(west)     HPUX:  cdsd, dtsd
(dce3)     OSF1:  client, secd replica, dtsd, ntp-provider
(barbados) OSF1:  client
(trinidad) OSF1:  client

The following error is printed when in fact all the dtsd servers 
are running.

1994-08-03-02:09:01.011-04:00I0.732 dtsd WARNING dts config 
logevent_v_ultrix.c 259 0x200ab8f8
Too few servers (2), need 3 servers

At the time the errors saved in the log occurred, I was running 
the RPC system tests.

The log is called dtsderr.aug3 and I will keep in my home directory.
(~dassarma)

[8/4/94 public]

Some further insight: when running a two machine cell with 2 local
servers on 8/3/94,  I've seen the following errors: 

On my HP machine (server: running secd, cdsd, dtsd local server)
Note: also running rpcd instead of dced.

DCE error Error requesting time from server :: unknown reject (dce / rpc)
1994-08-03-21:06:08.420-04:00I----- dtsd WARNING dts config logevent_v_ultrix.c 265 0x7aff8448
Too few servers (1), need 2 servers
1994-08-03-21:07:15.549-04:00I----- dtsd ERROR dts events logevent_v_ultrix.c 397 0x40029820
DCE error Error requesting time from server :: connection closed (dce / rpc)
1994-08-03-21:08:33.441-04:00I----- dtsd ERROR dts events logevent_v_ultrix.c 397 0x40029820
DCE error Error requesting time from server :: unknown reject (dce / rpc)
1994-08-03-21:08:38.231-04:00I----- dtsd WARNING dts config logevent_v_ultrix.c 265 0x7aff8448
Too few servers (1), need 2 servers

1994-08-04-06:57:01.469-04:00I----- dtsd ERROR dts events logevent_v_ultrix.c 397 0x40029820
DCE error Error requesting time from server :: unknown reject (dce / rpc)

And on the 2nd machine (OSF1, running only clerk software and dtsd
local server)(and rpcd)

mismatched seal 0
1994-08-03-21:05:55.615-04:00I----- dtsd ERROR rpc auth cnsassm.c 4017 0x005d0c50
RPC_CN_AUTH_VFY_CLIENT_REQ on server failed, status = 1712217d

mismatched seal 0
1994-08-03-21:08:33.187-04:00I----- dtsd ERROR rpc auth cnsassm.c 4017 0x005d00d0
RPC_CN_AUTH_VFY_CLIENT_REQ on server failed, status = 1712217d

mismatched seal 0
1994-08-04-06:57:00.944-04:00I----- dtsd ERROR rpc auth cnsassm.c 4017 0x006457e0
RPC_CN_AUTH_VFY_CLIENT_REQ on server failed, status = 1712217d

The translation for 1712217d is as follows:

Tech = 1 = 01 = 0x1 = dce
Comp = 28962 = 070442 = 0x7122 = sec
Mesg = 381 = 0575 = 0x17d = integrity error: EPAC seal mismatch.

So. looks like a security causing the RPC call to fail. 
Tom, Rob?

[8/4/94 public]
Looks like a dup of 11419 -  mismatched seal 0
"When security doesn't work, dts has problems."

[8/4/94 public]
Can't argue with that.  I won't make it a dup yet but will assign
to SEC and let 11419 engineer (sommerfeld) determine dup-ness.

[8/11/94 public]
Assigned this to Bill so he can evaluate whether or not this is a dup of 11419.



CR Number                     : 11530
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : gds
Subcomponent Name             : dsa
Short Description             : subtree op failed during gds_sec
Reported Date                 : 8/2/94
Found in Baseline             : 1.1
Found Date                    : 8/2/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 11279
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[8/2/94 public]
When running gds_sec on the HP:

  Configure DCE using cell_name:  C=ie/O=digital
  DCED listening...
  Configure Dir1 as Client system 
  Login to DCE ...
  Password must be changed!
  journal file name is: /dcetest/dcelocal/test/tet/functional/directory/gds/results/0006e/journal
  
  dcecp dcecp_add.tcl
  rgy_add.sh
  local_start: Configure GDS
  
  Local CACHE administration (DIR-IDs=11)
  Local CACHE administration (DIR-IDs=12)
  Waiting 60 sec. for coming up the DSA processes
  Adding objects in DSA-11
  
  gdsditadm < /dcetest/dcelocal/test/tet/functional/directory/gds/ts/config/copy_subtree.bat
		processed with ERROR
  Use  <vi /opt/dcelocal/var/adm/directory/gds/adm/tstfile>  for detailed information
    
Here's the tstfile:
*** INITIALIZATION BATCHFILE *****:
***Administration ****:
***Copy Subtree *******:
******* RETURN ******:
                                                                           
ERROR:
Appending of subtree failed (ADD operation) !
To continue press <CR> !
*** Administration ****:

[08/03/94 public]
I have no idea why this didn't run.
config/gds_sec_start.sh seems to be correct - first it removes
dir. id's 11 and 12, then it configures them, then it 
initializes the caches, then it adds objects do dir.id 11 via
gdscp, then it copies them to dir. id 12 via gdsditadm (subtree op.).
This didn't work.
Rich: Was there something in OUTDIR? (the output of gdscp, i.e.).

If you can reproduce this: Please do it with tracing switched on,
I need the DSA logfile of dsa 11 and 12.
Also you can change config/gds_sec_start.sh with altering the line

gdscp ${TET_EXECUTE}/config/dsa12_objects.tcl > /dev/null

to

gdscp ${TET_EXECUTE}/config/dsa12_objects.tcl > /tmp/jochen

.

[08/12/94 public]
See 11279: no client address was in the cache of dir. id 1.



CR Number                     : 11529
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : sec
Subcomponent Name             : 
Short Description             : kinit dumps core
Reported Date                 : 8/2/94
Found in Baseline             : 1.1b13
Found Date                    : 8/2/94
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 11227
Fix By Baseline               : 
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[8/2/94 public]

I login as root on an hp node which is acting as core server
for a cell and dce_login to cell_admin. Then I issue kinit and
get "Memory fault(coredump)". The backtrace in xdb simply shows
the following:

root@dce2> xdb -l /opt/dcelocal/lib/libdce.sl /usr/bin/kinit core

Core file saved as "core21892"
Core file from:  kinit
Child died due to: segmentation violation
Procedures:      0
Files: 0
>t
 0 strcpy@libc + 0x00000008 (hp-ux export stub)
 1 main + 0x00000790 (0x1, 0x7b03322c, 0, 0)
>

[8/2/94 public]
Dupe of bug to be fixed any day now.  Rick, I've got a fixed version
in a sandbox which you can have if it is gating you.



CR Number                     : 11528
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dcecp
Subcomponent Name             : 
Short Description             : help log doesn't work
Reported Date                 : 8/2/94
Found in Baseline             : 1.1b13
Found Date                    : 8/2/94
Severity                      : C
Priority                      : 3
Status                        : dup
Duplicate Of                  : 11507
Fix By Baseline               : 
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[8/2/94 public]

The help log command doesn't work:
dcecp> help log
Error: Object "log" is not unique: logout login log

This is annoying.

(I realize log help will work, but someone who doesn't know
how to use things wont know that)

[8/2/94 public]

Already reported as CR 11507.



CR Number                     : 11524
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : dce_shutdown
Short Description             : dce_config hung in shutting down dtsd using the dcecp command
Reported Date                 : 8/2/94
Found in Baseline             : 1.1
Found Date                    : 8/2/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 11506
Fix By Baseline               : 
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[8/2/94 public]

This is a problem with dce_shutdown. 

Our daily process for the smoke test is:

    run core smoke test
    run multi-machine smoke test

So, dce_config was used to install and configure the core smoke test.
Then, dce_config is used again to install and configure the multi-machines
smoke test.  So, in this step, dce_config will try to do a remove of all
existing installations.  

On the hp800 platform, the core smoke test has successfully been installed
and configured.  When we tried to configure the multi-machines smoke test,
dce_config hang.  dce_config.log is as followed:

S:****** Attempting to remove all remnants of previous DCE installations for all components...
DEBUG:     Executing: ./dce.rm install
DEBUG:     Executing: get_pid(dced)
DEBUG:     dce_shutdown: Executing: ./dfs.clean
V:         dfs.clean: Stopping DFS daemons.
DEBUG:     Executing: daemon_slayer(bosserver)
DEBUG:     bosserver can't be killed, not running
V:         dfs.clean: Executing: sleep 5
V:         dfs.clean: Successfully stopped all DFS daemons.
DEBUG:     Stopping DCE daemons...
D:         dce_shutdown: Executing dcecp -c "dts deactivate ; dts stop"

The 'dcecp -c dts deactivate ; dts stop' was hung for two hours.  
ps -aedfl shows the following:

  1 S    root  3899  3824  4 154 24  2139840  477   23b180 07:49:19 ?        0:01 dcecp -c dts deactivate ; dts stop
  1 S    root  3409     1  0 154 20  2139980 2764   23b180 04:41:20 ?        0:21 dtsd -s

When I manually kill dtsd and the dcecp processes, I get an extra line
in the dce_config.log saying:

D:         dce_shutdown: Executing cdscp disable clerk

When I manually kill the cdscp and cdsclerk processes, I get an extra
line in the dce_config.log saying:

D:         dce_shutdown: Executing cdscp disable server

I did another manually kill of all the cds processes, and I get an
extra line in dce_config.log saying:

D:         dce_shutdown: Executing dcecp -c registry stop ncacn_ip_tcp:localhost
 
I think you get the idea, I am NOT going to continue anymore.

Good luck
thanks
annie

[8/2/94 public]
The dcecp 'stop' commands (like dts stop) politely ask the daemon to
stop. If the daemon is wedged, and doesn't respond, dcecp just sits
and waits for the RPC to complete. This is what 'dce_shutdown -f' was
designed for.

Is there a way to have an RPC only wait for a specified amount of
time before returning regardless of the server's response?

[8/2/94 public]
"When CDS is hosed, everyone is hosed."

I believe this is a dup of 11506, and when that gets fixed (ie cds works
consistantly) this will go away.

and John is correct, to shutdown a hosed cell, you must use -f.

[8/3/94 public ]

+ cd /mnt/opt/dce1.1/etc
+ ./dce_config -c /u1/RAT_tools/mult_mach_configs/budapest_secr_cdsr_ds.cmd -e /u1/RAT_tools/mult_mach_configs/budapest_secr_cdsr_ds.env -i


S:****** Attempting to remove all remnants of previous DCE installations for 
         all components...


  Hung at this point removing remnants 40 minutes

[8/3/94 piblic]
This is consistant with dce_shutdown hanging is the cell is hung.
The script assume things are working, if they aren't, human intervention
is required (ie you typeing dce_shutdown -f before re-config).



CR Number                     : 11523
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : /file/episode/anode
Short Description             : Can't find library for -ldfstab
Reported Date                 : 8/2/94
Found in Baseline             : 1.1
Found Date                    : 8/2/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 11515
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b14
Affected File(s)              : src/Makefile, file/Makefile
Sensitivity                   : public

[8/2/94 public]



[ /file/episode/anode at 22:38 (PM) Monday ]
makepath anode/. && cd anode &&  exec make MAKEFILE_PASS=BASIC     build_all
c89 -c    -D_SHARED_LIBRARIES   -DAFS_DEBUG -DDCESHARED_PATH=\"/opt/dce\" -DDCELOCAL_PATH=\"/opt/dcelocal\" -D__hppa -Dhp9000s800 -Dhp9000s700 -D__hp9000s800 -D__hp9000s700 -DHPUX -D__hpux -Dunix +DA1.0 -D_HPUX_SOURCE    -I- -I. -I/u3/devobj/sb/nb_ux/src/file/episode/anode -I/project/dce/build/dce1.1-snap/src/file/episode/anode -IHPUX -I/u3/devobj/sb/nb_ux/src/file/episode/anode/HPUX -I/project/dce/build/dce1.1-snap/src/file/episode/anode/HPUX -I/u3/devobj/sb/nb_ux/export/hp800/usr/include -I/project/dce/build/dce1.1-snap/export/hp800/usr/include    /project/dce/build/dce1.1-snap/src/file/episode/anode/calcLogSize.c
c89 -c    -D_SHARED_LIBRARIES   -DAFS_DEBUG -DDCESHARED_PATH=\"/opt/dce\" -DDCELOCAL_PATH=\"/opt/dcelocal\" -D__hppa -Dhp9000s800 -Dhp9000s700 -D__hp9000s800 -D__hp9000s700 -DHPUX -D__hpux -Dunix +DA1.0 -D_HPUX_SOURCE    -I- -I. -I/u3/devobj/sb/nb_ux/src/file/episode/anode -I/project/dce/build/dce1.1-snap/src/file/episode/anode -IHPUX -I/u3/devobj/sb/nb_ux/src/file/episode/anode/HPUX -I/project/dce/build/dce1.1-snap/src/file/episode/anode/HPUX -I/u3/devobj/sb/nb_ux/export/hp800/usr/include -I/project/dce/build/dce1.1-snap/export/hp800/usr/include    /project/dce/build/dce1.1-snap/src/file/episode/anode/findlog.c
c89 -c    -D_SHARED_LIBRARIES   -DAFS_DEBUG -DDCESHARED_PATH=\"/opt/dce\" -DDCELOCAL_PATH=\"/opt/dcelocal\" -D__hppa -Dhp9000s800 -Dhp9000s700 -D__hp9000s800 -D__hp9000s700 -DHPUX -D__hpux -Dunix +DA1.0 -D_HPUX_SOURCE    -I- -I. -I/u3/devobj/sb/nb_ux/src/file/episode/anode -I/project/dce/build/dce1.1-snap/src/file/episode/anode -IHPUX -I/u3/devobj/sb/nb_ux/src/file/episode/anode/HPUX -I/project/dce/build/dce1.1-snap/src/file/episode/anode/HPUX -I/u3/devobj/sb/nb_ux/export/hp800/usr/include -I/project/dce/build/dce1.1-snap/export/hp800/usr/include    /project/dce/build/dce1.1-snap/src/file/episode/anode/newaggr.c
c89 -c    -D_SHARED_LIBRARIES -g  -DAFS_DEBUG -DDCESHARED_PATH=\"/opt/dce\" -DDCELOCAL_PATH=\"/opt/dcelocal\" -D__hppa -Dhp9000s800 -Dhp9000s700 -D__hp9000s800 -D__hp9000s700 -DHPUX -D__hpux -Dunix +DA1.0 -D_HPUX_SOURCE    -I- -I. -I/u3/devobj/sb/nb_ux/src/file/episode/anode -I/project/dce/build/dce1.1-snap/src/file/episode/anode -IHPUX -I/u3/devobj/sb/nb_ux/src/file/episode/anode/HPUX -I/project/dce/build/dce1.1-snap/src/file/episode/anode/HPUX -I/u3/devobj/sb/nb_ux/export/hp800/usr/include -I/project/dce/build/dce1.1-snap/export/hp800/usr/include    /project/dce/build/dce1.1-snap/src/file/episode/anode/runtest.c
c89 -c    -D_SHARED_LIBRARIES -g  -DAFS_DEBUG -DDCESHARED_PATH=\"/opt/dce\" -DDCELOCAL_PATH=\"/opt/dcelocal\" -D__hppa -Dhp9000s800 -Dhp9000s700 -D__hp9000s800 -D__hp9000s700 -DHPUX -D__hpux -Dunix +DA1.0 -D_HPUX_SOURCE    -I- -I. -I/u3/devobj/sb/nb_ux/src/file/episode/anode -I/project/dce/build/dce1.1-snap/src/file/episode/anode -IHPUX -I/u3/devobj/sb/nb_ux/src/file/episode/anode/HPUX -I/project/dce/build/dce1.1-snap/src/file/episode/anode/HPUX -I/u3/devobj/sb/nb_ux/export/hp800/usr/include -I/project/dce/build/dce1.1-snap/export/hp800/usr/include    /project/dce/build/dce1.1-snap/src/file/episode/anode/test_anode.c
c89 -c    -D_SHARED_LIBRARIES -g  -DAFS_DEBUG -DDCESHARED_PATH=\"/opt/dce\" -DDCELOCAL_PATH=\"/opt/dcelocal\" -D__hppa -Dhp9000s800 -Dhp9000s700 -D__hp9000s800 -D__hp9000s700 -DHPUX -D__hpux -Dunix +DA1.0 -D_HPUX_SOURCE    -I- -I. -I/u3/devobj/sb/nb_ux/src/file/episode/anode -I/project/dce/build/dce1.1-snap/src/file/episode/anode -IHPUX -I/u3/devobj/sb/nb_ux/src/file/episode/anode/HPUX -I/project/dce/build/dce1.1-snap/src/file/episode/anode/HPUX -I/u3/devobj/sb/nb_ux/export/hp800/usr/include -I/project/dce/build/dce1.1-snap/export/hp800/usr/include    /project/dce/build/dce1.1-snap/src/file/episode/anode/test_vm.c
gencat dfsepi.cat epi_errs.msf
gencat dfszea.cat epi_trace.msf
c89   -g   -z -Wl,-Bimmediate,-Bnonfatal,-a,default,+b,/lib:/usr/lib     -L/u3/devobj/sb/nb_ux/export/hp800/usr/shlib -L/project/dce/build/dce1.1-snap/export/hp800/usr/shlib -L/usr/shlib -L/u3/devobj/sb/nb_ux/export/hp800/usr/lib     -L/project/dce/build/dce1.1-snap/export/hp800/usr/lib   -o calcLogSize.X calcLogSize.o  -llogbuf -lasync  -lafsutil -lcom_err -ltools -losi -ldfstab -lcmd  -ldce -lBSD  
/bin/ld: Can't find library for -ldfstab
*** Error code 1

[8/2/94 public]
This problem occurs because the DFS build broke due to Makefile problems
that caused the serviceability items not to build. When CR 11515 is submitted,
this problem will not exist, as the libraries will get built.



CR Number                     : 11522
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : /file/scout
Short Description             : mssing library fsprobe
Reported Date                 : 8/2/94
Found in Baseline             : 1.1
Found Date                    : 8/2/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 11515
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b14
Affected File(s)              : src/Makefile, file/Makefile
Sensitivity                   : public

[8/2/94 public]



[ /file/scout at 22:38 (PM) Monday ]
makepath scout/. && cd scout &&  exec make MAKEFILE_PASS=BASIC     build_all
scout: created directory
c89 -c    -D_SHARED_LIBRARIES   -Dunix -DAFS_DEBUG -DDCESHARED_PATH=\"/opt/dce\" -DDCELOCAL_PATH=\"/opt/dcelocal\" -D__hppa -Dhp9000s800 -Dhp9000s700 -D__hp9000s800 -D__hp9000s700 -DHPUX -D__hpux -Dunix +DA1.0 -D_HPUX_SOURCE    -I- -I. -I/u3/devobj/sb/nb_ux/src/file/scout -I/project/dce/build/dce1.1-snap/src/file/scout  -I/u3/devobj/sb/nb_ux/export/hp800/usr/include -I/project/dce/build/dce1.1-snap/export/hp800/usr/include    /project/dce/build/dce1.1-snap/src/file/scout/scout.c
c89   -g   -z -Wl,-Bimmediate,-Bnonfatal,-a,default,+b,/lib:/usr/lib     -L/u3/devobj/sb/nb_ux/export/hp800/usr/shlib -L/project/dce/build/dce1.1-snap/export/hp800/usr/shlib -L/usr/shlib -L/u3/devobj/sb/nb_ux/export/hp800/usr/lib     -L/project/dce/build/dce1.1-snap/export/hp800/usr/lib   -o scout.X scout.o  -lfsprobe -lgtx -lvolc -lrep   -lftserver -lfldb  -lnubik -licl -lcmd -lafs4int -lncompat -ltpq  -ldacl -ldauth -ldacllfs -ldacl -ldauth  -ldacllfs -ldfsncs -lbomb  -lcommondata  -lafsutil -lcom_err  -lafssys -losi -ldce -lcurses -lBSD  
/bin/ld: Can't find library for -lfsprobe
*** Error code 1
`build_all' not remade because of errors.
*** Error code 1

[8/2/94 public]
This is fixed in CR 11515. It occurred because the library wasn't built in
a previous step due to the serviceability code omissions which will be fixed
by the previously mentioned 11515.

When the problem in CR 11516, which is fixed in CR 11515, is eliminated
this problem shouldn't exist.



CR Number                     : 11520
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : /file/update
Short Description             : missing include
Reported Date                 : 8/2/94
Found in Baseline             : 1.1
Found Date                    : 8/2/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 11515
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b14
Affected File(s)              : src/Makefile, file/Makefile
Sensitivity                   : public

[8/2/94 public]


[ /file/update at 22:35 (PM) Monday ]
makepath update/. && cd update &&  exec make MAKEFILE_PASS=BASIC     build_all
c89 -c    -D_SHARED_LIBRARIES   -Dunix -D_BSD -DAFS_DEBUG -DDCESHARED_PATH=\"/opt/dce\" -DDCELOCAL_PATH=\"/opt/dcelocal\" -D__hppa -Dhp9000s800 -Dhp9000s700 -D__hp9000s800 -D__hp9000s700 -DHPUX -D__hpux -Dunix +DA1.0 -D_HPUX_SOURCE    -I- -I. -I/u3/devobj/sb/nb_ux/src/file/update -I/project/dce/build/dce1.1-snap/src/file/update  -I/u3/devobj/sb/nb_ux/export/hp800/usr/include -I/project/dce/build/dce1.1-snap/export/hp800/usr/include    /project/dce/build/dce1.1-snap/src/file/update/util.c
util.c: 89: Unable to find include file 'dfsudtmac.h'.

[8/2/98 public]
The problem stems from needing to include the serviceability information for
DFS. The fix is to two Makefiles. The first is the src/Makefile which needs
to have the DFS file directory added to the SAMIDL_SUBDIRS directory list.
The second is to the file/Makefile which needs to have the update subdirectory
added to its SAMIDL_SUBDIRS list.

The fix will be submitted in CR 11515.



CR Number                     : 11519
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : /file/dfsbind
Short Description             : missing include
Reported Date                 : 8/2/94
Found in Baseline             : 1.1
Found Date                    : 8/2/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 11515
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b14
Affected File(s)              : 
Sensitivity                   : public

[8/2/94 public]

[ /file/dfsbind at 22:32 (PM) Monday ]
makepath dfsbind/. && cd dfsbind &&  exec make MAKEFILE_PASS=BASIC     build_all
c89 -c    -D_SHARED_LIBRARIES   -DAFS_DEBUG -DDCESHARED_PATH=\"/opt/dce\" -DDCELOCAL_PATH=\"/opt/dcelocal\" -DDNS_V3API -DDNS_CDS  -D__hppa -Dhp9000s800 -Dhp9000s700 -D__hp9000s800 -D__hp9000s700 -DHPUX -D__hpux -Dunix +DA1.0 -D_HPUX_SOURCE    -I- -I. -I/u3/devobj/sb/nb_ux/src/file/dfsbind -I/project/dce/build/dce1.1-snap/src/file/dfsbind  -I/u3/devobj/sb/nb_ux/export/hp800/usr/include -I/project/dce/build/dce1.1-snap/export/hp800/usr/include    /project/dce/build/dce1.1-snap/src/file/dfsbind/dfsbind_svc.c
dfsbind_svc.c: 39: Unable to find include file 'dfsdsbmac.h'.
*** Error code 1

[8/2/98 public]
The problem stems from needing to include the serviceability information for
DFS. The fix is to two Makefiles. The first is the src/Makefile which needs
to have the DFS file directory added to thee SAMIDL_SUBDIRS directory list.
The second is to the file/Makefile which needs to have the dfsbind subdirectory
added to its SAMIDL_SUBDIRS list.

The fix will be submitted in CR 11515.



CR Number                     : 11518
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : /file/pxd
Short Description             : missing includes
Reported Date                 : 8/2/94
Found in Baseline             : 1.1
Found Date                    : 8/2/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 11515
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b14
Affected File(s)              : src/Makefile, file/Makefile
Sensitivity                   : public

[8/2/94 public]



[ /file/pxd at 22:32 (PM) Monday ]
makepath pxd/. && cd pxd &&  exec make MAKEFILE_PASS=BASIC     build_all
pxd: created directory
c89 -c    -D_SHARED_LIBRARIES   -DAFS_DEBUG -DDCESHARED_PATH=\"/opt/dce\" -DDCELOCAL_PATH=\"/opt/dcelocal\" -D__hppa -Dhp9000s800 -Dhp9000s700 -D__hp9000s800 -D__hp9000s700 -DHPUX -D__hpux -Dunix +DA1.0 -D_HPUX_SOURCE    -I- -I. -I/u3/devobj/sb/nb_ux/src/file/pxd -I/project/dce/build/dce1.1-snap/src/file/pxd  -I/u3/devobj/sb/nb_ux/export/hp800/usr/include -I/project/dce/build/dce1.1-snap/export/hp800/usr/include    /project/dce/build/dce1.1-snap/src/file/pxd/pxd.c
pxd.c: 224: Unable to find include file 'dfsfxdmac.h'.
pxd.c: 225: Unable to find include file 'dfsfxdsvc.h'.
pxd.c: 226: Unable to find include file 'dfsfxdmsg.h'.
*** Error code 1

[8/2/98 public]
The problem stems from needing to include the serviceability information for
DFS. The fix is to two Makefiles. The first is the src/Makefile which needs
to have the DFS file directory added to thee SAMIDL_SUBDSIRS directory list.
The second is to the file/Makefile which needs to have the pxd subdirectory
added to its SAMIDL_SUBDIRS list.

The fix will be submitted in CR 11515.



CR Number                     : 11517
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : /file/afsd
Short Description             : missing includes
Reported Date                 : 8/2/94
Found in Baseline             : 1.1
Found Date                    : 8/2/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 11515
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b14
Affected File(s)              : src/Makefile, file/Makefile
Sensitivity                   : public

[8/2/94 public]


[ /file/afsd at 22:32 (PM) Monday ]
makepath afsd/. && cd afsd &&  exec make MAKEFILE_PASS=BASIC     build_all
afsd: created directory
c89 -c    -D_SHARED_LIBRARIES   -DAFS_DEBUG -DDCESHARED_PATH=\"/opt/dce\" -DDCELOCAL_PATH=\"/opt/dcelocal\" -D_BSD -D__hppa -Dhp9000s800 -Dhp9000s700 -D__hp9000s800 -D__hp9000s700 -DHPUX -D__hpux -Dunix +DA1.0 -D_HPUX_SOURCE    -I- -I. -I/u3/devobj/sb/nb_ux/src/file/afsd -I/project/dce/build/dce1.1-snap/src/file/afsd  -I/u3/devobj/sb/nb_ux/export/hp800/usr/include -I/project/dce/build/dce1.1-snap/export/hp800/usr/include    /project/dce/build/dce1.1-snap/src/file/afsd/afsd.c
afsd.c: 359: Unable to find include file 'dfsdsdmac.h'.
afsd.c: 360: Unable to find include file 'dfsdsdsvc.h'.
afsd.c: 361: Unable to find include file 'dfsdsdmsg.h'.
*** Error code 1

[8/2/98 public]
The problem stems from needing to include the serviceability information for
DFS. The fix is to two Makefiles. The first is the src/Makefile which needs
to have the DFS file directory added to thee SAMIDL_SUBDSIRS directory list.
The second is to the file/Makefile which needs to have the dfsd subdirectory
added to its SAMIDL_SUBDIRS list.

The fix will be submitted in CR 11515.
+



CR Number                     : 11516
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : /file/fsprobe
Short Description             : missing includes
Reported Date                 : 8/2/94
Found in Baseline             : 1.1
Found Date                    : 8/2/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 11515
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b14
Affected File(s)              : file/MakefilE
Sensitivity                   : public

[8/2/94 public]
[ /file/fsprobe at 21:41 (PM) Monday ]
makepath fsprobe/. && cd fsprobe &&  exec make MAKEFILE_PASS=THIRD     build_all
c89 -c    -D_SHARED_LIBRARIES   -Dunix -DDEBUG -DAFS_DEBUG -DDCESHARED_PATH=\"/opt/dce\" -DDCELOCAL_PATH=\"/opt/dcelocal\" -D__hppa -Dhp9000s800 -Dhp9000s700 -D__hp9000s800 -D__hp9000s700 -DHPUX -D__hpux -Dunix +DA1.0 -D_HPUX_SOURCE    -I- -I. -I/u3/devobj/sb/nb_ux/src/file/fsprobe -I/project/dce/build/dce1.1-snap/src/file/fsprobe  -I/u3/devobj/sb/nb_ux/export/hp800/usr/include -I/project/dce/build/dce1.1-snap/export/hp800/usr/include    /project/dce/build/dce1.1-snap/src/file/fsprobe/fsprobe.c
fsprobe.c: 135: Unable to find include file 'dfsfspmac.h'.
fsprobe.c: 136: Unable to find include file 'dfsfspsvc.h'.
fsprobe.c: 137: Unable to find include file 'dfsfspmsg.h'.
*** Error code 1

[8/2/94 public]
This is a dup of 11515. The fix is to the DFS Makefile in the src/file
directory, which will be submitted under that CR. The top level DFS Makefile
needs to have the name of the directory for fsprobe (fsprobe) added to the
SAMIDL_SUBDIRS list. Additionally, the Makefile in the src directory needs
to have the directory 'file' added to its list of SAMIDL_SUBDIRS to pick
up the DFS svc additions.



CR Number                     : 11513
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 10571,11582
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : utils
Subcomponent Name             : svc
Short Description             : Validation still poor for svc
Reported Date                 : 8/1/94
Found in Baseline             : 1.1
Found Date                    : 8/1/94
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 10571
Fix By Baseline               : 
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[8/1/94 public]

This don't look right to me:
dcecp> log mod -change {rpc:general.1,xmit.1recv.1,cn_state.1,cn_pkt.1:FILE:/opt/dcelocal/tom.debug.dtscp} /.:/hosts/surf/dts-entity
dcecp> log show /.:/hosts/surf/dts-entity
dcecp> log show -debug /.:/hosts/surf/dts-entity
{rpc {{general 1} {xmit 1recv.1} {cn_state 1} {cn_pkt 1}} FILE /opt/dcelocal/tom.debug.dtscp}


The {xmit 1recv.1} item is suspect....

[8/1/94 public]

You're right, the {xmit 1recv.1} item is the problem. What's happening
is that the sub-component name has a period in it. And dcecp "log show" 
assumes that sub-component names do not have commas, colons, spaces, or
periods.

If this assumption is wrong, then this CR is against "dcecp".

[8/2/94 public]
The problem is the svc code accepted '1recv.1' as a level for the 'xmit'
debug output.  I ment to type 'xmit.1,recv.1'.  I don't believe this
is dcecp's fault.

[08/03/94 public]
The only illegal chars in a subcomponent name are period command and space.
Just FYI, Julie.

[8/3/94 public]
Did you mean "comma" instead of "command"?
Just for my infomation Rich?  :-)



CR Number                     : 11469
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 10474
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : utils
Subcomponent Name             : svc
Short Description             : multiple routing - GDS purposes
Reported Date                 : 7/28/94
Found in Baseline             : 1.1
Found Date                    : 7/28/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 10474
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[7/28/94 public]

OT 10476 is fixed now, "dce_svc_printf" is able to use multiple routes for
messages. However the specification of the multiple routes is not sufficient
for our purposes.

Our intention is, that all messages, that are written by "dce_svc_printf"
should be routed as specified in the routing specification string.
But as this information is useful in general only together with the
context, where it was generated, it should be routed additionally to the
logfile, that is specified for debug (or log) messages (if there is any).
The debug level need not to be checked, as we regard these messages as
important, such that they should be written into the logfile in any case.

As is implemented now, the multiple routes have to be specified in the
routing specification string for the severity level. We could realize what
we want by specifying the second route for every severity level equal to the
route for logging. However we regard this as too much specification for
such a simple thing, second it does not work, as till now serviceability is
not able to write messages from different routes into the same physical file.
The messages would overwrite each other (see OT 10474).

This defect is high-prior because we think that no customer accepts
that one gds server process writes 6 logfiles - and we have a lot
of server processes. If 10474 is fixed we can decrease the priority -
we'll have a (ugly) workaround - as described above.

[8/2/94 public]
I need some clarification and details.

First, let's call the 2 kinds of messages "debug" and "production", where
production is FATAL, ERROR, WARNING, etc.
You can specify multiple routes for production messages by:
    ERROR:FILE:/opt/dcelocal/var/some/file.log FILE:/tmp/another.log

Are you unhappy with the syntax of this?

Debug messages can only go one place in the current implementation.  It
would be a lot of work to change that.

Examples of things that do not work would be helpful.

[08/03/94 public]
We don't care about the syntax - we just use whatever you define.
Our problem is:
We have a logfile for debug messages - let's call it debug.log.

We want to put "production messages" to (i.e. ERROR):
1.) error.log
2.) debug.log

That would mean the following specification:

gds:general.1,ipc.2:BINFILE.2.2000:debug.log	for debug messages

ERROR:FILE:error.log BINFILE:/tmp/debug.log	for production messages

Regarding to 10474 we would like to do also:

FATAL:FILE:error.log BINFILE:/tmp/debug.log
WARNING:FILE:error.log BINFILE:/tmp/debug.log
NOTICE:FILE:error.log BINFILE:/tmp/debug.log
NOTICE_VERBOSE:FILE:error.log BINFILE:/tmp/debug.log

What we do now is: (see /opt/dcelocal/var/adm/directory/gds/.profile)

gds:general.1,ipc.2:BINFILE.2.2000:debug.log
ERROR:FILE:error.log 
FATAL:FILE:fatal.log
WARNING:FILE:warning.log
NOTICE:FILE:notice.log
NOTICE_VERBOSE:FILE:notice_verbose.log

What we also do in some components (i.e. gdsdsa) as a workaround is i.e.:

dce_svc_printf(GDS_S_EXITDSA_MSG,d26_dir_id);
DCE_SVC_LOG((DCE_SVC(gds_svc_handle,"%d"),GDS_S_GENERAL,svc_c_debug1,
                 GDS_S_EXITDSA,d26_dir_id));

What we would like to do (and we do it i.e. in gds/ipc) is to put this
into one SVC call:

dce_svc_printf(GDS_S_EXITDSA_MSG,d26_dir_id);

(where GDS_S_EXITDSA is assigned in gds.sams to svc_c_sev_notice -
that means that this message would be in debug.log AND notice.log
(or, in the first step, error.log))

We want to have all messages in debug.log because it's much more easier
to follow the history with reading one file (debug.log) than to
merge the information from 6 logfiles. Additionally we want to have
the production messages in a seperate file (not in debug.log)  because
somtimes it's enough to read the error.log to find the problem.

Do you need more clarification and details, John?
We know that this means some work (with tables of file descriptors, we guess).
But I think it's valid to want all (debug and production) messages
in one logfile. I think it's not acceptable that you always have to do
things like:

dce_svc_printf(GDS_S_EXITDSA_MSG,d26_dir_id);
DCE_SVC_LOG((DCE_SVC(gds_svc_handle,"%d"),GDS_S_GENERAL,svc_c_debug1,
                 GDS_S_EXITDSA,d26_dir_id));

Summary: We would like to specify our routing in the following way:

gds:general.1,ipc.2:BINFILE.2.2000:debug.log	for debug messages
ERROR:FILE:error.log BINFILE:/tmp/debug.log	for production messages
FATAL:FILE:error.log BINFILE:/tmp/debug.log		"
WARNING:FILE:error.log BINFILE:/tmp/debug.log		"
NOTICE:FILE:error.log BINFILE:/tmp/debug.log		"
NOTICE_VERBOSE:FILE:error.log BINFILE:/tmp/debug.log	"

[09/12/94 public]
Using OT CR 10474, is this sufficient?

gds:general.1,ipc.2:BINFILE.2.2000:debug.log	for debug messages
ERROR:FILE:error.log SAMEAS:gds			for production messages
FATAL:SAMEAS:ERROR					"
WARNING:SAMEAS:ERROR					"
NOTICE:SAMEAS:ERROR					"
NOTICE_VERBOSE:SAMEAS:ERROR				"

[09/14/94 public]
Sorry that I'm answering that late:

Sure, it's sufficient. I didn't realize when reading 10474 that it's possible
for SVC to put the same message to a TEXTFILE and to a BINFILE.
OK - once you have submitted the fix for 10474 I will change

gds/.profile.sh 

in the way Rich Salz has proposed.

We should change also the mentioned code segments

dce_svc_printf(GDS_S_EXITDSA_MSG,d26_dir_id);
DCE_SVC_LOG((DCE_SVC(gds_svc_handle,"%d"),GDS_S_GENERAL,svc_c_debug1,
                 GDS_S_EXITDSA,d26_dir_id));

to just

dce_svc_printf(GDS_S_EXITDSA_MSG,d26_dir_id);

This means changes in a lot (about 50, I guess) files.
It's late for such a huge submit - I know. But it's "only"
serviceability changes.
Could you please submit your changes for 10474 some days before
the HARD FREEZE?



CR Number                     : 11457
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : cds
Subcomponent Name             : directory/cds/server/unix_cds_net.c
Short Description             : Function call arg. cannot be assigned
Reported Date                 : 7/27/94
Found in Baseline             : 1.1
Found Date                    : 7/27/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 11441
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[7/27/94 public]

xlc -c       -Dunix  -D_ALL_SOURCE -DDCE_SEC -DINSTRUMENT -DDNS_DFS -D_ALL_SOURCE -DAIX32   -I. -I/u1/devobj/sb/nb_rios/src/directory/cds/server -I/project/dce/build/dce1.1-snap/src/directory/cds/server  -I../stubs -I/u1/devobj/sb/nb_rios/src/directory/cds/stubs -I/project/dce/build/dce1.1-snap/src/directory/cds/stubs -I../includes -I/u1/devobj/sb/nb_rios/src/directory/cds/includes -I/project/dce/build/dce1.1-snap/src/directory/cds/includes -I/u1/devobj/sb/nb_rios/export/rios/usr/include -I/project/dce/build/dce1.1-snap/export/rios/usr/include   /project/dce/build/dce1.1-snap/src/directory/cds/server/unix_cds_net.c
"/project/dce/build/dce1.1-snap/src/directory/cds/server/unix_cds_net.c", line 236.1: 1506-103 (S) Tag evtblk requires a complete definition before it is used.
"/project/dce/build/dce1.1-snap/src/directory/cds/server/unix_cds_net.c", line 903.6: 1506-193 (E) Function call argument cannot be assigned to corresponding parameter.
*** Error code 1



CR Number                     : 11437
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 10051
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : cds
Subcomponent Name             : 
Short Description             : Adding attribute value for CDS_Towers fails.
Reported Date                 : 7/26/94
Found in Baseline             : 1.1
Found Date                    : 7/26/94
Severity                      : C
Priority                      : 3
Status                        : dup
Duplicate Of                  : 10051
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[7/26/94 public]


The cdscp command:

cdscp> add obj /.:/test CDS_Towers = ncadg_ip_udp:130.105.5.16

appears to complete correctly but looking at the results:

cdscp> show obj /.:/test

                        SHOW
                      OBJECT   /.../terrapin_cell.osf.org/test
                          AT   1994-07-26-08:41:51
                     CDS_CTS = 1994-07-26-12:36:10.421708100/00-00-c0-f7-de-56
                     CDS_UTS = 1994-07-26-12:38:47.201282100/00-00-c0-f7-de-56
                  CDS_Towers = :
               Invalid Tower = %x0102005d0007000100000000000000000000000000004b0009050013000dffff7d25ffffff11ff5408002b1cff1f01000200000013000d045dffffff1cff11ffff08002b10486002000200000001000a02000000010008020000000100090400ff690510

Seems to show that the process does not successfully add the attribute value. 
I implemented this for dcecp and I needed to rework the innards of the 
cdsCvtStrToTower in tower_lib.c and savetowerattr in attrname_actions_cds.c
in order to get it to work.

[8/4/94 public]
looks like a duplicate



CR Number                     : 11429
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : aud
Subcomponent Name             : libaudit
Short Description             : When DCEAUDITFILTERON is
set to 1, secd core dumps
Reported Date                 : 7/25/94
Found in Baseline             : 1.1
Found Date                    : 7/25/94
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 11700
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[7/25/94 public]

Setting the DCEAUDFILTERON environment variable to "1" causes secd
to core dump due to receiving a fatal status from rpc of "no bindings".

The engineer who did the rest of the investigation on this problem had
this to say:

"In looking through the libaudit code further, I was able to determine
that when setting DCEAUDITFILTERON, the dce_aud_open() code takes a
much different path than when this environment variable is not set
(where it simply returns).  Instead, the routine continues processing
and ultimately issues a call to register_update_interface(stp),
which is located in esl_sync.c.  This routine attempts to register
the update interface and contains the following initial code:
    rpc_server_inq_bindings(&bindings, status);
    if (BAD_STATUS(status)) {
        return;
    }
I believe this is where the "no bindings" rpc status is being returned
back to secd.

The one odd thing about all this is this update interface server 
registration is occurring in libaudit.  All other audit related 
interface server registrations occur within the auditd startup.
Unless I'm mistaken...the libaudit library is statically linked into 
secd, hence the libaudit call to rpc_server_register_if() seems to
be bogus - after all, in this instance, secd is the client of auditd.
It (secd) should not be trying to register auditd's interfaces,
should it?

[7/25/94 public]
The question is why the "no bindings" status is returned from RPC?  
Also why does this cause a coredump?
In case of DCEAUDITFILTERON being set, which means that secd wants to 
use audit functionality with filters being used.  But since filters are
maintained by the audit daemon, each library registers an "update" interface
so as the daemon can signal all audit clients whenever the filter database
is changed.  (auditcp or dcecp are used to talk to the audit daemon for filter
modifications.)
So indeed, if the audit library cannot register this update interface with RPC,
then secd bringup should fail, since otherwise no filter updates are going to
be performed and secd is not going to "see" any filter changes made in the system.

[7/25/94 public]

We're not sure why it's dumping core, it takes an rs_fatal() because
the call to dce_aud_open() in secd returns an error status.

When you say "each library" above - what do you mean?  Do you mean libaudit?
Remember that secd is logging audit events through libaudit.  It seems that
a client (in this case, secd because it's issuing libaudit client calls) is 
not able to register server interfaces.  

According to the man page for rpc_server_register_if(3rpc) - "A server can 
register an unlimited number of interfaces.  Once registered, an interface
is available to clients..."  In the above example, the client (secd) is
trying to register the interface.  The auditd code appears to register all
interfaces except this one.  This seems suspect.  

Why can't we get auditd to use filters, either?  What are we doing wrong?  
Are there some administrative tasks (undocumented) that are required to
get this to work?  I am concerned by the fact that there are no entries in
our central trail file (see above), even though we started auditd with the
-a option.

[7/26/94 public]

Per Robert's suggestion I have removed the auditd portion of this defect
and am opening a new defect for it.  This is a separate problem.

[7/26/94 public]
Looking in rs_main.c, the call to dce_aud_open is done before secd had
a chance to register its interfaces with rpc runtime, so no wonder that
the return code of "no bindings" is received by the audit library.  [mob 8/2/94 public]
HP made the changes that Robert recommended and secd still dumps core
when DCEAUDITFILTERON=1 , the stack trace is below:

 0 dce_svc__debug@libdce + 0x00000008 (hp-ux export stub)
 1 malloc@libc_r + 0x000005d0 (0, 0x4, 0x1, 0x40024134)
 2 dce_aud_start_with_pac + 0x000000fc (0x129, 0x4034969c, 0, 0)
 3 dce_aud_start + 0x000001c4 (0x129, 0x403460c0, 0, 0xffffffff)
 4 rsec_id_parse_name + 0x000000cc (0x403460c0, 0, 0x402088a8, 0x1e)
 5 rsec_id_parse_name_cache + 0x0000005c (0x403460c0, 0, 0x402088a8, 0x1e)
 6 op3_ssr + 0x000001b0 (0x403460c0, 0x40346c80, 0x4020854c, 0x40345c38)
 7 rpc__cn_call_executor@libdce + 0x000003a8 (0x40346c80, 0, 0, 0)
 8 cthread_call_executor@libdce + 0x00000178 (0x402062d0, 0, 0, 0)
 9 cma__thread_base@libdce + 0x000000f4 (0x4018c638, 0, 0, 0)
10 cma__thread_start1@libdce + 0x00000038 (0x4018c638, 0, 0, 0)
11 cma__thread_start0@libdce + 0x0000000c (0x4018c638, 0, 0, 0)

[8/4/94 public]
Changed priority to 1.  This still needs to be fixed but it's isn't holding
anyone else up.

[8/8/94 public]
This looks like blowing inside dce_svc_debug macro.  Are you getting ANY 
debug messages from the audit component at all?
(I.e. is your environment set up correctly for the debug messages to come out?).
This specific debug message comes out correctly on both my HP and RIOS machines.

[8/8/94 public]

What are the steps required to setup my environment so that the SVC debug
messages come out correctly?  All I'm doing is using a default routing file
and sending that info to a file.

[8/9/94 public]
Can you append here or send me the contents of that file?

[8/16/94 public]
Duplicate of 11700.  dce_aud_start should not be invoked before dce_aud_open.



CR Number                     : 11406
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dced
Subcomponent Name             : 
Short Description             : dced crashes during DCDREL001 test
Reported Date                 : 7/23/94
Found in Baseline             : 1.1b11
Found Date                    : 7/23/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 11408
Fix By Baseline               : 
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[7/23/94 public]

A simplified version of DCDREL001 was run for 15 hours in a cell
consisting of 2 OSF/1 systems and 1 HPUX system. The HPUX system
ran all the core servers. The test itself was run only on the 2
OSF/1 systems. The version of the test used in this case registered
an obj uuid vector contain 10 uuids (I note this only because it
will later be run with a higher value for the uuid count, which 
may change the behavior). 

After 13 hours of operation the test started failing on a server
call to rpc_ns_binding_export, with the error "RPC daemon
communications failure (dce / rpc)". After the test was completed
both dced and gdad were no longer running on the HPUX system.

[07/26/94 public]
Did you see a core file in /opt/dcelocal/var/dced?  I know 13hrs
is a long time but is this reproducible?  Try invoking dced like this:
	cd /opt/dcelocal/var/dced
	dced -d >log 2>&1
(or "dced -d >&log" if using csh).  dced will use SVC soon, very soon...

[08/01/94 public]
This problem did not occur during a 48-hour test run against BL13,
so I'm cancelling it.

[08/16/94 public]
This problem occurred again while testing BL14.0 so I'm reopening
it. This time the dced server on a client OSF/1 system crashed 
with a segmentation fault. No backtrace information was available. 
The stack pointer was reported as being in acl_db() by gdb. The 
crash occurred after the test had been running on 3 nodes (2 OSF/1 
platforms, 1 HPUX platform running the core servers) for 5 hours.

[08/22/94 public]
Is it easy to reproduce this?  Here is what I would like you to try.
Become root on the machine where dced crashes.  Stop dce.  In one window
do
	cd /opt/dcelocal/dced
	gdb (or xdb or xde or wahtever) /usr/bin/dced
	run -d
Then in another window, become root and run rc.dce

Then do the systest and wait for the debugger to catch the segfault.

tnx.

[08/26/94 public]
Does this still happen in BL16?

[08/29/94]
Yes, but not as quickly. Dced crashed on all three test nodes in
the test cell running DCDREL001 during a 48 hour test run, as follows:

31 hours- node maui (OSF/1 client platform)
38 hours- node jamaica (OSF/1 client platform)
43 hours- node dce2 (HP-UX dce core server platform)

[09/12/94 public]
I believe that this is a side-effect of the bug in 11408.



CR Number                     : 11365
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : sec
Subcomponent Name             : secd
Short Description             : secd core dumping soon after
cell config. (< 1 hour)
Reported Date                 : 7/20/94
Found in Baseline             : 1.1
Found Date                    : 7/20/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 11363
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[7/20/94 public]

secd core dump on HP after cell has been config'ed and up about 1/2
hour.  I am told that was no explicit user activity on the cell at the 
time of the crash.  The following stack was recovered from xdb:

 0 free@libc + 0x00000008 (hp-ux export stub)
 1 cma__free_mutex_nolock@libdce + 0x000000a8 (0x40053e50, 0, 0, 0)
 2 cma__free_mutex@libdce + 0x00000134 (0x73394bf0, 0x3, 0x4006f7a0, 0x1)
 3 krb5_free_principal@libdce + 0x00000040 (0x40394a30, 0x2, 0, 0)
 4 sec_krb_parsed_name_free@libdc + 0x00000044 (0x40400f08, 0x4006f724, 0,
0)
 5 rpc__krb_free_info@libdce + 0x000001a4 (0x4006f698, 0x1, 0, 0)
 6 rpc__auth_info_release@libdce + 0x00000268 (0x404022f8, 0, 0, 0)
 7 rpc__krb_free_key@libdce + 0x0000003c (0x4006f5e0, 0x3, 0x400badf0, 0)
 8 rpc__key_info_release@libdce + 0x00000210 (0x403facf8, 0xbb8,
0x4006f4e4, 0)
 9 rpc__dg_sct_timer@libdce + 0x000001f8 (0, 0x7aff05a0, 0x4006f4e4, 0x32)
10 rpc__timer_callout@libdce + 0x000000c0 (0x7aff3cb0, 0x7aff05a0,
0x4006f49c, 0)
11 timer_loop@libdce + 0x0000007c (0x4006f0e0, 0x7af5a068, 0x400404f0, 0x3)
12 cma__thread_base@libdce + 0x0000021c (0x400404f0, 0, 0, 0)
13 cma__thread_start1@libdce + 0x0000004c (0x400404f0, 0, 0, 0)
14 cma__thread_start0@libdce + 0x00000008 (0x400

Could be a wild chase, but:
Look at the routine sec_authn.c:sec_krb_parsed_name_free(), is the
combination of taking the contents of sec_krb_parsed_name *pname along
with the way krb5_free_principal() uses the krb5_free_data() and xfree()
macros correct?  Probably, but it was a little confusing to me.

NOTE:  OT #11363 may be a dupe but since that secd occurs during
configuration and no useable stack has been recovered, I'll leave them 
seperate for now.

[7/20/94 public]

Adding addt'l info from xdb for above core dump stack:

>lr $a
$arg0     = 0x73394bf0
$arg1     = 0
$arg2     = 0x4039663d
$arg3     = 0
>

>lr $r
$r0       = 0
$r1       = 0x24b5
$r2       = 0x800b27c3
$r3       = 0x7b0127b0
$r4       = 0x73394bf0
$r5       = 0x73394bec
$r6       = 0
$r7       = 0
$r8       = 0
$r9       = 0
$r10      = 0
$r11      = 0
$r12      = 0
$r13      = 0
$r14      = 0
$r15      = 0
$r16      = 0
$r17      = 0
$r18      = 0
$r19      = 0x7b007948
$r20      = 0x177dc000
$r21      = 0x800b27b8
$r22      = 0x7afeef98
$r23      = 0
$r24      = 0x4039663d
$r25      = 0
$r26      = 0x73394bf0
$r27      = 0x4002c7c0
$r28      = 0x177db009
$r29      = 0x4039663d
$r30      = 0x4006f8e0
$r31      = 0x813773cf
$ret0     = 0x177db009
$ret1     = 0x4039663d

>p *($pc-16)\20i
0x800b27b0  BV  0(2)
0x800b27b4  LDWM        -192(0,30),3
0x800b27b8  BL  _fp_status+0018,2
0x800b27bc  OR  0,0,0
0x800b27c0  LDW -24(0,30),2
0x800b27c4  LDSID       (0,2),1
0x800b27c8  MTSP        1,0
0x800b27cc  BE,N        0(0,2)
0x800b27d0  STW 2,-20(0,30)
0x800b27d4  STWM        3,192(0,30)
0x800b27d8  STW 4,-188(0,30)
0x800b27dc  STW 5,-184(0,30)
0x800b27e0  STW 6,-180(0,30)
0x800b27e4  STW 7,-176(0,30)
0x800b27e8  STW 8,-172(0,30)
0x800b27ec  STW 9,-168(0,30)
0x800b27f0  OR  26,0,4
0x800b27f4  STW 19,-32(0,30)
0x800b27f8  COMIBT,=    0,26,_fp_status+026c
0x800b27fc  OR  0,0,6

[7/21/94 public]
Maryann Hondo and Rob Baum are looking into this and think they have
a handle on what's going on.

[7/27/94 public]
Are you still seeing this problem?  Please let us know.

[7/27/94 public]
This particular problem has only been seen once.  Maybe caused by 
free() related problems that were fixed for OT 11363?  Could anything
be gleaned from the XDB info above?

[7/27/94 public]

I just checked and Maryann Hondo feels that this is a dup of 11363.  Rob,
if you agree, then please "do the honors" and close this one.  HP won't
do anything more unless it's seen again or more info turns up.

[7/27/94 public]

Made a dupe of OT 11363, with honors.



CR Number                     : 11352
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dcecp
Subcomponent Name             : aud
Short Description             : aufs s on unknow principle prints garbage
Reported Date                 : 7/18/94
Found in Baseline             : 1.1
Found Date                    : 7/18/94
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 10516
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[7/18/94 public]

Running the nightly build from 7/17-18.
This looks like a problem:

root@surf# dcecp
dcecp> login cell_admin           
Enter Password: 
Password must be changed!
dcecp> audf s {principal salamone}
test log access result is False 
sec_acl_perm_log = 128
1994-07-18-17:18:20.401-04:00I----- auditd ERROR aud general dmn_rpc_manager.c 1013 0x004dfa30
a client's audit log access denied
Error: principal USBHBHMBH8 is not registered or has been removed


The principle 'salamone' did not exist in the registry.

[7/18/94 public]
Yep. The extra messages were removed in a submit today, and the problem
with the error message is a dup of CR 10516.



CR Number                     : 11344
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 9207
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : cds
Subcomponent Name             : 
Short Description             : can't build db_common.o and db_compression.o with DCE_DEBUG off
Reported Date                 : 7/18/94
Found in Baseline             : 1.1
Found Date                    : 7/18/94
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 9207
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[7/18/94 public]

With DCE_DEBUG undefined in dce.h, I was unable to build db_common.o due to
statusBuf undefined and db_compression.o due fileBuf undefined.

[8/4/94 public]
Same as 9207, cannot build without DEBUG.



CR Number                     : 11334
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : sec
Subcomponent Name             : secd
Short Description             : dcesergy causes secd core dump after 6-8 hours
Reported Date                 : 7/15/94
Found in Baseline             : 1.1
Found Date                    : 7/15/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 11108
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[7/15/94 public]

Running the dcesergy system test for six to eight hours causes secd to
core dump. The system test performs a number of sec_logins, and adds/deletes
accounts on multiple clients.

core info

registers:

r0  00000000 000024b5 800a6633 00000002 r4  7af5a666 401c91b4 7b010ecc 7b010ed0
r8  400011f4 0000007f 00000000 401c9080 r12 00000002 00000000 00000000 00000002
r16 7af4aaac 00000029 00000000 7b007948 r20 7b00d160 800b94b8 00000000 7b010ea8
r24 00000002 7af4aaac 401c907e 4002bdb8 r28 00000000 00000001 401c9060 800a667b
    pc = 000024b5.800a6630     priv = 3     psw = jthLnxBCvmrQPDI     sar = 24

trace:

 0 kill@libc + 0x00000008 (hp-ux export stub)
 1 cma__abort_process@libdce + 0x000000a4 (0x6, 0, 0, 0x6c6f636b)
 2 cma__bugcheck@libdce + 0x00000488 (0x7af44d6c, 0x7af53c30, 0x4df, 0x7af53c4c)
 3 cma__assert_message@libdce + 0x00000134 (0x1, 0x7af53c30, 0x7af53c4c, 0x4df)
 4 cma__int_mutex_block@libdce + 0x000013e0 (0x4003d160, 0x3, 0xad5669c5, 0xee4541c5)
 5 ptdexc_mutex_lock@libdce + 0x000000dc (0x7affc958, 0x18, 0x8, 0x400f0e68)
 6 rpc__cn_call_start@libdce + 0x000001c4 (0x400cc9e8, 0x2, 0x7af8f810, 0)
 7 rpc_call_start@libdce + 0x0000025c (0x400cc9e8, 0x2, 0x7af8f810, 0)
 8 op0_csr@libdce + 0x000001bc (0x400cc9e8, 0x21a, 0x40d41d98, 0x1000)
 9 sec_krb5rpc_sendto_kdc@libdce + 0x000002ac (0x40ac3650, 0x21a, 0x40d41d98, 0x1000)
10 krb5_sendto_kdc@libdce + 0x000000bc (0x40bcdd50, 0x40ac3650, 0x401c8048, 0x54)
11 krb5_send_tgs@libdce + 0x00001050 (0, 0x40c5bde4, 0x401c0001, 0x401c0002)
12 krb5_get_cred_via_tgt@libdce + 0x000001b0 (0x401c7f30, 0, 0x401c0001, 0x401c0002)
13 krb5_get_cred_from_kdc@libdce + 0x0000097c (0x401c0f40, 0x40c5bdd0, 0x401c7ea0, 0x40c5bdd0)
14 krb5_get_credentials@libdce + 0x00000178 (0, 0x401c0f40, 0x40c5bdd0, 0x401c7824)
15 sec_priv_get_eptgt@libdce + 0x000008c4 (0x402f1048, 0x402f1048, 0x1, 0x2)
16 sec_login_util_get_krb_ptgt@li + 0x0000013c (0x402f1048, 0x402f1048, 0x1, 0x2)
17 sec_login_pvt_get_ecreds@libdc + 0x000000a4 (0x402f1048, 0x401c7840, 0x401c7824, 0)
18 sec_login_util_get_delegation_ + 0x00000104 (0x402f1048, 0x401c7840, 0x401c7824, 0)
19 sec_krb_build_message_common@l + 0x00000128 (0x402f1048, 0x40a15a68, 0x401c7370, 0x2)
20 sec_krb_cn_build_message@libdc + 0x00000114 (0x402f1048, 0x40a15a68, 0x5, 0x2)
21 rpc__krb_cn_fmt_client_req@lib + 0x00000324 (0x4035fde8, 0x402f2150, 0x40d99480, 0x401c720c)
22 send_pdu@libdce + 0x00000d70 (0x4035fd08, 0xb, 0x40c898b0, 0)
23 init_assoc_action_rtn@libdce + 0x00000574 (0x4035fd08, 0x401c704c, 0, 0x5)
24 rpc__cn_sm_eval_event@libdce + 0x0000016c (0, 0x401c704c, 0x4035fd08, 0x4035fd10)
25 rpc__cn_assoc_open@libdce + 0x000005ec (0x4035fd08, 0x402f4470, 0x7af96690, 0)
26 rpc__cn_assoc_request@libdce + 0x00000ab0 (0x401c0068, 0x402f6f10, 0x7af96690, 0x401c0264)
27 allocate_assoc_action_rtn@libd + 0x00000150 (0x401c0068, 0x7af96690, 0x7, 0x401c46e0)
28 rpc__cn_sm_eval_event@libdce + 0x0000016c (0x8, 0x7af96690, 0x401c0068, 0x401c009c)
29 rpc__cn_call_start@libdce + 0x00000f38 (0x402f6f10, 0, 0x7af96690, 0x3)
30 rpc_call_start@libdce + 0x0000025c (0x402f6f10, 0, 0x7af96690, 0x3)
31 op3_csr@libdce + 0x000001d4 (0x402f6f10, 0, 0x40c351c0, 0x1e)
32 sec__id_parse_name@libdce + 0x00000a14 (0x402f69c0, 0, 0x40c351c0, 0x401c5470)
33 sec_id_parse_name@libdce + 0x00000068 (0x402f69c0, 0x40c351c0, 0x401c5470, 0x401c5884)
34 dce_aud_start_with_name (event = 275, client = 0x40c351c0, address =   00000000, options = 0, outcome = 4294967295, ard = 0x401c47b4, status = 0x401c47d0)    [/project/dce/build/dce1.1-snap/src/security/audit/libaudit/evt_write.c: 342]
35 dce_aud_start (event = 275, binding = 0x40c89250, options = 0, outcome = 4294967295, ard = 0x401c47b4, stp = 0x401c47d0)    [/project/dce/build/dce1.1-snap/src/security/audit/libaudit/evt_write.c: 164]
36 rs_login_get_info + 0x0000006c (0x40c89250, 0x401c2910, 0x401c3514, 0x401c3530)
37 op0_ssr + 0x00000264 (0x40c89250, 0x40ced990, 0x401c253c, 0x401c2520)
38 rpc__dg_execute_call@libdce + 0x00001ba4 (0x40ced990, 0, 0, 0)
39 cthread_call_executor@libdce + 0x000002d4 (0x4015ae18, 0x7af590b8, 0x40044ad0, 0xb)
40 cma__thread_base@libdce + 0x0000021c (0x40044ad0, 0, 0, 0)
41 cma__thread_start1@libdce + 0x0000004c (0x40044ad0, 0, 0, 0)
42 cma__thread_start0@libdce + 0x00000008 (0x40044ad0, 0, 0, 0)
43 cma__thread_start0@libdce + 0x00000008 (0x40044ad0, 0, 0, 0)
.
.
.
99 (same)

[7/15/94 public]

The dcesergy test was recently modified to be client/server rather than 
running on a single node.  The command line to invoke the test is:

run.sec -t 15 -m "mach1 mach2 mach3" dcesergy

[7/15/94 public]
Yikes...  I've added dce-ot-rpc to the cc list, since this is an assertion
coming out of the RPC runtime...  Note that if you can trust the traceback
above, it's a server manager routine (below op0_ssr), that's making an outgoing
call (op3_csr), that makes another outgoing call (op0_csr) before op3_csr
even does it's call transceive, but after it did it's call start (I think
that's what the above says...).

[7/15/94 public]
Well, it RPC who is dumping core, but I blame security :-)

When constructing the krb_message for the CN BIND request,
rpc__krb_cn_fmt_client_req causes another RPC to be attempted.
It looks like its going to get somw deligation info.  This is bad
and we need to prevent this from happening, in rpc__cn_call_start
we try to go out and refresh our creds if needed just so this wont
happen.  Someone in the security space needs to tell me what
CN needs to do to prevent this second RPC.

See OT 11108 for even more info.

Bug dup'd to 11108.



CR Number                     : 11318
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dcecp
Subcomponent Name             : cds
Short Description             : cdscache create reports invalid RPC protocol sequence
Reported Date                 : 7/15/94
Found in Baseline             : 1.1
Found Date                    : 7/15/94
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 10837
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[7/15/94 public]

The "cdscache create" command incorrectly reports invalid RPC protocol 
sequence. 

dcecp> cdscache create jerry -binding nacdg_ip_udp:130.105.4.193
Error: invalid RPC protocol sequence

[kevins 7/19/94 public] 

This is exhibiting the same error as cdscp "define cache server" 
problem. Same problem different control program.



CR Number                     : 11243
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 11119
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : aud
Subcomponent Name             : auditd
Short Description             : auditd server entry does not
have write permission for self
Reported Date                 : 7/11/94
Found in Baseline             : 1.1
Found Date                    : 7/11/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 11431
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[7/11/94 public]
This is taken from OT11119:

  Here's what happens to me:
  
  <config, shutdown, then restart>
  
  root@surf# /etc/rc.dce
	  /opt/dcelocal/bin/dced
  No currently established network identity for which context exists
  DCED listening...
	  /opt/dcelocal/bin/secd
	  /opt/dcelocal/bin/sec_clientd
	  /opt/dcelocal/bin/cdsadv
	  /opt/dcelocal/bin/cdsd
	  /opt/dcelocal/bin/auditd -a
	  /opt/dcelocal/bin/dtsd -s
  1994-07-05-15:49:37.639-04:00I----- auditd FATAL aud general 0xa44b0bc4
  cannot register daemon's ACL manager interface bindings
    
Auditd, running as self, can't export it's bindings.  During the initial
dce_configuration, auditd is running as cell_admin.

[7/11/94 public]
I don't think that this is the problem. I just repaired the ACL my hand, and
started auditd. Same problem. I don't think that the way auditd registers
itself has changed recently, but this behavior is new.

dcecp> acl show /.:/hosts/ninja/aud-acl -e
{unauthenticated r--t-}
{user cell_admin rwdtc}
{user hosts/ninja/self rwdtc}
{group subsys/dce/cds-admin rwdtc}
{group subsys/dce/cds-server rwdtc}
{any_other r--t-}

I added hosts/ninja/self to the acl, but...

[ninja]
1994-07-11-22:16:39.994-04:00I----- auditd FATAL aud general dmn_main.c 462 0xa44cebd4
cannot register daemon's ACL manager interface bindings

[8/8/94 public]
I marked this as dup of 11431 and not the other way around, since there is 
more discussion there on the subject.



CR Number                     : 11241
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : sec_acl API
Short Description             : Incorrect length in
sec_acl_bind () malloc
Reported Date                 : 7/11/94
Found in Baseline             : 1.0.3, 1.1
Found Date                    : 7/11/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 8266
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : daclbind.c
Sensitivity                   : public

[7/11/94 public]

sec_acl_bind() in src/security/client/acl has a minor bug where
component_name is initially malloc'd.  The length passed to malloc is
computed as the sum of two string lengths, plus 1 byte for the "/".
This length is off by one.  An additional byte should be added for the 
null character that gets placed in the final strcat that fills in this string.

[7/11/94 public]
Duplicate of CR8266.



CR Number                     : 11234
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : rpc
Subcomponent Name             : 
Short Description             : RPC causes dced to core dump
when there is a 1.0.3 client in the cell
Reported Date                 : 7/11/94
Found in Baseline             : 1.1
Found Date                    : 7/11/94
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 8157
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[7/11/94 public]

Cell Configuration: 

HPUX (dce1.1)   : dced, SEC server, DTS server
OSF1 (dce1.0.3) : rpcd, CDS server, DTS server

NB- July 6 (BL-11)

The cell was idle during the weekend; dced cored dump with the following
error:

1994-07-11-05:44:09.536-04:00I----- dced FATAL rpc rpc_svc_cn_state 0x40027928
Illegal state transition detected in CN client association state machine
[2, cur_event: 0, assoc: 401313a0]


[I had a core dump, unfortunatelly when I brought up the debugger, it
created another core which overwrote the one from dced]

I am going to restart the cell.

[7/11/94 public]
This is a dup of 8157, which has been around for quite a while.
We don't have a good idea as to why this is happening.
See 8157 for lots of details.



CR Number                     : 11206
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : aud
Subcomponent Name             : security/audit/auditcp
Short Description             : automatic smoke test can't create /opt/dcelocal/bin/auditcp
Reported Date                 : 7/7/94
Found in Baseline             : 1.1
Found Date                    : 7/7/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 11192
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[7/7/94 public]

This is breaking all our automatic smoke tests.

+ hostname 
smoke_machine=budapest
build_machine=zagreb
build_fs=/u3
sb_suffix=ux
platform=hp800
release=1.1
mt_pt=/mnt
toolsdir=/u1/RAT_tools
dcelocal=/u1/opt/dcelocal
dcetest=/dcetest/dcelocal/test
+ /usr/bin/whoami 
user_name=root
+ [ root != root ] 
+ echo setting up DCE NLSPATH and LANG 
setting up DCE NLSPATH and LANG
NLSPATH=/usr/lib/nls/C/%N
LANG=C
+ export NLSPATH LANG 
+ [ ! -d /mnt ] 
+ [ ! -d /mnt/opt/dce1.1 ] 
+ /etc/mount -f zagreb:/u3/devobj/sb/nb_ux/install/hp800 /mnt 
+ cd /mnt/opt/dce1.1/etc 
+ ./dce_config -c /u1/RAT_tools/mult_mach_configs/budapest_secr_cdsr_ds.cmd -e /u1/RAT_tools/mult_mach_configs/budapest_secr_cdsr_ds.env -i 


S:****** Attempting to remove all remnants of previous DCE installations for 
         all components...
S:****** Successfully removed all remnants of previous DCE installations for 
         all components.
                installing sec_create_db sec_salvage_db secd ...
                installing dced rpcd cdsadv cdsclerk dtsd sec_clientd auditd dtstimed...
                installing dts_null_provider dts_ntp_provider...
                installing rpccp uuidgen cdscp getcellname getip...
                installing acl_edit dce_login rgy_edit dtscp dcecp...
                installing sec_admin passwd_import passwd_export auditcp...
                installing kinit klist kdestroy...
cp: cannot access /opt/dce/bin/auditcp: No such file or directory
Can't create file /opt/dcelocal/bin/auditcp
Ensure no DCE daemons are running
        Press <RETURN> to continue, CTRL-C to exit: 
# 


tests hang at this point

[7/7/94 public]
By the way, if you hit return it will continue.



CR Number                     : 11190
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : i486
S/W Ref Platform              : osf1
Component Name                : cds
Subcomponent Name             : 
Short Description             : problems unregistering endpoints
Reported Date                 : 7/6/94
Found in Baseline             : 1.1
Found Date                    : 7/6/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 11140
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[7/6/94 public]
This was found with binaries of 6/30.  On stopping DCE daemons:

        selection:  4
S:****** Attempting to stop all running DCE daemons...
1994-07-06-17:05:38.645-04:00I----- cdsd(2972) ERROR cds server 0x0082be78
Attempt to unregister the clerk/server RPC endpoint has failed with status = not registered in endpoint map (dce / rpc)
1994-07-06-17:05:39.465-04:00I----- cdsd(2972) ERROR cds server 0x0082be78
Attempt to unregister the dacl RPC endpoint has failed with status = not registered in endpoint map (dce / rpc)
Caught signal 15.  Exiting.
S:****** Successfully stopped all running DCE daemons.

[7/7/94 public]
I had already opened this defect.  I thought it sounded familiar ...



CR Number                     : 11188
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : other
S/W Ref Platform              : other
Component Name                : sec
Subcomponent Name             : sec_login API
Short Description             : superfluous ctx cache assertions
Reported Date                 : 7/6/94
Found in Baseline             : 1.0.3
Found Date                    : 7/6/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 9493
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : sec_login_cache.c sec_login_pvt.c others?
Sensitivity                   : public

[7/6/94 public]
  sec_login_pvt.c has several instances of routines that handle error
returns by going to a label "out" or "errout"... there are at least two
instances here of login contexts being entered into the login cache
explicitly just before returning, above the "errout" error exit code.
See routine sec_login_pvt_setup_refresh_context() for the relevant
case.
  The problem is that, when /opt is full, the refresh can fail while the
KRB data is allocated (opening the new ticket file, etc.) and the result
is that the 'rcp' ctx is handed to sec_login_pvt_purge_refresh_context()
without being entered into the cache. A cache assertion failure ensues,
triggered by routine sec_login_pvt_release_context().
  A real-life stack trace is attached:
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
=>[1] myassert(expr = 0xef708804 "<bad address>", file = 0xef708818
"<bad addres
  [2] __assert(expr = 0xef708804 "<bad address>", file = 0xef708818
"<bad addres
  [3] cache_sanity_check(present = 0x92078, absent = (nil)), line 166 in
"sec_lo
  [4] sec_login_pvt_release_context(lcp = 0x92078), line 301 in
"sec_login_cache
  [5] sec_login_pvt_purge_refresh_context(lcp = 0x92078, stp =
0xef38d524), line
  [6] sec_login_pvt_setup_refresh_context(lcp = 0x758c0, stp =
0xef38dd50), line
  [7] sec_login_validate_identity(login_context = 0x758c0, passwd =
0x91be0, res= 0xef38dd50), line 461 in "sec_login.c"
  [8] sec_login_valid_from_keytable(login_context = 0x758c0,
authn_service = 1,  reset_passwd = 0xef38dd5c, auth_src = 0xef38dd4c, st
= 0xef38dd50), line 1004 i
  [9] sec_login_validate_first(init_context = 0x758c0, reset_passwd =
0xef38dd5c82 in "sec_login.c"
  [10] machine_context(arg = (nil)), line 477 in "sec_clientd.c"
  [11] myStartRoutine(tcb = 0x72260), line 851 in "pthread.c"
  [12] _thread_start(0x72260, 0x0, 0x0, 0x0, 0x0, 0x0), at 0xef39d678
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  I'll be looking from here at how to clean up without triggering this
assertion failure. I'm afraid the obvious solution is the los ethe
assertion check, as sec_login_pvt_release_context() can evidfently be
called with unached contexts, and so the assertion is
superfluous/erroneous.

[7/11/94 public]

I believe the original intent was that sec_login_pvt_release_context() 
*not* be called with uncached contexts.  The fix is to cache the 
context regardless of whether or not an error occurred, or dispose
of it locally with custom code and not call on the generic purge
code at all.  I believe you are free to compile out the assertion
checks if you don't want them in your production DCE code.

[8/12/94 public]
Greg and I already figured this one out once and I believe he had a trial
fix.  I've reassigned this to myself so someone else doesn't have to figure
it out all over again.



CR Number                     : 11165
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : priv, rca
Short Description             : can't configure 1.1 client of 1.0.3 cell server
Reported Date                 : 7/1/94
Found in Baseline             : 1.1
Found Date                    : 7/1/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 10607
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : security/client/rca/rpriv.acf,
	security/client/rca/priv.c, security/client/rca/internal_binding.c
Sensitivity                   : public

[7/1/94 public]

In order to test interoperability between 1.0.3 and 1.1 RPC (and finish the
CN RPC integration with the 1.1 authorization model), I attempted to
configure a 1.1 client of a 1.0.3 cell.  This didn't work.  There were two
problems:
 - the new rpriv operations and interface blew up the 1.1 client (rgy_edit)
with an unhandled exception
 - the 1.1 client didn't properly fall back to the old rpriv operations
when it had to bind using the pe_site file.

The priv.c fallback code will be rewritten "eventually", but the above fix
is a stopgap to hold us until this works for real.

The fix will be coming soon to a source tree near you...

[7/5/96 public]

How are the fixes to this problem related to the fixes for OT# 10607?



CR Number                     : 11161
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : utils
Subcomponent Name             : svc
Short Description             : dce_svc_routing doesn't work correctly
Reported Date                 : 7/1/94
Found in Baseline             : 1.1
Found Date                    : 7/1/94
Severity                      : B
Priority                      : 0
Status                        : dup
Duplicate Of                  : 11059
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b12
Affected File(s)              : svcroute.c
Sensitivity                   : public

[7/1/94 public]

dce_svc_routing doesn't work correctly - we don't get any exception logging
into a file.

In gds/util/d27svc.c, function d27_001_svc_init we do:

dce_svc_routing((unsigned char *)"*:STDERR:-",st);

and, if tracing is switched on, additionally (i.e.):

dce_svc_routing("FATAL:TEXTFILE.1.100:/opt/dcelocal/var/directory/gds/adm/sstub/EXC_F%d",st);
...

The first problem is line 677 of svcroute.c:

It should change from

        else if (strcmp((char *)where, dce_svc_g_code_table[i]) == 0) {
to
        else if (strcmp((char *)where, dce_svc_g_code_table[i]) != 0) {

(We initialize dce_svc_g_code_table[i] with STDERR. When we call dce_svc_routing
the second time we want to overwrite the first call: where is TEXTFILE...
This should be overwritten by calling dce_svc__close_routes and
dce_svc__open_routes with the new route.)

With this change I come to dce_svc__open_routes - but also this doesn't work.
Basicly: dce_svc__open_routes is called by dce_svc_routing with 
":TEXTFILE.1.100:/opt/dcelocal/var/directory/gds/adm/sstub/EXC_F%d".
But it is called by dce_svcdce_svc_debug_routing with
"BINFILE.2.2000:/opt/dcelocal/var/directory/gds/adm/sstub/LOG%d".

The difference is the leading colon.

For TEXTFILE: "where" is overwritten by line 362: *p++ = '\0': after this
line "where" is "". So :

gens = strchr(where, SVC_LEVELSEP_CHAR)) (scanning of generation and count) 
						failes,

if (strcmp(where, ROUTE_TEXTFILE) == 0) failes, and no EXC_F... file is opened.

I tried to correct it: The result was that I got exception logging
but no debug logging.

So: Please give me a note if you can fix this soon. If not 
I will continue with fixing this in my sandbox. But I think 
SVC specialists are much faster than I am - I have to understand every line
first.

[7/8/94 public]
Already reported as CR 11059, but this CR explains it better and
has a fix outlined.  Fix is essentially:
    1. increment "p" to point to right place -- wasn't pointing to right
	part of route string.
    2. fix bad test of strcmp() - should be != instead ==.



CR Number                     : 11160
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : dced
Subcomponent Name             : admin/dced/server/sv_clientd.c
Short Description             : Function call argument cannot be assigned
Reported Date                 : 7/1/94
Found in Baseline             : 1.1
Found Date                    : 7/1/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 11158
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[7/1/94 public]

"/project/dce/build/dce1.1-snap/src/admin/dced/server/sv_clientd.c", line 322.9: 1506-193 (E) Function call argument cannot be assigned to corresponding parameter.
*** Error code 1

[07/01/94 public]
This error is really just a warning.  There is (was) an error in that file,
however, it was that sys/fcntl.h could not be found.  See OT CR 11158.

(The error you are seeing, by the way, is an AIX bug:
	extern int fchmod(char*, mode_t)
is how their system header files declare fchmod.  The first param should
be int.)



CR Number                     : 11140
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : i486
S/W Ref Platform              : osf1
Component Name                : cds
Subcomponent Name             : 
Short Description             : Errors recorded on cell shutdown
Reported Date                 : 6/30/94
Found in Baseline             : 1.1
Found Date                    : 6/30/94
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 11239
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[6/30/94 public]
This is what happened when I shut down my single machine cell:


        selection:  4 
S:****** Attempting to stop all running DCE daemons...
waitfor[4]: 5160 5322: Syntax error
WARNING: cdsadv did not shutdown
1994-06-30-08:12:44.343-04:00I----- cdsd(453) ERROR cds server 0x0080b740
Attempt to unregister the clerk/server RPC endpoint has failed with status = not registered in endpoint map (dce / rpc)
1994-06-30-08:12:45.123-04:00I----- cdsd(453) ERROR cds server 0x0080b740
Attempt to unregister the dacl RPC endpoint has failed with status = not registered in endpoint map (dce / rpc)
1994-06-30-08:12:47.113-04:00I----- cdsadv(445) WARNING cds library 0x005b6468
Thread routine error (ref. No. 1728) : Invalid argument
1994-06-30-08:12:47.173-04:00I----- cdsadv(445) FATAL cds adver 0x005b6468
pthread_lock() returned fatal thread error -1.
kill: 445: The specified process does not exist.
WARNING: Could not slay 445
Caught signal 15.  Exiting.
S:****** Successfully stopped all running DCE daemons.

cdsadv then dropped a core.

No daemons were left running.

[7/15/94 public]
The first tow are understood and harmless. They are also covered by 11272.
I suspect the rest are also covered by the same ot. They are instances of
a general hang/shutdown problem that has been showing up lately.

[7/15/94 public]
Should have been dup of 11239. 11272 is a bit different.

1994-06-30-08:12:44.343-04:00I----- cdsd(453) ERROR cds server 0x0080b740
1994-06-30-08:12:45.123-04:00I----- cdsd(453) ERROR cds server 0x0080b740



CR Number                     : 11116
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : cfg
Subcomponent Name             : 
Short Description             : can't start rpcd
Reported Date                 : 6/28/94
Found in Baseline             : 1.1b10
Found Date                    : 6/28/94
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 10953
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[6/28/94 public]
I can't seem to start dced -e on the 486.

[ninja]:/usr/sandbox/dcecp/src/admin/dcecp# /etc/rc.dce
        /opt/dcelocal/bin/rpcd
        /opt/dcelocal/bin/dced -e
(rpcd) Can't initialize ept database: (0x16c9a0d0) cannot create endpoint database (dce / rpc)
Can't register Security Validation server, communications failure
Can't register ACL Manager server, communications failure
Can't register Pre-1.1 ACL Manager server, communications failure
communications failure
dced (pid 18968) exited with status 0177400
        /opt/dcelocal/bin/sec_clientd

[6/28/94 piblic]
I thought dced was failing. It is rpcd. It happens regardless of if
dced gets started.

[6/28/94 piblic]
When using dced (the default), dce_config does not create the directory
that rpcd keeps it's private files in.  If you config'ed with the default,
you'll have to mkdir the right directories to run rpcd.
(or just let dced do the endpoint mapping)

[6/28/94 public]
Follow the bouncing CR...

This is now a config bug. dce_config should create both var/dced and var/rpc
under /opt/dcelocal.



CR Number                     : 11096
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dcecp
Subcomponent Name             : sec
Short Description             : fullnames cause problems
Reported Date                 : 6/27/94
Found in Baseline             : 1.1b10
Found Date                    : 6/27/94
Severity                      : D
Priority                      : 2
Status                        : dup
Duplicate Of                  : 11164
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[6/27/94 public]
I found that the performance of using simplenames or
fullnames is very different, in fact, using full names
results in errors sometimes.  Below are some commands run on
a build of 6/24/94 that output the members of each group in
the rgy.  When using fullnames I get an error of Registry
Server Unavailable.  When using simplenames, it works.

absolut admin/dcecp$ ./dcecp
dcecp> lca
Password must be changed!
dcecp> foreach g [group cat] {puts [group list $g]}
/.../absolut_cell/nobody
/.../absolut_cell/root
/.../absolut_cell/daemon
/.../absolut_cell/uucp
/.../absolut_cell/who
/.../absolut_cell/bin
/.../absolut_cell/root
/.../absolut_cell/sys
/.../absolut_cell/mail
/.../absolut_cell/root
/.../absolut_cell/dce-ptgt
/.../absolut_cell/dce-rgy
/.../absolut_cell/krbtgt/absolut_cell
/.../absolut_cell/cell_admin
/.../absolut_cell/hosts/absolut/self
/.../absolut_cell/tcb
/.../absolut_cell/cell_admin
Error: Registry server unavailable
dcecp> foreach g [group cat] {foreach m [group list $g] {puts $g:$m}}
/.../absolut_cell/nogroup:/.../absolut_cell/nobody
/.../absolut_cell/system:/.../absolut_cell/root
/.../absolut_cell/daemon:/.../absolut_cell/daemon
/.../absolut_cell/uucp:/.../absolut_cell/uucp
/.../absolut_cell/bin:/.../absolut_cell/who
/.../absolut_cell/bin:/.../absolut_cell/bin
/.../absolut_cell/kmem:/.../absolut_cell/root
/.../absolut_cell/kmem:/.../absolut_cell/sys
/.../absolut_cell/mail:/.../absolut_cell/mail
/.../absolut_cell/tty:/.../absolut_cell/root
/.../absolut_cell/none:/.../absolut_cell/dce-ptgt
/.../absolut_cell/none:/.../absolut_cell/dce-rgy
/.../absolut_cell/none:/.../absolut_cell/krbtgt/absolut_cell
/.../absolut_cell/none:/.../absolut_cell/cell_admin
/.../absolut_cell/none:/.../absolut_cell/hosts/absolut/self
/.../absolut_cell/tcb:/.../absolut_cell/tcb
/.../absolut_cell/acct-admin:/.../absolut_cell/cell_admin
Error: Registry server unavailable
dcecp> foreach g [group cat -s] {foreach m [group list $g] {puts $g:$m}}
nogroup:/.../absolut_cell/nobody
system:/.../absolut_cell/root
daemon:/.../absolut_cell/daemon
uucp:/.../absolut_cell/uucp
bin:/.../absolut_cell/who
bin:/.../absolut_cell/bin
kmem:/.../absolut_cell/root
kmem:/.../absolut_cell/sys
mail:/.../absolut_cell/mail
tty:/.../absolut_cell/root
none:/.../absolut_cell/dce-ptgt
none:/.../absolut_cell/dce-rgy
none:/.../absolut_cell/krbtgt/absolut_cell
none:/.../absolut_cell/cell_admin
none:/.../absolut_cell/hosts/absolut/self
tcb:/.../absolut_cell/tcb
acct-admin:/.../absolut_cell/cell_admin
subsys/dce/sec-admin:/.../absolut_cell/cell_admin
subsys/dce/cds-admin:/.../absolut_cell/cell_admin
subsys/dce/dts-admin:/.../absolut_cell/cell_admin
subsys/dce/cds-server:/.../absolut_cell/hosts/absolut/cds-server
subsys/dce/cds-server:/.../absolut_cell/hosts/absolut/gda
subsys/dce/dts-servers:/.../absolut_cell/hosts/absolut/self
dcecp> foreach g [group cat -s] {foreach m [group list $g -s] {puts $g:$m}}
nogroup:nobody
system:root
daemon:daemon
uucp:uucp
bin:who
bin:bin
kmem:root
kmem:sys
mail:mail
tty:root
none:dce-ptgt
none:dce-rgy
none:krbtgt/absolut_cell
none:cell_admin
none:hosts/absolut/self
tcb:tcb
acct-admin:cell_admin
subsys/dce/sec-admin:cell_admin
subsys/dce/cds-admin:cell_admin
subsys/dce/dts-admin:cell_admin
subsys/dce/cds-server:hosts/absolut/cds-server
subsys/dce/cds-server:hosts/absolut/gda
subsys/dce/dts-servers:hosts/absolut/self
dcecp> foreach g [group cat] {foreach m [group list $g -s] {puts $g:$m}}    
/.../absolut_cell/nogroup:nobody
/.../absolut_cell/system:root
/.../absolut_cell/daemon:daemon
/.../absolut_cell/uucp:uucp
/.../absolut_cell/bin:who
/.../absolut_cell/bin:bin
/.../absolut_cell/kmem:root
/.../absolut_cell/kmem:sys
/.../absolut_cell/mail:mail
/.../absolut_cell/tty:root
/.../absolut_cell/none:dce-ptgt
/.../absolut_cell/none:dce-rgy
/.../absolut_cell/none:krbtgt/absolut_cell
/.../absolut_cell/none:cell_admin
/.../absolut_cell/none:hosts/absolut/self
/.../absolut_cell/tcb:tcb
/.../absolut_cell/acct-admin:cell_admin
Error: Registry server unavailable
dcecp>

[6/28/94 public]

I think this should be punted to sec, Rajendra. Here is what I have 
found out. The entry that is failing is:
/.../absolut_cell/subsys/dce/sec-admin

If you remember when the dcecp code is passed a fullname as an argument
the that code is then passed to sec_rgy_site_bind_{query,update}().
Those procedures should open the master/{arbitrary replica}, depending 
on the call, if the name passed in is not a valid rgy_site name. 
This works after R. Stanzel made the fixes a few weeks ago. 

However, sec_rgy_site_bind_{query,update}() ALWAYS fails to correctly 
ascertain that a path begining with:
/{cell_name}/subsys/dce/sec 
is not a valid rgy site name. 

For instance:

/.../absolut_cell/subsys/dce/sec

will work however,

/.../absolut_cell/subsys/dce/sec{insert anything here}

will not work. 

You can take try this out on "name parse" which currently does two
things. 
A.) attempts to open a site within the cell of the name passed
    in. (may soon change. see related CR)
B.) calls sec_id_parse_name 

Try:

name parse /.:/subsys/dce/se
name parse /.:/subsys/dce/sec
name parse /.:/subsys/dce/sec-

The first two will pass and the third will fail always.

[kevins 07/01/94 public] 

I passed this off to security. It seems there is a pattern of 
path name failures. names that begin with /.:/subsys/dce/sec
will always fail. Also names that begin with /.:/hosts will
also fail.



CR Number                     : 11087
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : i486
S/W Ref Platform              : osf1
Component Name                : cfg
Subcomponent Name             : rpcd
Short Description             : can not bring up a cell with rpcd.
Reported Date                 : 6/27/94
Found in Baseline             : 1.1
Found Date                    : 6/27/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 10953
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[6/27/94 public]

With the latest nightly build, trying to bring up a simple cell with
EPMAP=rpcd,

rpcd fails with the error:
	can't initialize the database: (0x16c9a0d0)
	cannot create endpoint database (dce /rpc)

[6/27/94 public]


This is a dup of CR 10953. The work-around, so that you can bring up the
cell, is to mkdir /opt/dcelocal/var/rpc before starting the configuration.



CR Number                     : 11057
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000,hppa,i486
S/W Ref Platform              : osf1,aix,hpux
Component Name                : gds
Subcomponent Name             : gds/ts/gdssetup/lib/valid
Short Description             : don't know how to make sv_init1.cleanup
Reported Date                 : 6/23/94
Found in Baseline             : 1.1
Found Date                    : 6/23/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 11054
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : sv_init1.cleanup
Sensitivity                   : public

[6/23/94 public]


[ /test/functional/directory/gds/ts/gdssetup/lib/valid at 02:02 (AM) Thursday ]
makepath valid/. && cd valid &&  exec make MAKEFILE_PASS=BASIC     install_all
make: don't know how to make sv_init1.cleanup (continuing)history



CR Number                     : 11040
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : gds
Subcomponent Name             : libaplv2c.a
Short Description             : real-ld returned 1 exit status
Reported Date                 : 6/22/94
Found in Baseline             : 1.1
Found Date                    : 6/22/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 11034
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[6/22/94 public]

/project/dce/build/dce1.1-snap/tools/at386/macho/gcc -B/project/dce/build/dce1.1-snap/tools/at386/macho/  -%ld," -warn_nopic -glue"          -L/u1/devobj/sb/nb_486/export/at386/usr/shlib -L/project/dce/build/dce1.1-snap/export/at386/usr/shlib -L/usr/shlib -L/u1/devobj/sb/nb_486/export/at386/usr/lib     -L/project/dce/build/dce1.1-snap/export/at386/usr/lib   -o gdscacheadm.X d20frame.o    -lcurses -ladmv2ec -ladmschc -ldupdc  -laplv2c -lgda_util -ltermcap -ldce  
ld: No such file or directory for libaplv2c.a
collect: /project/dce/build/dce1.1-snap/tools/at386/macho/real-ld returned 1 exit status
*** Error code 1


[ /directory/gds/cacheadm/adm_iapl at 23:22 (PM) Tuesday ]
makepath adm_iapl/. && cd adm_iapl &&  exec make MAKEFILE_PASS=THIRD     build_all
adm_iapl: created directory
make: don't know how to make mess.o

[ /directory/gds/cacheadm/adm_iapl at 00:42 (AM) Wednesday ]
makepath adm_iapl/. && cd adm_iapl &&  exec make MAKEFILE_PASS=BASIC     build_all
make: don't know how to make mess.o (continuing)



CR Number                     : 11039
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : cds
Subcomponent Name             : 
Short Description             : Errors on cell shutdown
Reported Date                 : 6/22/94
Found in Baseline             : 1.1
Found Date                    : 6/22/94
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 11239
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[6/22/94 public]

I found the following problems on shutting down a cell installed from the
NB0621:  (on both 486 and HPUX)

        selection:  4
S:****** Attempting to stop all running DCE daemons...

        Enter Cell Administrator's principal name: (cell_admin)   
        Enter password: 

1994-06-22-10:31:24.811-04:00I----- cdsclerk(22279) WARNING cds clerk 0x00469358
Exit due to signal number 15 request
1994-06-22-10:31:25.051-04:00I----- cdsclerk(22293) WARNING cds clerk 0x00469358
Exit due to signal number 15 request
1994-06-22-10:31:36.150-04:00I----- cdsd(22146) ERROR cds server 0x0079dd30
Routine rpc_ep_unregister(3rpc) for clerk/server interface failed: not registered in endpoint map (dce / rpc)
1994-06-22-10:31:36.700-04:00I----- cdsd(22146) ERROR cds server 0x0079dd30
Routine rpc_ep_unregister(3rpc) for dacl interface failed: not registered in endpoint map (dce / rpc)
S:****** Successfully stopped all running DCE daemons.

All daemons have stopped.

[6/22/94 public]
Some of these errors will go away when dce_shutdown is used,
some may need to be re-evaluated as to weather they are really
errors that should come to the screen.

Anyway, this defect belongs in cds since its the one doing the
complaining and there isn't much dce_shutdown can do to stop it.

[7/14/94 public]
Made it a dup 11272 when it should have been 11239



CR Number                     : 11038
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : i486
S/W Ref Platform              : osf1
Component Name                : dced
Subcomponent Name             : 
Short Description             : failures with secval service
Reported Date                 : 6/22/94
Found in Baseline             : 1.1
Found Date                    : 6/22/94
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 11027
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[6/22/94 public]
Installed 'Beta' dce. (BL-10)
Brought of a simple cell with rpcd
killed sec_clientd.
I built dced using the sources from the backing tree.

dced -di
dced -def 

Ran all the dced api tests - 
	all the tests excepts for secval tests pass.


	secval tests fail with rpc_s_no_more_bindings(382312629)
	during binding_create.

	observation:
	binding_create with format /.:/host/config/service for secval
	service passes, while other formats fail.


	ofcourse, then secval_start returns with
	rpc_s_bad_binding(289255524), when that binding handle is used.

[6/28/94 public]
This bug is caused by the failure of rpc_ns_binding_import_next() in
dced_binding_create() and is a duplicate of OT#11027.



CR Number                     : 11019
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dcecp
Subcomponent Name             : secval
Short Description             : secval activate command core
dumps dcecp
Reported Date                 : 6/21/94
Found in Baseline             : 1.1
Found Date                    : 6/21/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 10948
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[6/21/94 public]

Nightly build of 6/20:

dcecp> secval activate

Causes a core dump of dcecp.  Other dced operations seem to be working.

[6/21/94 public]

Try "secval activate hosts/your-host-name", if it doesn't core dump, 
please mark it as dup of CR10948.

[6/21/94 public]

This form of the 'secval' command does not work, no core dump, it does not
recognize the host name:

  dcecp> secval activate hosts/oscar
  Error: Unrecognized hostname 'hosts/oscar'.
  dcecp> secval activate oscar
  Error: Unrecognized hostname 'oscar'.

Won't mark as dupe just yet.

[6/21/94 public]
Yes, the reason is the checking of return of dced_binding_create() didn't
cover the NULL hostname case and if hostname is not NULL and the 
dced_binding_create() fails it assume the hostname is incorrect. This has
been fixed and I'll check it in soon. The OT is a duplicate of CR10948,
as well as last half of Prasad's CR11027.



CR Number                     : 11001
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : Intercell.
Short Description             : Authenticated intercell
doesn't work.
Reported Date                 : 6/17/94
Found in Baseline             : 1.1
Found Date                    : 6/17/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 11623
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[6/17/94 public]
Created a new CR from CR 10932 which included intercell bug info.

[6/13/94 public]
I'm attempting to verify authenticated intercell operation against the
nightly from 6/13. After updating the bind database I can do show dirs
accross the intercell boundary unauthenticated. I then run the rgy_edit cell
command to exchange tickets and am able to show dir authenticated. However
when I do a dce_login from one cell to another and create a directory in
the cell I have logged into it failes with registery server unavailable.
The following is from a rios to a 486 but I'm got the same thig from an
hp to a 486 and from a 486 to the rios.

# cdscp create dir /.../john.qadce.osf.org/foo
1994-06-13-17:00:42.274-04:00I----- cdsclerk(8096) ERROR cds clerk 0x2025c5d8
Routine rpc_binding_set_auth_info(3rpc) failed : Registry server unavailable (dce / sec)
1994-06-13-17:00:42.313-04:00I----- cdsclerk(8096) WARNING cds clerk 0x2025c5d8
Communication has failed to /.../john.qadce.osf.org/balder_ch. Status = 387063931.
# 1994-06-13-17:01:12.062-04:00I----- cdsclerk(8096) ERROR cds clerk 0x2025c5d8
Routine rpc_binding_set_auth_info(3rpc) failed : Registry server unavailable (dce / sec)
1994-06-13-17:01:12.100-04:00I----- cdsclerk(8096) WARNING cds clerk 0x2025c5d8
Communication has failed to /.../jd.qadce.osf.org/wolfboy_ch. Status = 387063931


klist behaves very strangely. It takes a long time to put out the erroneous
information up to the '+++++++++++++' in the following. It then spits out the 
correct information normally.

DCE Identity Information:
        Warning: Identity information is not certified
        Global Principal: <Unable to generate principal name>
        Cell:      004b0e9c-b9e8-1dfc-87e0-0000c03fd04c <cell name unknown>
        Principal: 00000064-b9e8-2dfc-8700-0000c03fd04c <principal name unknown>
        Group:     0000000c-b9e8-2dfc-8701-0000c03fd04c <group name unknown>
        Local Groups:
                0000000c-b9e8-2dfc-8701-0000c03fd04c <group name unknown>
                00000844-ba0a-2dfc-a301-0000c03fd04c <group name unknown>
                00000845-ba0b-2dfc-a301-0000c03fd04c <group name unknown>
                00000846-ba0b-2dfc-a301-0000c03fd04c <group name unknown>
                00000847-ba0b-2dfc-a301-0000c03fd04c <group name unknown>

Identity Info Expires: 94/06/14:02:40:32
Account Expires:       never
Passwd Expires:        never

'++++++++++++++'

Kerberos Ticket Information:
Ticket cache: /opt/dcelocal/var/security/creds/dcecred_34c04e00
Default principal: cell_admin@john.qadce.osf.org
Server: krbtgt/john.qadce.osf.org@john.qadce.osf.org
        valid 94/06/13:16:40:32 to 94/06/14:02:40:32
Server: dce-rgy@john.qadce.osf.org
        valid 94/06/13:16:40:33 to 94/06/14:02:40:32
Server: krbtgt/jd.qadce.osf.org@john.qadce.osf.org
        valid 94/06/13:16:40:34 to 94/06/14:02:40:32
Server: dce-rgy@jd.qadce.osf.org
        valid 94/06/13:16:40:45 to 94/06/14:02:40:32
Server: dce-ptgt@john.qadce.osf.org
        valid 94/06/13:16:52:49 to 94/06/13:18:52:49
Client: dce-ptgt@john.qadce.osf.org     Server: krbtgt/john.qadce.osf.org@john.qadce.osf.org
        valid 94/06/13:16:52:49 to 94/06/13:18:52:49
Client: dce-ptgt@john.qadce.osf.org     Server: krbtgt/jd.qadce.osf.org@john.qadce.osf.org
        valid 94/06/13:16:52:50 to 94/06/13:18:52:49
Client: dce-ptgt@john.qadce.osf.org     Server: dce-ptgt@jd.qadce.osf.org
        valid 94/06/13:16:53:02 to 94/06/13:18:52:49

My secd and sec_clientd are running.

# ps -ef | grep sec
    root  3103     1   0 15:56:47  pts/2  0:10 sec_clientd 
    root  9233     1   0 15:56:22  pts/2  0:43 secd -bootstrap 
    root 13112 13504   1 17:01:02  pts/2  0:00 grep sec

[6/14/94 public]

I got you mail requesting that I turn on DEBUG_SEC=3. I did and here
is the result. Its a bit long....

The two cells are /.../john.qadce.osf.org a 486
              and /.../dugas.qadce.osf.org an hp

The following was run from the 486.

secd and sec_clientd was alive before and after.

These are the commands

klist - no identity
cdscp show dir /.../dugas.qadce.osf.org - worked
dce_login cell_admin -passwd-  - worked
rgy_edit - ran cell /.../dugas.qadce.osf.org - worked
klist - local identity
exit
klist - no identity
dce_login /.../dugas.qadce.osf.org/cell_admin -passwd-  - worked
cdscp create dir /.../dugas.qadce.osf.org/users  - failed
cdscp show dir /.../dugas.qadce.osf.org - failed
klist - Got in mustery state for a while then came out of it and spit out
        context.


Heres the log for the above. All of the actual commands are on lines
that start with a $.



#
# From /.../john.qadce.osf.org
#

#
# Unauthenticated show of /.../digas.qadce.osf.org works
#

$ klist
No DCE identity available: No currently established network identity for which context exists (dce / sec)

Kerberos Ticket Information:
klist: Unknown code DCE:krb 191 (336761023) while setting cache flags (ticket cache /opt/dcelocal/var/security/creds/dcecred_22fb2200)
$ cdscp show dir /.../dugas.qadce.osf.org
Warning: you have no network credentials. All requests will be unauthenticated.

                        SHOW
                   DIRECTORY   /.../dugas.qadce.osf.org
                          AT   1994-06-14-10:30:17
            RPC_ClassVersion = 0100
                     CDS_CTS = 1994-06-14-14:24:42.056242100/08-00-09-25-e3-2c
                     CDS_UTS = 1994-06-14-14:25:04.046289100/08-00-09-25-e3-2c
              CDS_ObjectUUID = 5c7a5ecc-8784-11cd-bd64-08000925e32c
                CDS_Replicas = :
          Clearinghouse UUID = 5af329c6-8784-11cd-bd64-08000925e32c
                       Tower = ncacn_ip_tcp:130.105.5.44[]
                       Tower = ncadg_ip_udp:130.105.5.44[]
                Replica type = master
          Clearinghouse Name = /.../dugas.qadce.osf.org/vanilla_ch
                 CDS_AllUpTo = 0
             CDS_Convergence = medium
                CDS_InCHName = allowed
        CDS_DirectoryVersion = 3.0
            CDS_ReplicaState = on
             CDS_ReplicaType = master
               CDS_LastSkulk = 1994-06-14-14:24:42.056242100/08-00-09-25-e3-2c
              CDS_LastUpdate = 1994-06-14-14:29:45.319150100/08-00-09-25-e3-2c
             CDS_RingPointer = 5af329c6-8784-11cd-bd64-08000925e32c
                   CDS_Epoch = 5c7a597c-8784-11cd-bd64-08000925e32c
          CDS_ReplicaVersion = 3.0

#
# Login into local cell, /.../john.qadce.osf.org, and do cell command to
# other cell, /.../dugas.qadce.osf.org
#
$ dce_login cell_admin -dce-
(binding_cache_lookup) Looking for site /.../john.qadce.osf.org, cell , princ dce-rgy, type 0
(binding_cache_lookup) Cache miss
(rca_site_bind_nsi) Attempting to bind to site /.../john.qadce.osf.org
(rca_site_bind_nsi) import_next failed, status 16c9a0b5
(rca_site_bind_nsi_cell) Attempting to bind to cell /.../john.qadce.osf.org
(rca_site_bind_nsi_cell) Trying rs_bind interface
(rca_site_bind_nsi_cell) about to call rca_setup_handle; rpc_handle==481448
(rca_setup_handle) bind succeeded -- setting up handle
(rca_setup_handle) req. site name is /.../john.qadce.osf.org, status 0
(rca_setup_handle) Replace entry name with /.../john.qadce.osf.org/subsys/dce/sec/master
(rca_site_bind) Bound to Cell '/.../john.qadce.osf.org'
(rca_site_bind) Bound to Site '/.../john.qadce.osf.org/subsys/dce/sec/master'
(rca_site_bind) String Binding  '000971be-bce5-1dfd-a815-0000c03fd04c@ncadg_ip_udp:130.105.5.12[2547]'
(binding_cache_enter) Adding 481148 to binding cache: site /.../john.qadce.osf.org/subsys/dce/sec/master cell /.../john.qadce.osf.org princ (null) type 0
481148: Dropping site refcount from 2 to 1
(binding_cache_lookup) Looking for site /.../john.qadce.osf.org, cell /.../john.qadce.osf.org, princ (null), type 0
(binding_cache_lookup) Looking at 481148: site `/.../john.qadce.osf.org/subsys/dce/sec/master' cell `/.../john.qadce.osf.org' princ `(null)' 0
(binding_cache_lookup) Cache hit: returning 481148
returning cached context 481148
481148: Dropping site refcount from 2 to 1
(binding_cache_lookup) Looking for site /.../john.qadce.osf.org, cell /.../john.qadce.osf.org, princ dce-rgy, type 1
(binding_cache_lookup) Looking at 481148: site `/.../john.qadce.osf.org/subsys/dce/sec/master' cell `/.../john.qadce.osf.org' princ `(null)' 0
info_type mismatch, dce expected
(binding_cache_lookup) Cache miss
(rca_site_bind) bumping ref on identity 477070
(rca_site_bind_nsi_cell) Attempting to bind to cell /.../john.qadce.osf.org
(rca_site_bind_nsi_cell) Trying rs_bind interface
(rca_site_bind_nsi_cell) about to call rca_setup_handle; rpc_handle==481848
(rca_setup_handle) bind succeeded -- setting up handle
(rca_setup_handle) req. site name is /.../john.qadce.osf.org, status 0
(rca_setup_handle) Replace entry name with /.../john.qadce.osf.org/subsys/dce/sec/master
(rca_setup_handle) Auth DCE, principal 'dce-rgy@john.qadce.osf.org'
(rca_setup_handle) rpc_binding_set_auth_info, identity 477070, handle 481848
(binding_cache_lookup) Looking for site /.../john.qadce.osf.org, cell /.../john.qadce.osf.org, princ (null), type 0
(binding_cache_lookup) Looking at 481148: site `/.../john.qadce.osf.org/subsys/dce/sec/master' cell `/.../john.qadce.osf.org' princ `(null)' 0
(binding_cache_lookup) Cache hit: returning 481148
returning cached context 481148
481148: Dropping site refcount from 2 to 1
(rca_setup_handle) end set_auth_info identity 477070
(rca_site_bind) Bound to Cell '/.../john.qadce.osf.org'
(rca_site_bind) Bound to Site '/.../john.qadce.osf.org/subsys/dce/sec/master'
(rca_site_bind) String Binding  '000971be-bce5-1dfd-a815-0000c03fd04c@ncadg_ip_udp:130.105.5.12[]'
Purging binding cache
(binding_cache_enter) Adding 481748 to binding cache: site /.../john.qadce.osf.org/subsys/dce/sec/master cell /.../john.qadce.osf.org princ dce-rgy@john.qadce.osf.org type 1
481748: Dropping site refcount from 2 to 1
Password must be changed!


$ rgy_edit 
(binding_cache_lookup) Looking for site /.../john.qadce.osf.org, cell , princ dce-rgy, type 1
(binding_cache_lookup) Cache miss
(rca_site_bind) bumping ref on identity 52ca28
(rca_site_bind_nsi) Attempting to bind to site /.../john.qadce.osf.org
(rca_site_bind_nsi) import_next failed, status 16c9a0b5
(rca_site_bind_nsi_cell) Attempting to bind to cell /.../john.qadce.osf.org
(rca_site_bind_nsi_cell) Trying rs_bind interface
(rca_site_bind_nsi_cell) about to call rca_setup_handle; rpc_handle==4ca900
(rca_setup_handle) bind succeeded -- setting up handle
(rca_setup_handle) req. site name is /.../john.qadce.osf.org, status 0
(rca_setup_handle) Replace entry name with /.../john.qadce.osf.org/subsys/dce/sec/master
(rca_setup_handle) Auth DCE, principal 'dce-rgy@john.qadce.osf.org'
(rca_setup_handle) rpc_binding_set_auth_info, identity 52ca28, handle 4ca900
(binding_cache_lookup) Looking for site /.../john.qadce.osf.org, cell , princ dce-rgy, type 0
(binding_cache_lookup) Cache miss
(rca_site_bind_nsi_cell) Attempting to bind to cell /.../john.qadce.osf.org
(rca_site_bind_nsi_cell) Trying caller-specified interface
(rca_site_bind_nsi_cell) rs_bind import_next failed, status 16c9a0b5
(rca_site_bind_nsi_cell) failed, status 16c9a0b5
(rca_nsi_binding_import) attempting to re-import
(rca_site_bind_nsi_cell) Attempting to bind to cell /.../john.qadce.osf.org
(rca_site_bind_nsi_cell) Trying caller-specified interface
(rca_site_bind_nsi_cell) rs_bind import_next failed, status 16c9a0b5
(rca_site_bind_nsi_cell) failed, status 16c9a0b5
(rca_site_bind_pe_site) calling get_site_bindings
(rca_get_site_bindings) about to open config file
(rca_get_site_bindings) Got binding 000971be-bce5-1dfd-a815-0000c03fd04c@ncacn_ip_tcp:130.105.5.12[]
(rca_bind_to_host) Successful bind.
(rca_get_site_bindings) bind_to_host succeeded
(rca_get_site_bindings) Got binding 000971be-bce5-1dfd-a815-0000c03fd04c@ncadg_ip_udp:130.105.5.12[]
(rca_bind_to_host) Successful bind.
(rca_get_site_bindings) bind_to_host succeeded
(rca_site_bind_pe_site) returned successfully from rca_get_site_bindings
(rca_rebind) Took alt_handle 0 from context
(rca_setup_handle) bind succeeded -- setting up handle
(rca_setup_handle) req. site name is /.../john.qadce.osf.org, status 16c9a0c1
(rca_setup_handle) No entry name -- status 16c9a0c1.  Falling back to site == /.../john.qadce.osf.org
(rca_site_bind) Bound to Cell '/.../john.qadce.osf.org'
(rca_site_bind) Bound to Site '/.../john.qadce.osf.org'
(rca_site_bind) String Binding  '000971be-bce5-1dfd-a815-0000c03fd04c@ncacn_ip_tcp:130.105.5.12[3607]'
(binding_cache_enter) Adding 4cab00 to binding cache: site /.../john.qadce.osf.org cell /.../john.qadce.osf.org princ (null) type 0
(binding_cache_lookup) Looking for site /.../john.qadce.osf.org, cell /.../john.qadce.osf.org, princ (null), type 0
(binding_cache_lookup) Looking at 4cab00: site `/.../john.qadce.osf.org' cell `/.../john.qadce.osf.org' princ `(null)' 0
(binding_cache_lookup) Cache hit: returning 4cab00
returning cached context 4cab00
4cab00: Dropping site refcount from 3 to 2
4cab00: Dropping site refcount from 2 to 1
(binding_cache_lookup) Looking for site /.../john.qadce.osf.org, cell /.../john.qadce.osf.org, princ (null), type 0
(binding_cache_lookup) Looking at 4cab00: site `/.../john.qadce.osf.org' cell `/.../john.qadce.osf.org' princ `(null)' 0
(binding_cache_lookup) Cache hit: returning 4cab00
returning cached context 4cab00
4cab00: Dropping site refcount from 2 to 1
(rca_setup_handle) end set_auth_info identity 52ca28
(rca_site_bind) Bound to Cell '/.../john.qadce.osf.org'
(rca_site_bind) Bound to Site '/.../john.qadce.osf.org/subsys/dce/sec/master'
(rca_site_bind) String Binding  '000971be-bce5-1dfd-a815-0000c03fd04c@ncadg_ip_udp:130.105.5.12[2547]'
Purging binding cache
(binding_cache_enter) Adding 4ca600 to binding cache: site /.../john.qadce.osf.org/subsys/dce/sec/master cell /.../john.qadce.osf.org princ dce-rgy@john.qadce.osf.org type 1
Current site is: registry server at /.../john.qadce.osf.org/subsys/dce/sec/master 
rgy_edit=> cell /.../dugas.qadce.osf.org
Enter group name of the local account for the foreign cell: none
Enter group name of the foreign account for the local cell: none
Enter org name of the local account for the foreign cell: none
Enter org name of the foreign account for the local cell: none
Enter your password:   
Enter account id to log into foreign cell with: cell_admin
Enter password for foreign account: 
Enter expiration date [yy/mm/dd or 'none']: (none) 
(binding_cache_lookup) Looking for site /.../dugas.qadce.osf.org, cell , princ dce-rgy, type 0
(binding_cache_lookup) Looking at 4ca600: site `/.../john.qadce.osf.org/subsys/dce/sec/master' cell `/.../john.qadce.osf.org' princ `dce-rgy@john.qadce.osf.org' 1
Site mismatch
(binding_cache_lookup) Looking at 4cab00: site `/.../john.qadce.osf.org' cell `/.../john.qadce.osf.org' princ `(null)' 0
Site mismatch
(binding_cache_lookup) Cache miss
(rca_site_bind_nsi) Attempting to bind to site /.../dugas.qadce.osf.org
(rca_site_bind_nsi) import_next failed, status 16c9a0b5
(rca_site_bind_nsi_cell) Attempting to bind to cell /.../dugas.qadce.osf.org
(rca_site_bind_nsi_cell) Trying rs_bind interface
(rca_site_bind_nsi_cell) about to call rca_setup_handle; rpc_handle==4caf00
(rca_setup_handle) bind succeeded -- setting up handle
(rca_setup_handle) req. site name is /.../dugas.qadce.osf.org, status 0
(rca_setup_handle) Replace entry name with /.../dugas.qadce.osf.org/subsys/dce/sec/master
(rca_site_bind) Bound to Cell '/.../dugas.qadce.osf.org'
(rca_site_bind) Bound to Site '/.../dugas.qadce.osf.org/subsys/dce/sec/master'
(rca_site_bind) String Binding  'f9243bcc-8783-11cd-95f2-08000925e32c@ncacn_ip_tcp:130.105.5.44[3197]'
Purging binding cache
(binding_cache_enter) Adding 4cb200 to binding cache: site /.../dugas.qadce.osf.org/subsys/dce/sec/master cell /.../dugas.qadce.osf.org princ (null) type 0
4cb200: Dropping site refcount from 2 to 1
4cb100: Dropping site refcount from 1 to 0
(binding_cache_lookup) Looking for site /.../john.qadce.osf.org, cell , princ dce-rgy, type 0
(binding_cache_lookup) Looking at 4cb200: site `/.../dugas.qadce.osf.org/subsys/dce/sec/master' cell `/.../dugas.qadce.osf.org' princ `(null)' 0
Site mismatch
(binding_cache_lookup) Looking at 4ca600: site `/.../john.qadce.osf.org/subsys/dce/sec/master' cell `/.../john.qadce.osf.org' princ `dce-rgy@john.qadce.osf.org' 1
info_type mismatch, none expected
(binding_cache_lookup) Looking at 4cab00: site `/.../john.qadce.osf.org' cell `/.../john.qadce.osf.org' princ `(null)' 0
(binding_cache_lookup) Cache hit: returning 4cab00
returning cached context 4cab00
(binding_cache_lookup) Looking for site /.../dugas.qadce.osf.org, cell /.../dugas.qadce.osf.org, princ dce-rgy, type 0
(binding_cache_lookup) Looking at 4cb200: site `/.../dugas.qadce.osf.org/subsys/dce/sec/master' cell `/.../dugas.qadce.osf.org' princ `(null)' 0
(binding_cache_lookup) Cache hit: returning 4cb200
returning cached context 4cb200
4cb200: Dropping site refcount from 2 to 1
4cab00: Dropping site refcount from 2 to 1
(binding_cache_lookup) Looking for site /.../dugas.qadce.osf.org, cell /.../dugas.qadce.osf.org, princ (null), type 0
(binding_cache_lookup) Looking at 4cb200: site `/.../dugas.qadce.osf.org/subsys/dce/sec/master' cell `/.../dugas.qadce.osf.org' princ `(null)' 0
(binding_cache_lookup) Cache hit: returning 4cb200
returning cached context 4cb200
4cb200: Dropping site refcount from 2 to 1
(binding_cache_lookup) Looking for site /.../dugas.qadce.osf.org, cell /.../dugas.qadce.osf.org, princ dce-rgy, type 1
(binding_cache_lookup) Looking at 4cb200: site `/.../dugas.qadce.osf.org/subsys/dce/sec/master' cell `/.../dugas.qadce.osf.org' princ `(null)' 0
info_type mismatch, dce expected
(binding_cache_lookup) Looking at 4ca600: site `/.../john.qadce.osf.org/subsys/dce/sec/master' cell `/.../john.qadce.osf.org' princ `dce-rgy@john.qadce.osf.org' 1
Site mismatch
(binding_cache_lookup) Looking at 4cab00: site `/.../john.qadce.osf.org' cell `/.../john.qadce.osf.org' princ `(null)' 0
Site mismatch
(binding_cache_lookup) Cache miss
(rca_site_bind) bumping ref on identity 55e8e8
(rca_site_bind_nsi_cell) Attempting to bind to cell /.../dugas.qadce.osf.org
(rca_site_bind_nsi_cell) Trying rs_bind interface
(rca_site_bind_nsi_cell) about to call rca_setup_handle; rpc_handle==5e5700
(rca_setup_handle) bind succeeded -- setting up handle
(rca_setup_handle) req. site name is /.../dugas.qadce.osf.org, status 0
(rca_setup_handle) Replace entry name with /.../dugas.qadce.osf.org/subsys/dce/sec/master
(rca_setup_handle) Auth DCE, principal 'dce-rgy@dugas.qadce.osf.org'
(rca_setup_handle) rpc_binding_set_auth_info, identity 55e8e8, handle 5e5700
(binding_cache_lookup) Looking for site /.../dugas.qadce.osf.org, cell /.../dugas.qadce.osf.org, princ (null), type 0
(binding_cache_lookup) Looking at 4cb200: site `/.../dugas.qadce.osf.org/subsys/dce/sec/master' cell `/.../dugas.qadce.osf.org' princ `(null)' 0
(binding_cache_lookup) Cache hit: returning 4cb200
returning cached context 4cb200
4cb200: Dropping site refcount from 2 to 1
(rca_setup_handle) end set_auth_info identity 55e8e8
(rca_site_bind) Bound to Cell '/.../dugas.qadce.osf.org'
(rca_site_bind) Bound to Site '/.../dugas.qadce.osf.org/subsys/dce/sec/master'
(rca_site_bind) String Binding  'f9243bcc-8783-11cd-95f2-08000925e32c@ncadg_ip_udp:130.105.5.44[]'
Purging binding cache
(binding_cache_enter) Adding 4cb100 to binding cache: site /.../dugas.qadce.osf.org/subsys/dce/sec/master cell /.../dugas.qadce.osf.org princ dce-rgy@dugas.qadce.osf.org type 1
4cb100: Dropping site refcount from 2 to 1
(binding_cache_lookup) Looking for site /.../john.qadce.osf.org, cell , princ dce-rgy, type 1
(binding_cache_lookup) Looking at 4cb100: site `/.../dugas.qadce.osf.org/subsys/dce/sec/master' cell `/.../dugas.qadce.osf.org' princ `dce-rgy@dugas.qadce.osf.org' 1
Site mismatch
(binding_cache_lookup) Looking at 4cb200: site `/.../dugas.qadce.osf.org/subsys/dce/sec/master' cell `/.../dugas.qadce.osf.org' princ `(null)' 0
Site mismatch
(binding_cache_lookup) Looking at 4ca600: site `/.../john.qadce.osf.org/subsys/dce/sec/master' cell `/.../john.qadce.osf.org' princ `dce-rgy@john.qadce.osf.org' 1
authz_svc mismatch
(binding_cache_lookup) Looking at 4cab00: site `/.../john.qadce.osf.org' cell `/.../john.qadce.osf.org' princ `(null)' 0
info_type mismatch, dce expected
(binding_cache_lookup) Cache miss
(rca_site_bind) bumping ref on identity 55e8e8
(rca_site_bind_nsi_cell) Attempting to bind to cell /.../john.qadce.osf.org
(rca_site_bind_nsi_cell) Trying rs_bind interface
(rca_site_bind_nsi_cell) about to call rca_setup_handle; rpc_handle==5e5b00
(rca_setup_handle) bind succeeded -- setting up handle
(rca_setup_handle) req. site name is /.../john.qadce.osf.org, status 0
(rca_setup_handle) Replace entry name with /.../john.qadce.osf.org/subsys/dce/sec/master
(rca_setup_handle) Auth DCE, principal 'dce-rgy@john.qadce.osf.org'
(rca_setup_handle) rpc_binding_set_auth_info, identity 55e8e8, handle 5e5b00
(binding_cache_lookup) Looking for site /.../dugas.qadce.osf.org, cell /.../dugas.qadce.osf.org, princ (null), type 0
(binding_cache_lookup) Looking at 4cb100: site `/.../dugas.qadce.osf.org/subsys/dce/sec/master' cell `/.../dugas.qadce.osf.org' princ `dce-rgy@dugas.qadce.osf.org' 1
info_type mismatch, none expected
(binding_cache_lookup) Looking at 4cb200: site `/.../dugas.qadce.osf.org/subsys/dce/sec/master' cell `/.../dugas.qadce.osf.org' princ `(null)' 0
(binding_cache_lookup) Cache hit: returning 4cb200
returning cached context 4cb200
4cb200: Dropping site refcount from 2 to 1
(rca_setup_handle) end set_auth_info identity 55e8e8
(rca_setup_handle) rpc_binding_set_auth_info returned status 14129007
(rca_site_bind_nsi_cell) about to call rca_setup_handle; rpc_handle==5e5a00
(rca_setup_handle) bind succeeded -- setting up handle
(rca_setup_handle) req. site name is /.../john.qadce.osf.org, status 0
(rca_setup_handle) Replace entry name with /.../john.qadce.osf.org/subsys/dce/sec/master
(rca_setup_handle) Auth DCE, principal 'dce-rgy@john.qadce.osf.org'
(rca_setup_handle) rpc_binding_set_auth_info, identity 55e8e8, handle 5e5a00
(binding_cache_lookup) Looking for site /.../dugas.qadce.osf.org, cell /.../dugas.qadce.osf.org, princ (null), type 0
(binding_cache_lookup) Looking at 4cb100: site `/.../dugas.qadce.osf.org/subsys/dce/sec/master' cell `/.../dugas.qadce.osf.org' princ `dce-rgy@dugas.qadce.osf.org' 1
info_type mismatch, none expected
(binding_cache_lookup) Looking at 4cb200: site `/.../dugas.qadce.osf.org/subsys/dce/sec/master' cell `/.../dugas.qadce.osf.org' princ `(null)' 0
(binding_cache_lookup) Cache hit: returning 4cb200
returning cached context 4cb200
4cb200: Dropping site refcount from 2 to 1
(rca_setup_handle) end set_auth_info identity 55e8e8
(rca_setup_handle) rpc_binding_set_auth_info returned status 14129007
(rca_site_bind_nsi_cell) rs_bind import_next failed, status 16c9a0b5
(rca_site_bind_nsi_cell) Trying caller-specified interface
(rca_site_bind_nsi_cell) about to call rca_setup_handle; rpc_handle==5e6200
(rca_setup_handle) bind succeeded -- setting up handle
(rca_setup_handle) req. site name is /.../john.qadce.osf.org, status 0
(rca_setup_handle) Replace entry name with /.../john.qadce.osf.org/subsys/dce/sec/master
(rca_setup_handle) Auth DCE, principal 'dce-rgy@john.qadce.osf.org'
(rca_setup_handle) rpc_binding_set_auth_info, identity 55e8e8, handle 5e6200
(binding_cache_lookup) Looking for site /.../dugas.qadce.osf.org, cell /.../dugas.qadce.osf.org, princ (null), type 0
(binding_cache_lookup) Looking at 4cb100: site `/.../dugas.qadce.osf.org/subsys/dce/sec/master' cell `/.../dugas.qadce.osf.org' princ `dce-rgy@dugas.qadce.osf.org' 1
info_type mismatch, none expected
(binding_cache_lookup) Looking at 4cb200: site `/.../dugas.qadce.osf.org/subsys/dce/sec/master' cell `/.../dugas.qadce.osf.org' princ `(null)' 0
(binding_cache_lookup) Cache hit: returning 4cb200
returning cached context 4cb200
4cb200: Dropping site refcount from 2 to 1
(rca_setup_handle) end set_auth_info identity 55e8e8
(rca_setup_handle) rpc_binding_set_auth_info returned status 14129007
(rca_site_bind_nsi_cell) about to call rca_setup_handle; rpc_handle==5e6100
(rca_setup_handle) bind succeeded -- setting up handle
(rca_setup_handle) req. site name is /.../john.qadce.osf.org, status 0
(rca_setup_handle) Replace entry name with /.../john.qadce.osf.org/subsys/dce/sec/master
(rca_setup_handle) Auth DCE, principal 'dce-rgy@john.qadce.osf.org'
(rca_setup_handle) rpc_binding_set_auth_info, identity 55e8e8, handle 5e6100
(binding_cache_lookup) Looking for site /.../dugas.qadce.osf.org, cell /.../dugas.qadce.osf.org, princ (null), type 0
(binding_cache_lookup) Looking at 4cb100: site `/.../dugas.qadce.osf.org/subsys/dce/sec/master' cell `/.../dugas.qadce.osf.org' princ `dce-rgy@dugas.qadce.osf.org' 1
info_type mismatch, none expected
(binding_cache_lookup) Looking at 4cb200: site `/.../dugas.qadce.osf.org/subsys/dce/sec/master' cell `/.../dugas.qadce.osf.org' princ `(null)' 0
(binding_cache_lookup) Cache hit: returning 4cb200
returning cached context 4cb200
4cb200: Dropping site refcount from 2 to 1
(rca_setup_handle) end set_auth_info identity 55e8e8
(rca_setup_handle) rpc_binding_set_auth_info returned status 14129007
(rca_site_bind_nsi_cell) rs_bind import_next failed, status 16c9a0b5
(rca_site_bind_nsi_cell) failed, status 16c9a0b5
(rca_nsi_binding_import) attempting to re-import
(rca_site_bind_nsi_cell) Attempting to bind to cell /.../john.qadce.osf.org
(rca_site_bind_nsi_cell) Trying rs_bind interface
(rca_site_bind_nsi_cell) about to call rca_setup_handle; rpc_handle==5f8758
(rca_setup_handle) bind succeeded -- setting up handle
(rca_setup_handle) req. site name is /.../john.qadce.osf.org, status 0
(rca_setup_handle) Replace entry name with /.../john.qadce.osf.org/subsys/dce/sec/master
(rca_setup_handle) Auth DCE, principal 'dce-rgy@john.qadce.osf.org'
(rca_setup_handle) rpc_binding_set_auth_info, identity 55e8e8, handle 5f8758
(binding_cache_lookup) Looking for site /.../dugas.qadce.osf.org, cell /.../dugas.qadce.osf.org, princ (null), type 0
(binding_cache_lookup) Looking at 4cb100: site `/.../dugas.qadce.osf.org/subsys/dce/sec/master' cell `/.../dugas.qadce.osf.org' princ `dce-rgy@dugas.qadce.osf.org' 1
info_type mismatch, none expected
(binding_cache_lookup) Looking at 4cb200: site `/.../dugas.qadce.osf.org/subsys/dce/sec/master' cell `/.../dugas.qadce.osf.org' princ `(null)' 0
(binding_cache_lookup) Cache hit: returning 4cb200
returning cached context 4cb200
4cb200: Dropping site refcount from 2 to 1
(rca_setup_handle) end set_auth_info identity 55e8e8
(rca_setup_handle) rpc_binding_set_auth_info returned status 14129007
(rca_site_bind_nsi_cell) about to call rca_setup_handle; rpc_handle==5f8858
(rca_setup_handle) bind succeeded -- setting up handle
(rca_setup_handle) req. site name is /.../john.qadce.osf.org, status 0
(rca_setup_handle) Replace entry name with /.../john.qadce.osf.org/subsys/dce/sec/master
(rca_setup_handle) Auth DCE, principal 'dce-rgy@john.qadce.osf.org'
(rca_setup_handle) rpc_binding_set_auth_info, identity 55e8e8, handle 5f8858
(binding_cache_lookup) Looking for site /.../dugas.qadce.osf.org, cell /.../dugas.qadce.osf.org, princ (null), type 0
(binding_cache_lookup) Looking at 4cb100: site `/.../dugas.qadce.osf.org/subsys/dce/sec/master' cell `/.../dugas.qadce.osf.org' princ `dce-rgy@dugas.qadce.osf.org' 1
info_type mismatch, none expected
(binding_cache_lookup) Looking at 4cb200: site `/.../dugas.qadce.osf.org/subsys/dce/sec/master' cell `/.../dugas.qadce.osf.org' princ `(null)' 0
(binding_cache_lookup) Cache hit: returning 4cb200
returning cached context 4cb200
4cb200: Dropping site refcount from 2 to 1
(rca_setup_handle) end set_auth_info identity 55e8e8
(rca_setup_handle) rpc_binding_set_auth_info returned status 14129007
(rca_site_bind_nsi_cell) rs_bind import_next failed, status 16c9a0b5
(rca_site_bind_nsi_cell) Trying caller-specified interface
(rca_site_bind_nsi_cell) about to call rca_setup_handle; rpc_handle==5f8c58
(rca_setup_handle) bind succeeded -- setting up handle
(rca_setup_handle) req. site name is /.../john.qadce.osf.org, status 0
(rca_setup_handle) Replace entry name with /.../john.qadce.osf.org/subsys/dce/sec/master
(rca_setup_handle) Auth DCE, principal 'dce-rgy@john.qadce.osf.org'
(rca_setup_handle) rpc_binding_set_auth_info, identity 55e8e8, handle 5f8c58
(binding_cache_lookup) Looking for site /.../dugas.qadce.osf.org, cell /.../dugas.qadce.osf.org, princ (null), type 0
(binding_cache_lookup) Looking at 4cb100: site `/.../dugas.qadce.osf.org/subsys/dce/sec/master' cell `/.../dugas.qadce.osf.org' princ `dce-rgy@dugas.qadce.osf.org' 1
info_type mismatch, none expected
(binding_cache_lookup) Looking at 4cb200: site `/.../dugas.qadce.osf.org/subsys/dce/sec/master' cell `/.../dugas.qadce.osf.org' princ `(null)' 0
(binding_cache_lookup) Cache hit: returning 4cb200
returning cached context 4cb200
4cb200: Dropping site refcount from 2 to 1
(rca_setup_handle) end set_auth_info identity 55e8e8
(rca_setup_handle) rpc_binding_set_auth_info returned status 14129007
(rca_site_bind_nsi_cell) about to call rca_setup_handle; rpc_handle==5f8b58
(rca_setup_handle) bind succeeded -- setting up handle
(rca_setup_handle) req. site name is /.../john.qadce.osf.org, status 0
(rca_setup_handle) Replace entry name with /.../john.qadce.osf.org/subsys/dce/sec/master
(rca_setup_handle) Auth DCE, principal 'dce-rgy@john.qadce.osf.org'
(rca_setup_handle) rpc_binding_set_auth_info, identity 55e8e8, handle 5f8b58
(binding_cache_lookup) Looking for site /.../dugas.qadce.osf.org, cell /.../dugas.qadce.osf.org, princ (null), type 0
(binding_cache_lookup) Looking at 4cb100: site `/.../dugas.qadce.osf.org/subsys/dce/sec/master' cell `/.../dugas.qadce.osf.org' princ `dce-rgy@dugas.qadce.osf.org' 1
info_type mismatch, none expected
(binding_cache_lookup) Looking at 4cb200: site `/.../dugas.qadce.osf.org/subsys/dce/sec/master' cell `/.../dugas.qadce.osf.org' princ `(null)' 0
(binding_cache_lookup) Cache hit: returning 4cb200
returning cached context 4cb200
4cb200: Dropping site refcount from 2 to 1
(rca_setup_handle) end set_auth_info identity 55e8e8
(rca_setup_handle) rpc_binding_set_auth_info returned status 14129007
(rca_site_bind_nsi_cell) rs_bind import_next failed, status 16c9a0b5
(rca_site_bind_nsi_cell) failed, status 16c9a0b5
(rca_site_bind_pe_site) calling get_site_bindings
(rca_get_site_bindings) about to open config file
(rca_get_site_bindings) Got binding 000971be-bce5-1dfd-a815-0000c03fd04c@ncacn_ip_tcp:130.105.5.12[]
(rca_bind_to_host) Successful bind.
(rca_get_site_bindings) bind_to_host succeeded
(rca_get_site_bindings) Got binding 000971be-bce5-1dfd-a815-0000c03fd04c@ncadg_ip_udp:130.105.5.12[]
(rca_bind_to_host) Successful bind.
(rca_get_site_bindings) bind_to_host succeeded
(rca_site_bind_pe_site) returned successfully from rca_get_site_bindings
(rca_rebind) Took alt_handle 0 from context
(rca_setup_handle) bind succeeded -- setting up handle
(rca_setup_handle) req. site name is /.../john.qadce.osf.org, status 16c9a0c1
(rca_setup_handle) No entry name -- status 16c9a0c1.  Falling back to site == /.../john.qadce.osf.org
(rca_setup_handle) Auth DCE, principal 'dce-rgy@john.qadce.osf.org'
(rca_setup_handle) rpc_binding_set_auth_info, identity 55e8e8, handle 5f8f58
(binding_cache_lookup) Looking for site /.../dugas.qadce.osf.org, cell /.../dugas.qadce.osf.org, princ (null), type 0
(binding_cache_lookup) Looking at 4cb100: site `/.../dugas.qadce.osf.org/subsys/dce/sec/master' cell `/.../dugas.qadce.osf.org' princ `dce-rgy@dugas.qadce.osf.org' 1
info_type mismatch, none expected
(binding_cache_lookup) Looking at 4cb200: site `/.../dugas.qadce.osf.org/subsys/dce/sec/master' cell `/.../dugas.qadce.osf.org' princ `(null)' 0
(binding_cache_lookup) Cache hit: returning 4cb200
returning cached context 4cb200
4cb200: Dropping site refcount from 2 to 1
(rca_setup_handle) end set_auth_info identity 55e8e8
(rca_setup_handle) rpc_binding_set_auth_info returned status 14129007
(rca_rebind) Took alt_handle 1 from context
(rca_setup_handle) bind succeeded -- setting up handle
(rca_setup_handle) req. site name is /.../john.qadce.osf.org, status 16c9a0c1
(rca_setup_handle) No entry name -- status 16c9a0c1.  Falling back to site == /.../john.qadce.osf.org
(rca_setup_handle) Auth DCE, principal 'dce-rgy@john.qadce.osf.org'
(rca_setup_handle) rpc_binding_set_auth_info, identity 55e8e8, handle 5f9058
(binding_cache_lookup) Looking for site /.../dugas.qadce.osf.org, cell /.../dugas.qadce.osf.org, princ (null), type 0
(binding_cache_lookup) Looking at 4cb100: site `/.../dugas.qadce.osf.org/subsys/dce/sec/master' cell `/.../dugas.qadce.osf.org' princ `dce-rgy@dugas.qadce.osf.org' 1
info_type mismatch, none expected
(binding_cache_lookup) Looking at 4cb200: site `/.../dugas.qadce.osf.org/subsys/dce/sec/master' cell `/.../dugas.qadce.osf.org' princ `(null)' 0
(binding_cache_lookup) Cache hit: returning 4cb200
returning cached context 4cb200
4cb200: Dropping site refcount from 2 to 1
(rca_setup_handle) end set_auth_info identity 55e8e8
(rca_setup_handle) rpc_binding_set_auth_info returned status 14129007
(rca_rebind) Non-nsi rebind failed
(rca_site_bind_pe_site) assuming /.../john.qadce.osf.org is string binding
5e5c00: Dropping site refcount from 1 to 0
Drop ref to identity 55e8e8 from binding cache
(binding_cache_lookup) Looking for site /.../john.qadce.osf.org, cell , princ dce-rgy, type 0
(binding_cache_lookup) Looking at 4cb100: site `/.../dugas.qadce.osf.org/subsys/dce/sec/master' cell `/.../dugas.qadce.osf.org' princ `dce-rgy@dugas.qadce.osf.org' 1
Site mismatch
(binding_cache_lookup) Looking at 4cb200: site `/.../dugas.qadce.osf.org/subsys/dce/sec/master' cell `/.../dugas.qadce.osf.org' princ `(null)' 0
Site mismatch
(binding_cache_lookup) Looking at 4ca600: site `/.../john.qadce.osf.org/subsys/dce/sec/master' cell `/.../john.qadce.osf.org' princ `dce-rgy@john.qadce.osf.org' 1
info_type mismatch, none expected
(binding_cache_lookup) Looking at 4cab00: site `/.../john.qadce.osf.org' cell `/.../john.qadce.osf.org' princ `(null)' 0
(binding_cache_lookup) Cache hit: returning 4cab00
returning cached context 4cab00
(binding_cache_lookup) Looking for site /.../dugas.qadce.osf.org, cell , princ dce-rgy, type 1
(binding_cache_lookup) Looking at 4cb100: site `/.../dugas.qadce.osf.org/subsys/dce/sec/master' cell `/.../dugas.qadce.osf.org' princ `dce-rgy@dugas.qadce.osf.org' 1
authz_svc mismatch
(binding_cache_lookup) Looking at 4cb200: site `/.../dugas.qadce.osf.org/subsys/dce/sec/master' cell `/.../dugas.qadce.osf.org' princ `(null)' 0
info_type mismatch, dce expected
(binding_cache_lookup) Looking at 4ca600: site `/.../john.qadce.osf.org/subsys/dce/sec/master' cell `/.../john.qadce.osf.org' princ `dce-rgy@john.qadce.osf.org' 1
Site mismatch
(binding_cache_lookup) Looking at 4cab00: site `/.../john.qadce.osf.org' cell `/.../john.qadce.osf.org' princ `(null)' 0
Site mismatch
(binding_cache_lookup) Cache miss
(rca_site_bind) bumping ref on identity 55e8e8
(rca_site_bind_nsi) Attempting to bind to site /.../dugas.qadce.osf.org
(rca_site_bind_nsi) import_next failed, status 16c9a0b5
(rca_site_bind_nsi_cell) Attempting to bind to cell /.../dugas.qadce.osf.org
(rca_site_bind_nsi_cell) Trying rs_bind interface
(rca_site_bind_nsi_cell) about to call rca_setup_handle; rpc_handle==5f9458
(rca_setup_handle) bind succeeded -- setting up handle
(rca_setup_handle) req. site name is /.../dugas.qadce.osf.org, status 0
(rca_setup_handle) Replace entry name with /.../dugas.qadce.osf.org/subsys/dce/sec/master
(rca_setup_handle) Auth DCE, principal 'dce-rgy@dugas.qadce.osf.org'
(rca_setup_handle) rpc_binding_set_auth_info, identity 55e8e8, handle 5f9458
(binding_cache_lookup) Looking for site /.../dugas.qadce.osf.org, cell , princ dce-rgy, type 0
(binding_cache_lookup) Looking at 4cb100: site `/.../dugas.qadce.osf.org/subsys/dce/sec/master' cell `/.../dugas.qadce.osf.org' princ `dce-rgy@dugas.qadce.osf.org' 1
info_type mismatch, none expected
(binding_cache_lookup) Looking at 4cb200: site `/.../dugas.qadce.osf.org/subsys/dce/sec/master' cell `/.../dugas.qadce.osf.org' princ `(null)' 0
(binding_cache_lookup) Cache hit: returning 4cb200
returning cached context 4cb200
(binding_cache_lookup) Looking for site /.../dugas.qadce.osf.org, cell /.../dugas.qadce.osf.org, princ (null), type 0
(binding_cache_lookup) Looking at 4cb100: site `/[greg 7/12/94 public]

I tried to reproduce this bug using the cdscp define cached server
command to botstrap intercell naming (connecting test cells using DNS 
is an incredibly laborious process here in chelmsford).  I was able to 
reproduce the bug only under the following circumstances.

1) configure cell A
2) configure cell B
3) connect cells A and B using the "cdscp> define cached server" and 
   "rgy_edit=> cell" commands

At this point, intercell was working just fine.

4) reconfigure cell A (but not cell B)
5) repeat step (3)

Now intercell is broken.  

I then spotted the following code snippet in the rgy_edit cell command code.

            /* Add foreign principal to the local cell */
            sec_rgy_pgo_add(context, sec_rgy_domain_person,
                            header.key.pname,
                            &header.item, &st);
            if (STATUS_EQUAL(&st, sec_rgy_name_exists)) {
                CLEAR_STATUS(&st);
            }

In the case of a reconfigured foreign cell, this would result
in a stale uuid for the foreign cell, which in  turn would
cause the local priv server to reject any requests for an intercell
PTGT that originate with the reconfigured foreign cell.  

There's still a bug here, but it is not an A0 bug.  I'm 
changing it to B1.

[7/13/94 public]
Greg asked Rajendra and I to do the above sequence here and we did just
prior to Rajendras leaving for vacation. 

1) configure cell A
2) configure cell B
3) run define cache server
4) run rgy_edit cell command
5) do things fromn one cell to another

We did and the following failed in step 5.

From cell A
dce_login /.../<dns name of cell B>/cell_admin -passwd-
cdscp create dir /.../<dns name of cell B>/foo

Unauthenticated commands - cdscp show dir /.: for example - worked as 
long as you ran them unauthenticated.

When we edited the PE_SITE files authenticated operations worked.

This gives me a work around for testing H-Cells, at least I believe it will.
I haven't gotten to it because of 11119.  Since I have a work around
I agree it is no longer an A0. But we here still believe authenticated
intercell does not work until the PE_SITE file is edited. Bear in mind such
operations don't fail every time but I'd say 9 out of 10 authenticated
dir creates for example will fail. Rajendra and I both saw this just prior
to his leaving for the month.



CR Number                     : 10991
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa,i486
S/W Ref Platform              : hpux,osf1
Component Name                : aud
Subcomponent Name             : 
Short Description             : ecfile_filter01 fails
Reported Date                 : 6/17/94
Found in Baseline             : 1.1
Found Date                    : 6/17/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 10764
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[6/17/94 public]
ecfile_filter01 fails on 486 and HP.  No further information available in
the journal or log.

[6/17/94 public]
aud_testec was dumping core.  Dupped to appropriate defect.



CR Number                     : 10989
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : aud
Subcomponent Name             : libaudit
Short Description             : api_filter01 fails
Reported Date                 : 6/17/94
Found in Baseline             : 1.1
Found Date                    : 6/17/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 10990
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[6/17/94 public]
api_filter01 fails on HP.  No further information availabe in journal or
log.

[6/17/94 public]
I'm duping this to 10990.  While rerunning the tests occaisionally
different test cases would fail, although api_filter03 seems to fail more
often than others.  (also saw 6 and 7 fail.)

Therefore, I think these are the same defects.



CR Number                     : 10984
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : i486
S/W Ref Platform              : osf1
Component Name                : cds
Subcomponent Name             : server
Short Description             : disabling cds server on a replica server made master causes problems
Reported Date                 : 6/16/94
Found in Baseline             : 1.1
Found Date                    : 6/16/94
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 11239
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[6/16/94 public]

Problem was found running the rep_ch_2_checklist test.

The sequence of steps is:

1) Create a test directory and object in master clearinghouse.
2) Create a readonly replica of test directory on a 2nd machine.
3) Exclude test directory from master clearinghouse
4) The replica on the 2nd machine is made the new master.
5) The original master is mad e a readonly replica
6) Disabling the server on the 2nd machine (new master) results in the
   following messages returned:

cdscp> disable server
cdscp> 1994-06-16-09:02:12.294-04:00I0.947 cdsd(25654) ERROR cds server 0x007990
48
Routine rpc_ep_unregister(3rpc) for clerk/server interface failed: not registere
d in endpoint map (dce / rpc)
1994-06-16-09:02:12.444-04:00I0.947 cdsd(25654) ERROR cds server 0x00799048
Routine rpc_ep_unregister(3rpc) for dacl interface failed: not registered in end
point map (dce / rpc)

Any subsequent commands in the test, such as attempting to clear the 
clearinghouse on the 2nd machine are unsuccessful.

The cell has to be reconfigured at this point, since the clearinghouse on the 
2nd machine is unreachable, and the test directory cannot be seen.

[7/15/94 public]
The above messages have nothing to do with the fact you are working with
a secondary clearinghouse. We wee the same error messages on a single machine
cell when cdsd is coming down as part of a normal shutdown. The cell does come
back up as should yours. Failure to unregister an endpoint cannot force a 
cell reconfiguration. When you restart the server the endpoints are reset
in any case. I see no indication above that any attempt to reenable the
server has been made. Until that is done the second clearinghouse is of 
course unreachable. 

The above messages are covered by ot 11239.



CR Number                     : 10966
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dcecp
Subcomponent Name             : era
Short Description             : Displaying encoding type bytes for era is incorrect
Reported Date                 : 6/15/94
Found in Baseline             : 1.1
Found Date                    : 6/15/94
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 11282
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : rgy_utils.c
Sensitivity                   : public

[6/15/94 public]

During the display of extended registry attributes, the current method
for displaying attributes with encoding type "bytes" is incorrect.

This is found in the show_era() function.

[7/14/94 public]

Superseded by 11282.



CR Number                     : 10936
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 8658
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : cds
Subcomponent Name             : 
Short Description             : Disabling clerks and removing cache causes problems with cdsd.
Reported Date                 : 6/12/94
Found in Baseline             : 1.0.3
Found Date                    : 6/12/94
Severity                      : D
Priority                      : 3
Status                        : dup
Duplicate Of                  : 8658
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[6/12/94 public]
The standard steps to test whether CDS caching is misbehaving are:
  cdscp disable clerk (kill cdsadv and cdsclerks)
  rm /var/dce/adm/directory/cds/*cache*
  rc.dce cdsadv (restart the Advertiser)

After doing this, if you attempt to do some cdscp commands, cdsd states that
it cannot find the root directory. Restarting cdsd fixes this problem.

Since the Advertiser was stopped without stopping the Server, the local 
socket which they shared is no longer valid.
It appears that the Advertiser and Server must be stopped together for
it to work properly.

At a minimum, this should be a documented restriction.

[6/14/94 public]
Are you working with the latest sources ?
(e.g. ./directory/cds/server/ta_adver.c rev 1.1.7.6)
This should be fixed now via CR#8658.
If not, what is your machine configuration? What cds commands?
Can I see a log of your actions?

[7/01/94 public]
This problem was reported on version 1.0.3.
I believe the "latest" version you refer to is for
DCE 1.1, is that correct?

If this has already been fixed in 1.1 (and it
sounds like it has), it can be closed.
Thanks.

[8/3/94]
Fixed in 1.1



CR Number                     : 10933
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : rpc
Subcomponent Name             : rpc runtime
Short Description             : incorrect exception value
received in CN
Reported Date                 : 6/11/94
Found in Baseline             : 1.0.3
Found Date                    : 6/11/94
Severity                      : C
Priority                      : 3
Status                        : dup
Duplicate Of                  : 10677
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[6/11/94 public]
IDL backend testcase pipefault failed with CN protocol

pipefault failed - unexpected CMA exception rpc_x_unknown_reject when
  the protocol is CN on both AIX and OS/2.

This problem was seen in DCE 1.0.3 on both AIX and OS/2, DCE 1.0.2
based OS/2 DCE, and DCE 1.1.

When protocol is ncacn_ip_tcp, the client displayed the messages
    "FAILURE: unexpected exception"
and "FAILURE: unexpected CMA exception rpc_x_unknown_reject"
after the message "Unbinding my-handle".

ncadg_ip_udp run ok without displaying the error messages.

Details:
The test server (in manager.c) intentionally tried to write to a
closed pipe.  RPC correctly raised rpc_x_ss_pipe_closed exception
in idl/lib/ndrmi3.c, rpc_ss_ndr_ee_marsh_pipe_chunk().

On the client side, in cncall.c, rpc__cn_call_transceive() received
the last fragment and checked the status.  The statement
    fault_code = RPC_CN_PTK_STUTUS(header_p);
set fault_code to 382312542 (16c9a05e), which translates to runtime
status: rpc_s_known_reject.

Except the rpc_x_ss_pipe_closed exception, tther pipe fault exceptions
: rpc_x_ss_pipe_empty, rpc_x_ss_pipe_order and
rpc_x_ss_pipe_discipline_error were correctly rasied, and the fault_code
in cncall.c on the client side was set to zero.

[6/13/94 public]

0x16c9a05e = rpc_s_call_orphaned . Sounds like CR 9550 to me.

[6/13/94 public]
Well, it certainly is a duplicate of 10677, which reported this test failure. 
I will try to fix 9550 and see if that fixes 10677.



CR Number                     : 10925
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : s12y
Short Description             : implement partial s12y in dfs
Reported Date                 : 6/9/94
Found in Baseline             : 1.1
Found Date                    : 6/9/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 12618
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : many
Sensitivity                   : public

[6/9/94 public]
This is a placeholder for the S12Y submissions to the DFS commands
and daemons.

[6/9/94 public]
Re-assigning to Ron S. since he's doing the work.



CR Number                     : 10902
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : dts
Subcomponent Name             : 
Short Description             : dtsd dies on startup
Reported Date                 : 6/8/94
Found in Baseline             : 1.1b10
Found Date                    : 6/8/94
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 10897
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[6/8/94 public]
dtsd dies on startup with the following message:

S:****** Configuring DTS Local Server...
S:****** Waiting for node self-identity to be established...
S:****** Starting dtsd...
Exception: fault invalid tag (dce / rpc)
S:****** Starting dtstimed...
S:****** This node is now a DTS local server.

This is only on the HP.

Code from 6/7/94 nightly build.

[6/8/94 public]
Starting dtsd by hand again worked.

[6/8/94 ]

This bug was reported earlier this morning.



CR Number                     : 10894
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : utils
Subcomponent Name             : svc
Short Description             : Wildcards in routing specification strings are not recognized
Reported Date                 : 6/8/94
Found in Baseline             : 1.1b9
Found Date                    : 6/8/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 10891
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[6/8/94 public]

A routing specification string may contain an asterisk in the first
position, if it specifies the routing for all severity levels. They are
not recognized by dce_dvc_routing. The code of line 660:

    all = strcmp((char *)where, "*") == 0;

does never set "all" to TRUE, as "where" does not contain EOS after the
'*' (but ':'), so "where" differs from "*" in all cases. The line should
change to

    all = *where == '*';

[06/08/94 public]
This is a dup of 10891 but thanks for giving me the fix. :-)
	all = where[0] == '*' && where[1] == SVC_SEP_CHAR;

[06/08/94 public]
Also I fixed the parsing to you can put "*:STDERR:" and such in
the default routing file now.



CR Number                     : 10878
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa,i486
S/W Ref Platform              : hpux,osf1
Component Name                : rpc
Subcomponent Name             : 
Short Description             : core smoketests fail while
setting ACLs
Reported Date                 : 6/7/94
Found in Baseline             : 1.1
Found Date                    : 6/7/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 10876
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[6/7/94 public]

I'm not sure which component is resposible so I've assigned this to SEC
bcause of the recent drop, and cc'd CDS and RPC.

We've run the core smoketests twice now, and each time the HPUX and AT486
core smoketests both fail during configuring with the following runtime
error that was also encountered by Kevin Sullivan.  On the HPUX:

S:****** Starting cdsd...
ERROR:   Error while setting ACLs on /.:
           Message from acl_edit:
           ERROR: communications failure (dce / rpc)
         Unable to bind to object /.:

And in the actual smoketest:

cdscp show server
connection request rejected (dce / rpc)
communications failure (dce / rpc)
communications failure (dce / rpc)
communications failure (dce / rpc)
cdscp show dir /.:

                        SHOW
                   DIRECTORY   /.../budapest_cell
                          AT   1994-06-07-07:42:42
Error on entity: /.../budapest_cell
connection request rejected (dce / rpc)
Function: dnsEnumAttr

cdscp list dir /.:
                        LIST
                   DIRECTORY   /.../budapest_cell
                          AT   1994-06-07-07:43:53
cdscp show clearinghouse /.:/budapest_ch

                        SHOW
               CLEARINGHOUSE   /.../budapest_cell/budapest_ch
                          AT   1994-06-07-07:44:29
Error on entity: /.../budapest_cell/budapest_ch
connection request rejected (dce / rpc)
Function: dnsEnumAttr

[6/7/94 public]
Already reported by Rich Z. These look like dups of 10852.



CR Number                     : 10861
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : cds
Subcomponent Name             : 
Short Description             : cdsadv doesn't always go away
Reported Date                 : 6/3/94
Found in Baseline             : 1.1
Found Date                    : 6/3/94
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 11239
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[6/3/94 public]
The advertizer doesn't always go away when it gets a sigterm. It seems to
dispatch the clerks and a second sigterm always sends it on its way. Its
probably missing notification that the clerks are gone. It actually has
the feel of a threads problem with sigchild but I'm not sure so I'll leave
this in cds for now. Its a fairly low priority because we have implemented
a fix for the shutdown problem in dce.clean by calling the disable clerk and
disable server instead of sending them sigterms. This is a better way to
shut things down anyway. I'm opening this as a holder to remind me that
cdsadv isn't handling sigterm quite right - or maybe threads isn't telling
it about its children being gone.

[6/7/94 public]
Submmitting a workaround to dce.clean to kill cdsadv twice.

[7/15/94 public]
I'm dup'ing this to 11239 because it contains a bit more information on 
similar problems in the server as well as the advertizer.



CR Number                     : 10854
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : sec
Subcomponent Name             : security/server/rrs/rrs_prop_replist.c 
					     security/server/rrs/rrs_rep_remote.c
Short Description             : include files rs_repadm.h, rs_replist.h not found
Reported Date                 : 6/3/94
Found in Baseline             : 1.1
Found Date                    : 6/3/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 10853
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[6/3/94 public]

[ /security/server/rrs at 22:42 (PM) Thursday ]

cc -c     -O  -DOSF_DCE -DDCESHARED_PATH=\"/opt/dce\" -DDCELOCAL_PATH=\"/opt/dcelocal\" -D_BSD -DBSD -DHAS_STDLIB_H  -D_ALL_SOURCE -DAIX32   -I. -I/u1/devobj/sb/nb_rios/src/security/server/rrs -I/project/dce/build/dce1.1-snap/src/security/server/rrs -I../../h -I/u1/devobj/sb/nb_rios/src/security/h -I/project/dce/build/dce1.1-snap/src/security/h -I../../idl -I/u1/devobj/sb/nb_rios/src/security/idl -I/project/dce/build/dce1.1-snap/src/security/idl -I../../utils -I/u1/devobj/sb/nb_rios/src/security/utils -I/project/dce/build/dce1.1-snap/src/security/utils -I/u1/devobj/sb/nb_rios/export/rios/usr/include -I/project/dce/build/dce1.1-snap/export/rios/usr/include   /project/dce/build/dce1.1-snap/src/security/server/rrs/rrs_prop_replist.c
    1501-106: (S) Include file rs_repadm.h not found.
*** Error code 1


    1501-106: (S) Include file rs_repadm.h not found.
    1501-106: (S) Include file rs_replist.h not found.



cc -c     -O  -DOSF_DCE -DDCESHARED_PATH=\"/opt/dce\" -DDCELOCAL_PATH=\"/opt/dcelocal\" -D_BSD -DBSD -DRS_REP_NAUTH -Dunix  -DHAS_STDLIB_H  -DDCE_AUD_POINTS -D_ALL_SOURCE -DAIX32   -I. -I/u1/devobj/sb/nb_rios/src/security/server/bin -I/project/dce/build/dce1.1-snap/src/security/server/bin -I../../h -I/u1/devobj/sb/nb_rios/src/security/h -I/project/dce/build/dce1.1-snap/src/security/h -I../../idl -I/u1/devobj/sb/nb_rios/src/security/idl -I/project/dce/build/dce1.1-snap/src/security/idl -I../rs -I/u1/devobj/sb/nb_rios/src/security/server/rs -I/project/dce/build/dce1.1-snap/src/security/server/rs -I/u1/devobj/sb/nb_rios/export/rios/usr/include -I/project/dce/build/dce1.1-snap/export/rios/usr/include   /project/dce/build/dce1.1-snap/src/security/server/bin/rgy_create.c
cc           -L/u1/devobj/sb/nb_rios/export/rios/usr/lib     -L/project/dce/build/dce1.1-snap/export/rios/usr/lib  -o secd.X rs_main.o  -L../../krb5/kdc -L../../krb5/lib/kdb -L../rsdb -L../rrs -L../../utils -L../../audit/libaudit -L../rs -lrs -lkrb5kdc -lkdb -lrsdb -lrrs -lsecutil -laudit -ldce -lrss -lbsd -lkrb5  
0706-005 ld: Cannot find file: /lib/librrs.a



CR Number                     : 10847
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dced
Subcomponent Name             : server srvrconf
Short Description             : srvrconf create core dumps
Reported Date                 : 6/2/94
Found in Baseline             : 1.1
Found Date                    : 6/2/94
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 10857
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[6/2/94 public]
srvrconf create core dumps. either the caller of string_copy or
string_copy itself need to check null pointer. Here is the gdb
stack info,
#0  0xa40408d2 in strlen ()
#1  0x40495e in string_copy (new=0x49f990, old=0x49f828, 
    alloc=0x40404c <copy_via_malloc>, st=0x59aaf4)
    at ../../../../../src/admin/dced/server/misc.c:396
#2  0x404e93 in service_copy (new=0x49f970, old=0x49f808, 
    alloc=0x40404c <copy_via_malloc>, st=0x59aaf4)
    at ../../../../../src/admin/dced/server/misc.c:560
#3  0x404f84 in service_list_copy (new=0x4cd680, old=0x59a900, 
    alloc=0x40404c <copy_via_malloc>, st=0x59aaf4)
    at ../../../../../src/admin/dced/server/misc.c:582
#4  0x404ff5 in server_copy (new=0x4cd66c, old=0x59a8ec, 
    alloc=0x40404c <copy_via_malloc>, st=0x59aaf4)
    at ../../../../../src/admin/dced/server/misc.c:600
#5  0x404722 in srvr_add_to_table (t=0x42cdb0, new=0x59a858, st=0x59aaf4)
    at ../../../../../src/admin/dced/server/misc.c:310
#6  0x409d25 in srvrconf_create (h=0x4b8098, server=0x59aaf8, st=0x59aaf4)
    at /project/dce/build/dce1.1/src/admin/dced/server/scops.c:130
#7  0x41eaba in op2_ssr (h=0x4b8098, IDL_call_h=0x5d9bf8, IDL_elt_p=0x59ae4c, 
    IDL_drep_p=0x4f57b8, IDL_transfer_syntax_p=0x5d9df4, IDL_mgr_epv=0x42aec0, 
    IDL_status_p=0x59ae28) at srvrconf_sstub.c:1980
#8  0xa41fc2d4 in rpc__cn_call_executor (6134776, 0)
#9  0xa41d3b08 in cthread_call_executor (5201144)
#10 0xa41ac38b in cma__thread_base ()
#11 0xa41b177d in cma__create_thread ()
#12 0xa41d3958 in cthread_call_executor ()
#13 0x5750e0 in acl_db ()
Cannot access memory at address 0x2.



CR Number                     : 10840
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : ./security/krb5/lib/crc-32/crc-test
Short Description             : This file is empty.  Do we need it?
Reported Date                 : 6/2/94
Found in Baseline             : 1.1
Found Date                    : 6/2/94
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 6648
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : security/krb5/lib/crc-32/crc-test
Sensitivity                   : public

[6/2/94 public]

The file ./security/krb5/lib/crc-32/crc-test is empty.
If it is not required, please remove it.  Otherwise, it will be
expanded with the OSF copyright.

[9/6/94 public]
This isn't a defect, it's an empty file that doesn't affect builds or tests
or DCE usage, so I've changed it to an 'enh'ancement to clean up the tree.



CR Number                     : 10839
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : time/zones
Short Description             : Zoneinfo files should be defuncted
Reported Date                 : 6/2/94
Found in Baseline             : 1.1
Found Date                    : 6/2/94
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 10449
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[6/2/94 public]

Hi Charlie,

The comment leader for the following files are incorrect:

       ./time/common/localtime #
       ./time/common/posixrules    #
       ./time/zones/Australia/LHI  #
       ./time/zones/Australia/NSW  #
       ./time/zones/Australia/North    #
       ./time/zones/Australia/Queensland   #
       ./time/zones/Australia/South    #
       ./time/zones/Australia/Tasmania #
       ./time/zones/Australia/Victoria #
      ./time/zones/Australia/West #
      ./time/zones/Australia/Yancowinna   #
      ./time/zones/Brazil/Acre    #
      ./time/zones/Brazil/DeNoronha   #
      ./time/zones/Brazil/East    #
      ./time/zones/Brazil/West    #
      ./time/zones/Canada/Atlantic    #
      ./time/zones/Canada/Central #
      ./time/zones/Canada/East-Saskatchewan   #
      ./time/zones/Canada/Eastern #
      ./time/zones/Canada/Mountain    #
      ./time/zones/Canada/Newfoundland    #
      ./time/zones/Canada/Pacific #
      ./time/zones/Canada/Yukon	#

These files are data files and SHOULD NOT have any comment leaders.

Since the comment leaders is the only way I used to detect whether
the DCE COPYRIGHT should be presented or not, this cause problems
when doing COPYRIGHT expansion.

One can change the comment leader as followed:

    bcs -c "NONE" <filename>

Do you want me to go ahead and do this?

Let me know when you are done so that I can remove this from my
list.

thanks
annie

[6//94 public]
These files need to be defuncted from the tree.
They are useless and copies get generated from the zic files in 
src/time/zoneinfo for installation.

[7/16/94 public]

Changed to a duplicate of 10449, since defuncting these files will 
effectively remove the "missing comment leader" problem.



CR Number                     : 10831
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dcecp
Subcomponent Name             : tcl
Short Description             : defunct tcl7.0 and tcl7.1
Reported Date                 : 6/1/94
Found in Baseline             : 1.1
Found Date                    : 6/1/94
Severity                      : E
Priority                      : 1
Status                        : dup
Duplicate Of                  : 10848
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[6/1/94 public]
The directories admin/tcl7.0 and admin/tcl7.1 should be defuncted.
We are using admin/tcl7.3.



CR Number                     : 10793
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : bld
Subcomponent Name             : dfs (./file)
Short Description             : Signal 10 during DCE1.1 on an hpux with the purified make
Reported Date                 : 5/26/94
Found in Baseline             : 1.1
Found Date                    : 5/26/94
Severity                      : B
Priority                      : 0
Status                        : dup
Duplicate Of                  : 10877
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[5/26/94 public]

We encountered a Signal 10 in DCE1.1's build.  The Signal problem causes
more than one build failures on the HP platform.  This is a recurring
problem that had also randomly occurred in DCE1.1a.

[6/01/94 public]

I changed the component name to bld and changed the severity to B0
since although it breaks the build - the workaround is to build in
place without removing the objects and the Signal goes away



CR Number                     : 10781
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : dced
Subcomponent Name             : 
Short Description             : dced core dumps easily on
keytab create or hostdata create operations ((HP only)
Reported Date                 : 5/25/94
Found in Baseline             : 1.1
Found Date                    : 5/25/94
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 10757
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[5/25/94 public]

Core dump happens quickly wqhen running dcecp keytab and hostdata FVT's
on HP.

The top of the stacks is free().  See OT #10778 & OT #10779, also free related
core dumps in the libs.



CR Number                     : 10772
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : dced
Subcomponent Name             : server
Short Description             : dced core dumps with multiple
rkeytab_change_key
Reported Date                 : 5/25/94
Found in Baseline             : 1.1
Found Date                    : 5/25/94
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 10615
Fix By Baseline               : 1.1beta
Fixed In Baseline             : 1.1b9
Affected File(s)              : 
Sensitivity                   : public

[5/25/94 public]

when I tried to use the keytab_change_key api more than once on HP,
dced server core dumps.


test1 :
	create the principal etc, thro' rgy_edit
	dced_keytab_create
	get the version number for the key
	dced_keytab_add_key
	dced_keytab_change_key (with version 0)
	dced_keytab_change_key (with version 0)
	dced_keytab_change_key (with version 0)
	dced_keytab_change_key (with version 0)
	..
	dced_keytab_delete

	Note: this test works fine on 486/osf with no problems.

test2:
	create the principal etc, thro' rgy_edit
	dced_keytab_create
	get the version number for the key
	dced_keytab_add_key
	sec_key_mgmt_change_key (with version 0)
	sec_key_mgmt_change_key (with version 0)
	sec_key_mgmt_change_key (with version 0)
	sec_key_mgmt_change_key (with version 0)
	...
	dced_keytab_delete

	Note: this test works fine both on 486/osf and hp/ux
		with no problems.

[6/3/94 public]
It's dumping core within the code in sec_key_mgmt_change_key() that binds
to the registry, not any of the DCED code.  It's from the "good" nightly
build of May 31.

Here's a stack trace
 0 TMEM@libc + 0x000ad284 (0x40011568, 0, 0, 0)
 1 TMEM@libdce + 0x000904bc (0x4034d4d8, 0x4029910c, 0x4034d3d0, 0x40298c40)
 2 rca_site_resolve_update (auth_info = 0x40298c40, icontext = 0x403462a8,
    ocontext = 0x402987bc, status = 0x40297870)
    [/project/dce/build/dce1.1/src/security/client/rca/internal_binding.c: 2455]
 3 sec_rgy_site_bind_update (site_name = 0x402987c0, auth_info = 0x40298c40,
    context = 0x402987bc, status = 0x40297870)
    [/project/dce/build/dce1.1/src/security/client/rca/binding.c: 201]
 4 sec_key_mgmt__bind_rgy (principal_name = 0x402d0478, auth_type =
    sec_rgy_bind_auth_dce, lc = 0x4034b090, rel_princ_name = 0x40298bf0,
    cell = 0x402987c0, update = 1, rgy_h = 0x402987bc, st = 0x40297870)
    [/project/dce/build/dce1.1/src/security/client/key_mgmt/seckey_util.c: 396]
 5 sec_key_mgmt_change_key (authn_service = 1, arg = 0x402d0da0,
     principal_name = 0x402d0478, key_vno = 0, keydata = 0x402d0ee8,
     garbage_collect_time = 0x40297b40, err = 0x40297870)
    [/project/dce/build/dce1.1/src/security/client/key_mgmt/keymgmt.c: 286]
 6 rkeytab_change_key (h = 0x402d4ba0, id_uuid = 0x4029784c, key = 0x4029785c,
    st = 0x40297870)
    [/project/dce/build/dce1.1/src/admin/dced/server/kmops.c: 499]
 7 op6_ssr (h = 0x402d4ba0, IDL_call_h = 0x400ae6d8, IDL_elt_p = 0x4029751c,
     IDL_drep_p = 0x400aead0, IDL_transfer_syntax_p = 0x400ae8d4,
     IDL_mgr_epv = 0x400085c8, IDL_status_p = 0x40297550)
    [rkeytab_sstub.c: 1353]
 8 TMEM@libdce + 0x0013ddd8 (0x400ae6d8, 0, 0, 0)
 9 TMEM@libdce + 0x00105410 (0x401349a0, 0x7af54e40, 0x40027928, 0x13

Rajendra reports there this is from a known bug (10615) in sec_id_parse_name()
(actually, it's deeper - where it binds to the registry).



CR Number                     : 10700
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000,hppa,i486
S/W Ref Platform              : osf1,aix,hpux
Component Name                : dts
Subcomponent Name             : time/service/dts_provider_util.c
Short Description             : "PATH_MAX" undefined
Reported Date                 : 5/19/94
Found in Baseline             : 1.1
Found Date                    : 5/19/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 10698
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : dts_provider_util.c
Sensitivity                   : public

[5/19/94 public]

cc: "/project/dce/build/dce1.1-snap/src/time/service/dts_provider_util.c", line\
 34: error 1588: "PATH_MAX" undefined.
cc: "/project/dce/build/dce1.1-snap/src/time/service/dts_provider_util.c", line\
 34: error 1502: Array size must be a constant expression.
*** Error code 1

[5/19/94 public]
Already opened a bug on this and fixed it.



CR Number                     : 10682
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : 
Short Description             : rgy_edit site command changed
behavior
Reported Date                 : 5/17/94
Found in Baseline             : 1.1
Found Date                    : 5/17/94
Severity                      : B
Priority                      : 0
Status                        : dup
Duplicate Of                  : 10615
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[5/17/94 public]

The rgy_edit "site" command works differently on 486 and HP 
machines. That is if I execute the following command on an HP:

rgy_edit=> site /.:/kevins
?(rgy_edit) Unable to open the registry at site "/.:/kevins" - Registry server unavailable (Registry Edit Kernel) (dce / sad)
Current site is: registry server at /.../absolut_cell/subsys/dce/sec/master 

And if I execute the command on a 486.
rgy_edit=> site /.:/kevins
Site changed to: registry server at /.../terrapin/subsys/dce/sec/master 

So there is an inconsistency between architectures when trying to bind to a 
site.

[5/17/94 public]
It should be noted that in the above example, there is no principal or
anything named kevins in the registry.  This is based on the behavior that
sec_rgy_site_bind() can accept a name of the form:

   /.../<valid-cellname>/<some-invalid-name>

and it will still bind to a security server in /.../<valid-cellname>.

Several dcecp commands will depend on this behavior, hence the high
priority (though it is NOT needed for beta).  For example, in dcecp you
can say: 

 dcecp> principal create melman
 dcecp> principal create /.../mycell/melman
 dcecp> principal create /.../someothercell/melman

There is no equivalent of the rgy_edit site command in dcecp, so we try
to bind to the name entered since we can't figure out the cellname
syntactically and we can't call sec_id_parse_name since the name might
not exist.

[5/18/94 public]
I reconfigured my 486 with the nightly build from 5/17/94. With this
build my machine is now exhibiting the same symptoms as the HP machine.
The question now is what is the correct behavior. The build dated 5/11
exhibited what I would consider to be the correct behavior which is
resolving to the apropriate site on any path that contains a valid
cellname. This behavior was consitent prior to last week. I first
noticed this behavior in 12/93.

[5/18/94 public]
The HP we tested against which did not bind to a cell given a name which
did not exist, was using the nightly build of 5/4/94.

[5/18/94 public]
So it's not arch-specific, it's just a bug (apparently previously reported.)



CR Number                     : 10677
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : i486
S/W Ref Platform              : osf1
Component Name                : rpc
Subcomponent Name             : idl
Short Description             : idl's handling of pipe execption with TCP is wrong
Reported Date                 : 5/17/94
Found in Baseline             : 1.0.3
Found Date                    : 5/17/94
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 9550
Fix By Baseline               : 
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[5/17/94 public]

If a write to a closed pipe happens, an exception of rpc_x_ss_pipe_closed
is supposed to be returned to the client code.

This is what is being tested by test/rpc/idl/pipefault test. THe test
runs OK with UDP protocol, but with TCP protocol, you get unexpected 
exception of rpc_x_unknown_reject. CATCH clause does not catch 
rpc_x_ss_pipe_closed.

To see the problem, build that test, cd to obj/at386/test/rpc/idl, set 
env var PROTOCOL to ncacn_ip_tcp, then do:

	run_tests 1 pipefault

[6/13/94 public]
IBM also discovered this failure.  Here is their analisys:


ywei from IBM says:

IDL backend testcase pipefault failed with CN protocol

pipefault failed - unexpected CMA exception rpc_x_unknown_reject when
  the protocol is CN on both AIX and OS/2.

This problem was seen in DCE 1.0.3 on both AIX and OS/2, DCE 1.0.2
based OS/2 DCE, and DCE 1.1.

When protocol is ncacn_ip_tcp, the client displayed the messages
    "FAILURE: unexpected exception"
and "FAILURE: unexpected CMA exception rpc_x_unknown_reject"
after the message "Unbinding my-handle".

ncadg_ip_udp run ok without displaying the error messages.

Details:
The test server (in manager.c) intentionally tried to write to a
closed pipe.  RPC correctly raised rpc_x_ss_pipe_closed exception
in idl/lib/ndrmi3.c, rpc_ss_ndr_ee_marsh_pipe_chunk().

On the client side, in cncall.c, rpc__cn_call_transceive() received
the last fragment and checked the status.  The statement
    fault_code = RPC_CN_PTK_STUTUS(header_p);
set fault_code to 382312542 (16c9a05e), which translates to runtime
status: rpc_s_known_reject.

Except the rpc_x_ss_pipe_closed exception, tther pipe fault exceptions
: rpc_x_ss_pipe_empty, rpc_x_ss_pipe_order and
rpc_x_ss_pipe_discipline_error were correctly rasied, and the fault_code
in cncall.c on the client side was set to zero.

Seiichi notes:
	0x16c9a05e = rpc_s_call_orphaned . Sounds like CR 9550 to me.

I am investigating 9550 to see if they are the same problem.

[6/13/94 public]
The fix provided by HP which corrects the fix to 8068 also fixes this
test failure.  Dup'ing this defect to 9550.



CR Number                     : 10652
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa,i486,rs6000
S/W Ref Platform              : hpux, osf1, aix
Component Name                : dts
Subcomponent Name             : /test/time/service
Short Description             : `build_all' not remade because of errors.
Reported Date                 : 5/16/94
Found in Baseline             : 1.1
Found Date                    : 5/16/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 10656
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[5/16/94 public]

[ /test/time/service at 01:34 (AM) Sunday ]
*** Error code 1
`build_all' not remade because of errors.
*** Error code 1
[ /test/time/control at 01:34 (AM) Sunday ]
`build_all' not remade because of errors.
*** Error code 1

[5/16/94 public]
This is a dup of 10656:

`build_all' not remade because of errors.



CR Number                     : 10650
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa,i486,rs6000
S/W Ref Platform              : hpux,osf1,aix
Component Name                : dcecp
Subcomponent Name             : /admin/dcecp/scripts
Short Description             : missing include file 'dce/dcedtssvc.h
Reported Date                 : 5/16/94
Found in Baseline             : 1.1
Found Date                    : 5/16/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 10642
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[5/16/94 public]

[ /admin/dcecp/scripts at 00:37 (AM) Sunday ]
dtss_includes.h: 79: Unable to find include file 'dcedtssvc.h'.
*** Error code 1
dtss_includes.h: 79: Unable to find include file 'dcedtssvc.h'.
*** Error code 1
dtss_includes.h: 79: Unable to find include file 'dcedtssvc.h'.
*** Error code 1
 tss_includes.h: 79: Unable to find include file 'dcedtssvc.h'.
*** Error code 1
`build_all' not remade because of errors.
*** Error code 1
`build_all' not remade because of errors.
*** Error code 1
`build_all' not remade because of errors.



CR Number                     : 10646
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : cds
Subcomponent Name             : cdsadv
Short Description             : Can't kill cdsadv
Reported Date                 : 5/15/94
Found in Baseline             : 1.1
Found Date                    : 5/15/94
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 10494
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[5/15/94 public]
I configured a single-machine cell with an x.500 name (c=ie/o=digital).
cdsadv won't die when I shut down the cell.  Repeated attempts to blast it
fail.

Heck, I needed to reboot this machine, anyhow.

[5/16/94 public]
I talked to Rich. This looks like a dup of the advertixer dumping
core problem.



CR Number                     : 10604
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dced
Subcomponent Name             : server
Short Description             : build error from /admin/dced/server
Reported Date                 : 5/11/94
Found in Baseline             : 1.1
Found Date                    : 5/11/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 10603
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[5/11/94 public]



see related ot 10556 05-06-94


[ /admin/dced/server at 00:05 (AM) Wednesday ]
*** Error code 1
*** Error code 1
*** Error code 1
*** Error code 1
`build_all' not remade because of errors.
*** Error code 1
`build_all' not remade because of errors.
*** Error code 1



CR Number                     : 10592
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : cds
Subcomponent Name             : cdscp/dcecp
Short Description             : cdscp delete directory <dirname>
does not  delete <dirname>, the directory stays.
Reported Date                 : 5/9/94
Found in Baseline             : 1.1
Found Date                    : 5/9/94
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 10580
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[5/9/94 public]


Using Sunday May 08/94
======================

cdscp (or dcecp) does not delete a directory eventhough 
the delete operation returns successfully. 

Here is what happens:

1. Login as cell_admin
root@bronze> dce_login cell_admin -dce-
Password must be changed!

2. create and list directory

root@bronze> cdscp
cdscp> create directory /.:/test_1
cdscp> list directory /.:/test_1
                        LIST
                   DIRECTORY   /.../b_cell.qadce.osf.org/test_1
                          AT   1994-05-09-18:07:23
test_1

3. Delete directory

cdscp> delete directory /.:/test_1

4. list the directory deleted - the directory still 
   can be listed, however, one with the same name cannot
   be created again (see error below).

cdscp> list directory /.:/test_1
                        LIST
                   DIRECTORY   /.../b_cell.qadce.osf.org/test_1
                          AT   1994-05-09-18:07:36
test_1
cdscp> create directory /.:/test_1
Unknown message number 0x10d0a0d7Specified full name already exists (dce /
cds)
Unknown message number 0x10d0a0d8

[5/9/94 public]
Just a little more info, it's not just the child pointer in the parent dir
that is hanging around.  Where /.:/br_dir_1 has been deleted:

  dcecp> dir rem /.: -me br_dir_1 
  dcecp> dir list /.: -s -d
  br_dir_2 br_dir_3 hosts mel melma melman msd subsys test_1
  dcecp> dir cre /.:/br_dir_1
  Error: Specified full name already exists
  dcecp> 

These dcecp commands remove the child pointer from /.: successfully (api
doesn't return an error and listing the directories under /.: shows it's
not there) but then can't create a dir called /.:/br_dir_1

[5/10/94 public]
This was apparently another side affect of the work around for the intercell
problem that dec submited and then backed out yesterday. I have a cell that
still hadsthe work around and was able to replicate the problem in it. The
problem does not appear in a cell with the work around backed out. I ran
killer on an hp after the back out. It does the following over and
over again, all the way up to z, and it had no problem. 

create directory /.../vanilla_cell.qadce.osf.org/root/testdir/a
delete directory /.../vanilla_cell.qadce.osf.org/root/testdir/a
create directory /.../vanilla_cell.qadce.osf.org/root/testdir/a
create directory /.../vanilla_cell.qadce.osf.org/root/testdir/a/b
delete directory /.../vanilla_cell.qadce.osf.org/root/testdir/a/b
create directory /.../vanilla_cell.qadce.osf.org/root/testdir/a/b
create directory /.../vanilla_cell.qadce.osf.org/root/testdir/a/b/c
delete directory /.../vanilla_cell.qadce.osf.org/root/testdir/a/b/c
create directory /.../vanilla_cell.qadce.osf.org/root/testdir/a/b/c
create directory /.../vanilla_cell.qadce.osf.org/root/testdir/a/b/c/d
delete directory /.../vanilla_cell.qadce.osf.org/root/testdir/a/b/c/d
create directory /.../vanilla_cell.qadce.osf.org/root/testdir/a/b/c/d
create directory /.../vanilla_cell.qadce.osf.org/root/testdir/a/b/c/d/e
delete directory /.../vanilla_cell.qadce.osf.org/root/testdir/a/b/c/d/e
create directory /.../vanilla_cell.qadce.osf.org/root/testdir/a/b/c/d/e
create directory /.../vanilla_cell.qadce.osf.org/root/testdir/a/b/c/d/e/f
delete directory /.../vanilla_cell.qadce.osf.org/root/testdir/a/b/c/d/e/f
create directory /.../vanilla_cell.qadce.osf.org/root/testdir/a/b/c/d/e/f

I just installed last night's build on both the 486 and hpux platforms and
the problem does not appear. I'm making this a dup of 10580 which is the A0
that was opened and fixed yesterday.



CR Number                     : 10584
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : i486
S/W Ref Platform              : osf1
Component Name                : dts
Subcomponent Name             : 
Short Description             : utc_cvt.c is not compilable with gcc flags
Reported Date                 : 5/9/94
Found in Baseline             : 1.1b8
Found Date                    : 5/9/94
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 10457
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : time/common/utc_cvt.c
Sensitivity                   : public

[5/9/94 public]
Setting the gcc clean-up flags :
	-ansi -pedantic -Wchar-subscripts -Wcomment -Wformat
	-Wid-clash-32 -Wimplicit -Wmissing-prototypes -Wreturn-type
	-Wstrict-prototypes -Wswitch -Wunused -Wtrigraphs
prohibits compilation of time/common/utc_cvt.c :


/project/dce/build/dce1.1-baseline/bl-8/src/time/common/utc_cvt.c:109: warning:
function declaration isn't a prototype
/project/dce/build/dce1.1-baseline/bl-8/src/time/common/utc_cvt.c:110: warning:
function declaration isn't a prototype
/project/dce/build/dce1.1-baseline/bl-8/src/time/common/utc_cvt.c:111: warning:
function declaration isn't a prototype
/project/dce/build/dce1.1-baseline/bl-8/src/time/common/utc_cvt.c:112: warning:
function declaration isn't a prototype
/project/dce/build/dce1.1-baseline/bl-8/src/time/common/utc_cvt.c:147: warning:
function declaration isn't a prototype
/project/dce/build/dce1.1-baseline/bl-8/src/time/common/utc_cvt.c:147: warning:
function declaration isn't a prototype
/project/dce/build/dce1.1-baseline/bl-8/src/time/common/utc_cvt.c: In function `
utc_asclocaltime':
/project/dce/build/dce1.1-baseline/bl-8/src/time/common/utc_cvt.c:327: warning:
implicit declaration of function `utc_settdf'
/project/dce/build/dce1.1-baseline/bl-8/src/time/common/utc_cvt.c: In function `
utc_ascanytime':
/project/dce/build/dce1.1-baseline/bl-8/src/time/common/utc_cvt.c:417: parse err
or before `if'
/project/dce/build/dce1.1-baseline/bl-8/src/time/common/utc_cvt.c: At top level:
/project/dce/build/dce1.1-baseline/bl-8/src/time/common/utc_cvt.c:432: parse err
or before `;'
/project/dce/build/dce1.1-baseline/bl-8/src/time/common/utc_cvt.c: At top level:
/project/dce/build/dce1.1-baseline/bl-8/src/time/common/utc_cvt.c:540: parse err
or before `else'
/project/dce/build/dce1.1-baseline/bl-8/src/time/common/utc_cvt.c:591: warning:
function declaration isn't a prototype
/project/dce/build/dce1.1-baseline/bl-8/src/time/common/utc_cvt.c:1789: warning:
 function declaration isn't a prototype
/project/dce/build/dce1.1-baseline/bl-8/src/time/common/utc_cvt.c:1949: warning:
 function declaration isn't a prototype
/project/dce/build/dce1.1-baseline/bl-8/src/time/common/utc_cvt.c:1998: warning:
 function declaration isn't a prototype
/project/dce/build/dce1.1-baseline/bl-8/src/time/common/utc_cvt.c:2382: warning:
 function declaration isn't a prototype
/project/dce/build/dce1.1-baseline/bl-8/src/time/common/utc_cvt.c:2513: warning:
 function declaration isn't a prototype
/project/dce/build/dce1.1-baseline/bl-8/src/time/common/utc_cvt.c:2637: warning:
 function declaration isn't a prototype
/project/dce/build/dce1.1-baseline/bl-8/src/time/common/utc_cvt.c:2677: warning:
 function declaration isn't a prototype
/project/dce/build/dce1.1-baseline/bl-8/src/time/common/utc_cvt.c:2765: warning:
 function declaration isn't a prototype
/project/dce/build/dce1.1-baseline/bl-8/src/time/common/utc_cvt.c:2774: warning:
 function declaration isn't a prototype
*** Error code 1

[5/09/94 public]
This is a dup. This fix is part of code cleanup.



CR Number                     : 10563
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dcecp
Subcomponent Name             : /admin/dcecp/scripts
Short Description             : "dced_s_no_more_entry" undefined
Reported Date                 : 5/6/94
Found in Baseline             : 1.1
Found Date                    : 5/6/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 10554
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : /admin/dcecp/dhd_server.c
Sensitivity                   : public

[5/6/94 public]

[ /admin/dcecp/scripts ]

c89 -c    -D_SHARED_LIBRARIES   -g +w1 -D__hppa -Dhp9000s800 -Dhp9000s700 -D__hp9000s800 -D__hp9000s700 \
-DHPUX -D__hpux -Dunix +DA1.0 -D_HPUX_SOURCE    -I. -I/u3/devobj/sb/nb_ux/src/admin/dcecp -I/project/dce\
/build/dce1.1-snap/src/admin/dcecp   -I/u3/devobj/sb/nb_ux/export/hp800/usr/include -I/project/dce/build\
/dce1.1-snap/export/hp800/usr/include    /project/dce/build/dce1.1-snap/src/admin/dcecp/dhd_server.c
cc: "/project/dce/build/dce1.1-snap/src/admin/dcecp/dhd_server.c", line 202: error 1588: "dced_s_no_more\
_entry" undefined.
cc: "/project/dce/build/dce1.1-snap/src/admin/dcecp/dhd_server.c", line 202: error 1563: Expression in i\
f must be scalar.
*** Error code 1

[5/6/94 public]

Cancelling because this OT is a duplicate of the earlier OT #10554.
The bug fix has already been submitted.



CR Number                     : 10562
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : api
Short Description             : dcecp accepts input outside
PCS when creating principals and groups
Reported Date                 : 5/6/94
Found in Baseline             : 1.1
Found Date                    : 5/6/94
Severity                      : C
Priority                      : 1
Status                        : dup
Duplicate Of                  : 12028
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[5/6/94 public]

dcecp accepts input outside the PCS for principal names and 
groups (see RFC 23.0- Limitations due to protocol definitions). 

rgy_edit on equivalent operations returns an error:

dd Principal=> Enter name: <Greek Characters>
?(rgy_edit) Unable to add principal <Greek Characters> - Principal name
contains an illegal character (Registry Edit Kernel) (dce / sad)
Add Principal=> Enter name:

[5/9/94 public]
This sounds like it should be done in the sec_rgy_pgo_*().
I know that we don't do input checking as a rule, but I'll let the security
and I18n folks figure this out.  dcecp doesn't seem like the right place to
check this.  What if someone else puts in bogus values via the API and then
the admin wants to fix it with dcecp?

[9/2/94 public]
Could someone of the I18N or SEC folks comment on this please?

[9/2/94 public]
This is being fixed as part of the Security I18N fixes (OT 12028), and hence
has been marked as a dupe.  

The fix will indeed be applied in the affected sec_rgy_pgo_*() routines
since it is necessary to protect the sec database from being polluted
with invalid principal names containing non-PCS characters.



CR Number                     : 10561
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : utils
Subcomponent Name             : sams
Short Description             : problems with format strings
Reported Date                 : 5/6/94
Found in Baseline             : 1.1
Found Date                    : 5/6/94
Severity                      : B
Priority                      : 0
Status                        : dup
Duplicate Of                  : 10544
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[5/6/94 public]

We have a problem with the SAMS compiler of base-line 8, which has
changed its behaviour compared with base-line 6.

When a message contains more than one format element, e.g.

   "\t%-12.10s%-9d%-9.7s%-9.7s%-9.7s"

the SAMS compiler of base line 6 generates the following message in
dcegds.msg:

    \t%1$-12.10s%2$-9d%3$-9.7s%4$-9.7s%5$-9.7s

while the SAMS compiler of base line 8 generates

    \t%0$-12.10s%1$-9d%2$-9.7s%3$-9.7s%4$-9.7s

The digits between % and $, that indicate the position of the argument to
be substituted count from 0 now, while they have started to count from
1 up so far. When dce_svc_printf (of base line 8) gets such a message
it issues the format string itself rather than the first argument following.

Is this a bug in the SAMS compiler, or are we making something wrong ?

This is very urgent because our next code drop is scheduled for begin
of next week. No real test can work because "gdsdirinfo" which uses
the format string mentioned above.



CR Number                     : 10557
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dcecp
Subcomponent Name             : 
Short Description             : entering "help" should be useful
Reported Date                 : 5/6/94
Found in Baseline             : 1.1
Found Date                    : 5/6/94
Severity                      : B
Priority                      : 3
Status                        : dup
Duplicate Of                  : 11559
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[5/6/94 public]
If a user types "help" at a dcecp> prompt, something useful should happen.
Perhaps something directing the user to the other help systems or the "man
dcecp" command.



CR Number                     : 10535
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : other
S/W Ref Platform              : other
Component Name                : sec
Subcomponent Name             : acl_edit
Short Description             : acl_edit cannot remove orphans
Reported Date                 : 5/4/94
Found in Baseline             : 1.0.2
Found Date                    : 5/4/94
Severity                      : C
Priority                      : 3
Status                        : dup
Duplicate Of                  : 8131
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : security/client/admin/acl_edit/{tty,deif}.c
Sensitivity                   : public

[5/4/94 public]
  Taken directly from our own defect database:
.
If you delete an account/principal listed on an acl, you can't remove
the acl entry via 'acl_edit delete'.  I suggest a subcommand like
'cleanacl' (like fs cleanacl in AFS), which would cleanup obsolete acl's.
This should be forwarded to OSF, but we should also make sure we don't
introduce the same deficiency in any tools we're creating.
There is a work-around: use 'acl_edit kill', then add all of the desired
acl's again....bogus (esp. for long acl lists), but it gets you there.
colby[dce] acl_edit /.:/hamel/foo -m user:kelp:rw
colby[dce] rgy_edit
Current site is: registry server at /.../colby/subsys/dce/sec/master
rgy_edit=> do p
Domain changed to: principal
rgy_edit=> del kelp
Please confirm delete of name "kelp" [y/n]? (n) y
rgy_edit=> quit
bye.
colby[dce] acl_edit /.:/hamel/foo
sec_acl_edit> l
# SEC_ACL for /.:/hamel/foo:
# Default cell = /.../colby.dce.transarc.com
user:cell_admin:rwdtcia
user:0000006d-89e4-2c14-bd00-9e620a670000:rw-----
sec_acl_edit> d user:0000006d-89e4-2c14-bd00-9e620a670000
ERROR: SEC_ACL_EDIT - invalid or unknown entry key (dce / sad)
sec_acl_edit>

[5/4/95 public]
I agree acl_edit (and dcecp?) should be enhanced to allow you to remove ACL
entries with this problem.  BUT, beware that just because you get a uuid
instead of a name doesn't mean it's an orphan (it could've been a network
glitch during the id to name translation, or a foreign cell's secd that you
can't get to...).  Anyway, I feel that the enhancement shouuld be to let the
user specify the entry just as it appears in the UI (ie: copy/paste the entry
as is from the output into a modify or delete subcommand).  If acl_edit
cannot translate the key to a name, it should see if it's a valid UUID and
if so, attempt to perform the same operation by uuid (since that's what's done
internally after translating the name to uuid anyway).  BTW, thanks for opening
this as an enhancement instead of a defect, not everybody thinks to do that.

[10/3/94 public]
FYI, CR 10546 tracks this in dcecp.  As an enh we would add a -uuid option
to understand ACL's that have UUID's.  The reason for the option is that
what if someone created a principal with a UUID as a name...



CR Number                     : 10523
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : 
Short Description             : sec_salvage_db corrupts database
Reported Date                 : 5/4/94
Found in Baseline             : 1.0.3
Found Date                    : 5/4/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 10503
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[5/4/94 public]

This is related to CR 10503.

I had a cell with two machines running: one is a master secd and the other is a
slave secd. I issued "sec_admin stop" to stop the master secd and issued the 
following "sec_salvage_db" commands to the master secd:

     sec_salavge_db -print -prtpath /tmp/print
     sec_salvage_db -reconstruct -prtpath /tmp/print

  <NOTE> I did not update any ascii files that were created by "sec_salvage_db
         -print" 

After I restarted the master secd, any update via rgy_edit to the master databas
e  
did not get propagated to the slave's database. Beside when I issued "lrep -all"

to display the replicas, the "Last update sequence no'" of the master replica 
was reset to 100 while that of the slave remained unchanged. I tried to put the 

two databases back in synch via "sec_admin initrep <slave_replica>" and the 
initialization of the slave replica failed with the following message:

    Initialize replica operation failed - Registry object not found

There was no other way for me to put the two databases back in synch.

[5/4/94 public]
As stated in CR 10503, due to ERA/H-Cells functionality sec_salvage_db
requires additional work to function correctly. Currently dupping to 10503 
which will be a placeholder for all sec_salvage_db work.



CR Number                     : 10522
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : 
Short Description             : sec_salvage_db corrupts database
Reported Date                 : 5/4/94
Found in Baseline             : 1.0.3
Found Date                    : 5/4/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 10503
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[5/4/94 public]

This is related to CR 10503.

I had one machine running in a cell. I used a "sec_admin stop" to stop secd.
Then I issued the following "sec_salvage_db" commands on the machine where
secd was running:
          
           sec_salvage_db -print -prtpath /tmp/print
           sec_salvage_db -reconstruct -prtpath /tmp/print 

<NOTE> I did not update any *.prt files that were created by "sec_salvage_db 
       -print".

I restarted secd. Then I configured a security replica to the cell and the 
configuration failed with the following messages:

        Modifying acls on /.:/sec/replist ...
ERROR: acl object not found (dce / sec)
Unable to bind to object /.:/sec/replist
ERROR: acl object not found (dce / sec)
Unable to bind to object /.:/sec/replist
        Modifying acls on /.:/subsys/dce/sec ...
        Modifying acls on /.:/sec ...
        Modifying acls on /.: ...
        Modifying acls on /.:/cell-profile ...
        Enter keyseed for initial database master key: 

Registry: Error - Cannot add new replica to master registry - 0x1712207a - Regis

try object not found (dce / sec)
Registry: Fatal Error - Failed to create database
 at line 453 of file ../../../../../src/security/server/bin/rgy_create.c - 0x171

2207a - Registry object not found (dce / sec)
/etc/dce_config: 21481 Abort
ERROR:   sec_create_db may have failed to create security slave
        Press <RETURN> to continue, CTRL-C to exit:

[5/4/94 public]
As stated in CR 10503, due to ERA/H-Cells functionality sec_salvage_db
requires additional work to function correctly. Currently dupping to 10503 
which will be a placeholder for all sec_salvage_db work.



CR Number                     : 10521
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : 
Short Description             : sec_salvage_db corrupts database
Reported Date                 : 5/4/94
Found in Baseline             : 1.0.3
Found Date                    : 5/4/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 10503
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[5/4/94 public]

This is related to CR 10503.

I had one machine running in a cell. I used a "sec_admin stop" to stop secd.
Then I issued the following "sec_salvage_db" commands on the machine where
secd was running:
          
           sec_salvage_db -print -prtpath /tmp/print
           sec_salvage_db -reconstruct -prtpath /tmp/print 

<NOTE> I did not update any *.prt files that were created by "sec_salvage_db 
       -print".

After I restarted secd, I could not put secd into a maintenance mode (sec_admin
state -m), could not stop secd (sec_admin stop) and could not change the 
master key (sec_admin master_key).

[5/4/94 public]
As stated in CR 10503, due to ERA/H-Cells functionality sec_salvage_db requires
additional work to function correctly. Currently dupping to 10503 which will
be a placeholder for all sec_salvage_db work.



CR Number                     : 10517
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dcecp
Subcomponent Name             : login
Short Description             : The login command is printing context not valiadated
Reported Date                 : 5/3/94
Found in Baseline             : 1.1
Found Date                    : 5/3/94
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 10330
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[5/3/94 public]

Using BL8, and HP and OSF/1

The login command is not working all the time anymore.
Here are the sequence of commands that are causing a
problem.

dcecp> login cell_admin -password -dce-
Password must be changed!
dcecp> logout				===> Wait a few seconds
dcecp> login cell_admin -password -dce-
Error: Context has not been validated
dcecp>

[5/4/94 public]
Duplicate of CR 10330.



CR Number                     : 10481
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : utils
Subcomponent Name             : svc
Short Description             : inconsistent log files - dce_svc_log_get
Reported Date                 : 4/28/94
Found in Baseline             : 1.1
Found Date                    : 4/28/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 10467
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[4/28/94 public]

"dce_svc_log_get" checks too early for an end of file. Due to
an inconsistent logging it may happen, that the end of the file
is reached when a data element is read according to the format
specification of the message found in the message catalog, which
was logged with a different (wrong) format string.
"dce_svc_log_get" should suppress this checking for end of file,
but seek for the next record first and then check for the end of file.

[04/28/94 public]
Reported and fixed yesterday as OT CR 10467.



CR Number                     : 10421
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : other
S/W Ref Platform              : other
Component Name                : sec
Subcomponent Name             : secd
Short Description             : secd loops because condition
variable pointer not set on error path
Reported Date                 : 4/21/94
Found in Baseline             : 1.0.3
Found Date                    : 4/21/94
Severity                      : A
Priority                      : 2
Status                        : dup
Duplicate Of                  : 9273
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : .../src/security/server/rs/rs_prop_tasks.c
Sensitivity                   : public

[4/21/94 public]

 The routine prop_driver_sleep() in rs_prop_tasks.c calls 
pthread_cond_timedwait(). The condition variable passed to this call is set
by the routine - if the normal path is taken. If an error path is taken,
i.e. if the routine is called with its parameter "*n_bad_prop_state" not
equal to zero, the condition variable is not set and garbage is passed to
the pthread_cond_timedwait() call.

 To quote the customer:

>   When running the system test according to the
>   backup_restore_rgy_checklist, secd went into a loop when it is
>   set to maintenance mode via sec_admin. secd kept spitting out
>   the following error message:
>
>     SECD: prop_driver_sleep - error from pthread_cond_timedwait
>        (error 22)
>
>  Apparently, when secd went into the maintenance mode, the
>  prop_driver_sleep executed the code under the path
>  n_bad_prop_state > 0. This path does not set up the condition variable
>  pointer, sleep_cv, which is later passed to pthread_cond_timedwait.
>  When pthread_cond_timedwait validates the parameters, it returns
>  an error since the condition variable is not set up to point anything.
>  Since it points to garbage, it might cause different symptoms on
>  different systems or environment.
>
>   I have modified prop_driver_sleep to set up the condition variable
>   pointer, and it seemed to be running fine afterwards.



CR Number                     : 10371
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : sec
Subcomponent Name             : rgy_edit
Short Description             : Different error messages for
1.0.3 and 1.1 during rgy_edit when creds expired.
Reported Date                 : 4/15/94
Found in Baseline             : 1.1
Found Date                    : 4/15/94
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 10106
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[4/15/94 public]

Trying to do rgy_edit after creds expires in 1.1 gives different error
message than 1.0.3 code.

1.1
---

$ rgy_edit
?(rgy_edit) Unable to contact the registry - Registry server
unavailable (Registry Edit Kernel) (dce / sad)


1.0.3
----

$ rgy_edit
?(rgy_edit) Warning - binding is not authenticated - Cant establish
authentication to registry (Registry Edit Kernel) (dce / sad)

[4/15/94 public]

This is because rpc_binding_set_auth_info() when called with expired creds
returns rpc_s_auth_tkt_expired in 1.0.3 . In 1.1, the error returned
is  "Matching credential not found" (which I believe is KRB5_CC_NOTFOUND ) . 
The code in security/client/rca/internal_binding.c explicitly checks 
for rpc_s_auth_tkt_expired error . Hence the different behaviour.

The current method of handling rpc_s_auth_tkt_expired via exceptions
will probably (maybe) replaced by the general mechansim for handling 
"Registry Server Unavailable" messages. 

So the only question is why is rpc_binding_set_auth_info() returning
a different error code ( and that too an undocumented error code) ? 

Anyone know why ?

[4/19/94 public]
This is an exact duplicate of 10106.



CR Number                     : 10347
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : utils
Subcomponent Name             : 
Short Description             : dce_config having problem with highUNIX ID
Reported Date                 : 4/13/94
Found in Baseline             : 1.1
Found Date                    : 4/13/94
Severity                      : C
Priority                      : 3
Status                        : dup
Duplicate Of                  : 8856
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[4/13/94 public]


It seems like most OSF1 systems have a UNIX ID like the following:

nobody:*Nologin:4294967294:4294967294:anonymous NFS user:/:

However when dce_config reads this UNIX ID it complains about it:

S:****** The current highest UNIX ID for persons on this node is 4294967294.
config_sec[186]: 4.29497e+09: Syntax error
        Enter the starting point to be used for UNIX ID's that
        are automatically generated by the Security Service
        when a principal is added using "rgy_edit": (4.29497e+09) 
config_sec[233]: 4.29497e+09: Syntax error
S:****** The current highest UNIX ID for groups is 5000.
        Enter the starting point to be used for UNIX ID's that
        are automatically generated by the Security Service
        when a group is added using "rgy_edit": (5100) 

I think dce_config should handle this UNIX ID more gracefully.

[04/13/94 public]
It does handle it gracefully (for both user and group):

# Revision 1.2.45.2  1993/09/07  17:34:16  tom
#       Bug 8556 - don't include the 'nobody' user or the 'nogroup' group
#       in calculating the highest unix ids.
#       [1993/09/03  21:35:19  tom]

And the code:
        uid_values=`$passwd_file | \
                awk -F ":" -v GAP="$uid_gap" 'BEGIN {HIGHEST=0}
                        {if ( $3 > HIGHEST && $1 != "nobody") HIGHEST = $3}
                        END {print HIGHEST " " HIGHEST+GAP}'`
  
        gid_values=`$group_file | \
                awk -F ":" -v GAP="$gid_gap" 'BEGIN {HIGHEST=0}
                        {if ( $3 > HIGHEST && $1 != "nogroup" && $1 != "nobody")
 HIGHEST = $3}
                        END {print HIGHEST " " HIGHEST+GAP}'`



CR Number                     : 10338
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : cfg
Subcomponent Name             : dce_config/checktime
Short Description             : dce_config fails across time zones
Reported Date                 : 4/13/94
Found in Baseline             : 1.0.3
Found Date                    : 4/13/94
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 8702
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : config/dce_config
Sensitivity                   : public

[4/13/94 public]

checktime() in dce_config uses the daytime inetd service which does not
return any indication of a time zone. If you try to configure machines in
different time zones, the synchronization fails.  Dominick found this out
when he was trying to configure a machine as a client to a cell in
California.

Replacing daytime with time, which returns time in seconds since 0:00:00
GMT, Jan. 1, 1900 and changing checktime() should do the trick for the next
40-50 years. It seems however that a lot of OSF/1 systems do not have
the time protocol configured in /etc/services and /etc/inetd.conf.

[4/13/94 public]
Unfortunately, the 'time' inet service return the machine readable
time, which is hard to parse in a shell script.  I believe there
is documentation (or should be) that you must disable the time check
if you are in different timezones.

Dup'd to 8702.  Which will probably be canceled.



CR Number                     : 10288
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : i486
S/W Ref Platform              : osf1
Component Name                : utils
Subcomponent Name             : db
Short Description             : The dce_db_std_header_fetch
routine returns with error.
Reported Date                 : 4/4/94
Found in Baseline             : 1.0
Found Date                    : 4/4/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 10000
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : dbheader.c
Sensitivity                   : public

[4/4/94 public]

According to the test spec this is a known problem.  

Verify with TET test acldb/ts/db/dce_db_misc.c[db_header_fetch]

[4/5/94 public]
CR 10000 says that the implementation is not complete, hence the errors.
I'll mention the above test in that CR.



CR Number                     : 10274
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : aud
Subcomponent Name             : 
Short Description             : aud control API needs .acf
Reported Date                 : 4/1/94
Found in Baseline             : 1.1
Found Date                    : 4/1/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 9928
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[4/1/94 public]

The audit control API needs an acf file created so that exceptions
raised by the daemon can be trapped and passed back to the caller as
status codes. The control program should not need to be concerned 
about exceptions, only status codes. The TRY/CATCH blocks then can 
be removed from the audit control program.



CR Number                     : 10271
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : thr
Subcomponent Name             : 
Short Description             : Code cleanup
Reported Date                 : 4/1/94
Found in Baseline             : 1.1
Found Date                    : 4/1/94
Severity                      : D
Priority                      : 3
Status                        : dup
Duplicate Of                  : 9579
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[4/1/94 public]
Code cleanup



CR Number                     : 10255
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : i486
S/W Ref Platform              : osf1
Component Name                : gds
Subcomponent Name             : xds
Short Description             : XDS threads_os fails
Reported Date                 : 3/30/94
Found in Baseline             : 1.1
Found Date                    : 3/30/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 10245
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[3/30/94 public]
Two tests in the XDS threads_os testsuite fail (i.e., all the testcases
fail, rather than just one):  mod_entry9v, rem_entry16v

[3/31/94 public]
This is related to 10245: mod_entry9v and rem_entry16v do not run
in tests.xds.valid too.
So it's a dup of 10245.



CR Number                     : 10247
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : gds
Subcomponent Name             : xds
Short Description             : XDS bind performance problems
Reported Date                 : 3/29/94
Found in Baseline             : 1.1
Found Date                    : 3/29/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 10244
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[3/29/94 public]
The following error occured when running the XDS 'invalid' tests.  The
means of running the test was:
	
	cd /dcetest/dcelocal/test/directory/xds/tests.xds/invalid
	../../xt_test -a Testcases

The following (seemingly) performance related problems occured in bind3i

: Function BIND : 
:       session = session4
:       workspace = workspace1
:       call ds_bind()
:       xt_cmp_status: received status was:
: "No more Directory Service sessions can be started"
:       (ERROR) expected and received DS_status from xt_ds_bind differ
:       BIND returned ERROR

This does not happen when running bind3i individually:

  ../../xt_test -i bind3i

[3/30/94 public]
The problem seems to be that some unbinds are missing.
Rich: Could you provide me with a full tester log - as you did it
for 10245 and 10246?

[3/30/94 public]
It's part of the log for ot10246.
(/afs/dce/project/dce/sni/ot10246/invalid.log.)  The same is true for
10248.

[4/7/94 public]
Reproduced on HP/UX.

[04/26/94 public]
It's related to 10244: It only happens if you use the "-a" switch.
Some testcases before bind3i did fail - some unbinds were not performed -
so there have been too many open binds.



CR Number                     : 10232
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : other
S/W Ref Platform              : sinix
Component Name                : sec
Subcomponent Name             : sec_acl_bind
Short Description             : sec_acl_bind memory allocation problem
Reported Date                 : 3/28/94
Found in Baseline             : 1.0.3
Found Date                    : 3/28/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 8266
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : security/client/acl/daclbind.c
Sensitivity                   : public

[3/28/94 public]

This problem was reported by our DFS group.

>When configuring DFS on SINIX-Z, the following command, executed
>by the dfs_config script, results in a segmentation fault:
>
>        /opt/dcelocal/bin/acl_edit -e /.:/sec/principal/hosts/logan/dfs-server
>                -m group:subsys/dce/dfs-admin:rcDnfmag
>
>The security object /.:/sec/principal/hosts/logan/dfs-server has
>already been created.

Further investigating, I found that the following might have caused the
core dump:

File: security/client/acl/daclbind.c
....
....
        /* component_name = unresolved_name + optional residual */
        if (bind_to_entry) {
            component_name = (unsigned_char_p_t) malloc(
                                            strlen((char *) residual) + 1 +
#ifdef SNI_SVR4
                                            1 + /* for strlen("/") */
#endif
                                            strlen((char *) unresolved_name));
            strcpy((char *) component_name, (char *) unresolved_name);
            strcat((char *) component_name, "/");
            strcat((char *) component_name, (char *) residual);
        }
        else {
            component_name = unresolved_name;
        }
....
....

The #ifdef SNI_SVR4 suggests the fix.

[7/14/94 public]
Yet another dup of 8266.

[7/15/94 public]
As mentioned above, this is a duplicate of another CR.  Since I own that CR,
I must own this one too, since duplicates aren't necessarily ever updated
after marking them 'dup'.



CR Number                     : 10226
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 10331
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : sec
Subcomponent Name             : rgy_edit cell
Short Description             : Memory Fault w/X500 cell name in rgy_edit
Reported Date                 : 3/24/94
Found in Baseline             : 1.1
Found Date                    : 3/24/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 10331
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[03/24/94 public]

Using BL5, you get a Memory Fault with the rgy_edit cell command when you
are using a valid X500 cell name.  If I use an invalid name I get an ap-
propriate error message.

USING A VALID X500 CELL NAME:

rgy_edit=> cell /.../c=us/o=osf/ou=soldier_cell
Enter group name of the local account for the foreign cell: none
Enter group name of the foreign account for the local cell: none
Enter org name of the local account for the foreign cell: none
Enter org name of the foreign account for the local cell: cell_admin
Enter your password:   
Enter account id to log into foreign cell with: cell_admin
Enter password for foreign account: 
Enter expiration date [yy/mm/dd or 'none']: (none) 
Memory fault

USING A INVALID X500 CELL NAME:

rgy_edit=> cell /.../c=us/o=osfosf/ou=ple
Enter group name of the local account for the foreign cell: none
Enter group name of the foreign account for the local cell: none
Enter org name of the local account for the foreign cell: none
Enter org name of the foreign account for the local cell: none
Enter your password:   
Enter account id to log into foreign cell with: cell_admin
Enter password for foreign account: 
Enter expiration date [yy/mm/dd or 'none']: (none) 
?(rgy_edit) Incomplete cell add - Registry server unavailable (Registry Edit Kernel) (dce / sad)

[03/24/94 public]
Given that you seem to be able to reproduce this, and have a cell set up to
do so already, you might save us *lots* of time if you could run it in the
debugger and get a traceback when it does the memory fault.

[03/25/94 public]

How's this?

r0  00000000 000024b5 80a024f3 00000020 r4  00000015 00000001 7b033278 7b033350
r8  00000014 00000004 00000000 00000000 r12 4000bee0 00000000 10000080 10000000
r16 00000000 00000014 00000000 7af461d4 r20 00000000 00000008 00000001 00000000
r24 401c057d 7b03945c 40010ef8 4000e3d0 r28 177db009 401c057d 7b039050 7b038488
    pc = 000024b5.80a024f0     priv = 3     psw = jthlnxbCvmrQPDI     sar = 24
        0x80a024a0   rca_site+0668   LDSID   (0,1),31
        0x80a024a4   rca_site+066c   MTSP    31,0
        0x80a024a8   rca_site+0670   BLE     0(0,1)
        0x80a024ac   rca_site+0674   OR      31,0,2
        0x80a024b0   rca_site+0678   LDW     -32(0,30),19
        0x80a024b4   rca_site+067c   LDW     -108(0,30),26
        0x80a024b8   rca_site+0680   LDO     -1172(30),25
        0x80a024bc   rca_site+0684   LDW     -72(0,30),24
        0x80a024c0   rca_site+0688   LDW     -1252(0,30),23
        0x80a024c4   rca_site+068c   LDW     -1260(0,30),22
        0x80a024c8   rca_site+0690   STW     22,-52(0,30)
        0x80a024cc   rca_site+0694   LDW     -1264(0,30),1
        0x80a024d0   rca_site+0698   STW     1,-56(0,30)
        0x80a024d4   rca_site+069c   BL      rca_site_resolve_update+06a4,2
        0x80a024d8   rca_site+06a0   ADDIL   0xffff4000,2
        0x80a024dc   rca_site+06a4   LDO     964(1),1
        0x80a024e0   rca_site+06a8   LDSID   (0,1),31
        0x80a024e4   rca_site+06ac   MTSP    31,0
        0x80a024e8   rca_site+06b0   BLE     0(0,1)
        0x80a024ec   rca_site+06b4   OR      31,0,2
 >      0x80a024f0   rca_site+06b8   LDW     -32(0,30),19
        0x80a024f4   rca_site+06bc   LDW     -1260(0,30),31
        0x80a024f8   rca_site+06c0   LDW     0(0,31),20
        0x80a024fc   rca_site+06c4   LDO     8(20),21
        0x80a02500   rca_site+06c8   LDW     0(0,21),22
        0x80a02504   rca_site+06cc   LDO     8(0),1
        0x80a02508   rca_site+06d0   OR      22,1,31
        0x80a0250c   rca_site+06d4   STWS    31,0(0,21)
        0x80a02510   rca_site+06d8   LDW     -144(0,30),26
        0x80a02514   rca_site+06dc   BL      rca_site_resolve_update+06e4,2
        0x80a02518   rca_site+06e0   ADDIL   0xfff27000,2
        0x80a0251c   rca_site+06e4   LDO     1864(1),1
        0x80a02520   rca_site+06e8   LDSID   (0,1),31
        0x80a02524   rca_site+06ec   MTSP    31,0
        0x80a02528   rca_site+06f0   BLE     0(0,1)
        0x80a0252c   rca_site+06f4   OR      31,0,2
        0x80a02530   rca_site+06f8   LDW     -32(0,30),19
        0x80a02534   rca_site+06fc   LDW     -72(0,30),26
        0x80a02538   rca_site+0700   BL      rca_site_resolve_update+0708,2
        0x80a0253c   rca_site+0704   ADDIL   0xffdfe000,2
 File: unknown    Procedure: rca_site_resolve_upd + 0x000006b8    Line: unknown

Copyright Hewlett-Packard Co. 1985,1987-1992. All Rights Reserved.
<<<< XDB Version A.09.01 HP-UX >>>>
It appears that there's no debugging information in /opt/dcelocal/bin/rgy_edit (
UE445)
Core file from:  rgy_edit
Child died due to: segmentation violation
WARNING: /usr/lib/end.o was not linked with this program (UE836)
         Shared-library debugging cannot be made available (UE837)
Procedures:      0
Files: 0
>t
 0 rca_site_resolve_update + 0x000006b8 (Address not found (UE302)

[04/26/94 public]

I'm just guessing, but I think this defect could be the same as 10331.

[4/26/94 public]
The above traceback doesn't help much because it's not linked with end.o
(as the debugger error message states).

[5/4/94 public]
Duping to 10331 which fails with DNS style name.



CR Number                     : 10210
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : dcecp
Subcomponent Name             : acl
Short Description             : Replacing more than 2 ACL entries on initial container and initial object ACLs causes a core dump.
Reported Date                 : 3/22/94
Found in Baseline             : 1.1
Found Date                    : 3/22/94
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 10207
Fix By Baseline               : 1.1beta
Fixed In Baseline             : 1.1b9
Affected File(s)              : src/admin/dcecp/acl_edit.c
Sensitivity                   : public

[3/22/94 public]

Use automated FVT tests to verify:
(acl_replace_035_P thru acl_replace_042_P)

This is OK:
dcecp> acl rep /.:/jas1 -ic -acl {{unauthenticated r} {group subsys/dce/cds-admin rwdtcia}}
dcecp> acl rep /.:/jas1 -io -acl {{unauthenticated r} {group subsys/dce/cds-admin rwdtc--}}

This is NOT OK:
dcecp> acl rep /.:/jas1 -ic -acl {{unauthenticated r} {group subsys/dce/cds-admin rwdtcia} {any_other rwdtcia}}
dcecp> acl rep /.:/jas1 -io -acl {{unauthenticated r} {group subsys/dce/cds-admin rwdtc--} {any_other rwdtc--}}

May be related to CR10207: Replacing all ACL entries with 1 ACL entry.

[3/22/94 public]

Removed free((char *) replace_acl_entries); in dcp_acl_do_replace_entries().
This freed memory before call to sec_acl_replace().



CR Number                     : 10204
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : i486
S/W Ref Platform              : osf1
Component Name                : dts
Subcomponent Name             : 
Short Description             : fix /* warning message
Reported Date                 : 3/22/94
Found in Baseline             : 1.1
Found Date                    : 3/22/94
Severity                      : E
Priority                      : 4
Status                        : dup
Duplicate Of                  : 10457
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : time/common/dtssmsg_ultrix.h
Sensitivity                   : public

[3/22/94 public]
If you build dtssmsg_ultrix.h with the coding style guide switches to gcc,
you get a warning :

  time/common/dtssmsg_ultrix.h:100: warning: `/*' within comment

This comes (rather humorously) from the following line:

/*  *14    3-JUL-1991 11:35:20 COMUZZI "Eliminated /* embedded in a comment" */

[5/10/94 public]
This will be taken care of as part of code cleanup. There is little 
value in having a separate CR for each of the thousands of warnings
that will be fixed as part of code cleanup.



CR Number                     : 10181
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : bld
Subcomponent Name             : common makefiles
Short Description             : need to add Veritas/VISTA support to common makefiles
Reported Date                 : 3/18/94
Found in Baseline             : 1.1
Found Date                    : 3/18/94
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 11163
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : lbe/mk/osf.*.mk
Sensitivity                   : public

[3/18/94 public]
The DCE common makefiles do not currently provide support for using the
Veritas VISTA tools.  The common makefiles should be modified to permit
the use of a substitute compiler (covcc rather than gcc) with appropriate
comand line options.

[6/10/94 public]

As you can see in osf.std.mk (.include <hp.vista.mk>), HP has such
modifications already. osf.lib.mk, osf.obj.mk, osf.prog.mk, osf.std.mk and
hp.vista.mk files are changed. Just ask for it. :-) (If OSF takes it, it
will simplify our makefile merges.)

[06/10/94 public]
Could someone at HP check those into a branch so we could look at them?

[6/16/94 public]

I have checked them into the tatsu_s_vista branch. (It's been a long time
since I originally made this change. 2 years!) Just a couple of notes:

We only instrument the HP product version of DCE. We never did the vista
build for dce1.1. So you may need a little twist.

We only use the thread-safe version of cov3.o complied with CMA headers and

[6/16/94 public]

(My previous comment got truncated when I checked in.??? Here it continues...)

[6/16/94 public]

(It happened again. This time, I guess I know what caused it.)

We only use the thread-safe version of cov3.o complied with CMA headers
and +Z linker option, and link it into the libdce.sl shared library so that
even if the program is not instrumented we can get the coverage for libdce.
Obviously, some CMA files can't be instrumented.

We call covinit() from crt0.o. (Really one of functions called by _start()
in crt0.o, which lives in libdce, does "covinit((char *)0);
atexit(covdump);".)

I must forget something (I'm not one who does Vista build or runs the
instrumented cell). But, the instrumented compilation should work, though
linking and runtime errors may happen.

And don't forget those VISTAHOME, COV_SIG and HIT_FILE environment
variables.

(I can't recall what I wrote originally.)

[ sally 06/16/94 public]

The rats are willing to pick this up as planned after the majority of our
work is done for Beta - which should be next week.  If anyone can not wait
that long - then by all means - help yourself to doing the work.  
Thank you tatsu_s for sharing your implementation of Vista - we will
check it out and use where appropriate.  Thanks again.

[ sally 07/20/94 public]
This is just a status update to let you know that Ron Rizzo has been
working on this OT.  Thanks to help in testing from Martha
Lynch and debugging efforts from Andy Mckeen we are very close
to submitting a drb-request.

Ron has added the changes to the
common Makefiles to allow vista to be built when the
associated variables are set and the vista binaries
available.  This apparently allows you to collect
dynamic metrics.  We have also added the ablitiy to 
generate static metrics.  This
capability was added by Andy Mckeen to DME and was 
thought to be very beneficial by qa.  Ron Rizzo ported 
those changes to DCE and Andy was extremely helpful in
debugging them.

Ron has successfully built two components (threads and time)
on the at486 platform, and verified the output. We plan on
doing complete builds tonight on all three platforms
even though we only have binaries and licences for the 486 
platform, just to verify that changes to the common makefiles
have not introduced any other errors.


If the full builds are successful, Ron will be sending 
a drb-request and a mail message containing instructions on
how to enable these metrics and what to expect as output.

We do not plan on turning VISTA on in the regular
nightly builds as the output contains many warnings and the
time to build is greatly increased.  However once that 
capability exists within the common makefiles, developers and
qa engineers can turn it on for any component in their own
sandboxes.



CR Number                     : 10161
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : bld
Subcomponent Name             : test/rpc
Short Description             : move files to nosupport
Reported Date                 : 3/17/94
Found in Baseline             : 1.0.3
Found Date                    : 3/17/94
Severity                      : E
Priority                      : 3
Status                        : dup
Duplicate Of                  : 9481
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1
Affected File(s)              : in nosupport/test/rpc/idl_frontend and test/rpc/idl_frontend
Sensitivity                   : public

[3/17/94 public]

This is a hold over from the DCE1.0.3 endgame which fell through the
cracks due to lack of human resources on both the DCE dev side and the Rats.

The test/rpc/idl_frontend directory needs to be moved to nosupport.

[3/28/94 public]
 
dup of 9220.

[3/28/94 public]

oops the dup info was incorrect because 9920 is a doc defect which has
already been closed out. Re-opened this defect.

[3/29/94]
Moved from test/rpc/idl_frontend to nosupport/test/rpc/idl_frontend.
This is a low risk fix and is necessary.



CR Number                     : 10153
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : aud
Subcomponent Name             : auditcp
Short Description             : auditcp core dumps on command
when auditd not running
Reported Date                 : 3/16/94
Found in Baseline             : 1.1
Found Date                    : 3/16/94
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 9928
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[3/16/94 public]
Auditcp dumps core when issued the 'aud enable' command while auditd is not
running:

  root@gemini var/audit$ auditcp
  auditcp> aud enable
  Exception: communications failure (dce / rpc)
  Resources lost(coredump)

I didn't get much of a stack trace; 'gdb' reports that it died in
start_time() 

This happens on OSF1 and HPUX.



CR Number                     : 10146
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : 
Short Description             : export dtss_includes.h & add dce/
Reported Date                 : 3/16/94
Found in Baseline             : 1.1
Found Date                    : 3/16/94
Severity                      : D
Priority                      : 2
Status                        : dup
Duplicate Of                  : 10457
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : dtss_includes.h, common/Makefile
Sensitivity                   : public

[3/16/94 public]
dcecp uses some time header and idl files.  Not surprisingly since it is
recreating dtscp fucntionality.  As such, there are now some files in
src/time that were internal, that are now required by another component.
There are two things this bug covers:

 * dtss_includes.h should be exported to /usr/include/dce.  
   Note that this says exported, not installed.

 * dtss_includes.h should include dcedtsmsg.h with dce/.  
   dcedtsmsg.h is already being exported during the SAMIDL pass.

These changes will mean that dcecp can be build with just a populated
exported tree.  Currently we have to do a build in time/common so that we
can get files from the obj/<machine>/time/common tree.  A bad thing to do.

I made these changes and could build dcecp on an HP.  I did not try
building time (but it should work :-)

[03/16/94 public]
Don't do this.  dtss_includes.h defines no interfaces, it only
includes other header files and some of them are very random and
totally related to building DTS, not talking to it.  I mean,
<fcntl.h>, really now...

The file should NOT have dcedtsmsg.h; only those files that care about
status codes should #include it.  I had to be very careful about
the ordering of files in order to get dce_msg_define_msg_table to
compile.  I consider this further evidence in favor of point 1.

[5/25/94 public]
The DTS headers will be reorganized under code cleanup but dtss_includes.h
will not be exported.



CR Number                     : 10111
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dcecp
Subcomponent Name             : acl
Short Description             : acl error msg cleanup
Reported Date                 : 3/9/94
Found in Baseline             : 1.1
Found Date                    : 3/9/94
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 9950
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1
Affected File(s)              : dcp.sams
Sensitivity                   : public

[3/9/94 public]
Incorporate the suggested changes for the ACL messages from Kathy Digan's
review on 2/14/94.

Submitted this fix under CR 9950.



CR Number                     : 10082
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : sec
Subcomponent Name             : 
Short Description             : KRB5_CC_NOTFOUND returned unexpectedly
Reported Date                 : 3/7/94
Found in Baseline             : 1.1b3
Found Date                    : 3/7/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 10106
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[3/7/94 public]


There are some dfs applications which check for
rpc_s_auth_tkt_expired as a result of an rpc call
and if the error code is indeed rpc_s_auth_tkt_expired,
they will then attempt to refresh the identity.
This all worked nicely in 1.0.3a.

Now we are on 1.1 bl-3, and what I am seeing is that what
we are getting as an error code is KRB5_CC_NOTFOUND, which 
is some kerberos internal error code, when the identity expires.
Needless, to say this breaks DFS if you run it long enough or
have the defaults set short enough, because the applications
do not expect to receive this error code.

I am not sure if this is rpc's or security's doing regarding
not mapping this error code to something that an application
would expect to receive.  Or maybe this is a new 1.1 error code?

[5/3/94 public]
Exact same problem as reported in 10106.  Since that one has more info, (even
though it is newer), I'm dup'ing this CR to 10106.



CR Number                     : 10067
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : sec
Subcomponent Name             : passwd_export
Short Description             : 
passwd_export can clobber datafiles if more than one processes are running.
Reported Date                 : 3/4/94
Found in Baseline             : 1.0.3
Found Date                    : 12/28/93
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 9714
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[3/4/94 public]
If there are more than one passwd_export processes are running,
passwd_export can overwrite each other's data files.  

Also, a conditional check in passwd_export.c should be :
while ((GOOD_STATUS(&lstat)) && (mbrs_saved < num_members)),
instead of (mbrs_saved != num_members).  We suspect this
conditonal check is the cause of a run-wild ( in an infinite
loop) passwd_export.

[3/4/94 public]
This is a dup of 9714.



CR Number                     : 10060
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : aud
Subcomponent Name             : 
Short Description             : dce_config should support audit installation
Reported Date                 : 3/3/94
Found in Baseline             : 1.1
Found Date                    : 3/3/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 9625
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : dce_config
Sensitivity                   : public

[3/3/94 public]
dce_config should add a procedure for audit installation.  Shyh-Wei 
will send a request for submission.



CR Number                     : 10024
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : other
S/W Ref Platform              : other
Component Name                : sec
Subcomponent Name             : security local registry
Short Description             : unpriv'd lrgy access jams a lock
Reported Date                 : 2/26/94
Found in Baseline             : 1.0.2
Found Date                    : 2/26/94
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 9359
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : security/client/rca/sec_lrgy.c
Sensitivity                   : public

[2/26/94 public]
  If a process lacking write access to the local registry directory
calls sec_login_setup_identity() with a principal name that doesnot
exist withng the registry, the RCA locks the local registry as it looks
in all possible registries (cell-wide + local) for the absent prinicpal.
The locking of the lrgy is incorrect -- after locking the process' mutex
for the lrgy, the failure of open() to read the lrgy causes an error
exit from lrgy_read_lock() and the mutex remains locked. All callers of
lrgy_read_lock() see this error and never call the unlock routine.
  The result is that the following program will hang forever for
non-superusers.
	=======================================================
#include <pthread.h>
#include <dce/rpc.h>
#include <dce/dce_error.h>
#include <dce/sec_login.h>
#include <stdio.h>
#define BOOL_STRING(b) ((b) ? "TRUE" : "FALSE")
int main(argc, argv)
int argc;
char **argv;
{
  error_status_t      est;
  sec_login_handle_t  h;
  boolean32           bool;
  char                dce_err[dce_c_error_string_len];
  int                 scrap;
  char               *nonuser = "boogieman";
  if (argc > 1) nonuser = argv[1];
  printf("Trying back-to-back setups for user %s ...\n", nonuser);
  bool = sec_login_setup_identity(nonuser, sec_login_no_flags, &h, &est);
  dce_error_inq_text(est, &dce_err[0], &scrap);
  printf("First setup: bool %s, status: %s\n", BOOL_STRING(bool), dce_err);
  bool = sec_login_setup_identity(nonuser, sec_login_no_flags, &h, &est);
  dce_error_inq_text(est, &dce_err[0], &scrap);
  printf("Second setup: bool %s, status: %s\n", BOOL_STRING(bool), dce_err);
  sec_login_purge_context(&h, &est);
  printf("Purged that context\n");
  return 0;
}
	=======================================================
  The evident fix to to add an unlock of the mutex when the open of the
lrgy file fails, before leaving the locker routine.

[2/26/94 public]
 Whoa, this is a duplicate of CR 9359. Sorry.



CR Number                     : 9985
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : other
S/W Ref Platform              : other
Component Name                : cds
Subcomponent Name             : cdsd
Short Description             : Object appears to repeat forever
Reported Date                 : 2/21/94
Found in Baseline             : 1.0.2
Found Date                    : 2/21/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 7940
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[2/21/94 public]
 The B1 rating is intended to flag this for inspection; once the problem
is narrowed, please do assign it any other more appropriate rating.
.
  cdscp can ge asked to show an entry in our namespace and this entry
will be seen to repeat, evidently forever. Further details are
available, please instruct us how to obtain additional data.  
.
  Attached: sample output from the cds client utilities.
.

[sparc33-travis] getcellname
/.../rainier.dce.transarc.com

[sparc33-travis] cdscp show dir /.:/encina/testing/prakash-luna/tpm/prakash-luna_ecm
                        SHOW
                   DIRECTORY   /.../rainier.dce.transarc.com/encina/testing/prakash-luna/tpm/prakash-luna_ecm
                          AT   1994-02-21-16:42:33
            RPC_ClassVersion = 0100
                     CDS_CTS = 1993-09-13-19:44:55.700769100/c0-37-cf-05-aa-77
                     CDS_UTS = 1994-02-20-20:19:46.857153100/9e-62-0d-02-aa-77
              CDS_ObjectUUID = 006af374-cdb7-1c94-bb7b-c037cf05aa77
                CDS_Replicas = :
          Clearinghouse UUID = 000ed576-350e-1cd5-bee3-9e620d02aa77
                       Tower = ncadg_ip_udp:158.98.13.2[]
                Replica type = master
          Clearinghouse Name = /.../rainier.dce.transarc.com/walrus_ch
                 CDS_AllUpTo = 1994-02-21-04:29:57.304864100/9e-62-0d-02-aa-77
             CDS_Convergence = medium
           CDS_ParentPointer = :
               Parent's UUID = 004cb6ac-ca4b-1c94-bb7b-c037cf05aa77
                     Timeout = :
                  Expiration = 1994-02-21-15:19:46.817-05:
                   Extension = +1-00:00:00.000I0.000
                      MyName = /.../rainier.dce.transarc.com/encina/testing/prakash-luna/tpm/prakash-luna_ecm
        CDS_DirectoryVersion = 3.0
            CDS_ReplicaState = on
             CDS_ReplicaType = master
               CDS_LastSkulk = 1994-02-21-04:29:57.304864100/9e-62-0d-02-aa-77
              CDS_LastUpdate = 1994-02-20-20:19:46.857153100/9e-62-0d-02-aa-77
             CDS_RingPointer = 000ed576-350e-1cd5-bee3-9e620d02aa77
                   CDS_Epoch = 007d53e8-a50a-1cd6-8dea-9e620d02aa77
          CDS_ReplicaVersion = 3.0

[sparc33-travis] date
Mon Feb 21 16:43:09 EST 1994

[sparc33-travis] cdscp list obj /.:/encina/testing/prakash-luna/tpm/prakash-luna_ecm/\*
                        SHOW
                      OBJECT   /.../rainier.dce.transarc.com/encina/testing/prakash-luna/tpm/prakash-luna_ecm/cm
                          AT   1994-02-21-16:48:45
            RPC_ClassVersion = 0100
             RPC_ObjectUUIDs = 9e0f66007ace941cb8259e6209120000
                     CDS_CTS = 1993-09-13-19:48:11.867124100/c0-37-cf-05-aa-77
                     CDS_UTS = 1993-09-13-19:48:19.018381100/c0-37-cf-05-aa-77
                   CDS_Class = RPC_Entry
            CDS_ClassVersion = 1.0
                  CDS_Towers = :
                       Tower = ncadg_ip_udp:158.98.9.18[]
                  CDS_Towers = :
                       Tower = ncadg_ip_udp:158.98.9.18[]
                  CDS_Towers = :
                       Tower = ncadg_ip_udp:158.98.9.18[]
                  CDS_Towers = :
                       Tower = ncadg_ip_udp:158.98.9.18[]
                  CDS_Towers = :
                       Tower = ncadg_ip_udp:158.98.9.18[]
                  CDS_Towers = :
                       Tower = ncadg_ip_udp:158.98.9.18[]
                        SHOW
                      OBJECT   /.../rainier.dce.transarc.com/encina/testing/prakash-luna/tpm/prakash-luna_ecm/dakota.transarc.com
                          AT   1994-02-21-16:49:02
            RPC_ClassVersion = 0100
             RPC_ObjectUUIDs = 281d100033cf941c92719e6209120000
                     CDS_CTS = 1993-09-13-19:51:16.312332100/c0-37-cf-05-aa-77
                     CDS_UTS = 1993-09-13-19:51:19.487711100/c0-37-cf-05-aa-77
                   CDS_Class = RPC_Entry
            CDS_ClassVersion = 1.0
                  CDS_Towers = :
                       Tower = ncadg_ip_udp:158.98.9.18[]
                  CDS_Towers = :
                       Tower = ncadg_ip_udp:158.98.9.18[]
                  CDS_Towers = :
                       Tower = ncadg_ip_udp:158.98.9.18[]
                        SHOW
                      OBJECT   /.../rainier.dce.transarc.com/encina/testing/prakash-luna/tpm/prakash-luna_ecm/mondProfile
                          AT   1994-02-21-16:49:03
            RPC_ClassVersion = 0100
                 RPC_Profile = <empty set>
                     CDS_CTS = 1993-09-13-19:58:47.457809100/c0-37-cf-05-aa-77
                     CDS_UTS = 1993-09-13-20:35:16.462905100/c0-37-cf-05-aa-77
                   CDS_Class = RPC_Entry
            CDS_ClassVersion = 1.0
                        SHOW
                      OBJECT   /.../rainier.dce.transarc.com/encina/testing/prakash-luna/tpm/prakash-luna_ecm/mondProfile
                          AT   1994-02-21-16:49:05
            RPC_ClassVersion = 0100
                 RPC_Profile = <empty set>
                     CDS_CTS = 1993-09-13-19:58:47.457809100/c0-37-cf-05-aa-77
                     CDS_UTS = 1993-09-13-20:35:16.462905100/c0-37-cf-05-aa-77
                   CDS_Class = RPC_Entry
            CDS_ClassVersion = 1.0
                        SHOW
                      OBJECT   /.../rainier.dce.transarc.com/encina/testing/prakash-luna/tpm/prakash-luna_ecm/mondProfile
                          AT   1994-02-21-16:49:17
            RPC_ClassVersion = 0100
                 RPC_Profile = <empty set>
                     CDS_CTS = 1993-09-13-19:58:47.457809100/c0-37-cf-05-aa-77
                     CDS_UTS = 1993-09-13-20:35:16.462905100/c0-37-cf-05-aa-77
                   CDS_Class = RPC_Entry
            CDS_ClassVersion = 1.0
                        SHOW
                      OBJECT   /.../rainier.dce.transarc.com/encina/testing/prakash-luna/tpm/prakash-luna_ecm/mondProfile
                          AT   1994-02-21-16:49:18
            RPC_ClassVersion = 0100
                 RPC_Profile = <empty set>
                     CDS_CTS = 1993-09-13-19:58:47.457809100/c0-37-cf-05-aa-77
                     CDS_UTS = 1993-09-13-20:35:16.462905100/c0-37-cf-05-aa-77
				   .
				   .
				   .
				   .
			   (forever and ever)
				   .
				   .
				   .
				   .
^O^C

[sparc33-travis] cdscp list obj /.:/encina/testing/prakash-luna/tpm/prakash-luna
_ecm/\*
                        LIST
                      OBJECT   /.../rainier.dce.transarc.com/encina/testing/prakash-luna/tpm/prakash-luna_ecm
                          AT   1994-02-21-16:50:55
cm
dakota.transarc.com
mondProfile
mondProfile
mondProfile
mondProfile
mondProfile
mondProfile
mondProfile
mondProfile
mondProfile
mondProfile
mondProfile
mondProfile
mondProfile
mondProfile
mondProfile
mondProfile
mondProfile
mondProfile
mondProfile
	   .
	   .
	   .
	   .
   (forever and ever)
	   .
	   .
	   .
	   .
^O^

[2/22/94 public]
There was nothing in the above that would lead me to believe that this is
a security problem, so I'm assuming that it was a mistake that this was
assigned to 'sec' and have reassigned it to 'cds'.

[2/22/94 public]
  Just reviewing to make sure no other of my usual defaults got through.
Also changed the component to 'cdsd', as I have stepped through our own
client (cdsls) and it seems to be getting these repeated responses from
the server, not manufacturing them on its own; coupled with the fact
that cdscp agrees, I'd say the bug is in cdsd itself.
Changed Subcomponent Name from `cdscp' to `cdsd'

[6/13/94 public]
I believe this is a sympton of CR 7940 which was fixed for 1.0.3



CR Number                     : 9962
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : rpc
Subcomponent Name             : CN runtime
Short Description             : When auth. RPC using CN faults it maps any fault into call orphaned status (0x16c9a05e)
Reported Date                 : 2/16/94
Found in Baseline             : 1.0.3
Found Date                    : 2/16/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 9550
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : rpc/runtime/cnsclsm.c
Sensitivity                   : public

[2/16/94 public]

When application would use authenticated CN RPC and the call faults in the
server manager routine, the CN runtime incorrectly returns the fault code
rpc_s_call_orphaned (0x16c9a05e). It looses the correct falult status that
was returned to it from the IDL library code.

To reproduce the error you can run the test/rpc/runtime/perf test. Run the
server and client as show below (the principal 'perf' has to be created and
its a/c and key should be created with password -dce-):

./server -p1,perf 1 ncacn_ip_tcp
./client -p1,2,5,perf 9 'ncacn_ip_tcp:140.231.30.192[2001]'

The test fails with the message that it got wrong exception. It was expecting
IntZeroDivide (0x1c000001) fault.

The action routine abort_resp_action_rtn() (file rpc/runtime/cnsclsm.c) that is
called from abort_resp_send_fault_action_rtn() should count in the iovec for 
the authentication trailer as shown below in #ifdef SNI_SVR4. This fix is a
generic fix and the #ifdef should be taken off:

     /*
      * If there are buffered iovector elements, deallocate them.
      *
      * Note that the comparison below is not strictly correct.
      * Even if there is only a single iovector element, there
      * may be copied stub data after the header.  It's ok to
      * ignore them because the only way in which the first
      * iovector element would be reused is if we use it to send
      * a fault.  That operation would adjust the pointers
      * anyway to point to only the fault data.
      */
+#ifdef SNI_SVR4
+    if (call_rep->sec == NULL && RPC_CN_CREP_IOVLEN (call_rep) > 1 ||
+        RPC_CN_CREP_IOVLEN (call_rep) > 2)
+#else
     if (RPC_CN_CREP_IOVLEN (call_rep) > 1)
+#endif /* SNI_SVR4 */
     {
         rpc__cn_dealloc_buffered_data (call_rep);
 
         /*
          * This will keep the call_end_action_rtn from attempting to
          * send the remaining iov which at this point is only an auth_tlr
          * if this was an authenticated call.  We are calling this an
          * orphaned call which technically, it is, ie the connection is
          * gone and along with it the association.
          */
         call_rep->cn_call_status = rpc_s_call_orphaned ;

[2/16/94 public]

Dup'ing. So there are at least two ways to fix this...  I think that
abort_resp_send_fault_action_rtn() shouldn't call abort_resp_action_rtn().

[2/16/94 public]

I think even if we take out call abort_resp_action_rtn() from the routine
abort_resp_send_fault_action_rtn() (which I am not sure is "the correct
thing"), we should apply the fix suggested here. The obviously incorrect
comparison 'RPC_CN_CREP_IOVLEN (call_rep) > 1' should be fixed.

[2/17/94 public]

I didn't mean just taking out call to abort_resp_action_rtn(). What I was
trying to say is that abort_resp_send_fault_action_rtn() should do the
AbortResp action without calling abort_resp_action_rtn(). If we look at the
server call state machine specification, you'll find that the AbortResp
action is defined as "discontinue any further transmission of normal
response data". It is not supposed to set any call status. The fix for
OT8068 broke this because it didn't pay attention to the fact that
abort_resp_action_rtn() is called by abort_resp_send_fault_action_rtn().

[2/17/94 public]

Aren't you implying the same thing here? Anyway, OT8068 indeed seems to have
broken this routine. Setting the call status is creating this problem. However,
send_call_fault_action_rtn() already does call 'rpc__cn_dealloc_buffered_data
(call_rep);' then there is no need for the action 
abort_resp_send_fault_action_rtn() to call to abort_resp_action_rtn() as you
said and I agree. Yet, we need to fix the incorrect comparison that ignores
the fact that RPC_CN_CREP_IOVLEN (call_rep) would be 2 for CN auth call.

Many places 'RPC_CN_CREP_IOVLEN (call_rep) = 1' is incorrect as it ignores
CN auth situation. However, in all cases I checked, this statement is harmless
since it is never used, rather it is overwritten by correct values when it
is actually used.



CR Number                     : 9961
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : gds
Subcomponent Name             : 
Short Description             : libraries built during BASIC pass
Reported Date                 : 2/16/94
Found in Baseline             : 1.1
Found Date                    : 2/16/94
Severity                      : E
Priority                      : 4
Status                        : dup
Duplicate Of                  : 9977
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[2/16/94 public]
There are a number of libraries which are re-built during the BASIC
(commands) pass.  To start the list:

gds/cacheadm/adm_iapl: libaaplv2c.a
gds/cacheadm/adm_sch:	libadmschc.a
gds/cacheadm/admin:	libadmv2ec.a
gds/cacheadm/delupd:	libdupdc.a
gds/asn1:		libd24asn.a
			libd2aasn.a
			libdirasn.a
gds/adm/adm_iapl:	libaplv2.a
gds/adm/adm_dump	libdump.a
gds/adm/adm_sch:	libadmsch.a
gds/adm/admin:		libadmv2e.a
gds/adm/adm_tree	libtree.a
gds/cache:		libduac.a
gds/dsa:		libd26dsa.a
gds/ipc:		libd23.a
			libd23nodeb.a
gds/osiadr:		libosiaddr.a
gds/oss/prod:		liboss.a
gds/oss/tools:		libstep.a
gds/ros/Product/Sources:libros.a
gds/ros/sh:		libshth.a
... and my build is still going ..

hmmm ... sounds like it could be every library which is rebuilt in GDS.



CR Number                     : 9906
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : aud
Subcomponent Name             : libaudit
Short Description             : libaudit ar'ed twice in build
Reported Date                 : 2/8/94
Found in Baseline             : 1.1
Found Date                    : 2/8/94
Severity                      : E
Priority                      : 3
Status                        : dup
Duplicate Of                  : 9977
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[2/8/94 public]
ar is run twice when building libaudit.a.



CR Number                     : 9884
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : cfg
Subcomponent Name             : dcecp
Short Description             : dcecp needs to be installed by dce_config
Reported Date                 : 2/3/94
Found in Baseline             : 1.1
Found Date                    : 2/3/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 9771
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[2/3/94 public]

dcecp needs to be installed by dce_config. This includes all the dcecp
scripts.

[2/3/94 public]

This problem was already added to CR 9771



CR Number                     : 9821
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : i486
S/W Ref Platform              : osf1
Component Name                : utils
Subcomponent Name             : src/libdce
Short Description             : Undefined symbol "_dbopen" referenced
Reported Date                 : 1/26/94
Found in Baseline             : 1.1
Found Date                    : 1/26/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 9814
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b2
Affected File(s)              : libdce_1.o
Sensitivity                   : public

[1/26/94 public]

The "libdce/Makefile" had been changed as part of a "dce/utils" fix.

During the compilation of the first piece of library "libdce" the following
error occurred, breaking the build of "libdce":

[ /libdce ]

/project/dce/build/dce1.1-snap/tools/at386/macho/ld -R -export_default \
  libdce: -L/u1/devobj/sb/nb_486/export/at386/usr/shlib \
  -L/project/dce/build/dce1.1-snap/export/at386/usr/shlib \
  -L/usr/shlib -L/u1/devobj/sb/nb_486/export/at386/usr/lib \
  -L/project/dce/build/dce1.1-snap/export/at386/usr/lib \
  -o libdce.so.X libdce_1.o libdce_2.o libdce_3.o libdce_4.o  -lc -lbsd \
  /project/dce/build/dce1.1-snap/tools/at386/macho/gnulib
libdce_1.o: Undefined symbol "_dbopen" referenced

collect: /project/dce/build/dce1.1-snap/tools/at386/macho/real-ld returned \
  1 exit status
*** Error code 1
`build_all' not remade because of errors.

[1/27/94 public]
This was all cause by Makefile and directory shuffling, as outlined
in CR 9814.  It should all be considered one bug.



CR Number                     : 9798
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : ./time/common
Short Description             : include file dcedtsmsg.h missing
Reported Date                 : 1/22/94
Found in Baseline             : 1.1
Found Date                    : 1/22/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 9708
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1
Affected File(s)              : time_support.c
Sensitivity                   : public

[1/22/94 public]
Errors in the build of Friday night, Jan 21, 1994:

/project/dce/build/dce1.1-snap/src/time/common/time_support.c
Processing include file
/project/dce/build/dce1.1-snap/src/time/common/dtss_includes.h 
    1501-106: (S) Include file dcedtsmsg.h not found.
*** Error code 1

/project/dce/build/dce1.1-snap/src/time/common/arith.c
Processing include file
/project/dce/build/dce1.1-snap/src/time/common/dtss_includes.h
    1501-106: (S) Include file dcedtsmsg.h not found.
*** Error code 1

/project/dce/build/dce1.1-snap/src/time/common/dtss_error_unix.c
Processing include file
/project/dce/build/dce1.1-snap/src/time/common/dtss_includes.h
    1501-106: (S) Include file dcedtsmsg.h not found.
*** Error code 1

[ rrizzo 1/24/94 public ]

This OT duplicates OT 9804 which was filed against a more recent build
so I'm closing this one.

[01/24/94 public]
Marked it dup, not closed.



CR Number                     : 9759
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : dfs
Subcomponent Name             : libafs
Short Description             : libafs depends on libktkc.a which was not built
Reported Date                 : 1/17/94
Found in Baseline             : 1.0.3a
Found Date                    : 1/17/94
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 9754
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[1/17/94 public]

file/tkc got a signal 10 on the HPUX platform - (CR 9754)

Since libafs depends on libktkc.a, it was not built.

[1/17/94 public]
THis is a dup of 9754.



CR Number                     : 9758
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : dfs
Subcomponent Name             : noship directory
Short Description             : noship directory did not build
Reported Date                 : 1/17/94
Found in Baseline             : 1.0.3a
Found Date                    : 1/17/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 9754
Fix By Baseline               : 1.0.3a
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[1/17/94 public]

Never got built at all.  make just die.  Not sure why.

[1/19/94 public]
Assigned to annie to verify that using the right set of ode
tools makes this problem disappear.



CR Number                     : 9757
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : dfs
Subcomponent Name             : file/epidummy
Short Description             : build of file/epidummy caused compilation errors
Reported Date                 : 1/17/94
Found in Baseline             : 1.0.3a
Found Date                    : 1/17/94
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 9754
Fix By Baseline               : 1.0.3a
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[1/17/94 public]

Not sure about this one as the library got created but make
seems to have die.

[1/19/94 public]
Assigned to annie to verify that using the right set of ode
tools makes this problem disappear.



CR Number                     : 9755
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : bld
Subcomponent Name             : libdce's build
Short Description             : ranlib after ar was executed
Reported Date                 : 1/17/94
Found in Baseline             : 1.0.3a
Found Date                    : 1/17/94
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 8329
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[1/17/94 public]

The Makefile for libdce has its own ar.  This is incorrect.

First of all, the ar rules should have come from the common
Makefiles.  

In addition, the fact that the library has been ar and why 
does it needs to be ranlib beats the hell out of me.

For now, we can ignore this error.  In fact if folks agree,
we can consider this as a warning.  Let me know as I need
to change my script.

[1/17/94 public]
Not sure who's responsible for the libdce build these days -
assigning to unknown component and lowering priority so
the core folks can figure out what needs to be done with 
this.

[1/19/94 public]
Dupping this defect.



CR Number                     : 9704
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : kinit
Short Description             : kinit man page error
Reported Date                 : 1/7/94
Found in Baseline             : 1.0.3
Found Date                    : 1/7/94
Severity                      : D
Priority                      : 3
Status                        : dup
Duplicate Of                  : 9378
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[1/7/94 public]

The kinit -l or -r parameters (which specify lifetimes) are documented 
in the kinit man-page as taking paramteres that specify the number of hours
that the credentials should remain valid for. In fact, just specifying a
number gives the number of minutes, not hours. The paramter can be
specified as <nni> where nn would be an integer and i is an indicator as
in 3h meaning 3 hours.

There are obvious internationalization problems with this.

The man page should be fixed, but longer term the code should be fixed

[1/7/94 public]
Inadvertent change introduced late in l.0.3.



CR Number                     : 9642
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : cds
Subcomponent Name             : 
Short Description             : cdsd crashes enumerating objects in a corrupted directory
6~
Reported Date                 : 12/21/93
Found in Baseline             : 1.0.3
Found Date                    : 12/21/93
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 7940
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[12/21/93 public]

We have had 6 or 7 customer reports of cdsd crashes when
enumerating objects (via cdscp list obj /.:/dir1/dir2/*
or via an expand all operation in the cdsbrowser) in
an apparently corrupted directory in the namespace.
The cdsd can be restarted and functions correctly until
that directory is again enumerated, at which time it
core dumps again.  This problem persists through the
deletion of the clerk cache and restart of cdsadv, so
it is definitely in the server database.

The problem is intermittant and rare.  Rerunning the same
application in the same way does not immediately reproduce
the crash.  The crash was observed with a test program for
an object-oriented library (which twice corrupted a particular
test directory), with Encina, and with an application built
on top of Encina (which thrice corrupted a particular
directory).  We have not been able to reproduce the problem
in our lab.

The code is HP DCE 1.1 (based on OSF DCE 1.0.3).

The problem does not appear to be due to any resource
limitations on the systems involved.

This problem was thought to be related to a write of
unchecked length into the server database (OT9071).
But Alan Peckham at DEC has examined a database dump
a cell with this problem, and found no evidence of
overlong data structures.  The database does have
obsolete information from previous operations which
indicate considerable cds activity in the corrupted
directories.

A server database dump produced with the cds_dbdump tools
can be found in /afs/dce.osf.org/project/dce/hp/cr9017/dbdumpc.

Core files show a segment violation and similar tracebacks:

 0 entry_read_next + 0x00000104 (0x40534768, 0, 0x404423b5, 0x405ad844)
 1 db_entry_read_next + 0x00000060 (0x40534768, 0x40628109, 0x40441f98, 0x4044
 2 build_name_set + 0x00000608 (0x40534768, 0x404415e8, 0x40441c5c, 0x40441d60
 3 ta_enumerate + 0x0000023c (0x404415e8, 0x40624078, 0x40441c5c, 0x40441d60)
 4 cds_EnumerateObjects + 0x000001d0 (0x405ac438, 0x4043eaec, 0x4043e9e6, 0x40

 0 entry_read_next + 0x000000e4 (0x3, 0, 0, 0)
 1 db_entry_read_next + 0x00000058 (0, 0x405d1af0, 0x40748110, 0x400fe7cc)
 2 build_name_set + 0x000005a8 (0x40100dd0, 0, 0, 0x400fe810)
 3 ta_enumerate + 0x00000238 (0, 0, 0, 0x400fe152)
 4 cds_EnumerateObjects + 0x00000200 (0x400fd660, 0, 0, 0)

This problem produces a cdsd crash and can only be corrected
by a reconfiguration of the cell, with the loss of all naming
data.  It has been seen at three different customer sites.
Setting severity/priority to A0.

[12/22/93 public]
The database dump shows that the directory
/.:/koscom.encina.tpm.Monsoon.server
is corrupted.  The marker which indicates the end of directory is missing.
We have never seen this before.  It appears to be related to 'large'
records => an entry requiring over 16k of storage.  All three
entires in this directory are large.  

I have not been able to re-create the problem.  Can you find out more about
the history of this directory.  It currently has 3 entries, querya1,
querya2 and queryb1.  Have there been alot of creates/deletes in this
directory, or have these 3 objects been alone.  

janet

[12/28/93 public]
Verify that you have ot fix 7940.  This was fixed 10/23/93 and you original
problem report for ot 9071 is dated 10/7/93

[1/11/94 public]
This has been verified by us and HP to be a duplicate of 7940



CR Number                     : 9607
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : rpc
Subcomponent Name             : runtime?
Short Description             : pkt_priv protection fails over
UDP with new binding per call
Reported Date                 : 12/10/93
Found in Baseline             : 1.0.3
Found Date                    : 12/10/93
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 9614
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[12/10/93 public]
The explanation for the somewhat cryptic short deescription is this:
  I was testing fixes to the rpc.cds.3 system test for intercell, and was
  getting really poor results; 1/3 to 1/2 of the calls got rejected
  with "unknown reject".  So I started trying different things....

  What I ended up with is this:  If I run rpc.cds.3, inter cell or intra
  cell, using pkt_priv protection, and specifying UDP bindings only, then
  the first call succeeds, and all subsequent calls, through that binding
  or any others, fails with the "unknown reject" error.  The short description
  reflects the following two datapoints:
     1. The rpc.sec.2 system test, run in the same cell, works correctly
        for all protection levels and protocols.  Note that there are two
        major differences between rpc.sec.2 and rpc.cds.3:
          1. rpc.sec.2 gets a binding and uses it for the duration of 
             the test run; rpc.cds.3 goes to the namespace for a new
             binding before each call to the server.

          2. rpc.sec.3 gets bindings directly from the server CDS entry;
             rpc.sec.2 gets an object UUID from a namespace entry and then
             pulls a binding from the server entry via a group attribute.

    2. The rpc.cds.3 system test functions properly for all protection
       levels a protocols except for pkt_priv.  This indicates to me that
        the test code is basically sound.

 Some might argue the high prio/sev, but group attributes and data
 encryption are an important part of the value and usefulness of DCE.
 Let me know if you disagree.   Unfortuneatly, I have no more time to 
 spend on this at present.  I would guess that the next steps would be
 something like:
    Make rpc.cds.3 not use group attributes and see what happens;

    Make rpc.cds.3 use the same binding for the entire test (defeats the
    purpose of the test, but might help debugging.

    Make rpc.sec.2 use group attribute and see what happens.

    Start digging at the code.

[12/14/93 public]

Or use RPC_DEBUG to get the detailed reject status. RPC_DEBUG=0.1 will
produce: "(queue_mapped_reject) st=0xXXXX => 0xYYYY...". Also note that
there are other pkt_privacy related CRs, i.e., 9614, 9551 and 8643.

[12/16/93 public]
Looked at the RPC_DEBUG output of running this test, and determined that
I am seeing the same error as is described in 9614;  I get it because I use
a new binding every call, as opposed to 9614 which does a binding_reset per
call.  Duped.



CR Number                     : 9578
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : i486
S/W Ref Platform              : osf1
Component Name                : thr
Subcomponent Name             : 
Short Description             : pthread.h doesn't compile with "-ansi"
Reported Date                 : 12/7/93
Found in Baseline             : 1.0.3
Found Date                    : 12/7/93
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 9579
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : cma_config.h exc_handling.h
Sensitivity                   : public

[12/7/93 public]
I tried to compile a gds source including pthread.h with gcc on AT386.
If the "-ansi" flag is not set gcc sets "-Di386" and "-D__i386__".
If I set the "-ansi" flag gcc will not set "-Di386". Because of that
_CMA_HARDWARE and  _EXC_HARDWARE_ are not defined; so the mentioned
files do not compile.
I changed in both files "i386" to "__i386__"; that works. Only
one warning comes in cma.h: the prototype for cma_t_call_routine
is not correct. That is acceptable.
I assigned A0 because all guys here are working on the code clean
which means especially to compile with gcc and "-ansi" and a lot of other
switches on AT386.

[10/07/93 public]
The threads code cleanup is scheduled as a 1.1 requirement. I've opened
up a bug, 9579, ass a place holder for this work. This bug is a dup of
that.



CR Number                     : 9573
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : 
Short Description             : dfs fails to copy file when cache size cannot be increased
Reported Date                 : 12/3/93
Found in Baseline             : 1.0.3
Found Date                    : 12/3/93
Severity                      : A
Priority                      : 2
Status                        : dup
Duplicate Of                  : 4040
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[12/3/93 public]
I was trying to copy a file from DFS to a native file system and kept
getting the following eror:

779 ->cp fts.runtests.log /tmp/fts.ufs.log
cp: fts.runtests.log: There is an input or output error.

This error message gave me no clue as to the real problem. I had created
the dfs cache on disk in the /opt file system I had created. However, I
don't believe at the time of the copy that there was enough disk space to
allow the cache size to grow. I deleted some files that were in the /opt
file system and then I was able to copy the file.

questions:
1) Why can't dfs report an error on trying to increase the cache size?
2) Why can't dfs just purge old information from the cache? When the
	request to expand the cache fails, purge the cache until enough
	cache is available. If this fails then report an error that
	is meaningful, such as "dfs: cache to small for requested operation".

[12/10/93 public]
Defer to 1.1, drop priority, change to enhancement.  I believe this 
is a documented restriction on cache size.  You must have enough disk space
pre-allocated for your cache plus some small ancillary files.
You must not let other files infringe on that space else you
may get a panic.  I'm surprised you did not get one here.  It 
is recommended in the docs that you put your cache in it's own 
filesystem.



CR Number                     : 9539
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : sec
Subcomponent Name             : 
Short Description             : Secd maintenance in infinite loop
Reported Date                 : 11/23/93
Found in Baseline             : 1.0.3
Found Date                    : 11/23/93
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 9273
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[11/23/93 public]

Full Description:

	Using sec_admin to put security server into and out of maintenance
	mode, I have experienced the secd getting into infinite loop. I had

	to kill secd and restart it.

Repeat By:

	This does not happen very often. It seems that it happens once every
	three times or so.

	Do the following:

	$ sec_admin
	sec_admin> state -maintenance
	sec_admin> state -service

	A coiple of times. Then you will see "state -service" hanging there,
	not returning. Checking secd will show that it is running all the
	time, making heavy use of CPU.

	Kill secd and restart it. Go into sec_admin and do a "info -full" and
	you will see the secd is still in maintenance mode.

	Looks like it was trying to get out of maintenance mode by
	reloading or reinitializing the database, somehow it just got into
	an infinite loop.

Jean Hsiao had a similar experience with secd in an infinite loop.



CR Number                     : 9525
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : sec_pkl
Short Description             : cut & paste error in sec_pkl.c
Reported Date                 : 11/22/93
Found in Baseline             : 1.0.3
Found Date                    : 11/22/93
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 9939
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : security/utils/sec_pkl.c
Sensitivity                   : public

[11/22/93 public]

From mail Ping sent me:

   Date: Mon, 22 Nov 93 14:10:44 EST
   From: "Ping Lin" <PLIN@TOROLAB6.VNET.IBM.COM>

   Bill,

       Something that I noticed while reading through
sec_id_pac_t_unpickle:
   in the last IF that deals with foreign groups, there is a segment:

	   if (Z == 0)
	   {
	       data->groups=(*allocator)(1);
	   }

   Should this be data->foreign_groups?

This is indeed a bug...

[05/03/94 public]
This is a dup of 9939.  This one was created first, but since that one has
a lot more commentary in it (on 4/8byte alignment), I decided to dup this one
to that one, to make sure we keep the commentary in the open one that will be
looked at while fixing the problem.



CR Number                     : 9430
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : CM
Short Description             : TSR did not recover the lock hold by a client.
Reported Date                 : 11/10/93
Found in Baseline             : 1.0.2a
Found Date                    : 10/13/93
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 9429
Fix By Baseline               : 1.0.2a
Fixed In Baseline             : 
Affected File(s)              : some
Sensitivity                   : public
Transarc Status               : import
Transarc Deltas               : 
Transarc Herder               : andi@transarc.com

[11/10/93 public]
**Description Text**
 Three machines configured by 3.35 (M1, M2, and M3). M1 and M3 were running
 ITL tsr script to try lock (M1 held the lock and M3 was trying). After a reboot
 of M2 where the fileset the test file located exported, M1 still held the
 lock but M3 can get the lock. 
 
 jess-Wed, 13 Oct 1993 13:59:15
 
 ----------------------------------------------------------------------
 
 So far, this is correct.  If M2 crashes, M1 should discard its lock
 tokens and mark the file bad with ESTALE; M3 should be able to get the
 lock.
 
 Basically, lock tokens are treated specially.  As a long-lived token,
 for M1's CM to claim that the lock continues to be held throughout the
 crash, it would have to know things that M2's implementation can't yet
 tell it--designed and architected, but not implemented--so the upshot
 is that CMs lose lock tokens when a server crashes.  The test should
 be that M1 marks the file with ESTALE.  This is one of the things
 tested in Tu's hand tests.
 
 I'm marking this as RETURNED, for clarification as to whether Jess et al.
 still think there's a bug.
 
 cfe-Thu, 14 Oct 1993 09:03:45
 cfe-Thu, 14 Oct 1993 09:05:03
 
 -------------------------------------------------------------------------------
 
 Yes, Craig is right. M1 did get a ESTALE after M2 is rebooted. Then we
 have to change our test scenario accordingly. 
 
 Now let talk about a related problem that is the case of network partition.
 When disconnecting M2 for 105 seconds and then putting it back, M1 held
 the lock and everything was ok with M1 (No ESTALE returned) but M3 got the
 lock. It is ok to disconnect M2 for 30 seconds. Craig could you confirm if
 this is a problem or not. If it is I am going to reopen the defect.
 jess-Thu, 14 Oct 1993 11:59:39
 
 ---------------------------------------------------------------------------
 
 [cfe 14 Oct 1993]
 It should never be the case that M1 and M3 have conflicting locks and neither
 one returns ESTALE.  I'm not sure what the problem is.  To diagnose this,
 it would be most helpful to have dfstrace results (of the cmfx log) for all
 three machines immediately after the discrepancy is noted.  Thanks.
 
 cfe-Thu, 14 Oct 1993 13:01:25
 
 ---------------------------------------------------------------------------
 
 [cfe 15 Oct 1993]
 
 Some more diagnosis.  The server that has the token goes down and the client
 holding the lock (M1) doesn't do partition-TSR until after the lock-grabber
 (M3) does TSR and grabs the lock.  Thus, the server has legitimately marked
 M1 as down, granting the token.  What's bogus is that if the first call
 that M1 does is to release the lock, the file isn't marked with ESTALE;
 TSR happens but the file has no locks (by the time releaselockf tries to
 store the lock token back), so nothing is upset when the lock token cannot
 be renewed.  Unfortunately, the application cannot tell that the lock had
 been lost some time earlier; nothing marked the file with ESTALE.  Had TSR
 taken place some other time than while releasing the lock, this condition
 probably would not have happened.
 
 The CM had indeed marked the server as down.
 cfe-Fri, 15 Oct 1993 15:24:12
 
 ---------------------------------------------------------------------
 
 [cfe 10/18/93]
 The way to fix the problem is probably to check, when doing any lock work
 and particularly doing an unlock, that the CM can guarantee tokens--that
 the server isn't in TSR mode and there's been a successful RPC to the
 server within the server's HostLifetime.  If there hasn't been, then the
 CM should force an RPC (and concomitant possible TSR work) before proceeding
 with the lock.
 
 However, the window in which this problem seems to occur is pretty small,
 and is not as pressing a problem as it first appears.  That is, it seems to
 be a special case of TSR not working, not a general case.
 cfe-Mon, 18 Oct 1993 09:28:38
**Solution Text**
 Delta: cfe-db4486-ignore-tokens-on-old-hosts
 cfe-Thu, 21 Oct 1993 09:24:07
 
 Entered as OT 9429
 
 andi-Wed, 10 Nov 1993 10:53:22
**Validation Text**

[11/10/93 public]
  Moved from Transarc database and in dfs-osf-1.5
Added field Transarc Herder with value `andi@transarc.com' 
Added field Transarc Status with value `import'

[11/10/93 public]
Changed Status from `open' to `dup' 
Filled in Duplicate Of with `9429'



CR Number                     : 9427
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : CM
Short Description             : file append gets ESTALE
Reported Date                 : 11/10/93
Found in Baseline             : 1.0.2a
Found Date                    : 10/13/93
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 9426
Fix By Baseline               : 1.0.2a
Fixed In Baseline             : 
Affected File(s)              : some
Sensitivity                   : public
Transarc Status               : import
Transarc Deltas               : 
Transarc Herder               : andi@transarc.com

[11/10/93 public]
**Description Text**
 This is a problem introduced with the TSR protocol revs that attempt
 to handle the situation where an AFS_SetContext is called for the
 first time to a server from the secondary interface. In order for
 these changes to work AFS_SetContext calls had to be serialized. This
 has the side effect that it can cause an AFS_SetContext call in the
 primary interface to block an AFS_SetContext call in the secondary
 interface. Since calls on the primary interface are not protected from
 thread starvation this is bad news.
 Dimitris Varotsis
 Tue Oct 19 11:01:00 1993
 dimitris-Tue, 19 Oct 1993 11:01:06
**Solution Text**
 Delta: cfe-db4482-move-servermutex-to-connandreset 
 Backed by dfs-103 3.35
 cfe-Tue, 19 Oct 1993 15:40:48
 
 Entered as OT 9426
 
 andi-Wed, 10 Nov 1993 10:51:09
**Validation Text**

[11/10/93 public]
  Moved from Transarc database and in dfs-osf-1.5
Added field Transarc Herder with value `andi@transarc.com' 
Added field Transarc Status with value `import'

[11/10/93 public]
Changed Status from `open' to `dup' 
Filled in Duplicate Of with `9426'



CR Number                     : 9421
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : EPISODE
Short Description             : There is no synchronization between volops and rm due to the inactive daemon
Reported Date                 : 11/10/93
Found in Baseline             : 1.0.2a
Found Date                    : 10/13/93
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 9420
Fix By Baseline               : 1.0.2a
Fixed In Baseline             : 
Affected File(s)              : some
Sensitivity                   : public
Transarc Status               : import
Transarc Deltas               : 
Transarc Herder               : andi@transarc.com

[11/10/93 public]
**Description Text**
 Before the inactive daemon the entire rm operation was completed
 between a vol_StartVnodeOp vol_EndVnodeOp clause so it was
 synchronized with the volops. Due to the introduction of the inactive
 daemon the VN_RELE call is executed asynchronously thus it can race
 with a volop. This bug causes the kernel to panic when it tries to do
 the epif_ChangeLink call and finds the anode refcount to be 2 instead
 of 1. (volops get the anode without going through the vnode layer)
 Dimitris Varotsis
 Thu Oct 14 07:18:04 1993
 dimitris-Thu, 14 Oct 1993 07:18:10
**Solution Text**
 blake-db4491-volops-must-wait-for-inactive-daemon.
 
 Add synchronization so that vnm_StopUse can wait for inactive
 processing to complete before returning.
 blake-Mon, 18 Oct 1993 18:08:38
 
 Entered as OT 9420
 
 andi-Wed, 10 Nov 1993 10:46:35
**Validation Text**

[11/10/93 public]
  Moved from Transarc database and in dfs-osf-1.5
Added field Transarc Herder with value `andi@transarc.com' 
Added field Transarc Status with value `import'

[11/10/93 public]
Changed Status from `open' to `dup' 
Filled in Duplicate Of with `9420'



CR Number                     : 9337
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : rpc
Subcomponent Name             : rpc/runtime/mgmt.c
Short Description             : if_id_vector in
rpc_mgmt_inq_if_ids() should be initialized to NULL
Reported Date                 : 11/3/93
Found in Baseline             : 1.0.3
Found Date                    : 11/3/93
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 8193
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : rpc/runtime/comif.c
Sensitivity                   : public

[11/3/93 public]

Licensee reported:

"       When a NULL binding handle is supplied, if_id_vector returned by
        rpc_mgmt_inq_if_ids() is not set to NULL.  This variable should
        be initialized to NULL so as to match the man page and the AES.

Repeat By:


Proposed Solution: Extract of our change.

PRIVATE void rpc_mgmt_inq_if_ids (binding_h, if_id_vector, status)

rpc_binding_handle_t    binding_h;
rpc_if_id_vector_p_t    *if_id_vector;
unsigned32              *status;

{
    idl_void_p_t            (*old_allocate) PROTOTYPE ((unsigned long
size));
    idl_void_p_t            (*tmp_allocate) PROTOTYPE ((unsigned long
size));
    void                    (*old_free) PROTOTYPE ((idl_void_p_t ptr));
    void                    (*tmp_free) PROTOTYPE ((idl_void_p_t ptr));

#ifdef _FTX
    if (if_id_vector)
      (*if_id_vector) = NULL;
    else {
      *status = rpc_s_invalid_arg;
      return;
    }
#endif

    RPC_VERIFY_INIT ();

"

[11/3/93 public]

"Found in Baseline" can't be 1.0.3, because it was already fixed in 1.0.3. :-)
It must be 1.0.2 or 1.0.3b?. Returning rpc_s_invalid_arg when
if_id_vector==NULL seems to be reasonable.

[11/03/93 public]
I am sure there are many people waiting for me to respond to that last
sentence. :-)
	DO NOT WASTE TIME CHECKING FOR NULL POINTERS
strcpy doesn't, fopen doesn't, and so on.  A NULL pointer is a programming
error and many people believe that trying to be "robust" in the face of such 
errors does not do programmers any good at all.

[11/04/93 public]
Uh guys, I don't think we are talking about the same problem here.
I believe the report was concerning NULLing out an output argument
so it would not return garbage.  This is not the same as checking
for NULL pointers.  The side affect of the suggested fix, however,
does check for a null value for the output argument.

Seiichi, are you sure this can be dup'd to 8193?

[11/04/93 public]
I understand what the suggested code was doing and I was complaining about
half of it.  (Never mind that the if test is completely backwards --
the entire function body should be inside the if, as written.)
The proper fix for this defect is to add this as the first executable
line of rpc_mgmt_inq_if_ids
      *if_id_vector = NULL;

[11/04/93 public]

This is the duplication of OT8193. If you look at rpc_mgmt_inq_if_ids(), it
will call either rpc__if_mgmt_inq_if_ids()::comif.c (local case,
binding_h==NULL) or inq_if_ids()::mgmt.c (remote case, binding_h!=NULL).
inq_if_ids() already does the right thing, i.e., returns
*if_id_vector==NULL on error. That's why the original report said "When a
NULL binding handle is supplied". rpc__if_mgmt_inq_if_ids() has been fixed
by OT8193. I must say that nullifying *if_id_vector at the beginning of the
call is a good coding practice. :-)



CR Number                     : 9305
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 8202
Project Name                  : dce
H/W Ref Platform              : hppa,i486
S/W Ref Platform              : hpux, osf1
Component Name                : cds
Subcomponent Name             : cdscp
Short Description             : cdscp cores dump
Reported Date                 : 11/1/93
Found in Baseline             : 1.0.3
Found Date                    : 11/1/93
Severity                      : A
Priority                      : 2
Status                        : dup
Duplicate Of                  : 9806
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[11/1/93 public]

cdscp cores dump if control characters are entered on the command line.
(In this case, "erase" was not mapped to the backspace key, so 
that the backspace key produced control character instead.)
After having pressed the return key, the screen flashed and cdscp cored dump.

Ex.
On an OSF/1 (486)

root@trinidad> cdscp
cdscp> show ^?^?
syntax error
show     

< the screen flashes >

Memory fault(coredump)


On HP-UX


# cdscp
cdscp> sho     00


Memory fault(coredump)
#

[6/2/94 public]
This is related to CR 8202. It was pointed out in the original report that 
the problem was in function accum_cmd() in control/accum_cmd.c. jd later
pointed out that this fucntion was called with input and output pointers 
pointing to the same buffer, hence the original fix was not right. Turned out
there was another problem (length related), so 8202 fixed the length problem.

With this fix, it is obvious that in 1.0.3 (supposedly 8202 was fixed in
1.0.3), this control character problem still exists.

A further check with how accum_cmd() is called shows that this function is
not always called with input and output pointers pointing to the same buffer.
This means the original fix (see below) still makes sense. This also explains
the behavior reported here: a control character can cause a big screen flash.
This is becasue (see the original code below) when a control character is
entered, the input pointer from is not incremented, but the output buffer
(pointed by p) is incremented by the time with SPACE inserted. When the end
of the output buffer is reached, it is dumped out (screen flash) and dumps
core.

In the routine accum_cmd() in the file cds/control/accum_cmd.c, the line

           do   {
        c = *from;                      /* get current character */
        code = class[c];                /* classify it */
        switch (code)
            {
            case WHITE:
            case CTL:
                {
                *p++ = '\040';          /* one blank to output buffer */
                                        /* then advance to non white */
==>		while (class[*from] == WHITE) from++;

needs to change to 

	while (class[*from] == WHILE || class[*from] == CTL) from++;

[6/16/94 public]
This was fixed in the code cleanup drop.  Same as cr 9806



CR Number                     : 9289
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : aix
Component Name                : cds
Subcomponent Name             : 
Short Description             : cdsadv core dumps on RIOS running rtandidl
Reported Date                 : 10/28/93
Found in Baseline             : 1.0.3
Found Date                    : 10/28/93
Severity                      : A
Priority                      : 2
Status                        : dup
Duplicate Of                  : 9065
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[10/28/93 public]

While running the RPC rtandidl testcases, the cdsadv
dumped core, and all cdsclerks died along with it.

Unfortunately, I could not use the core to debug with, so
I have no information on what went wrong.  I am looking for
help from some cds developers on what types on runtime flags
I should turn on to help debug this problem.

The build I used was weekly build 8 (dce1.0.3ib8).  I was
running a single machine cell on a RS/6000 370 with
64M of RAM and lots of disk.

There is plenty of disk space free when the crash occurs.

I have not been able to point to the exact test that 
causes this to fail (I would guess one of the NSI tests),
but I'm not sure becuase I have only been able to 
recreate it when I got through the whole rtandidl
bucket.  I have reproduced this three times this
afternoon.

[10/29/93 public]
We will run the tests on a RIOS on this morning. I'll update this
later today when I've got something. Assigning it to myself until 
we get more data.

[10/29/93 public]
I am trying to reproduce this on a different much slower machine.
I'll post any interesting results.

[10/29/93 public]
Gerry, we ran the tests against both last night's build and the last weekly
and we can't reproduce the problem. I'm lowering the priority but not 
cancelling it. If you can give us something that we can run to cause
the advertizer to core dump we will work it. Let me know what you find.....

After reading OT 9065 and looking at the swap space on my machine in 
question, I increased the swap area and re-ran the tests and everything
is OK.  Duplicate of 9065.  I guess another question would be why
things need as much swap space as they do.  I had 64 meg on the 
machine that failed (64 meg of swap area).



CR Number                     : 9283
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : cfg
Subcomponent Name             : 
Short Description             : dce_config incorrectly reports time diff
Reported Date                 : 10/28/93
Found in Baseline             : 1.0.3
Found Date                    : 10/28/93
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 9624
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[10/28/93 public]
When trying to configure a client I somtimes get the following error:

S:****** Time on agony.austin.ibm.com is forward by 
             -1 years 11 months -1 days 23 hours 59 minutes 54 seconds
           compared with time on yale.
S:****** Time on agony.austin.ibm.com is not within specified tolerance (120 sec
) of time on yale.
	Do you want to synchronize agony.austin.ibm.com's system time to yale (y
/n)? (n)  


However, when I check the date on the two machines they are the same.
If I select to change the date, the date is set to an incorrect date.
This does not occur all of the time but I have seen this occur several
times.

[03/28/94 public]
The clock syncing feature sometimes has problems.
In particular, it is sensitive to an AIX shell bug (see OT 9524).

Solutions are:
	Use ksh on AIX
	Set SYNC_CLOCKS to 'n' to prevent this code from being used.

Bug dup'd to 9524. (which is currently canceled, but we may fix it by
making dce_config a ksh script by default)



CR Number                     : 9267
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : i486
S/W Ref Platform              : osf1
Component Name                : gds
Subcomponent Name             : xds tests
Short Description             : xds/valid/list4v crashes xt_test
Reported Date                 : 10/26/93
Found in Baseline             : 1.0.3b8
Found Date                    : 10/26/93
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 9237
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[10/26/93 public]


While running test/directory/xds/tests.xds/valid/list4v on 486/OSF1
as tester/machine1, and HPUX as machine 2, a la the porting guide,
we note the following:

root@fido  # cd /usr/users/treff/tst/xds/tests.xds/valid
root@fido  # ../../xt_test -i list4v
Directory tester: threads version 2.0t [Oct 22 1993  02:08:12]

[1]: Testcase = list4v

[1]:

[1]: Opening Include file ../tree/build_tree8

[1]: INITIALIZE returned OK

[1]: VERSION returned OK

[1]: BIND returned OK

[1]:  Func xt_cmp_status : DS_SUCCESS expected, error received

[1]:  Func xt_ds_add_entry : expected and received DS_status differ

[1]:  Func xt_run : Function call FAILED

[1]: ADD_ENTRY returned ERROR

[1]:  Func xt_cmp_status : DS_SUCCESS expected, error received

[1]:  Func xt_ds_add_entry : expected and received DS_status differ

[1]:  Func xt_run : Function call FAILED

[1]: ADD_ENTRY returned ERROR

[1]:  Func xt_cmp_status : DS_SUCCESS expected, error received

[1]:  Func xt_ds_add_entry : expected and received DS_status differ

[1]:  Func xt_run : Function call FAILED

[1]: ADD_ENTRY returned ERROR

[1]:  Func xt_cmp_status : DS_SUCCESS expected, error received

[1]:  Func xt_ds_add_entry : expected and received DS_status differ

[1]:  Func xt_run : Function call FAILED

[1]: ADD_ENTRY returned ERROR

[1]: UNBIND returned OK

[1]: SHUTDOWN returned OK

[1]: Exiting Include file ../tree/build_tree8

[1]: INITIALIZE returned OK

[1]: VERSION returned OK

[1]: CREATE returned OK

[1]: PUT returned OK

[1]: BIND returned OK
Segmentation fault (core dumped)
root@fido  # gdb ../../xt_test core
GDB is free software and you are welcome to distribute copies of it
 under certain conditions; type "show copying" to see the conditions.
There is absolutely no warranty for GDB; type "show warranty" for details.
GDB 4.8, Copyright 1993 Free Software Foundation, Inc.

OSF version 4.8-osf.11 created Mon Apr 26 16:11:24 1993

..(no debugging symbols found)...
Core was generated by `xt_test'.
Program terminated with signal 11, Segmentation fault.
#0  0xa403fea4 in dsa4_name (
Cannot access memory at address 0x43c2dc.
(gdb) bt
#0  0xa403fea4 in dsa4_name (Cannot access memory at address 0x43c2dc.
(gdb) quit
root@fido  # 



Note that this time the stubs _stayed_up_!

[9/27/93 public]
Turns out to be a dup of 9237, a byte-ordering problem in d26refis.c.
It's fixed.



CR Number                     : 9264
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : i486
S/W Ref Platform              : osf1
Component Name                : gds
Subcomponent Name             : ROS
Short Description             : xds valid tests crash cstub
and sstub
Reported Date                 : 10/26/93
Found in Baseline             : 1.0.3b8
Found Date                    : 10/26/93
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 9237
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[10/26/93 public]

running XDS valid tests on Machine 1 486/OSF1, machine 2 HPUX, 
the compare6v test causes the Cstub on Machine 1 (test machine) to
exit (NO CORE FILE !).  The last line of the Cstub log reads

	d25raction.c(231): FATAL ERROR: ROS-function failed
			(code = -1 class = 4 value = 7441)


The Cstub log has many garbage characters in it above this last line.

The error occurs in d25_rosbinrq, on this line:

    /* execute ROS-bind request */
    if (r_binrq (&bnrq) != R_SUCES) {
	D27_LOGINFO((D27_FAT3, D27_ERRMSG10, bnrq.r_hdinfo.r_retcod, 
			      bnrq.r_hdinfo.r_erclas,
				bnrq.r_hdinfo.r_errval)) ;
	return (D25_AERROR) ;


I will put a complete set of log files in /afs/dce/project/dce/sni/OTxxxx,
where xxxx is the number assigned to this defect.

Here's the xt_test.log:

Directory tester: threads version 2.0t [Oct 22 1993  02:08:12]

[1]: Testcase = compare6v

[1]:

[1]: Opening Include file ../tree/build_tree11

[1]: INITIALIZE returned OK

[1]: VERSION - dump of DS_status returned

[1]: VERSION returned OK

[1]: CREATE returned OK

[1]: PUT returned OK

[1]: BIND - dump of DS_status returned

[1]: BIND - dump of read bound_session_return

[1]: SESSION at 0x4e07a0

[1]: PSAP at null address

[1]: 0x4c35b0 > [1]: 38 [1]: 35 [1]: 2e [1]: 34 [1]: 2e [1]: 36 [1]: 04 [1]: 64  [1]: 65 [1]: 01 [1]: 38 [1]: 35 [1]: 2e [1]: 34 [1]: 2e [1]: 31 [1]:    [1]: 8[1]: 5[1]: .[1]: 4[1]: .[1]: 6[1]: .[1]: d[1]: e[1]: .[1]: 8[1]: 5[1]: .[1]: 4[1]: .[1]: 1

[1]: 0x4c35c0 > [1]: 30 [1]: 03 [1]: 64 [1]: 62 [1]: 70 [1]: 01 [1]: 38 [1]: 35  [1]: 2e [1]: 34 [1]: 2e [1]: 31 [1]: 31 [1]: 03 [1]: 64 [1]: 61 [1]:    [1]: 0[1]: .[1]: d[1]: b[1]: p[1]: .[1]: 8[1]: 5[1]: .[1]: 4[1]: .[1]: 1[1]: 1[1]: .[1]: d[1]: a

[1]: 0x4c35d0 > [1]: 70 [1]: 31 [1]: 31 [1]: 01 [1]: 38 [1]: 35 [1]: 2e [1]: 34  [1]: 2e [1]: 33 [1]: 03 [1]: 64 [1]: 73 [1]: 61 [1]: 01 [1]: 38 [1]:    [1]: p[1]: 1[1]: 1[1]: .[1]: 8[1]: 5[1]: .[1]: 4[1]: .[1]: 3[1]: .[1]: d[1]: s[1]: a[1]: .[1]: 8

[1]: 0x4c35e0 > [1]: 35 [1]: 2e [1]: 34 [1]: 2e [1]: 33 [1]: 03 [1]: 64 [1]: 73  [1]: 61 [1]: 2d [1]: 6d [1]: 32 [1]:                [1]: 5[1]: .[1]: 4[1]: .[1]: 3[1]: .[1]: d[1]: s[1]: a[1]: -[1]: m[1]: 2

[1]: Password length = 0

[1]: Password :

[1]: Private extension = 1

[1]: _____ End of SESSION _____

[1]: HANDLE at 0x4e1848

[1]: Type = OM_PRIVATE_OBJECT	[1]: Flags = 0x1806

[1]: Class Identifier : length = 10

[1]: 0x4e0780 > [1]: 2b [1]: 0c [1]: 02 [1]: 88 [1]: 53 [1]: 01 [1]: 03 [1]: 64  [1]: 00 [1]: 00 [1]:                      [1]: +[1]: .[1]: .[1]: .[1]: S[1]: .[1]: .[1]: d[1]: .[1]: .

[1]: Package = 1	[1]: Type = 0	[1]: SubId = 0x8000

[1]: Subobject list = 0x0	[1]: XDS Object = 0x4e07a0

[1]: -- End of Handle --

[1]:

[1]: BIND returned OK

[1]: ADD_ENTRY - dump of DS_status returned

[1]:  Func xt_cmp_status : DS_SUCCESS expected, error received

[1]:  Func xt_ds_add_entry : expected and received DS_status differ

[1]:  Func xt_run : Function call FAILED

[1]: ADD_ENTRY returned ERROR

[1]: ADD_ENTRY - dump of DS_status returned

[1]:  Func xt_cmp_status : DS_SUCCESS expected, error received

[1]:  Func xt_ds_add_entry : expected and received DS_status differ

[1]:  Func xt_run : Function call FAILED

[1]: ADD_ENTRY returned ERROR

[1]: ADD_ENTRY - dump of DS_status returned

[1]:  Func xt_cmp_status : DS_SUCCESS expected, error received

[1]:  Func xt_ds_add_entry : expected and received DS_status differ

[1]:  Func xt_run : Function call FAILED

[1]: ADD_ENTRY returned ERROR

[1]: UNBIND - dump of DS_status returned

[1]: UNBIND returned OK

[1]: SHUTDN - dump of DS_status returned

[1]: SHUTDOWN returned OK

[1]: Exiting Include file ../tree/build_tree11

[1]: INITIALIZE returned OK

[1]: VERSION - dump of DS_status returned

[1]: VERSION returned OK

[1]: BIND - dump of DS_status returned

[1]: BIND - dump of read bound_session_return

[1]: SESSION at 0x4e07a0

[1]: PSAP at 0x4e1848

[1]: 0x4e1848 > [1]: 10 [1]: 00 [1]: 2c [1]: 00 [1]: 06 [1]: 00 [1]: 10 [1]: 00  [1]: 53 [1]: 65 [1]: 72 [1]: 76 [1]: 65 [1]: 72 [1]: 00 [1]: 00 [1]:    [1]: .[1]: .[1]: ,[1]: .[1]: .[1]: .[1]: .[1]: .[1]: S[1]: e[1]: r[1]: v[1]: e[1]: r[1]: .[1]: .

[1]: 0x4e1858 > [1]: 40 [1]: 00 [1]: 1c [1]: 00 [1]: 11 [1]: 00 [1]: 1c [1]: 00  [1]: 54 [1]: 00 [1]: 72 [1]: 87 [1]: 22 [1]: 03 [1]: 13 [1]: 01 [1]:    [1]: @[1]: .[1]: .[1]: .[1]: .[1]: .[1]: .[1]: .[1]: T[1]: .[1]: r[1]: .[1]: "[1]: .[1]: .[1]: .

[1]: 0x4e1868 > [1]: 05 [1]: 00 [1]: 51 [1]: 46 [1]: 21 [1]: 01 [1]: 10 [1]: 00  [1]: 01 [1]: 00 [1]: 00 [1]: 00 [1]:                [1]: .[1]: .[1]: Q[1]: F[1]: ![1]: .[1]: .[1]: .[1]: .[1]: .[1]: .[1]: .

[1]: _____ End of PSAP _____

[1]: 0x4c3bb0 > [1]: 38 [1]: 35 [1]: 2e [1]: 34 [1]: 2e [1]: 36 [1]: 04 [1]: 64  [1]: 65 [1]: 01 [1]: 38 [1]: 35 [1]: 2e [1]: 34 [1]: 2e [1]: 31 [1]:    [1]: 8[1]: 5[1]: .[1]: 4[1]: .[1]: 6[1]: .[1]: d[1]: e[1]: .[1]: 8[1]: 5[1]: .[1]: 4[1]: .[1]: 1

[1]: 0x4c3bc0 > [1]: 30 [1]: 03 [1]: 64 [1]: 62 [1]: 70 [1]: 01 [1]: 38 [1]: 35  [1]: 2e [1]: 34 [1]: 2e [1]: 31 [1]: 31 [1]: 03 [1]: 64 [1]: 61 [1]:    [1]: 0[1]: .[1]: d[1]: b[1]: p[1]: .[1]: 8[1]: 5[1]: .[1]: 4[1]: .[1]: 1[1]: 1[1]: .[1]: d[1]: a

[1]: 0x4c3bd0 > [1]: 70 [1]: 31 [1]: 31 [1]: 01 [1]: 38 [1]: 35 [1]: 2e [1]: 34  [1]: 2e [1]: 33 [1]: 03 [1]: 64 [1]: 73 [1]: 61 [1]: 01 [1]: 38 [1]:    [1]: p[1]: 1[1]: 1[1]: .[1]: 8[1]: 5[1]: .[1]: 4[1]: .[1]: 3[1]: .[1]: d[1]: s[1]: a[1]: .[1]: 8

[1]: 0x4c3be0 > [1]: 35 [1]: 2e [1]: 34 [1]: 2e [1]: 33 [1]: 03 [1]: 64 [1]: 73  [1]: 61 [1]: 2d [1]: 6d [1]: 31 [1]:                [1]: 5[1]: .[1]: 4[1]: .[1]: 3[1]: .[1]: d[1]: s[1]: a[1]: -[1]: m[1]: 1

[1]: Password length = 0

[1]: Password :

[1]: Private extension = 1

[1]: _____ End of SESSION _____

[1]: HANDLE at 0x4e1808

[1]: Type = OM_PRIVATE_OBJECT	[1]: Flags = 0x1806

[1]: Class Identifier : length = 10

[1]: 0x4e0740 > [1]: 2b [1]: 0c [1]: 02 [1]: 88 [1]: 53 [1]: 01 [1]: 03 [1]: 64  [1]: 00 [1]: 00 [1]:                      [1]: +[1]: .[1]: .[1]: .[1]: S[1]: .[1]: .[1]: d[1]: .[1]: .

[1]: Package = 1	[1]: Type = 0	[1]: SubId = 0x8000

[1]: Subobject list = 0x0	[1]: XDS Object = 0x4e07a0

[1]: -- End of Handle --

[1]:

[1]: BIND returned OK

[1]: COMPARE - dump of DS_status returned

[1]:  Func xt_cmp_status : DS_SUCCESS expected, error received

[1]:  Func xt_ds_compare : expected and received DS_status differ

[1]:  Func xt_run : Function call FAILED

[1]: COMPARE returned ERROR

[1]: UNBIND - dump of DS_status returned

[1]: UNBIND returned OK

[1]: SHUTDN - dump of DS_status returned

[1]: SHUTDOWN returned OK

[1]:

[1]: Opening Include file ../tree/delete_tree11

[1]: INITIALIZE returned OK

[1]: VERSION - dump of DS_status returned

[1]: VERSION returned OK

[1]: CREATE returned OK

[1]: PUT returned OK

[1]: BIND - dump of DS_status returned

[1]:  Func xt_cmp_status : DS_SUCCESS expected, error received

[1]:  Func xt_ds_bind : expected and received DS_status differ

[1]:  Func xt_run : Function call FAILED

[1]: BIND returned ERROR

[1]: REMOVE_ENTRY not called

[1]: REMOVE_ENTRY not called

[1]: REMOVE_ENTRY not called

[1]: UNBIND not called

[1]: SHUTDN - dump of DS_status returned

[1]: SHUTDOWN returned OK

[1]: Exiting Include file ../tree/delete_tree11

[1]: Testcase compare6v failed

[1]:  Func xt_main : test FAILED

[1]:  Exiting program

[10/26/93 public]

xds/tests.xds/valid/compare7v causes both the cstub AND the sstub to
crash, on the same line in d25raction.c.  Logs for that run are
also in /afs/project/dce/sni/OT9264.

[10/27/93 public]
Dup'ed to 9237.  Using the new d26refis.c does the trick, so it's fixed.



CR Number                     : 9258
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 7504
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : rpc
Subcomponent Name             : cn
Short Description             : rpcd dies while running
dfs_glue for 48 hrs
Reported Date                 : 10/26/93
Found in Baseline             : 1.0.3
Found Date                    : 10/26/93
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 9240
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : rpc/runtime/cnassoc.c
Sensitivity                   : public

[10/26/93 public]

While attempting to complete the 48 hour dfs_glue test for the
dfs_repfs.checklist test, rpcd died and coredumped on the DCE core
component server machine.  The cell configuration is as follows:

	Machine 1:  DCE security server, DCE CDS server
	Machine 2:  DCE client, DFS FLDB server, root.dfs 
	Machine 3:  DCE client, DFS FLDB server
	Machine 4:  DCE client, DFS FLDB server

This is reproducible and Seiichi is attempting to determine the cause of
this problem when I can get the machines to run the test.

[10/26/93 public]

This is some what related to CR9240 or may be duplicated. rpcd coredump'ed
by the CMA exception when the timer thread reclaimed the already free'ed
assoc. The CMA raised the exception because pthread_cond_destroy() was
called twice.

For your reading pleasure, I have put the RPC_DEBUG=0.20,23,24 trace in
/afs/dce/project/dce/hp/tmp/OT9258/rpcd.log and the stack dump in the
rpcd.dump in the same directory. rpcd wasn't debuggable so we couldn't get
any useful info from the coredump.

[10/27/93 public]

Yes, yes, yes, finally I've found it! It was caused by
rpc__cn_assoc_grp_create().

When rpc_g_cn_assoc_grp_tbl.assoc_grp_vector is expanded (and relocated),
the active assoc_grp's first assoc on the grp_assoc_list (the one pointed
by rpc_g_cn_assoc_grp_tbl.assoc_grp_vector[x].grp_assoc_list.next) is still
holding the pointer to the old (free'ed) grp_assoc_list, e.g.,
new_assoc_grp[x].grp_assoc_list.next->last ==
old_assoc_grp[x].grp_assoc_list . Thus, when this assoc is removed from the
grp_assoc_list by using RPC_LIST_REMOVE()::rpclist.h macro, it updates
old_assoc_grp[x].grp_assoc_list.next pointer. It never update the now
relocated rpc_g_cn_assoc_grp_tbl.assoc_grp_vector[x].grp_assoc_list.next .
(Also the second assoc on the list still points to the
old_assoc_grp[x].grp_assoc_list after the removal. See RPC_LIST_REMOVE().)
If what IBM is seeing in CR9240 happens after the call to
rpc__cn_assoc_grp_create(), this must be it.

The fix in rpc__cn_assoc_grp_create() should be trivial. I'll think about
it after I get sleep.

[10/27/93 public]

Here is my suggested fix.

In rpc__cn_assoc_grp_create()::cnassoc.c, between memcpy() and
RPC_MEM_FREE() add:

        for (i = 0; i < old_count; i++)
        {
            /*
             * Relocate the "last" pointer in the head of the grp_assoc_list.
             * We don't check group's state because they must be all active.
             * Otherwise, this function never get called. (grp_assoc_list.next
             * shouldn't be NULL.)
             */
            if (new_assoc_grp[i].grp_assoc_list.next != NULL)
            {
                ((rpc_list_p_t)(new_assoc_grp[i].grp_assoc_list.next))->last =
                    (pointer_t)&new_assoc_grp[i].grp_assoc_list;
            }
        }        

We will test this fix.

[10/28/93 public]
This fix had been submitted to the OSF code base.  I am dupping
this to 9240 since we believe these problems to be related.

Either defect can be re-opened if more extensive testing finds that this
fix does not solve the problem.

[10/28/93 public]
Just noting that I hit this problem in the following config with the
following symptoms:

486 = core server
2 HPs + 1 RIOS = core clients, dfs fldb servers

Lost client authentication during bos command attempts, got "Registry
server unavailable" messages.

486 was REALLY slow, although iostat indicated cpu 95% idle.

/opt/dcelocal/var/rpc contained core file PLUS rpcd.log with the
telltale last (and in this case only) entry:

Exception: Object referenced does not currently exist (dce / thd)

Thanks for fixing this one!

[10/29/93 public]

I have verified this fix by using runtime/perf test. It's fairly simple.

1) Start the server and save the server output.

  $ script
  $ export RPC_DEBUG=0.20,23,24
  $ server -v10 10 ncacn_ip_tcp

2) Start 14 multi-threaded clients.

  $ for i in 1 2 3 4 5 6 7 8 9 10 11 12 13 14; do \
      client -v10 -w0,99999 -m3 0 ncacn_ip_tcp:host 2 1 n y & \
    done

Without this fix, the server coredump'ed with:

  Exception: Object referenced does not currently exist (dce / thd)
  Abort(coredump)

After the fix, the server continued the execution.

3) Verify the server's output that rpc__cn_assoc_grp_create() was called
twice.

  $ fgrep rpc__cn_assoc_grp_create typescript



CR Number                     : 9251
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : cfg
Subcomponent Name             : dfs_config
Short Description             : re-configuration deletes needed backup directory
Reported Date                 : 10/25/93
Found in Baseline             : 1.0.3
Found Date                    : 10/25/93
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 8549
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Herder               : 
Transarc Status               : 

[10/25/93 public]
When a machine is reconfigured, and the old configuration information
removed, /opt/dcelocal/var/adm/backup is removed.
However, since it's only created during the install pass, the bakserver
fails to start properly on a reconfigured machine.
dfs_config should at some point check for needed structure in .../adm/
and rebuild it.
Added field Transarc Herder with value `' 
Added field Transarc Status with value `'

[10/26/93 public]
Do you really mean /var/dfs/backup rather than /var/adm/backup?
It appears during the HP work on dce_config, they made the
following change in dfs.rm.  I assume that restoring the original code
(currently commented out) would fix this problem.  Since we dont' 
run backup here at OSF, please verify this fix.  Thanks.
Code frag from dfs.rm:
    # The only files created by DFS are under $DCELOCAL/var/dfs, so just delete
    # the whole tree.  The only other things created by configuring DFS are the
    # /... directory and links for /.: and /: These may as well stay around.  We
    # do need to put rc.dfs back the way it was.
    # For some reason OSF code (in dce.rm) removes individual subdirectories.
    #    rm -rf $DCELOCAL/var/dfs/adm/*
    #    rm -rf $DCELOCAL/var/dfs/backup/*
    #    rm -rf $DCELOCAL/var/dfs/aggrs
    #    rm -f  $DCELOCAL/var/dfs/* 2> /dev/null
    #
    log_msg DETAIL "dfs.rm: Executing: rm -rf $DCELOCAL/var/dfs"
    rm -rf $DCELOCAL/var/dfs

[10/27/93 public]

[10/27/93 public]
Yes, I meant /var/adm/backup -- sorry.
Swapping the old code for the new does indeed fix it.  Thanks!

[11/09/93 public]
Duping this to 8549.  No fix has been submitted because it has been
pointed out that the above proposed fix could be more robust by
re-creating the deleted directory structure in the bakserver itself.



CR Number                     : 9189
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : mx300
S/W Ref Platform              : sinix
Component Name                : gds
Subcomponent Name             : 
Short Description             : wrong compile flag vor cget.c
Reported Date                 : 10/19/93
Found in Baseline             : 1.0.3
Found Date                    : 10/19/93
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 3100
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3b8
Affected File(s)              : gds/cacheadm/adm_iapl/Makefile
Sensitivity                   : public

[10/19/93 public]
cget.c has to be compiled with M_SYSV. But in the Makefile you find SYS5ATT.

[10/19/93 public]
It's a dup of 3100.  Now it's finally fixed.



CR Number                     : 9186
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : 
Short Description             : FLDB config fails - bos admin list
Reported Date                 : 10/18/93
Found in Baseline             : 1.0.3
Found Date                    : 10/18/93
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 9193
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[10/18/93 public]

This problem first began showing up on the nightly build available
10/14/93. The problem is that, on both HP and RIOS, configuring a
core and fldb server machine fails with:

S:****** Starting bosserver...
/opt/dcelocal/bin/bos: file admin.bos not found, try using the `-createlist' flag
/opt/dcelocal/bin/bos: failed to add group 'subsys/dce/dfs-admin' (you are not authorized for this operation (dfs / bbs))
/opt/dcelocal/bin/bos: failed to create new server instance flserver of type 'simple' (you are not authorized for this operation (dfs / bbs))
Checking for a Ubik sync site in  hosts/tinker
(last message repeats until you exit)

If you attempt to create the admin list by hand,

/opt/dcelocal/bin/bos addadmin -server /.:/hosts/tinker -adminlist
admin.bos -group subsys/dce/dfs-admin -createlist

It fails with:

/opt/dcelocal/bin/bos: failed to add group 'subsys/dce/dfs-admin' (unexpected in
ternal error; check bosserver log (dfs / bbs))

and the BosLog contains:

Fri Oct 15 19:03:58 1993: BOSSVR_AddSUser: unable to setup handle to
secd: incomplete name (dce / rpc)

Logging as an A0 since this is blocking system test (and daily dfs smoketesting)

[10/19/93 public]
Not too much new to add here.  A call to sec_rgy_cell_bind() is failing
in bossvr_ncs_procs.c.  Re-assigning to a security person since the
bosserver code hasn't changed since August.

[10/19/93 public]
Looking at the error return from secd indicates that this problem is
similar in nature to the CR 9193; i.e. secd returning rpc_s_incomplete_name
to the calling routine. Dupping this CR to 9193.



CR Number                     : 9100
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : cfg
Subcomponent Name             : config
Short Description             : fix to dfs.unconfig
Reported Date                 : 10/13/93
Found in Baseline             : 1.0.3
Found Date                    : 10/13/93
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 8442
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : dfs.unconfig
Sensitivity                   : public

[10/13/93 public]

In file dfs.unconfig there is a return $err_found.  This must be
changed to exit $err_found, otherwise unconfiguring a client 
will fail.  You cannot return if you are not inside a function

Clem

[10/13/93 public]
Ron is the man for dfs_config problems.
Note: the return is only a problem if you are not using the POSIX
shell (ksh).

[10/18/93 public]
This was fixed in OT8442.



CR Number                     : 9024
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : TEST SUITES
Short Description             : rep tests do multiple fts releases in quick succesion without checking that the replicas are back on-line
Reported Date                 : 10/5/93
Found in Baseline             : 1.0.2a
Found Date                    : 09/13/93
Severity                      : C
Priority                      : 3
Status                        : dup
Duplicate Of                  : 8057
Fix By Baseline               : 1.0.2a
Fixed In Baseline             : 
Affected File(s)              : some
Sensitivity                   : public
Transarc Status               : import
Transarc Deltas               : 
Transarc Herder               : andi@transarc.com

[10/5/93 public]
**Description Text**
 -------------------------------------------------------------------------------
 
 The replication tests do multiple fts releases in a row. The tests do
 not wait to make sure that the previous fts release on this fileset has completed and the R/O
 replicas are back On-Line before doing this test. 
 
 khale-Mon, 13 Sep 1993 16:15:12

[10/5/93 public]
  Moved from Transarc database and in dfs-osf-1.5
Added field Transarc Herder with value `andi@transarc.com' 
Added field Transarc Status with value `import'

[10/5/93 public]

[10/5/93 public]
Changed Status from `open' to `dup' 
Filled in Duplicate Of with `8057'



CR Number                     : 8902
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : cds
Subcomponent Name             : cdsclerk
Short Description             : clerk sometimes spins after running dce clean and rebooting machine
Reported Date                 : 10/4/93
Found in Baseline             : 1.0.3
Found Date                    : 10/4/93
Severity                      : C
Priority                      : 3
Status                        : dup
Duplicate Of                  : 7647
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[10/4/93 public]

During testing of dfs I've had to do numerous dce.cleans followed by
a clean shutdown of the system.  When I bring the system back up
and run rc.dce, some processes, namely dts and fxd hang waiting
for information from cds.  Frequently I see the cdsclerk chew up
cpu time when this happens.  The last time this happened (fxd hung
waiting for cds), I killed the cdsclerk, and was then able to
successfully restart fxd. 

I have also put the fxd under a debugger when this is happening and
It hangs in dfs_GetJunctionName, which makes numerous rpc_ns_profile*
calls.

Dts will sometimes return with an error "no such entry"

[10/04/93 public]
Its a dup of 7647 which was canceled. I just reopened 7647. Paul Ellis
has a system test that shows something very similar......



CR Number                     : 8879
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : dfstrace
Short Description             : Output of dfstrace lsset should be rationalized
Reported Date                 : 9/30/93
Found in Baseline             : 1.0.2
Found Date                    : 9/30/93
Severity                      : C
Priority                      : 3
Status                        : dup
Duplicate Of                  : 8666
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : See description
Sensitivity                   : public
Transarc Deltas               : 
Transarc Status               : open
Transarc Herder               : 

[9/30/93 public]
The dfstrace lsset command labels dormant event sets with the
words "inactive (dormant)". To prevent confusion with the inactive
state and to have it corresponding the the dfstrace setset option -dormant,
this label should be changed to "dormant"
Added field Transarc Deltas with value `' 
Added field Transarc Status with value `open'

[10/6/93 public]
Work done under related delta.
Changed Defect or Enhancement? from `enh' to `def' 
Changed Status from `open' to `dup' 
Filled in Duplicate Of with `8666' 
Added field Transarc Herder with value `'



CR Number                     : 8867
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : cfg
Subcomponent Name             : dce_config
Short Description             : GDS message catalogs are not installed
Reported Date                 : 9/28/93
Found in Baseline             : 1.0.3
Found Date                    : 9/28/93
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 8695
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : 
Sensitivity                   : public

[9/28/93 public]

The GDS message catalogs (i.e. gdsdithelp.cat, gdssyshelp.cat, gdsditadm.cat
and gdssysadm.cat) are not installed by dce_config.

[09/28/93 public]
I fixed this yesterday under defect 8695.
Bug dup'd.



CR Number                     : 8655
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : dfs
Subcomponent Name             : test/systest/dfs.lock
Short Description             : filewnr -D option no longer valid
Reported Date                 : 9/22/93
Found in Baseline             : 1.0.3
Found Date                    : 9/22/93
Severity                      : E
Priority                      : 4
Status                        : dup
Duplicate Of                  : 8449
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : test/systest/dfs.lock
Sensitivity                   : public

[9/22/93 public]
The dfs.lock_cl -d option enables the filewnr -D option, which has been
removed recently.  dfs.lock should drop the -d option, and possibly the
DEBUG_CLI environment variable.

[9/23/93 public]
Actually if the -v option is specified to the filewnr program, then the
filewnr clients will print extra info on arguements, etc.  So I think the 
DEBUG_CLI varible should stay, and the command line switch -d for dfs.lock
should enable filewnr -v.

[9/23/93 public]
This is actually a dup of 8449.  Dup'ed thusly.



CR Number                     : 8618
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 7526
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : fts
Short Description             : desirable aggregate-import tool
Reported Date                 : 9/17/93
Found in Baseline             : 1.0.3
Found Date                    : 9/17/93
Severity                      : D
Priority                      : 3
Status                        : dup
Duplicate Of                  : 7594
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Status               : open
Transarc Deltas               : 
Transarc Herder               : jaffe@transarc.com

[9/17/93 public]
As discussed in lengthy detail in OT CR 7526, it might be pleasant to have
some sort of tool by which filesets and aggregates could be imported from
one cell to another.  I'm reproducing the discussion from OT CR 7526 here
since it's likely to be lost if the doc defect gets fixed.
-----------beginning of discussion from 7526
  [gmd 3/17/93 public]
  BUILD:	nb available 3/11/93 (aka dfs 2.8)
  CONFIG:	3 pmax cell, 2 flservers
  TEST:	admin_checklist
  Before syncfldb, ufs partition dfs exported with fileset id 0,,4.
  After syncfldb, fldbentry for above ufs partition gone.
  Expected behavior (which I believe I have seen - but perhaps only
  when conflict was between 2 lfs filesets?) is to have new fldbentry
  renumbered to next available fileset id.
  BEFORE:
  root@dce12> fts lsfldb
  dce12.u3
          readWrite   ID 0,,4  valid
          readOnly    ID 0,,5  invalid
          backup      ID 0,,6  invalid
  number of sites: 1
     server           flags     aggr   siteAge principal      owner
  dce12.osf.org       RW       /u3     0:00:00 hosts/dce12    <nil>
  epi.1
          readWrite   ID 0,,22  valid
          readOnly    ID 0,,23  invalid
          backup      ID 0,,24  invalid
  number of sites: 1
    Release repl: maxAge=2:00:00; failAge=1d0:00:00; reclaimWait=18:00:00
     server           flags     aggr   siteAge principal      owner
  valentine.osf.org   RW       val_u4_aggr 0:00:00 hosts/valentine<nil>
  root.dfs
          readWrite   ID 0,,1  valid
          readOnly    ID 0,,2  invalid
          backup      ID 0,,3  invalid
  number of sites: 1
     server           flags     aggr   siteAge principal      owner
  valentine.osf.org   RW       val_u4_aggr 0:00:00 hosts/valentine<nil>
  valentine.u2
          readWrite   ID 0,,7  valid
          readOnly    ID 0,,8  invalid
          backup      ID 0,,9  invalid
  number of sites: 1
     server           flags     aggr   siteAge principal      owner
  valentine.osf.org   RW       /u2     0:00:00 hosts/valentine<nil>
  ----------------------
  Total FLDB entries that were successfully enumerated: 4 (0 failed)
  LSHEADER AND SYNFLDB:
  root@dce5> fts lsheader -server dce5 -aggregate lfs_aggr2
  Total filesets on server dce5 aggregate lfs_aggr2 (id 3): 4
  Barasso.663              0,,10 RW      8 K alloc     22 K quota On-line
  Barasso.663.readonly     0,,11 RO     22 K alloc     22 K quota On-line
  dce5.u3                  0,,25 RW      9 K alloc      9 K quota On-line
  dce5_fset                0,,4 RW      9 K alloc      9 K quota On-line
  Total filesets on-line 4; total off-line 0; total busy 0
  root@dce5> fts syncfldb -server dce5
  -- done processing entry 1 of total 3 --
  Could not fetch FLDB entry (fs=0,,10, type=0)
  Error: FLDB: no such entry (dfs / vls)
          readWrite   ID 0,,10  valid
          readOnly    ID 0,,11  valid
          backup      ID 0,,12  invalid
  number of sites: 0    number of addresses: 1
     server           flags     aggr   siteAge principal      owner
  dce5.osf.org        RW,RO    lfs_aggr2 0:00:00                <nil>
  -- done processing entry 2 of total 3 --
  -- done processing entry 3 of total 3 --
  FLDB synchronized with server dce5
  AFTER:
  root@dce12> fts lsfldb
  Barasso.663
          readWrite   ID 0,,10  valid
          readOnly    ID 0,,11  valid
          backup      ID 0,,12  invalid
  number of sites: 1
     server           flags     aggr   siteAge principal      owner
  dce5.osf.org        RW,RO    lfs_aggr2 0:00:00 hosts/dce5     <nil>
  dce5.u3
          readWrite   ID 0,,25  valid
          readOnly    ID 0,,26  invalid
          backup      ID 0,,27  invalid
  number of sites: 1
     server           flags     aggr   siteAge principal      owner
  dce5.osf.org        RW       lfs_aggr2 0:00:00 hosts/dce5     <nil>
  dce5_fset
          readWrite   ID 0,,4  valid
          readOnly    ID 0,,5  invalid
          backup      ID 0,,6  invalid
  number of sites: 1
     server           flags     aggr   siteAge principal      owner
  dce5.osf.org        RW       lfs_aggr2 0:00:00 hosts/dce5     <nil>
  epi.1
          readWrite   ID 0,,22  valid
          readOnly    ID 0,,23  invalid
          backup      ID 0,,24  invalid
  number of sites: 1
    Release repl: maxAge=2:00:00; failAge=1d0:00:00; reclaimWait=18:00:00
     server           flags     aggr   siteAge principal      owner
  Error: communications failure (dce / rpc)
  valentine.osf.org   RW       1       0:00:00 hosts/valentine<nil>
  root.dfs
          readWrite   ID 0,,1  valid
          readOnly    ID 0,,2  invalid
          backup      ID 0,,3  invalid
  number of sites: 1
     server           flags     aggr   siteAge principal      owner
  Error: communications failure (dce / rpc)
  valentine.osf.org   RW       1       0:00:00 hosts/valentine<nil>
  valentine.u2
          readWrite   ID 0,,7  valid
          readOnly    ID 0,,8  invalid
          backup      ID 0,,9  invalid
  number of sites: 1
     server           flags     aggr   siteAge principal      owner
  Error: communications failure (dce / rpc)
  valentine.osf.org   RW       4       0:00:00 hosts/valentine<nil>
  ----------------------
  Total FLDB entries that were successfully enumerated: 6 (0 failed)
  NOTE: the communications failures are due to the fact that fts moves
  of the filesets appeared to have worked and I disabled the ftserver
  process on valentine, and successfully cd'd into /: (root.dfs now
  on dce5) - but the fldb never reflected this. Entering this as
  as separate CR, data here for reference only.
  root@dce12> cd /:
  root@dce12> ls
  dce12_u3  epi_1
  root@dce12> cm whereis /:/epi_1
  dfs: fileset (0,,22) is not available!
  cm: '/:/epi_1': No such device
  root@dce12> cm whereis /:
  The file '/:' resides in the cell 'dce12_cell', in fileset 'root.dfs',
  [cfe@transarc.com 3/18/93 public]
  I believe that the expectations are a little far-fetched.  In particular,
  there was already a fileset with ID 0,,4 in the FLDB, and ``syncfldb'' by
  definition says to change what's in the FLDB to agree with what's on the
  disk.  In this case, what was already on the disk (albeit in the dfstab
  file and not in the fileset itself) was a fileset on dce5 with ID 0,,4.
  Thus, I don't believe that this is a failure, but that it's pilot error:
  if there's a fileset with id X on a disk, then invoking syncfldb on that
  disk should (and must) update or overwrite the fldb entry for id X.
  I don't know of any case in which a free fileset ID will be selected by
  syncfldb.  Could we please cancel this one?
  Filled in Subcomponent Name with `fts'
  Filled in Interest List CC with `cfe'
  Filled in Responsible Engr. with `gmd'
  Filled in Resp. Engr's Company with `osf'
  Added field Transarc Deltas with value `'
  Added field Transarc Herder with value `'
  Added field Transarc Status with value `'
  +HISTORY Thu Mar 18 11:41:25 1993 cfe	scomp: NULL -> fts
  +HISTORY Thu Mar 18 11:41:25 1993 cfe	cc: NULL -> cfe
  +HISTORY Thu Mar 18 11:41:25 1993 cfe	code: NULL -> gmd
  +HISTORY Thu Mar 18 11:41:25 1993 cfe	codecomp: NULL -> osf
  +HISTORY Thu Mar 18 11:41:25 1993 cfe	added/changed [gmd 3/17/93 public]
  +HISTORY Thu Mar 18 11:41:25 1993 cfe	added/changed [cfe@transarc.com 3/18/93 public]
  +HISTORY Thu Mar 18 11:41:25 1993 cfe	added/changed [gmd 3/17/93 public]
  [gmd 3/18/93 public]
  I believe the (albeit uninspired) machine names may have caused some
  confusion here. DCE5 has an lfs aggregate with a fileset id from a
  previous fldb. My current fldb has the same fileset id for a ufs aggregate
  on DCE12. If I ask that my current fldb be sync'd to include the fileset
  info on DCE5's lfs aggregate, shouldn't I get a warning at least that I'm
  tromping out/tromped out an existing fldb entry ( in this case, one for
  a fileset on a different machine, DCE12)? I could've sworn I'd
  seen this type of conflict handled more gracefully by syncfldb before -
  ie. the fileset being added whose fileset id is currently in use gets
  the next available fileset id. In any event - if syncfldb is documented
  to be a "USE AT YOUR OWN RISK - COULD CAUSE DATABASE CORRUPTION" function then,
  yes, what I'm asking for is an enhancement - but if not, I think we
  should document this OR change the destructive behavior ...
  NOTE: this happened in a cell whose flservers (dce5 and dce12)
  BOTH thought they were the sync site.
  +HISTORY Thu Mar 18 12:20:23 1993 gmd	added/changed [gmd 3/18/93 public]
  [cfe@transarc.com 3/18/93 public]
  One of the intended uses of this command is to allow you to remove a disk
  from a hard-crashed machine and attach it to a working machine, and yet
  bring all the data from the disk back on-line as being served by the new
  machine.  In doing this, you want to overwrite all the FLDB entries that
  pointed to the disk's old location and now point them to this new location
  (new server, possibly a new aggregate ID).  That's the kind of repair
  that ``fts syncfldb'' is intended to handle, and that's exactly why the
  server/aggr information in the FLDB entries is overwritten so freely.
  Certainly the doc doesn't say that syncfldb issues warnings and requires
  confirmation.  From the 7.11 section of the DFS admin guide:
  ``The fts syncfldb command....checks the FLDB entry associated with
  the fileset to verify that the FLDB correctly records the fileset's status
  at the site.  If the FLDB is incorrect, fts syncfldb alters it; if no
  entry exists for an online fileset, it creates one.''
  Apparently, folks have gotten used to re-populating their FLDBs after
  a re-configuration by using fts syncfldb, and this should work pretty much
  OK (except that any replication information is lost).  It works out
  because all the filesets on-line in a cell should have been mutually
  consistent.  But, unfortunately, ``fts syncfldb'' isn't a general tool
  for gently incorporating aggregates of any source into a DFS installation;
  it will in fact overwrite existing data.  It's *meant* to overwrite
  existing data.  Perhaps there's a need for a tool to do this kind of
  gentle aggregate incorporation, but ``fts syncfldb'' isn't that tool, and
  trying to make it into that tool will only keep it from being the kind of
  tool that you need to make more gross configuration repairs.
  I believe that a gentler tool could be built, and could even have been
  partially simulated by hand, in that ``fts lshead'' on the newly-attached
  aggregate on dce5 would have shown you the filesets that existed there,
  and ``fts zap'' would have let you destroy the filesets that you didn't
  want before incorporating them into the cell.  What's not built is a tool
  to re-number filesets on a disk in preparation for syncfldb, or any kind
  of automatic collision-detector that would check that all the filesets
  on an aggregate have IDs different from any that are currently in the FLDB.
  Now, fts syncfldb does have some marginally-friendly behavior, in that if
  you're incorporating a fileset that has a fileset ID larger than any
  so far allocated in the FLDB, then syncfldb will ensure that the FLDB's
  high-water-mark for fileset IDs is increased to accommodate the filesets
  to be incorporated.  However, in no case has syncfldb ever re-numbered an
  existing fileset (LFS or otherwise) to give it an unused fileset ID.
  Again, I'm going to ask Jeff K. to take a crack at whether the fts syncfldb
  (and fts syncserv) documentation is sufficiently scary that this sort of
  behavior should have been acceptable.
  Changed Interest List CC from `cfe' to `cfe, jeff@transarc.com'
  +HISTORY Thu Mar 18 14:43:53 1993 cfe	cc: cfe -> cfe, jeff@transarc.com
  +HISTORY Thu Mar 18 14:43:53 1993 cfe	added/changed [cfe@transarc.com 3/18/93 public]
  +HISTORY Thu Mar 18 14:43:53 1993 cfe	added/changed [gmd 3/18/93 public]
  +HISTORY Thu Mar 18 14:43:53 1993 cfe	added/changed [cfe@transarc.com 3/18/93 public]
  +HISTORY Thu Mar 18 14:43:53 1993 cfe	added/changed [cfe@transarc.com 3/18/93 public]
  +HISTORY Thu Mar 18 14:43:53 1993 cfe	added/changed [gmd 3/18/93 public]
  [gmd 3/18/93 public]
  You're right Craig - the friendly behavior I thought I'd seen was NOT
  renumbering but accepting new/higher fileset id numbers.
  I would like to see syncfldb be the single tool for both the "moved" aggregate
  case you mention and the "reconfig" or "added" aggregate case I hit most often -
  a sysadmin could easily have to move an aggregate from a machine in one
  cell to a machine in another cell and not want to delete or renumber by
  hand filesets with duplicate fileset ids OR remember to use another tool ...
  SO ... we can mark this as a doc bug to warn unsuspecting sysadmin's of the
  damage they can do - if it's already well doc'd, can we make this a post-1.0.2
  enhancement request to make syncfldb friendlier and smarter?
  +HISTORY Thu Mar 18 16:36:05 1993 gmd	added/changed [gmd 3/18/93 public]
  [rsarbo 3/18/93 public]
  I vote with Gail.  At the very least, syncfldb should be better
  documented (i.e. with clear warnings about its limited intelligence)
  for 1.0.2.  Craig may remember OT4467 which describes problems
  I had with syncfldb in the 1.0.1 timeframe that sound an awful lot
  like the problems Gail was seeing except in my case syncfldb blew
  away my root.dfs FLDB entry.  2 folks at OSF have used syncfldb now
  and both ran into the same "pilot error".  Sounds conclusive enough
  to justify a doc change to me and probably an open OT defect/enhancement
  for 1.0.3.
  +HISTORY Thu Mar 18 18:03:19 1993 rsarbo	added/changed [rsarbo 3/18/93 public]
  [cfe@transarc.com 3/19/93 public]
  Well, I understand that both Ron and Gail have stumbled into similar
  disasters with syncfldb overwriting existing fldb entries when importing
  essentially-foreign aggregates, and I agree that this is a situation that
  should bear some specific warning.  I spoke with Jeff Kaminski, who claims
  that the documentation for 1.0.2 froze a while ago and thus it wouldn't
  be possible for a warning there, but we can probably all come up with a
  release note that addresses the issue, and some kind of suggestion for
  work to be addressed in a later release (e.g. 1.0.3).
  All that granted, though, I don't know how syncfldb could change to handle
  both points of view, and I'm afraid I keep wondering how syncfldb came
  to be viewed as the tool to use to import foreign aggregates.  As I say,
  one could come up with a tool to import foreign aggregates--possibly an
  fts sub-function--but its purpose honestly seems to be to be at odds with
  the kinds of repairs that syncfldb is supposed to be authorized to do.
  Can the OSF offer any enlightenment here, as to how these two functions
  are viewed as being such close relatives?  For concrete examples, consider
  two cases:
  	(a) an LFS fileset with an ID already in the FLDB for a different
  	    server/aggregate.
  	    (a1) syncfldb overwrites the existing FLDB entry, and has to;
  	    (a2) aggregate-import ideally wants to create a new FLDB entry
  		 and renumber the LFS fileset with the new ID number, but
  		 this might not be possible if the fileset is locally mounted.
  	(b) a UFS fileset exported with an ID that's already in the FLDB
  	    for a different server/aggregate.
  	    (a1) syncfldb, again, overwrites the existing FLDB entry, and
  		 has to do that to do its job;
  	    (a2) aggregate-import ideally will create a new FLDB entry and
  		 request that the administrator edit the server's
  		 /opt/dcelocal/var/dfs/dfstab file to match, after first
  		 detaching (un-exporting) the UFS aggregate and then
  		 re-attaching (re-exporting) it.
  The whole rationale behind ``syncfldb'' is to say that, for the filesets
  on the server/aggregate(s) named in the fts syncfldb command, the
  information in the FLDB is wrong and the information on the aggregate(s)
  is right.  This is fundamentally different from the foreign-aggregate-import
  problem, where an aggregate was created using IDs from some other numbering
  system and you now want to import it into a DCE DFS cell.  Is this helping
  to clarify my point of view here?  Can the OSF help by telling me how these
  two functions are now viewed as so similar?  (Thanks!)
  +HISTORY Fri Mar 19 10:15:11 1993 cfe	added/changed [cfe@transarc.com 3/18/93 public]
  +HISTORY Fri Mar 19 10:15:11 1993 cfe	added/changed [gmd 3/18/93 public]
  +HISTORY Fri Mar 19 10:15:11 1993 cfe	added/changed [rsarbo 3/18/93 public]
  +HISTORY Fri Mar 19 10:15:11 1993 cfe	added/changed [cfe@transarc.com 3/19/93 public]
  +HISTORY Fri Mar 19 10:15:11 1993 cfe	added/changed [cfe@transarc.com 3/18/93 public]
  +HISTORY Fri Mar 19 10:15:11 1993 cfe	added/changed [gmd 3/18/93 public]
  +HISTORY Fri Mar 19 10:15:11 1993 cfe	added/changed [rsarbo 3/18/93 public]
  [gmd 3/19/93 public]
  In general, I feel anything that has a destructive side effect should either
  be well documented and/or have a warning and/or require acknowledgement
  of the destruction to occur.
  I view the two functions as similar because, in both cases, there is
  header information that needs to be recorded/reflected in the FLDB.
  I think there'll be plenty of cases where the FLDB is half of what
  the sysadmin wants and the aggregate header is the other half ...
  I believe most system administators will think in terms of all the filesets
  they manage, whether in one cell or many, by name and NOT in terms of
  cell-specific fileset id's.
  I believe the 2 functions could be handled if the software DID note
  fileset names AND fileset ids and allowed the system admin the option
  to alter or overlay name and fileset id conflicts.
  For instance:
  aggregate has:	fileset id 4 for fileset pmax.bin
  		fileset id 7 for fileset usr.gmd
  		fileset id 10 for fileset user.gail
  fldb has:	fileset id 7 for fileset user.gail
  		fileset id 4 for fileset pmax.bin on dead server
  fts syncfldb says:
  	id conflict: fileset id 0,,7
  	overlay user.gail entry with usr.gmd? (y/n) n
  	add new fileset usr.gmd? (y/n) y
  fileset 0,,13 created ...
  	id conflict: fileset id 0,,4
  	overlay pmax.bin entry with pmax.bin? (y/n) y
  	name conflict: user.gail
  	overlay user.gail id 0,,7 with user.gail id 0,,10? (y/n) n
  	add fileset 0,,10 with new name? (y/n) y
  	name for fileset id 0,,10 : user.marie
  You could have an "-y" switch to turn off interactive portion and just
  answer "yes" to everything. If it's easier for this to be a separate
  tool from synfldb, that's fine with me. Let me know what you think
  Craig - you and Tony and Elliot probably have more DFS sys admin experience
  than I do.
  +HISTORY Fri Mar 19 16:38:06 1993 gmd	added/changed [gmd 3/19/93 public]
  [jeff@transarc.com 3/22/93 public]
  Craig and I discussed the fts syncfldb command as it relates to the problem
  encountered at OSF.  The documentation can potentially be updated to better
  document the somewhat confusing effects of using the command to "move" a
  fileset from one cell to another.  For now, the best I can do is a release
  note that provides the following admonitory information:
     The fts syncfldb command is used to synchronize the filesets that reside on
     an aggregate with the FLDB of the cell in which they reside.  The command
     creates FLDB entries for filesets that do not have them; it also updates
     FLDB entries to record the current locations of filesets whose entries
     do not accurately record their present sites.  However, the fts syncfldb
     command is inappropriate for creating FLDB entries for existing filesets
     from one cell in the FLDB of another cell, a situation that can occur if
     a disk is physically moved from a server machine in one cell to a server
     machine in another cell.
     For example, suppose fileset Foo has fileset ID number 0,,8 in the FLDB of
     cell A.  If the disk that houses fileset Foo is removed from its server
     machine in cell A and installed on a server machine in cell B, the fts
     syncfldb command should not be used to create an entry for the fileset in
     the FLDB of cell B:  If fileset Bar with ID number 0,,8 already exists in
     cell B, the command updates its FLDB entry to reflect the location and
     information associated with fileset Foo, making it impossible to access
     fileset Bar.  Issuing the command on the aggregate that houses fileset Bar
     corrects the entry for that fileset, but fileset Foo is then no longer
     accessible.  Because of potential fileset ID number conflicts of this type,
     there is no convenient way to move a disk partition from a machine in one
     cell to a machine in a second cell and update the FLDB of the second cell.
  This is a first draft of a possible release note.  Please feel free to provide
  any corrections or clarifications to this information, as necessary.  I would
  like to include information about this problem in the release notes sometime
  in the next day or two.  Sorry for any confusion; thanks for any help.
  +HISTORY Mon Mar 22 11:27:04 1993 jeff	added/changed [cfe@transarc.com 3/19/93 public]
  +HISTORY Mon Mar 22 11:27:04 1993 jeff	added/changed [gmd 3/19/93 public]
  +HISTORY Mon Mar 22 11:27:04 1993 jeff	added/changed [jeff@transarc.com 3/22/93 public]
  +HISTORY Mon Mar 22 11:27:04 1993 jeff	added/changed [cfe@transarc.com 3/19/93 public]
  +HISTORY Mon Mar 22 11:27:04 1993 jeff	added/changed [gmd 3/19/93 public]
  [gmd 3/22/93 public]
  Jeff - The Release Note looks good - it's a confusing topic. Could you add
  a short paragraph about what you SHOULD do when there is a fileset id
  number conflict and syncfldb is not appropriate? Ie. how does one change
  the cell A fileset id of Foo to add it to cell B? Thanks.
  Craig - Are we changing this CR to a doc one and adding a separate CR for
  the code enhancement request? Or do you feel the manual steps Jeff will
  describe above are sufficient to cover this?
  +HISTORY Mon Mar 22 11:50:44 1993 gmd	added/changed [gmd 3/22/93 public]
  [cfe@transarc.com 3/22/93 public]
  I believe that I understand the suggestion that Gail is making; I even think
  that I understand its motivation.  I still feel strongly that syncfldb
  isn't a general aggregate-import tool, and that it's weakened by adding
  that requirement to it.  I have nothing against the creation of a tool
  that would do this aggregate-import function, and am happy to deal with
  an enhancement request to that effect.
  We haven't even discussed all the problems with importing filesets into
  a new cell.  For instance, if there are any ACLs at all, even ones that
  are created implicitly, in the fileset, you can't naively import such
  filesets into a cell, because the UUID of the cell will be different from
  the cell UUIDs stored in the ACLs.  Now, it's possible to re-create a cell
  with the same UUID as that of the previous cell (which it must therefore
  be replacing), in which case the operation makes sense.  But the naive
  importing of live filesets will simply fail, for well-understood reasons.
  It continues to make sense to detach a disk from one server and attach
  it to another server in the same cell, then running syncfldb; it
  continues to make sense to use syncfldb to repair some classes of damage
  that might be encountered if fileset operations are interrupted at
  inopportune moments; and it continues to make sense to use syncfldb to
  recreate an FLDB after installing a new cell (with the same UUID as before).
  But, by definition, all concurrently-active cells must have different UUIDs,
  so it doesn't make sense to import filesets across cell boundaries, since
  the UUIDs will no longer match up.  Interestingly, fileset dump and restore
  will preserve complete ACLs, with cell UUIDs, so dump and restore can't be
  used naively to move fileset contents.  One thing that will work today is
  to tar together the contents of the filesets on a disk, move the disk,
  clean it completely with ``newaggr'', re-create the filesets with
  ``fts create'', and restore the non-ACL contents of the filesets via tar.
  This isn't ideal, but to do the job right would require the translation
  of arbitrary ACLs, which is quite a tough problem.
  So, in direct answer to Gail's questions, yes, in my opinion, this has
  turned into a doc defect report, and there might be a code enhancement
  request yet to be created, also.  So far we've resisted the temptation
  to make any of the fts commands interactive (going so far as to remove
  a question that ``fts restore'' used to ask), in hopes of making this
  command suite more useful for script-writing--if you were looking for
  any kind of existing command suite style guide.  I'm hoping that I've
  clarified some of the difficulties to be faced by an aggregate-import
  function, or even a fileset-import function, as motivation for keeping
  the syncfldb/import functions distinct (as I thought they were in this
  first round of tools).
  +HISTORY Mon Mar 22 13:16:37 1993 cfe	added/changed [gmd 3/19/93 public]
  +HISTORY Mon Mar 22 13:16:37 1993 cfe	added/changed [jeff@transarc.com 3/22/93 public]
  +HISTORY Mon Mar 22 13:16:37 1993 cfe	added/changed [gmd 3/22/93 public]
  +HISTORY Mon Mar 22 13:16:37 1993 cfe	added/changed [cfe@transarc.com 3/22/93 public]
  +HISTORY Mon Mar 22 13:16:37 1993 cfe	added/changed [gmd 3/19/93 public]
  +HISTORY Mon Mar 22 13:16:37 1993 cfe	added/changed [jeff@transarc.com 3/22/93 public]
  +HISTORY Mon Mar 22 13:16:37 1993 cfe	added/changed [gmd 3/22/93 public]
  [gmd 3/25/93 public]
  Okay, this CR is now a doc one assigned to Jeff at Transarc. Up'd the
  priority to 1 to reflect the fact that the Release Note has to be done
  in order to ship.
  The enhancement request is CR 7594.
  +HISTORY Thu Mar 25 14:23:34 1993 gmd	area: code -> doc
  +HISTORY Thu Mar 25 14:23:34 1993 gmd	prior: 2 -> 1
  +HISTORY Thu Mar 25 14:23:34 1993 gmd	code: gmd -> jeff
  +HISTORY Thu Mar 25 14:23:34 1993 gmd	codecomp: osf -> tarc
  +HISTORY Thu Mar 25 14:23:34 1993 gmd	added/changed [gmd 3/25/93 public]
  [jeff@transarc.com 4/10/93 public]
  I included the following release note, with some slight modifications, in the
  DCE 1.0.2 Release Notes:
  *** Begin Release Note ********************************************************
  The documentation needs to state that moving a fileset from one cell to another
  is not supported with DFS.  Neither of the following fileset operations is
  supported:
   o Dumping a fileset in one cell and restoring it in another cell.
   o Moving the physical disk on which a fileset resides from a machine in one
     cell to a machine in another cell.
  Moving a fileset from one cell to another causes the following types of
  problems:
   1. The ACLs on file and directory objects in the fileset prohibit access to
      the objects because they are essentially "foreign" ACLs in the new cell.
      Because all ACLs contain the UUID of the cell in which they are are
      created, objects that have ACLs cannot be moved between cells.
   2. The fileset's ID number may conflict with the ID number of a fileset in
      the new cell.  A fileset's ID number is unique within the cell in which
      it is created; it may not be unique in another cell because a different
      fileset may already have that ID number in the other cell.
  Note that if a physical disk is moved from a machine in one cell to a machine
  in a different cell, the fts syncfldb command is inappropriate for creating
  FLDB entries for existing filesets on the disk in the FLDB of the new cell.
  The fts syncfldb command synchronizes the filesets that reside on an aggregate
  with the FLDB of the cell in which they reside.  It creates FLDB entries for
  filesets that do not have them; it also updates FLDB entries to record the
  current locations of filesets whose entries do not accurately record their
  present sites.
  For example, suppose fileset foo has fileset ID number 0,,8 in the FLDB of cell
  A.  Suppose also that fileset bar has fileset ID number 0,,8 in the FLDB of
  cell B.  If the disk that houses fileset foo is removed from its server machine
  in cell A and installed on a server machine in cell B, the fts syncfldb command
  should not be used to create an entry for the fileset in the FLDB of cell B:
  The command updates the entry for fileset bar to reflect the location and
  information associated with fileset foo, making it impossible to access
  fileset bar.  Issuing the command on the aggregate that houses fileset bar
  corrects the entry for that fileset, but fileset foo is then no longer
  accessible.  Such fileset ID conflicts prohibit the moving of a disk partition
  from a machine in one cell to a machine in a second cell.
  *** End Release Note **********************************************************
  Because the crux of this defect has evolved into the need for better
  documentation of intercell fileset moves, I changed the one-line description
  accordingly.  I also lowered both the priority and the severity of the defect
  because it has been documented in the DCE 1.0.2 Release Notes.
-----------end of discussion from 7526
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `jaffe@transarc.com' 
Added field Transarc Status with value `open'

[3/29/94 public]
Dup'ing to 7594.
Changed Status from `open' to `dup' 
Filled in Duplicate Of with `7594'



CR Number                     : 8612
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : all
Component Name                : cds
Subcomponent Name             : 
Short Description             : error with socket from cds as root
Reported Date                 : 9/16/93
Found in Baseline             : 1.0.3
Found Date                    : 9/16/93
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 7530
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : jaffe@transarc.com
Transarc Status               : open

[9/16/93 public]
I'm seeing the following problem on a rios (dce1.0.3-8-31):
[in as comer]
$ dce_login cell_admin
$ cdscp show cell /.:
                        SHOW
                        CELL   /.../slab.dce.transarc.com
                          AT   1993-09-16-09:23:35
              Namespace Uuid = 001a4140-638f-1c97-b7e2-08005a4d135d
          Clearinghouse Uuid = 005cc628-638a-1c97-b7e2-08005a4d135d
          Clearinghouse Name = /.../slab.dce.transarc.com/slab_ch
                Replica Type =   Master
                       Tower = ncacn_ip_tcp:158.98.15.3[]
                       Tower = ncadg_ip_udp:158.98.15.3[]
$ su root
root's Password:
# cdscp show cell /.:
                        SHOW
                        CELL   /.../slab.dce.transarc.com
                          AT   1993-09-16-09:23:52
Error on entity: /.../slab.dce.transarc.com
Error with socket (dce / cds)
Function: dnsReadAttrValue
Error on entity: /.../slab.dce.transarc.com
Error with socket (dce / cds)
Function: dnsReadAttrValue
       ---- AND ----
$ su root
root's Password:
# dce_login cell_admin
# cdscp show cell /.:
                        SHOW
                        CELL   /.../slab.dce.transarc.com
                          AT   1993-09-16-09:33:01
Error on entity: /.../slab.dce.transarc.com
Error with socket (dce / cds)
Function: dnsReadAttrValue
Error on entity: /.../slab.dce.transarc.com
Error with socket (dce / cds)
Function: dnsReadAttrValue
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `jaffe@transarc.com' 
Added field Transarc Status with value `open'

[8/16/93 public]
I cannot reproduce this problem on RIOS which runing dce1.0.3-weekly,
% dce_login cell_admin -dce-
Password must be changed!
% whoami
pwang
% cdscp show cell /.:
                        SHOW
                        CELL   /.../orange_cell
                          AT   1993-09-16-10:08:01
              Namespace Uuid = 00515e14-314b-1c96-be44-08005a0d2b0f
          Clearinghouse Uuid = 008a21ea-3146-1c96-be44-08005a0d2b0f
          Clearinghouse Name = /.../orange_cell/orange_ch
                Replica Type =   Master  
                       Tower = ncacn_ip_tcp:130.105.5.21[]
                       Tower = ncadg_ip_udp:130.105.5.21[]
% su root
root's Password: 
# cdscp show cell /.:
                        SHOW
                        CELL   /.../orange_cell
                          AT   1993-09-16-10:08:17
              Namespace Uuid = 00515e14-314b-1c96-be44-08005a0d2b0f
          Clearinghouse Uuid = 008a21ea-3146-1c96-be44-08005a0d2b0f
          Clearinghouse Name = /.../orange_cell/orange_ch
                Replica Type =   Master  
                       Tower = ncacn_ip_tcp:130.105.5.21[]
                       Tower = ncadg_ip_udp:130.105.5.21[]
# 
Please use the /project/dce/build/dce1.0.3-weekly to try again or
provide more information.

[09/17/93 public]
I too have done this and it works. Could you please get us more information.
I don't know what to do with this other than cancel it....

[09/17/93 public]
Foolish me. This looks like a dup of 7530 which says the eadvertiser won't
spawn a clerk for root. The socket error in all likelyhood is because
the clerk for root isn't there. We saw this during system testing but it
shows itself very infrequently. I currently have 7530 on my list of bugs that
I spend background time on trying to to spot something in the code. It
doesn;t happen often enough to get a handle on but we've seen it enough
times that I've been convinced its still there. dce.clean and rc.dce always 
removed the problem. I'm going to lower the priority and dup it to 7530.
Mike if you have a way of readily reproducing this I'd appreciate it
if you would let me know. As I said, I'm looking at 7530.

[9/17/93 public]
You exactly right, a clerk wasn't being spawned for root.  I didn't 
look into the problem any more than this, though.  I'll let you know
if I see it again (and can provide a little more info).



CR Number                     : 8602
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 8613
Project Name                  : dce
H/W Ref Platform              : i486
S/W Ref Platform              : osf1
Component Name                : bld
Subcomponent Name             : file/flserver, file/bosserver, file/libafs
Short Description             : Makefile stumbles over install targets
Reported Date                 : 9/14/93
Found in Baseline             : 1.0.3
Found Date                    : 9/14/93
Severity                      : C
Priority                      : 1
Status                        : dup
Duplicate Of                  : 8613
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : Makefile
Sensitivity                   : public

[9/14/93 public]

[ /file/flserver at 01:19 (AM) Tuesday ]

/share/include/dcedfs/flserver.h: installing as \
/u1/devobj/sb/nb_486/install/at386/opt/dce1.0/share/include/dcedfs/flserver.h
make: don't know how to make flserver (continuing)

[ /file/bosserver at 01:19 (AM) Tuesday ]

makepath bosserver/. && cd bosserver &&  exec make MAKEFILE_PASS=BASIC \
install_all gencat dfsbbs.cat bbos_err.msf 
release   -o bin -g bin -m 755 -tostage \
/u1/devobj/sb/nb_486/install/at386/opt/dce1.0 -fromfile dfsbbs.cat \
/nls/msg/en_US.ASCII/dfsbbs.cat
/nls/msg/en_US.ASCII/dfsbbs.cat: copying from dfsbbs.cat
/nls/msg/en_US.ASCII/dfsbbs.cat: owner bin, group bin, mode 0755
/nls/msg/en_US.ASCII/dfsbbs.cat: installing as
/u1/devobj/sb/nb_486/install/at386/opt/dce1.0/nls/msg/en_US.ASCII/dfsbbs.cat
make: don't know how to make bosserver (continuing)

[ /file/libafs at 01:19 (AM) Tuesday ]

makepath libafs/. && cd libafs &&  exec make MAKEFILE_PASS=BASIC install_all
make: don't know how to make libknck.a (continuing)

[10/1/93 public]

I really think this is related to 8613 (spurious signal 11 from the make
command), and I can't do anything with it until that problem is fixed.
Reassigning back to bld.

[10/8/93 public]

Changed to a dup of 8613
Down graded the priority.
to be fixed in DCE1.1 with the use of ODE2.3.



CR Number                     : 8575
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : other
S/W Ref Platform              : other
Component Name                : sec
Subcomponent Name             : rs_task
Short Description             : fatal errors produce hung server
Reported Date                 : 9/9/93
Found in Baseline             : 1.0.2
Found Date                    : 9/9/93
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 7763
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : rs_task.c
Sensitivity                   : public

[9/9/93 public]
  If a thread other than the DT calls fatal_st(), that thread tries to
cancel the DT and exits its own thread. This triggers the DT to a CATCH
which also calls fatal_st() and that also causes the calling thread to
exit. In that case, it's the DT and the DT does *not* reach the exit()
to terminate the process -- because it just suicided.
 
  There's a comment before the rs_task_fatal() routine which implies
that the pthread_exit() call should be inside the "if not DT" clause,
not after it. Making that edit and trying it out produces a secd that
will hit all sorts of process-killing faults because fatal() is called
by the DT before it enters a TRY scope. The edit results in a
rs_task_fatal() routine that does nothing if called by the DT. So
testing it with the (trivial) case of starting it on a system which is
already running a secd produces a failed test: the second secd seg
faults after it calls fatal() to report "database locked" but proceeds
past the fatal() call that reported that error.
  What should rs_task_fatal() really be doing?
  This is filed as a high priority bug; fatal errors are leaving secd's
up and running because only the thread that eperienced the fatal error
and the DT get exited. All the other threads, and the process itself,
live on! The result is a secd which continues to answer requests as best
as it can; a secd in the process list to fool job monitors that want to
restart it if it goes away; etc etc etc.



CR Number                     : 8530
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 8529
Project Name                  : dce
H/W Ref Platform              : hppa,i486,rs6000
S/W Ref Platform              : aix,hpux,osf1
Component Name                : gds
Subcomponent Name             : directory/gds/conf
Short Description             : don't know how to make asn1_attr
Reported Date                 : 8/30/93
Found in Baseline             : 1.0.3
Found Date                    : 8/30/93
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 8529
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : Makefile
Sensitivity                   : public

[8/30/93 public]

[ /directory/gds/ros/step at 18:00 (PM) Sunday ]

makepath step/. && cd step &&  exec make MAKEFILE_PASS=BASIC install_all
make: don't know how to make gdsstep (continuing)
`install_all' not remade because of errors.

[9/13/93 public]
Assigned to Norbert, who should be able to reproduce this puppy
on HPUX

[9/16/93 public]
This error is a consequence of 8529 (no gdsstep was built).



CR Number                     : 8526
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 10266
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : rpc
Subcomponent Name             : runtime
Short Description             : cn/dg semantics differ for
rpc_s_cthread_not_found (rpc_s_server_too_busy)
Reported Date                 : 8/29/93
Found in Baseline             : 1.0.2
Found Date                    : 8/29/93
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 10266
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[8/29/93 public]

cn-rpc immediately returns rpc_x_server_too_busy in the case of 
rpc_s_cthread_not_found (bind nak pdu ??).

dg-rpc retries up to comm timeout, then returns rpc_x_comm_failure.

The cn-rpc semantics seem preferable since they allow the application
writer the most flexibility.

In any event, I don't see why the semantics should be different.



CR Number                     : 8500
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : i486
S/W Ref Platform              : osf1
Component Name                : sec
Subcomponent Name             : DCE client process seg faults
Short Description             : Possible NULL pointer
referencing problem in krb5_mk_req_extended().
Reported Date                 : 8/23/93
Found in Baseline             : 1.0.2
Found Date                    : 8/23/93
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 8495
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[8/23/93 public]

This problem has been discovered by the DME development group running 1.0.2
on 486 platform. Here are the details as mailed to me by the DME developer:
(the set-up is: process with a single login context and 20 threads)

   I have seg faults happening in a multi-threaded DCE client 
   process and could use a bit of asistance in figuring it out.
   The faults occur deep down in the DCE code below my RPC.  The 
   routine is called krb5_mk_req_extended() although I *may have
   have seen is elsewhere as well.  The stack fragment
   below shows the 3rd from the last parm as NULL, this is a pointer
   called 'cred' through which a member access is attempted.  Ouch.

   This problem seems to go away when I only have one thread doing
   RPC's.  The process normally has 20 RPC threads.

  #0  0xa43cba77 in krb5_mk_req_extended
      (536870912, 9212900, 16, 0, 0, 10233632, 0, 0, 9212912)
  #1  0xa430077e in sec_krb_cn_build_message
      (11219448, 0, 5, 2, 9212968, 9212976)
  #2  0xa422bb33 in rpc__krb_cn_fmt_client_req
      (13477108, 13386760, 11808836, 9213052, 13476936)
  #3  0xa41f77e9 in send_pdu (13476888, 14, 0, 0, 13386760, 13476936)
  .....
  .....  (12 more levels)

   Here is the fragment of the DCE function and the clear use of 'creds',
   the NULL pointer....

krb5_mk_req_extended(ap_req_options, checksum, kdc_options,
                     sequence, newkey, ccache, creds, authentp, outbuf)
const krb5_flags ap_req_options;
const krb5_checksum *checksum;
const krb5_flags kdc_options;
krb5_int32 sequence;
krb5_keyblock *newkey;
krb5_ccache ccache;
krb5_creds *creds;krb5_authenticator *authentp;
krb5_data *outbuf;
{
    krb5_error_code retval;
    krb5_ap_req request;
    krb5_authenticator authent;
    krb5_data *scratch;
    krb5_enctype etype;
    krb5_encrypt_block eblock;
    krb5_data *toutbuf;

    if ((ap_req_options & AP_OPTS_USE_SESSION_KEY) &&
        !creds->ticket.length)                  <***********
        return(KRB5_NO_TKT_SUPPLIED);

    if (!creds->ticket.length) {                <***********
          /* go get creds */


What could my application level code be doing wrong to cause
this NULL pointer so deep down the stack?

[10/07/93 public]

I have worked my way backwards from krb5_mk_req_extended to send_pdu
and everything looks ok, so could you add in the rest of the
(12 more levels).   

From the current information what ever function that's calling
send_pdu, has an incomplete sec_context pointer.  The sec_context
pointer (fifth arg to send_pdu), gets passed to the 
rpc__krb_cn_fmt_client_req function.


The rpc__krb_cn_fmt_client_req does the following:

	krb_cn_info = (rpc_krb_cn_info_p_t) sec->sec_cn_info;

	sec_krb_cn_build_message (krb_info->auth_info.u.auth_identity,
                                    krb_cn_info->cred,		<<<< NULL >>>>
                                    krb_info->auth_info.authn_level,
                                    krb_info->auth_info.authz_protocol,
                                    &key,
                                    &krb_ap_req);

As shown in the provide stack trace up above.

If a program that demonstrates this bug exists, it would be useful to have.

[10/7/93 public]

Here is the detailed trace info.

#0  0xa43cba77 in krb5_mk_req_extended
    (536870912, 9212900, 16, 0, 0, 10233632, 0, 0, 9212912)
#1  0xa430077e in sec_krb_cn_build_message
    (11219448, 0, 5, 2, 9212968, 9212976)
#2  0xa422bb33 in rpc__krb_cn_fmt_client_req
    (13477108, 13386760, 11808836, 9213052, 13476936)
#3  0xa41f77e9 in send_pdu (13476888, 14, 0, 0, 13386760, 13476936)
#4  0xa41f6145 in send_alt_context_req_action_rtn (13476888, 9213220)
#5  0xa4203f79 in rpc__cn_sm_eval_event (7, 9213220, 13476888, 13476896)
#6  0xa41edc1c in rpc__cn_assoc_alter_context
    (13476888, 4692940, 12864744, 11848188, 11848184, 11848220, 9213692)
#7  0xa41e8f23 in rpc__cn_assoc_request
    (11847680, 11347264, 4692940, 11848188, 11848184, 11848220, 9213692)
#8  0xa41f7bfc in allocate_assoc_action_rtn (11847680, 4692940)
#9  0xa4203f79 in rpc__cn_sm_eval_event (8, 4692940, 11847680, 11847732)
#10 0xa41f0edd in rpc__cn_call_start
    (11347264, 0, 4692940, 0, 9214848, 9214844)
#11 0xa41d2da0 in rpc_call_start
    (11347264, 0, 4692940, 0, 9214876, 9214848, 9214844)
#12 0x45cdba in evs_i_ntf_rpc_emit_event (p_cookie_=0x4effc8 "oreo", 
    p_ntf_record_=0xab1a3c, p_status_=0x8c9d3c, rpc_hnd_=0xad2540)
    at evs_ntf_if_cstub.c:183
#13 0x409646 in evs_i_erb_rpc_forward (p_forward_buf=0xab19f0, 
    p_thread_data=0x4ed8c0, p_login_context=0x5197c0, p_status=0x8c9e10)
    at ../../../../../src/services/evs/evs_erb/erb_rpc.c:217
#14 0x403053 in evs_i_erb_emit_thrd_main (emit_thrd_id_arg=0x6)
    at ../../../../../src/services/evs/evs_erb/erb_emit_thrd.c:116
#15 0xa41c2063 in cma__thread_base ()
#16 0xa41cd685 in cma__create_thread ()
#17 0x402f48 in evs_i_erb_emit_thrd_main (Cannot access memory at address
0x6.
oscar 10 -->

[ mdf 10/12/93 public ]

Based on the provide stack trace and by viewing the code,
I belive I have found the bug, however I have not yet proven
this.  Could you provide the test program so I can verify?

[10/13/93 public ]

I retract yesterdays belief...  8^_)

I have traced the code back to rcp__cn_call_start, where I am currently
trying to find out what's what.

Could you turn on any debugging environment variables, and supply 
the results into this defect report?


Rational for dup.
In defect 8495, the module is trying to obtain credentials, which
in is failing due to non thread safe flock and fcntl.  This defect
seems to be directly related, (comes from the same module, just a 
few lines further down).



CR Number                     : 8490
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : dfs
Subcomponent Name             : dfs_config
Short Description             : rc.dfs loses execute rights
Reported Date                 : 8/20/93
Found in Baseline             : 1.0.3
Found Date                    : 8/20/93
Severity                      : D
Priority                      : 3
Status                        : dup
Duplicate Of                  : 8450
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : dfs_config
Sensitivity                   : public

[8/20/93 public]

 rc.dfs loses its execution priveledges during the initial configuration
 of DFS.  Therefore, a START after shutting down the machine will not
 executre rc.dfs.  Within the routine enable_in_dfs_rc in dfs_config,
 the line:

           { mv /tmp/rc.dfs$$ $RCDFS;

 should be changed to

           { cp /tmp/rc.dfs$$ $RCDFS;

 to correct the problem.

[08/20/93 public]
I think this is a duplicate of one you filed Ron....



CR Number                     : 8430
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : rpc
Subcomponent Name             : 
Short Description             : unclosed comment in stubbase.h
Reported Date                 : 8/10/93
Found in Baseline             : 1.0.3
Found Date                    : 8/10/93
Severity                      : E
Priority                      : 2
Status                        : dup
Duplicate Of                  : 8289
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : rpc/sys_idl/stubbase.h
Sensitivity                   : public

[8/10/93 public]
../export/hp800/usr/include/dce/stubbase.h:918: warning: `/*' within comment

The code is:

/*
   v1_enum macros are missing for CRAY;
   the whole CRAY section is untested and should probably be 
  excised from

/*
 * ndr_small_int is larger than 8 bits
 */
#define rpc_marshall_small_int(mp, src)\
    *(char *)mp = (char)src

[08/16/93 public]
Third bug on this problem (see 8289 and 7575).
Somehow this didn't get submitted to 1.0.3i correctly.



CR Number                     : 8331
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : cds
Subcomponent Name             : 
Short Description             : "/usr/include/Motif1.2/Xm/Xm.h", line 1405: error 1000: Unexpected symbol: "XmImGetXIM"
Reported Date                 : 7/21/93
Found in Baseline             : 1.0.3
Found Date                    : 7/21/93
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 8338
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[7/21/93 public]
[ /directory/cds/cdsbrowser at 07:57 (AM) Wednesday ]
cc: "/usr/include/Motif1.2/Xm/Xm.h", line 1405: error 1000: Unexpected symbol: "XmImGetXIM".
cc: error 2017: Cannot recover from earlier errors, terminating.
*** Error code 1



CR Number                     : 8237
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 4920
Project Name                  : dce
H/W Ref Platform              : other
S/W Ref Platform              : other
Component Name                : thr
Subcomponent Name             : 
Short Description             : Race condition between kill
and sigwait in dealing with SIGCHLD
Reported Date                 : 7/7/93
Found in Baseline             : 1.0.2
Found Date                    : 7/7/93
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 4920
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[7/7/93 public]

Problem reported by customer with SVR4 platform:

Full Description:
        On SVR4 systems blocking SIGCHLD will not prevent
        it from being dropped immediately when the
        disposition for this signal is default ( SIG_IGN )

        There is no thread safe call or a wrapper that
        can be used to install a signal handler for this
        signal - as cma_sigaction jacket will not allow
        handlers to be registered for asynchronous signals  -
        which would prevent this race condition.

Repeat By:

Proposed Solution:
        Several possibilities exist, none of which seem
        to be good.

        1. Fix OS to not drop blocked signals even if
           their disposition is SIG_IGN.
           ( Bad because - can break existing apps,
             This would be a feature, if applications
             were to rely upon, would not meet posix
             portability guidelines )

        2. Fix CMA to allow handler to be registered for
           SIGCHLD ( Making cma signal handling inconsistent
            - can of worms ? )

        3. Fix cma so that it registers a handler for
           SIGCHLD. ( would change SYSV behavior relating
           to wait and zombies )

        4. Get around cma_sigaction with and #undef sigaction
           or using sigset.

        5. Having applications build some external synchronization
           mechanism that prevents this race - child waits to
           die until parent calls sigwait.

        Any more ??

[Thu Jul  8 10:32:20 EDT 1993 public]

As far as I can tell, the "problem" description in the first praragraph 
is not really a problem; here is how I understand the problem:

	1)  The SIGCHLD signal is being dropped when its disposition is
	SIG_IGN.  

	2)  Also mentioned is the fact that this happens when
	the signal is blocked.

POSIX sematics state that any signal which is "ignored" (whose state 
is set to SIG_IGN) will not be received by a process.  Therefore,
it seems like this is not a problem at all, and certainly not specific
to SVR4.

In addition, the fact that the signal is blocked at the time should
have no bearing on what happens to a signal which is ignored.

The second paragraph states that there is not call which can be used to 
install a signal handler for this signal.  This is correct, and is
documented in P1003.4a and in the "OSF DCE Application Development Guide".
In order to "catch" or "handle" the SIGCHLD signal, one must use the
sigwait(2) call.

It seems like this bug should be cancelled, or at the very least
made a bug on all platforms -- not SVR4 specific.

[Mon Jul 12 16:04:38 EDT 1993 public]

I was too hasty in my statements above, and will try to clarify now.

From P1003.1-1988, section 3.3.1.2:

	If the action associated with a blocked signal is to ignore the
	signal and if that signal is generated for the process, it is
	unspecified whehther the signal is discarded immediately upon
	generation or remains pending.

which means that the SVR4 platform is in compliance with the standard, 
as well as those that do not "drop" the signal.

[7/12/93 public]

I agree that this is not a SVR4 specific problem, and the OSs that drop
SIGCHLD when it is blocked and its default action is SIG_IGN are not to
blame either.

As such, i am re-assigning to osf for consideration.

The problem is still there: for OS that drops SIGCHLD when its default
action is SIG_IGN, like SVR4, there is no way to catch it: sigwait() is not
going to work since the underlying OS has already dropped the signal. To
change the default action, one needs to use sigaction (cma_siogaction), but
sigaction explicitly disallow the async signals.

[Mon Jul 12 17:10:35 EDT 1993 public]

I will argue very strongly that this bug should be cancelled.  The
fact that there is nothing which says what happens to the disposition
of a signal when it is blocked and ignored, means that there is no
bug here.

Even if one were able to use sigaction(2) to change the action for
a given signal, it would not help in this case since the signal
has already been dropped by the OS.  This is true regardless of whether
one uses sigaction(2) or sigwait(2).  The disposition of the signal must
be something other than SIG_IGN *before* a signal is generated for 
a process, if the process wants to handle it.

[7/13/93 public]

I agree that this is none of OS's fault, but it is more likly to be a CMA
design issue.

It seems to me that when cma signals handling was designed, it did not
occur that it is possible that async signal may get dropped if its handler
is SIG_IGN. The saying that one has to use cma_sigaction to catch the sync
siglas and cma_sigwait to catch async signals assumes that signals do not
get dropped by the OS.

The dilemma now is that for some OSs, like SVR4, one needs to use
cma_sigaction to change the default SIG_IGN action in order for the OS not
to drop the signal, but one could not do so.

[Mon Aug  2 10:08:18 EDT 1993 public]

I have come around to believing that there is actually a problem.  The
short description is misleading.  The problem is not really there there
is a race condition.  It seems to me that the problem is really, how
in SVR4 DCE, can one reliably obtain SIGCHLD signals?

I will illustrate with a code
example:

    catch_children()
    {
    sigset_t    sigset;

        if ( sigemptyset( &sigset ) == -1 )
            {
            perror("sigemptyset");
            exit(-1);
            }

        if ( sigaddset(SIGCHLD, &sigset) == -1 )
            {
            perror("sigaddset");
            exit(-1);
            }

        if ( sigprocmask(SIG_BLOCK, &sigset, (sigset *)NULL) == -1 )
            {
            perror("sigprocmask");
            exit(-1);
            }

        while (1)
            {
            if ( sigwait(&sigset) == -1 )
                {
                perror("sigwait");
                perror("sigwait");
                exit(-1);
                }

            /*
            *   One of our children died, do something now.
            */
            }   /* while() */
    }   /* catch_children() */

The basic idea, is to forever loop, waiting for children which die.  It is
necessary to call sigprocmask(2) in order to not lose any SIGCHLD signals
between calls to sigwait(2).  If sigprocmask(2) were not used, then
the application would "lose" some SIGCHLD signals.  Unfortunately, SVR4
states that if a signal is blocked and its disposition is SIG_IGN, then
it may get dropped, so using sigprocmask(2) does not help an SVR4 application.

The reason that this is not a problem in a non-DCE application is because
an application would use sigaction(2) to install a signal handler for
SIGCHLD.  This signal handler never gets deinstalled (unlike when sigwait(2)is used -- signals will only be caught while inside of the sigwait(2) call)
-- therefore a SIGCHLD signal will never get "lost".

OSF OT #4920 describes a similar problem.

[jd 10/07/93 public] 
Ben's analysis looks correct. This is a dup of 4920 and I'm marking it as 
such. The question remains what can be done about it given that sigaction
can;t be used to assign an handler.......



CR Number                     : 8224
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 10568
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : rpc
Subcomponent Name             : cn runtime
Short Description             : client hangs when connected to a non-DCE tcp socket
Reported Date                 : 7/1/93
Found in Baseline             : 1.0.2
Found Date                    : 7/1/93
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 10568
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : cnassoc.c
Sensitivity                   : public

[7/1/93 public]

If a cn rpc client successfully connects to a non-DCE tcp socket, and
the owner of the socket doesn't mind, the client hangs out forever.

This might be a good use for set_com_timeout in ncacn_ip_tcp.



CR Number                     : 8218
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : bld
Subcomponent Name             : 
Short Description             : libdce.a get rebuilt on install
Reported Date                 : 6/30/93
Found in Baseline             : 1.0.3
Found Date                    : 6/30/93
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 7053
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[6/30/93 public]
When you do an install_all of libdce, it rebuilds libdce.a on HP's.
Also, when you change one .o file, it ar's every .o file in to libdce.a,
which takes along time (in both cases) and is stupid.

To reproduce:

cd src/libdce; build install_all
cd src/time/libutc/user; touch utc_shared_map.c ; cd src/libdce; build



CR Number                     : 8136
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : pmax
S/W Ref Platform              : osf1
Component Name                : dfs
Subcomponent Name             : cm
Short Description             : du -s on UFS fileset panics pMax
Reported Date                 : 6/10/93
Found in Baseline             : 1.0.2a
Found Date                    : 6/10/93
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 7780
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : 
Transarc Status               : 

[6/10/93 public]
Scenario:  2 pMax cell with 1-flserver, 2 px DFS filesystem running since
May 23 ( no kidding) for admin systest work.  Each server has several LFS
and UFS partitions, until the time of the incident only the LFS partitions
have been exercised, AT ALL, in fact I never went into the UFS partitions
through the glue.
 
So:  I cp -R  dfs1.0.2/src/test/directory/xds into fileset prelude_ufs2,
mounted over /u2 on prelude, do a fts dump out of it, do a restore into
another UFS partition on the same machine.  Get rpc timeout error on
the restore into the /u1 partition, mounted as prelude_ufs1.  In the
process of documenting this error for what will eventually be yet another
OT report, I thought I'd find out how big the fileset I'd originally
dumped was:
 
>cd /:
>ls
prelude_ufs2 other_fileset    other_fileset
 
plus others . . .
 
>ls prelude_ufs2
xds
>ls prelude_ufs2/xds
file   file   directory  directory
 
du -s prelude_ufs2
panic: ufs_write type
Kdb kernel trap [du]: Interrupt trap, code=0
thread 0xc1567744, pcb 0xc3ad9c08
panic from  ufs_write +1c4
ufs_write from cm_UFSCacheRDWR+74
	  from cm_CFileRDWR+30
	  from cm_CFileRW+48
	  from cm_CacheFetchProc+a8e
	  from AFS_Readdir+70c
	  from cm_FetchDCache+5c4
	  from cm_GetDOnline+470
	  from cm_GetDLock+6fc
	  from cm_readdir+510
	  from nosf_readdir+74
	  from xglue_readdir+d0
	  from getdirentries+11c
	  from syscall+27c
Hard bang.  By the way, when I rebooted, both the /u2 and  /u1 partitions 
had to be newfs'd, since fsck couldn't fix them  up (and I ran it twice) 
after the aborted restore.  
 
  I will be trying to reproduce this, naturally, since I will be trying to
reproduce the error that led to this one.  Any suggestions are welcome,
especially what info would be interesting in Pittsburgh.  I will be turning
any and all tracing on . . .

[6/10/93 public]
I believe that someone at the OSF will need to debug this as it occurs on
the OSF/1 platform, and dies in OSF/1 specific code.  None the less, I'm
assigning it to Craig so that he can describe what type of things to look 
for and what type of additional information will help track down the problem.
Changed Responsible Engr. from `Elliot_Jaffe@transarc.com' to 
 `cfe@transarc.com' 
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `' 
Added field Transarc Status with value `'

[6/10/93 public]
It appears the panic occurred when the CM was trying to write a 
just fetched chunk into the on-disk cache.  Dave will have to confirm 
this, but my guess is Dave's /opt directory lived on /u1, and when /u2 
was restored onto /u1 all the DCE stuff got blown away.  This would 
obviously include the DFS on disk cache and would explain the panic.
 
If this is truly the case, perhaps the way to prevent this in the
future is to prevent users from restoring onto a mounted UFS fileset.
On second thought this might not 't work since a UFS fileset must be 
mounted locally before it can be dfsexported and attached to the DFS 
space, though I'm not sure why that is a requirement.
 
In any case, there should be some kind of safety checks to prevent
users from restoring onto a live UFS fileset (perhaps a check
analogous to the one done at unmount time that returns EBUSY if
there's any activity on the fileset?).

[6/10/93 public]
My conjecture was also that Dave had restored on top of the UFS partition
housing his DFS cache.  If that's really not what it was, the next thing
is to figure out where in ufs_write() it's crashing, and why--what code
it is around ufs_write+1c4, what source code that corresponds to, and like
that.
 
As to Ron's suggestion about interlocking against UFS restorations, there
is code like that in the filesystem-specific VOL_OPEN processing that should
be doing this.  I don't know why it doesn't work.
 
I guess I'd treat this either as pilot error or an OSF/1 UFS-volops bug.
Filled in Interest List CC with `cfe@transarc.com' 
Changed Responsible Engr. from `cfe@transarc.com' to `treff@transarc.com' 
Changed Resp. Engr's Company from `tarc' to `osf'

[6/10/93 public]
oops, got the assignment wrong
Changed Responsible Engr. from `treff@transarc.com' to `treff'

[6/10/93 public]

Unfortunately, Ron, you're right -- there goes my opt partition . . . so
what this is is a dup of the general run of 7780/7331/7312, related to
6787/6049 as an Ease-of-Use/Pain-in-the-Keister thing.  Right: it sez so
in the documentation, you're strongly urged not to restore into a
non-empty, mounted fileset, LFS or UFS.  I know: I've done this several times, 
myself.  Pilot error: sure.  But should fts be fixed so that one CAN'T restore 
into  a mounted fileset, and a full restore only if empty, and detect 
restores into filesets with incrementals missing?  Absolutely, and in
1.0.3.  Dup'ed to 7780.



CR Number                     : 8133
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 4459, 3383
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : cds
Subcomponent Name             : 
Short Description             : memory associated with deleted
namespace entities is neither freed or reused causing cdsd to eat alot of system
memory.
Reported Date                 : 6/9/93
Found in Baseline             : 1.0.2
Found Date                    : 6/9/93
Severity                      : B
Priority                      : 3
Status                        : dup
Duplicate Of                  : 3383
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[6/9/93 public]
This oughta cause a stir.  During our CET testing cycles, DCE is kept up for
excesses of 24 hours doing all kinds of things from RPC apps to Encina and DFS.
We've seen cdsd just take up a huge amount of system memory at times.  Also
I have been seeing deleted entities (mostly child pointers) coming back from
the deleted state and causing tremendous amounts of grief.  These things 
prompted me to wonder whether cdsd was freeing and/or re-using buckets 
associated with deleted entities.  As per a conversation with Alan Pekham, he
informed me that cdsd doesn't free or reuse memory associated with deleted
entities.  Some internal specs also state that to get the benefits of a 
compressed database, one has to disable the server and re-enable it.  This is
not so good since several customers that I have talked to want to build apps
ontop of DCE that will stay up for 24hrs/7days/52wks.  I do not know if anyone
has opened any OT on this.  I'm sure that this is going to be down-graded and
/or defered faster than greased lightning but this is a major problem for cdsd,
especially on modest machines.  I am not aware of any reorg code in cdsd that
would reorg the database.  

The thing about this that causing me so much grief is if memory is left around,
this affords cdsd limitless possibilities to get old deleted stuff.

[6/10/93 public]

>associated with deleted entities.  As per a conversation with Alan Pekham, he
>informed me that cdsd doesn't free or reuse memory associated with deleted
>enties

My old cdscp "create 100 dirs/delete 100 such dirs" experiment told me that 
the deleted directories would be re-used. To be clear, when I first created 
100 dirs, cdsd grew abot 3.4 MB. Then, I deleted those 100 dirs and cdsd didn't
shrink. But, when I created another 100 dirs, its size only grew a little
comparing with the 3.4 MB growth. So, in this directory create/delete test
the cdsd did re-use the deleted entries. 

Maybe for child pointers it is a different story. Can you do a similar 
experiment to decide if cdsd re-uses the deleted child pointer entries?

I guess that there may be a parameter inside cdsd to control its memory
database size. If my guess is right, we can limit that size to a certain
value. Once it grows beyond that point, the daemon needs to re-structure
its database by writing out old/deleted entries to the disk. But, this 
has performance implication.

[06/10/93 public]
OK, I'll go on record as agreeing with Gerald. The current behavior of
growing and shrinking only on a disable/enable doesn't seem reasonable to
me either. This has been discussed in the past and I think it's time to at 
least leave this open as a bug long enough to see what it's going to take
to change the behavior. Given the current schedule it may/probably won't
get changed for 1.0.3 and may become an enhancement request for 1.1. 

As Gerald suspected A1 is in reality a bit high.

[06/10/93]

This OT is related to 3383 and 4459, which both already discuss some
of the issues raised here.

[06/15/93 public]
Really is a dup of 3383. We will scope the work required to fix this.



CR Number                     : 8117
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : pmax
S/W Ref Platform              : osf1
Component Name                : dfs
Subcomponent Name             : rep
Short Description             : spin in rep test2
Reported Date                 : 6/9/93
Found in Baseline             : 1.0.2a
Found Date                    : 6/9/93
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 8042
Fix By Baseline               : 1.0.2a
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : jaffe@transarc.com
Transarc Status               : open

[6/9/93 public]
I modified the replication rtest3 to serialize the fts release's
in the appropriate place as discussed with Craig.  I ran the
replication tests overnight in a loop.  On the first iteration
of the loop, rtest 1 and 2 passed; rtest3 failed with a cut and
paste error on my part.  On the second iteration, rtest1 passed;
rtest2 is spinning in an fts update on Stevens.1847.  Both
the ftserver and the fts update are accumulating CPU time
as of this morning.  I do not believe this problem is related
to my changes in rtest3, but perhaps the cause of the problem
is the same as the cause I was trying to address with the
changes to rtest3.
 
My feeble interpretation of what's going on is that the repserver
on barge made a FTSERVER_Forward() rpc call to the ftserver on
shotz to suck over an incremental dump of the (distinguished?) RO.
The ftserver attempted to fetch the dump, and failed with 
"repserver forward fileset" (i.e. the ftserver thinks the R/O is 
busy).  lsheader on shotz shows no evidence that this R/O fileset 
even exists.  lsreplicas appears to show it with flags 0x20081.  
I'm having trouble interpreting these flags.  They don't appear to 
correspond to the "states" defined in volume.h.  In fact, tips on 
interpreting any of the information coming from lsreplicas would be useful.
 
I presume the spinning action is simply the repserver on barge
retrying the transaction over and over again (perhaps at the
prompting of the fts update which would explain why it's
accumulating CPU time), but the ftserver keeps telling it
the (primary, distinguished?) R/O is busy.  I don't see
the activity in the RepLog on barge that would corroborate
this theory, though.
 
The raw data including the Ftlog, the verbose test output, and
the output from fts lsfldb, lsreplicas, lsheader, statftserver,
statrepserver is in ~notuser/rsarbo/rep0609.  I notice the
verbose output is apparently not keeping up with the test
itself.

[6/18/93 public]
It's about time that I looked into this!
I agree with Ron that his rtest3 changes didn't cause the deadlock.  The
most that it caused was the Rubble.<PID>.[12345] filesets, with
maybe some repserver activity in the background.
 
The runtests.log file isn't tremendously interesting, since as Ron
noted the verbose output isn't kept up-to-date there.  Instead, it's
kept up-to-date in some file like /tmp/rep.1.<PIDnumber> by the
runtests program, and it's appended to runtests.out when a given
test exits.  It's a little too bad, as it was in the second rtest2
run that this failed.  But only a little, since it wouldn't have helped
that much anyway.
 
The situation as of the fts.diag.out status and the FtLog is basically
this--not that different from Ron's analysis.  The repserver on barge
is in the middle of an RPC call to forward a dump of the Stevens.1847
R/W fileset to its local instance of Stevens.1847.readonly.  That repserver
on barge is making this call to the ftserver on shotz.  My surmise is that
something went wrong with the restoration process.  But as discussed at
the end of OT 8042, the ftserver services FTSERVER_Forward() calls by
pthread_create()ing a helper thread.  The parent thread calls the
remote FTSERVER_Restore() procedure (from the ftserver on shotz to the
ftserver on barge), something went wrong there, and the ftserver on
shotz is trying to clean up.  It's doing a pthread_join() trying to
clean up its sub-thread.  The sub-thread, meanwhile, is trying to write
to a local in-core ``pipe'', which is used for buffering between the
dumper and the restorer.  It wasn't a pipe exception that killed the
restoration process, but was rather some other, not-yet-logged error code.
(An exception would have caused a log message to be generated.)
Thus, the call executor never finishes the RPC service call, and the
repserver on barge never gets an answer other than ``still working on
your call; don't quit yet''.  Thus, the repserver on barge doesn't ever
fail the call (and it would be tough to have a timeout here, since the
_Forward call could legitimately take a huge amount of time).  Meanwhile,
the ftserver on shotz continues to hold the reference count high on its
in-core transaction, so that the transaction-GC'er can't delete it.  And
even though the shotz/Stevens.1847 R/W fileset has long since been
declared no-longer-busy by the kernel on shotz, the ftserver on shotz
still has its active transaction, so that when the repserver on shotz
goes to ask for a dump of data from the R/W, the shotz ftserver gives it the
error code that the barge repserver gave it when preparing for its
FTSERVER_Forward() call.  Of course, that code translates to
``repserver forward fileset''.
 
All the processes in this case (shotz repserver, shotz ftserver, barge
repserver) are in some level of loop and will accumulate CPU time.  The
fileset is set for scheduled replication, so it's the duty of the shotz
repserver to attempt to update it, particularly since it hasn't updated it
for well over the target siteMaxAge.  The barge repserver is stuck in
the RPC runtime, probing the shotz ftserver to ask if the call is still
in progress.  The shotz ftserver is continuing to run its background
transaction-GC'er as well as answering the probes from the barge repserver.
 
As to the output of fts lsrep/fts statrepserver, indeed the ``flags'' word
is a collection of the bits defined in src/file/rep/repser.h (yes, it's
probably installed in usr/include/dcedfs): the symbols starting with
repflag_XXX.  For example, the 0x20001 bits are repflag_HaveWVTRead and
repflag_KnowVLDB.  There's also a ``volstates'' word that, if present,
contains the fileset states bits of the published replica, should that
be interesting.  Here's a quick summary of one of the status messages:
   On barge.osf.org:
[message from the repserver on barge.osf.org]
   Stevens.1847, cell 134240781,,1166149805: src 0,,39 (lfs_aggr2) (on shotz.osf.org) => barge.osf.org 0,,40 (lfs_aggr)
[Here's a work item.  The fileset is named Stevens.1847, the DFS ID of the
cell is as listed.  The source of data is fileset 0,,39 on aggregate lfs_aggr2
of the machine shotz.osf.org, and the destination being managed is fileset
0,,40 on barge.osf.org's aggregate named lfs_aggr.]
      flags 0x20001, volstates 0.  NumKAs 0; lastKA sweep=Wed Dec 31 19:00:00 1969
[The repserver's internal repflag_XXX bits are 0x20001.  There are no available
fileset states.  There are no vnodes being kept alive for this fileset by
this repserver.]
      srcVV: 0,,219; curVV: 0,,0; WVT ID = 739577335,,1111
[The fileset version of the data source is 0,,219, and the fileset version
of the fileset being managed locally is unknown.  Since repflag_HaveWVTRead
is set, the token ID of the whole-fileset token is as given.]
      Lost token 7821871 ago; token expires -31471 hence; new version published 739633996 ago
[The last time that the token was lost was many seconds ago (probably never).
The token has already expired (31471 seconds ago).  There was never a new
version of this fileset published.]
      vvCurr 731812125.766556 (7821871 ago); vvPingCurr 739588125.845792 (45871 ago)
[These are copies of variables that the repserver maintains for the fileset
in the kernel, indicating when the repserver last made contact, or tried
to make contact, with the R/W for this fileset.  They're timestamps.]
      Last update attempt 739588127.287495 (45869 ago); next scheduled attempt 0.000000 (-739633996 hence)
[This repserver last tried to obtain an update from the source ftserver at
the given timestamp.  Since the next-scheduled-attempt is zero, the
repserver is supposed to attempt to get one of these updates ASAP.]
      Status msg: Calling FTSERVER_Forward() on primary
[This is just the last message dumped into the work-item structure by the
repserver, more or less as a trace to say what was most recently attempted
or achieved on behalf of this replica.]
 
The bottom line is that I believe that this problem, such as it is, will be
fixed as part of the fix for 8042.  This is probably a better capturing of
the problem itself, but I have work enqueued under that OT.
Filled in Interest List CC with `cfe@transarc.com' 
Changed Status from `open' to `dup' 
Filled in Duplicate Of with `8042' 
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `jaffe@transarc.com' 
Added field Transarc Status with value `open'



CR Number                     : 8098
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 3551
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : host
Short Description             : the scout does not correctly update the hosts
Reported Date                 : 6/7/93
Found in Baseline             : 1.0.2
Found Date                    : 6/7/93
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 5722
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : jaffe@transarc.com
Transarc Status               : open

[6/7/93 public]
The fshost package does not update the number workstation hosts correctly.
This is shown in scout. 
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `jaffe@transarc.com' 
Added field Transarc Status with value `open'

[7/14/93 public]
This is essentially a dup of ot5722.
Elliot, please cancel it. 
Changed Status from `open' to `dup' 
Filled in Duplicate Of with `5722'



CR Number                     : 8091
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : cds
Subcomponent Name             : 
Short Description             : cdscp detects software error in obj operations.
Reported Date                 : 6/4/93
Found in Baseline             : 1.0.2a
Found Date                    : 6/4/93
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 7940
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : jaffe@transarc.com
Transarc Status               : open

[6/4/93 public]
When running my test program which is using a cds ob
ject and I have following
cdscp command failures:
Running script ====== close.dist.scr ======
run with setup file close.dist.scr.setup
 [1] (0:00) --- The test is starting on Mon Apr 26 16:16:56 1993
 [1] (0:01) ### DCE ERROR: rpc_ns_binding_export FAILED -
        [282109903] Software error detected in server (dce / cds)
 [1] (0:01) ### DCE ERROR: ns_Listen FAILED -
        [282109903] Software error detected in server (dce / cds)
This is found on a two-machin cell and the cell is up
uptime
  04:43PM  up 2 days,  22:32,  1 user,  Runable processes: 1
 
The configuration is dfs-102-carl.
 
When you use cdscp commands:
# cdscp del obj /.:/dfs-test/g
Error on entity: /.../moe.com/dfs-test/g
Software error detected in server (dce / cds)
Function: dnsDelObj
# cdscp cre obj /.:/dfs-test/g
Error on entity: /.../moe.com/dfs-test/g
Software error detected in server (dce / cds)
Function: dnsCreateObj
# cdscp show obj /.:/dfs-test/g
                        SHOW
                      OBJECT   /.../moe.com/dfs-test/g
                          AT   1993-06-04-08:16:10
Error on entity: /.../moe.com/dfs-test/g
Software error detected in server (dce / cds)
Function: dnsEnumAttr
# cdscp show dir /.:/dfs-test
                        SHOW
                   DIRECTORY   /.../moe.com/dfs-test
                          AT   1993-06-04-08:16:38
            RPC_ClassVersion = 0100
                     CDS_CTS = 1993-05-11-21:47:37.171862100/08-00-5a-4d-20-84
                     CDS_UTS = 1993-06-04-07:52:15.876052100/08-00-5a-4d-20-84
              CDS_ObjectUUID = 001a47a8-1ef9-1bf0-95c8-08005a4d2084
                CDS_Replicas = :
          Clearinghouse UUID = 0086af92-fcb4-1bef-95c8-08005a4d2084
                       Tower = ncadg_ip_udp:192.55.207.162[]
                Replica type = master
          Clearinghouse Name = /.../moe.com/moe_ch
                 CDS_AllUpTo = 1993-06-04-14:53:00.662738100/08-00-5a-4d-20-84
             CDS_Convergence = medium
           CDS_ParentPointer = :
               Parent's UUID = 0075ff30-fcb7-1bef-95c8-08005a4d2084
                     Timeout = :
                  Expiration = 1993-06-05-03:52:15.855-04:
                   Extension = +1-00:00:00.000I0.000
                      MyName = /.../moe.com/dfs-test
        CDS_DirectoryVersion = 3.0
            CDS_ReplicaState = on
             CDS_ReplicaType = master
               CDS_LastSkulk = 1993-06-04-14:53:00.662738100/08-00-5a-4d-20-84
              CDS_LastUpdate = 1993-06-04-07:52:15.876052100/08-00-5a-4d-20-84
             CDS_RingPointer = 0086af92-fcb4-1bef-95c8-08005a4d2084
                   CDS_Epoch = 0044ebd4-1efa-1bf0-95c8-08005a4d2084
          CDS_ReplicaVersion = 3.0
# cdscp del dir /.:/dfs-test
Error on entity: /.../moe.com/dfs-test
Software error detected in server (dce / cds)
Function: dnsDelDir
 
It seems to me that I have no way to get rid of this problem except
reconfig the machine.
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `jaffe@transarc.com' 
Added field Transarc Status with value `open'

[6/4/93 public]
Changed Found in Baseline from `1.0.2' to `1.0.2a' 
Changed Fix By Baseline from `1.0.2' to `1.0.3'

[6/4/93 public]
It's not going to get fixed if it's really a CDS problem assigned to DFS.
Jess, I imagine that DEC is going to require more information than this.
Changed Component Name from `dfs' to `cds' 
Changed Subcomponent Name from `CDS' to `'

[07/14/93 public]
Yea, I'm not sure where to go with this without more information. Was
the test running continuously for the 2 days? What kinds of things does
the test do. For instance does it create lots and lots of objects in
the name space or few things? Any idea exactly what it was tring to 
do at the time of the first failure? The status code 282109903  as you 
probably already know is the same as the rest of the failures - 'Software 
error detected in server'. I assmue you reconfigured. Have you rerun the
test. Did the problem recur. Untill I get more information I'm dropping
this to a P2.

[6/23/93 public]

[7/18/93 public]
I had chance to runinto the problem again. What I have done in my tests
is that my testtool (ITL) will export and unexport bindings by using
rpc_ns_binding_export and rpc_ns_binding_unexport repeatly when running
my distributed test scripts (ITL scripts).
Acationaly, (sometime) any object entry under a cds directory in my
case /.:/dfs-test/ will result a software error detected in server.
Whatever command you use, e.g, cdscp show, del, cre (obj). They all
result in a consistent error. The follwoing debug information may 
gives some hints. Hope it will help.
*******************************************************************************
Good case:
(gdb) run show obj /.:/dfs_test/g
Starting program: /usr/bin/cdscp show obj /.:/dfs_test/g
Breakpoint 1, load_parse_file (p=0x200a28d4,
    fspec=0x2009546d "/opt/dcelocal/etc/cdscp.bpt") at load_parse_file.c:170
170         status = DNS_SUCCESS;               /* assume it will work. */
(gdb) c
Continuing.
                        SHOW
                      OBJECT   /.../moe.com/dfs_test/g
                          AT   1993-07-18-12:44:00
            RPC_ClassVersion = 0100
             RPC_ObjectUUIDs = <empty set>
                     CDS_CTS = 1993-07-18-15:12:02.795557100/08-00-5a-4d-20-84
                     CDS_UTS = 1993-07-18-18:47:33.956919100/08-00-5a-4d-20-84
                   CDS_Class = RPC_Entry
            CDS_ClassVersion = 1.0
                  CDS_Towers = <empty set>
Program exited normally.
*******************************************************************************
Bad Case:
(gdb) run show obj /.:/dfs-test/g
Starting program: /usr/bin/cdscp show obj /.:/dfs-test/g
Breakpoint 1, load_parse_file (p=0x200a28d4,
    fspec=0x2009546d "/opt/dcelocal/etc/cdscp.bpt") at load_parse_file.c:170
170         status = DNS_SUCCESS;               /* assume it will work. */
(gdb) n
171         f = fopen2aux2(fspec);              /* substitute if need be */
(gdb) n
173         if (p->tbl == NULL)                 /* no buffer speced, we pick siz
e&loc*/
(gdb)
175             p->tbl = &tiny_buffer[0];       /* use one we expect to fail */
(gdb)
176             p->tbs = sizeof(tiny_buffer);   /* because it is too small */
(gdb)
177             result = pr_read(p, f);         /* try to read it */
(gdb)
178             if (result == RET_SIZE)         /* means too small */
(gdb)
180                 p->tbl = (char *)malloc(p->tbu);    /* get a big enough buff
er */
(gdb)
181                 if (p->tbl == NULL)         /* did the malloc work ok? */
(gdb)
188                     p->tbs = p->tbu;        /* remember size & location */
(gdb)
191             else
(gdb)
201         if (status == DNS_SUCCESS)
(gdb)
206             result = pr_read(p, f);
(gdb)
207             if (result != RET_SUCCESS)
(gdb)
218         fopen2aux3(f);              /* return mem for spec of used file */
(gdb) p result
$9 = 1
(gdb) p status
$10 = 282107905
(gdb) n
219         return(status);             /* DNS_SUCCESS unless something bad happ
ened */
(gdb) b reassemble_command
Function "reassemble_command" not defined.
(gdb) b accum_cmd
Function "accum_cmd" not defined.
(gdb) b log_command
Function "log_command" not defined.
(gdb) b make_withlist_empty
Function "make_withlist_empty" not defined.
(gdb) s
220         }
(gdb)
                        SHOW
                      OBJECT   /.../moe.com/dfs-test/g
                          AT   1993-07-18-12:40:33
Error on entity: /.../moe.com/dfs-test/g
Software error detected in server (dce / cds)
Function: dnsEnumAttr
Program exited with code 01.
(gdb)
****************************************************************************
This debug information is just showing the scope of the problem.
I had no way to break at some functions (I guess they are lib functions 
or kernel function which I realy do not know). 
One thing I am sure about is that the line
"static char msgfilespec[] = DNS_CP_MSG_FILE" in mgmt_main.c used
later in the line p->msgspecp = msgfilespec in function init_msgblk
in the file load_msg_file.c is troublesome because msgfilespec[] is
a static string. 
--Jess

[6/16/94 public]
I believe this is a symptom of CR7940.  Lots of exports led to DB corruption.



CR Number                     : 8085
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : other
S/W Ref Platform              : other
Component Name                : cds
Subcomponent Name             : cdsclerk
Short Description             : clerk orphans files
Reported Date                 : 6/2/93
Found in Baseline             : 1.0.2
Found Date                    : 6/2/93
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 7498
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : clerk_bind.c,clerk_main.c
Sensitivity                   : public

[6/2/93 public]
 It appears that the cdsclerk, after importing the login context of the
user, does not make use of the context to set its UID. Perhaps this is
by design -- but if the credentials are certified, it perhaps should.
When it fails to do this, it causes the security name cache to be stored
in a file which is owned by cdsclerk's UID (0), and which does not
appear to get removed by the clerk when the clerk times out and exits.
Further, since the file is not owned by the UID of the actual user,
thatuser cannot remove it via the usual means (kdestroy,
sec_login_purge_context, etc.)
 An alternatative slution is to have the securityname cache manager
chown() the file it creates and ignore the error when it is not run as
root; this appears to be unnecessary if a process which imports a login
context will change to the associated UID (which is not always
possible).
 I see pros and cons for either solution. I've copied Mike Burati for
the security side.
 This is reproduced here (on HPs, Suns, and RIOSes) by:
    dce_login non-super-user passwd
    ls -lrt /opt/dcelocal/var/security/creds | tail (see your files)
    cdscp list dir /.:/\*			    (spawn clerk, lookup cds)
    !ls						    (see new .nc file)
	(wait for cdsclerk to die)
    !ls						    (we see the .nc file still)
    kdestroy				(cannot kill the .nc file)

[6/3/93 public]

This is a duplicate of bug 7498. Janet McCann suggested another alternative-
create the '.nc' file (empty) when the credentials file is created.
This way, it would have the proper owner and permissions on it.



CR Number                     : 8025
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 6886
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : thr
Subcomponent Name             : 
Short Description             : closing all file descriptors in threaded env
Reported Date                 : 5/20/93
Found in Baseline             : 1.0.2a
Found Date                    : 5/20/93
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 6886
Fix By Baseline               : 
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : 
Transarc Status               : 

[5/20/93 public]
I have a process that goes into the kernel and never comes back.
Before it goes into the kernel, I want to close all it's file
descriptors.  I want to do this primarily to close all RPC connections
that might have been opened for me.  So, I cycle through all the file
descriptors and get a couple of different errors.
The first is an assertion failure:
 % See 'cma_dump.log' for state information.
 %Internal DCE Threads problem (version CMA BL10+), terminating execution.
 % Reason: assertion failure:  cma__io_available:  i exceeded cma__g_file_num
   before nfound reached zero.
        at line 867 in ../../../src/threads/cma_thread_io.c
A good candidate for what's causing this is on line 873 of
cma_thread_io.c.  THere is a check for whether the file is known to be
open by CMA.  If not, it just continues.  What it should be doing is
checking the event masks and decrementing nfound appropriately since
even file descriptors not known to cma will still be included in the
count returned from select.
The second is a set of warnings:
        running fxd...
 **** Assertion warning. cma__close_general:  Closing a file with threads waitin
g to read.
     at line 508 in ../../../src/threads/cma_thread_io.c
 **** Assertion warning. cma__close_general:  Closing a file with threads waitin
g for exception.
     at line 514 in ../../../src/threads/cma_thread_io.c
 **** Assertion warning. cma__close_general:  Closing a file with read mask bit
set.
These messages aren't terribly useful to me.  Is it against the rules
to close a file descriptor opened in another thread?  Is there some
way to blow away the thread state?
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `' 
Added field Transarc Status with value `'

[10/7/93 public]
This has the Inter-related CR 6886, which is assigned to jd. 
Reassigning this to jd.



CR Number                     : 8024
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : pmax
S/W Ref Platform              : osf1
Component Name                : dfs
Subcomponent Name             : repserver
Short Description             : fts release doesn't return
Reported Date                 : 5/20/93
Found in Baseline             : 1.0.2a
Found Date                    : 5/20/93
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 7797
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : jaffe@transarc.com
Transarc Status               : open

[5/20/93 public]
 
BUILD:	dfs.carl
CONFIG:	4 mach cell, 3 pmax, 1 rios - 3 flservers, 4 ftservers
TEST:	dfs.repfs_checklist
 
relevant steps:
	- detach aggregate housing read-only replicas
	- attempt fts release of fileset whose staging replica is detached
	- note that command never returns but you can ctl-c out of it
 
root@valentine> dfsexport /dev/rz1e -detach
dfsexport: Revoking tokens for filesets on aggregate 2...
root@valentine> fts release epi.a
The fileset 0,,54 could not be released: No such file or directory
(ctl-c)
root@valentine> fts release epi.a
fts: Using unauthenticated connection for cell /.../p102a_cell.qadce.osf.org: auth ticket expired (dce / rpc).
Could not lock FLDB entry (vol=0,,54, type=0, op=32)
Error: FLDB: status report: last release was aborted (dfs / vls)
(ctl-c)
 
root@dce5> dce_login cell_admin -dce-
Password must be changed!
root@dce5> fts release epi.a
Could not lock FLDB entry (vol=0,,54, type=0, op=32)
Error: FLDB: status report: last release was aborted (dfs / vls)
The fileset 0,,54 could not be released: No such file or directory

[5/20/93 public]
I had erroneously thought the repservers were healthy but
after reattaching the aggregate, I'm still having trouble. Specifically,
fts addsite to the rios hangs and fts statrep of the repserver on the
rios hangs. (You can ctl-c out of both). After receiving "rpc call to
(valentine addr in cell blah) timed out messages, a second attempt at
fts addsite doesn't hang, but errors out correctly. Still hang during
fts statrep -server cobbler -long. Note the "release clone" entry in
the fts lsfldb output for epi.a.
 
root@valentine> fts addsite epi.2 -server cobbler -aggr lfs_aggr4
(ctl-c)
root@valentine> cd /:/epi_a
dfs: Warning: the rpc call to server 130.105.201.7 in cell p102a_cell.qadce.osf.org timed out.
root@valentine> dfstrace dump > /tmp/rpc_call_to.dump
root@valentine> dfstrace clear
root@valentine> cd /:/epi_a
root@valentine> ls
dce.clean          dce_config.1105    dce_config.test    timestamp
dce.clean.new      dce_config.getip   rc.dce
dce.rm             dce_config.rsarbo  rc.dce.orig
dce_config         dce_config.sav     rc.dce_debug
root@valentine>  fts addsite epi.2 -server cobbler -aggr lfs_aggr4
There is already a R/O replica on cobbler.osf.org (lfs_aggr4).
Error in addsite: status ffffffff (unknown facility) (unknown)
root@cobbler> cm whereis /:/epi_a
dfs: Warning: the rpc call to server 130.105.201.7 in cell p102a_cell.qadce.osf.org timed out.
The file '/:/epi_a' resides in the cell 'p102a_cell.qadce.osf.org', 
in fileset 'epi.a.readonly', on hosts valentine.osf.org, cobbler.osf.org.
root@cobbler> cd /:/epi_a
root@cobbler> ls
dce.clean          dce_config.1105    dce_config.test    timestamp
dce.clean.new      dce_config.getip   rc.dce
dce.rm             dce_config.rsarbo  rc.dce.orig
dce_config         dce_config.sav     rc.dce_debug
 
config info:
valentine (pmax) 
fts aggrinfo -server valentine
LFS aggregate lfs_aggr (/dev/rz1a): 96896 K free out of total 102392
LFS aggregate lfs_aggr2 (/dev/rz1e): 336170 K free out of total 342376
Non-LFS aggregate /u2 (/dev/rz1b): 49823 K free out of total 89145 (9905 reserved)
fts lsheader -server valentine -aggr lfs_aggr2
Total filesets on server valentine aggregate lfs_aggr2 (id 2): 3
epi.2                    0,,25 RW   1605 K alloc   1605 K quota On-line
epi.a.readonly           0,,55 RO   1063 K alloc   1063 K quota On-line
epi.b.readonly           0,,58 RO     17 K alloc     17 K quota On-line
Total filesets on-line 3; total off-line 0; total busy 0
cobbler (rios)	
fts aggrinfo -server cobbler
LFS aggregate lfs_aggr4 (/dev/hd1): 262364 K free out of total 266232
fts lsheader -aggr lfs_aggr4 -server cobbler
Total filesets on server cobbler aggregate lfs_aggr4 (id 7): 5
epi.4                    0,,42 RW     10 K alloc     10 K quota On-line
epi.a.readonly           0,,55 RO   1063 K alloc   1063 K quota On-line
epi.b                    0,,57 RW     16 K alloc     16 K quota On-line
epi.gmd                  0,,50 RW      9 K alloc      9 K quota On-line
root.dfs.readonly        0,,19 RO     17 K alloc     17 K quota On-line
Total filesets on-line 5; total off-line 0; total busy 0
fts lsfldb
epi.1  
        readWrite   ID 0,,33  valid
        readOnly    ID 0,,34  invalid
        backup      ID 0,,35  invalid
number of sites: 1
   server           flags     aggr   siteAge principal      owner    
valentine.osf.org   RW       lfs_aggr 0:00:00 hosts/valentine<nil>
 
epi.2  
        readWrite   ID 0,,25  valid
        readOnly    ID 0,,26  valid
        backup      ID 0,,27  invalid
number of sites: 3
  Sched repl: maxAge=2:00:00; failAge=1d0:00:00; reclaimWait=18:00:00; minRepDelay=0:05:00; defaultSiteAge=0:30:00
   server           flags     aggr   siteAge principal      owner          
valentine.osf.org   RW       lfs_aggr2 0:00:00 hosts/valentine<nil>       
dce5.osf.org        RO       lfs_aggr3 0:30:00 hosts/dce5     <nil>       
cobbler.osf.org     RO       lfs_aggr4 0:30:00 hosts/cobbler  <nil>      
 
epi.3  
        readWrite   ID 0,,29  valid
        readOnly    ID 0,,30  invalid
        backup      ID 0,,31  invalid
number of sites: 1
   server           flags     aggr   siteAge principal      owner        
dce5.osf.org        RW       lfs_aggr3 0:00:00 hosts/dce5     <nil>        
 
epi.4  
        readWrite   ID 0,,42  valid
        readOnly    ID 0,,43  valid
        backup      ID 0,,44  invalid
number of sites: 2
  Release repl: maxAge=2:00:00; failAge=1d0:00:00; reclaimWait=18:00:00
   server           flags     aggr   siteAge principal      owner         
cobbler.osf.org     RW,RO    lfs_aggr4 0:00:00 hosts/cobbler  <nil>       
valentine.osf.org   RO       lfs_aggr 0:00:00 hosts/valentine<nil>       
 
epi.a  
        readWrite   ID 0,,54  valid
        readOnly    ID 0,,55  valid
        backup      ID 0,,56  invalid
        releaseClone        0,,72
number of sites: 3
  Locked for ='&release on Wed Dec 31 19:00:00 1969
  Release repl: maxAge=2:00:00; failAge=1d0:00:00; reclaimWait=18:00:00
   server           flags     aggr   siteAge principal      owner         
valentine.osf.org   RW       lfs_aggr 0:00:00 hosts/valentine<nil>        
valentine.osf.org   RO       lfs_aggr2 0:00:00 hosts/valentine<nil>       
cobbler.osf.org     RO       lfs_aggr4 0:00:00 hosts/cobbler  <nil>        
 
epi.b  
        readWrite   ID 0,,57  valid
        readOnly    ID 0,,58  valid
        backup      ID 0,,59  invalid
number of sites: 2
  Sched repl: maxAge=2:00:00; failAge=1d0:00:00; reclaimWait=18:00:00; minRepDelay=0:05:00; defaultSiteAge=0:30:00
   server           flags     aggr   siteAge principal      owner          
cobbler.osf.org     RW       lfs_aggr4 0:00:00 hosts/cobbler  <nil>   
valentine.osf.org   RO       lfs_aggr2 0:30:00 hosts/valentine<nil>
 
epi.gmd  
        readWrite   ID 0,,50  valid
        readOnly    ID 0,,51  invalid
        backup      ID 0,,52  invalid
number of sites: 1
   server           flags     aggr   siteAge principal      owner     
cobbler.osf.org     RW       lfs_aggr4 0:00:00 hosts/cobbler  <nil>  
 
root.dfs  
        readWrite   ID 0,,18  valid
        readOnly    ID 0,,19  valid
        backup      ID 0,,20  valid
number of sites: 3
  Sched repl: maxAge=2:00:00; failAge=1d0:00:00; reclaimWait=18:00:00; minRepDelay=0:05:00; defaultSiteAge=0:30:00
   server           flags     aggr   siteAge principal      owner        
valentine.osf.org   RW,BK    lfs_aggr 0:00:00 hosts/valentine<nil>     
cobbler.osf.org     RO       lfs_aggr4 0:30:00 hosts/cobbler  <nil>    
dce5.osf.org        RO       lfs_aggr3 0:30:00 hosts/dce5     <nil>      
----------------------
Total FLDB entries that were successfully enumerated: 8 (0 failed)

[5/20/93 public]
Bumped to an A - required restarting repserver. RepLog contents were:
93-May-19 12:38:08 repserver: log initialized to /opt/dcelocal/var/dfs/adm/RepLog
93-May-19 12:38:13 Replication server started.  Mainprocs=1; tokenprocs=4; verbose=0.
93-May-19 12:38:38 FLDB finds: 'root.dfs', 0,,19, aggr 7
93-May-19 12:38:38 FLDB finds: 'epi.a', 0,,55, aggr 7
93-May-19 12:38:38 Disk scan: attaching 0,,19 (aggr 7, backing 0,,0) to rep 'root.dfs'
93-May-19 12:38:38 repserver: VOL_GETSTATUS (aggr ix 0, lfs_aggr4, ID 7, type 2, id 0,,57) returns failure 16
93-May-19 12:38:38 Disk scan: attaching 0,,55 (aggr 7, backing 0,,0) to rep 'epi.a'
93-May-19 14:45:21 0,,55: RenewTokens-2/getFSconn: setContext fails to server 130.105.5.27: (382312470) communications failure (dce / rpc)

[6/22/93 public]
This is fixed by a bunch of changes that are being queued under OT 7797.
Changed Subcomponent Name from `repserver?' to `repserver' 
Changed Status from `open' to `dup' 
Filled in Duplicate Of with `7797' 
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `jaffe@transarc.com' 
Added field Transarc Status with value `open'



CR Number                     : 7989
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : rpc
Subcomponent Name             : rpc
Short Description             : rpc_mgmt_is_server_listening is broken
Reported Date                 : 5/13/93
Found in Baseline             : 1.0.2
Found Date                    : 5/13/93
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 7970
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : dglsn.c
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : mason@transarc.com
Transarc Status               : open

[5/13/93 public]
The rpc_mgmt_is_server_listening() is broken in DCE1.0.2. Providing a 
partially bound handle with an arbitrary object uuid set on it, to the
rpc_mgmt_is_server_listening() call, returns a true. The following
simple program can be used to reproduce the problem:
--------------------------------------------
#include <dce/rpc.h>
main(argc, argv)
int argc;
char *argv[];
{
    uuid_t uuid;
    unsigned char *stringBindingP;
    unsigned char *uuidStringP;
    unsigned long status;
    rpc_binding_handle_t handle;
    if(argc < 3) {
	printf("usage: %s <protocol_seq> <ip_addr>\n", argv[0]);
	exit(1);
    }
    uuid_create(&uuid, &status);
    uuid_to_string(&uuid, &uuidStringP, &status);
    printf("uuid: %s\n", uuidStringP);
    rpc_string_binding_compose(uuidStringP, (unsigned char *)argv[1], 
                               (unsigned char *)argv[2], (unsigned char *)0, 
                               (unsigned char *)0, &stringBindingP, &status);
    printf("string binding: %s\n", stringBindingP);
    rpc_binding_from_string_binding(stringBindingP, &handle, &status);
    if(rpc_mgmt_is_server_listening(handle, &status))
	printf("server is listening\n");
    else 
	printf("error code: %d %x\n", status, status);
}
----------------------------------------
The reason for the problem appears to be the changed logic in recv_dispatch()
in dglsn.c, that deals with the mechanism to forward the call or determine
if the call must be handled locally.
A workaround using the rpc_ep_resolve_binding() is not very appropriate
because some client libraries may not necesarily know the interface id
that must be passed to the rpc_ep_resolve_binding() call.
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `mason@transarc.com' 
Added field Transarc Status with value `open'



CR Number                     : 7963
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : pmax
S/W Ref Platform              : osf1
Component Name                : dfs
Subcomponent Name             : rep
Short Description             : cm not switching between ro filesets
Reported Date                 : 5/7/93
Found in Baseline             : 1.0.2a
Found Date                    : 5/7/93
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 7735
Fix By Baseline               : 1.0.2a
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : 
Transarc Status               : 

[5/7/93 public]
I had a rw fileset epi.1 with 2 ro release replicas.  I deleted
the rw; I was still able to access the ro.  I deleted one of the
two ro, the cm was not able to access the other ro with the following
error:
root@shotz  # ls /:/epi_1_ro
dfs: fileset (0,,8) error (code 691089410) on server 130.105.5.22 in cell singsing_cell.
ls: The file /:/epi_1_ro does not exist.
The dfstrace looks like:
DFS Trace Dump -
   Date: Fri May  7 14:44:38 1993
Found 1 logs.
Contents of log cmfx:
Log wrapped; data missing.
time 523.384371, pid 251: cm_lookup c3b2c1f8 epi_1_ro
time 523.384371, pid 251: gettokens vp c3b2c1f8, rights.low 0x404
time 523.384371, pid 251: nh_dolookup dvp c3b2c1f8, name epi_1_ro
time 523.384371, pid 251: gettokens vp c3b2c1f8, rights.low 0x404
time 523.384371, pid 251: cm_GetScache vp c3b2c4ec, volume.low 0x1, vnode 0x5
time 523.384371, pid 251: found fid b4a13a36.1.5.4 (hex)
time 523.384371, pid 251: lookup crossing mount point
time 523.384371, pid 251: gettokens vp c3b2c4ec, rights.low 0x404
time 523.388277, pid 251: in EvalMountPoint, vp c3b2c4ec
time 523.388277, pid 251: gettokens vp c3b2c4ec, rights.low 0x404
time 523.388277, pid 251: cm_ConnByMHosts server type 20000
time 523.388277, pid 251: cm_ConnByHosts server type 0x200, connp 0
time 523.388277, pid 251: cm_ConnByHost using conn c290c800, service 0x20000
time 523.388277, pid 251: begin AFS_LookupRoot
time 523.403901, pid 0: in AFS_LookupRoot Volume 0.8
time 523.403901, pid 0: fshs_GetPrincipal START
time 523.403901, pid 0: fshs_GetHost, cookie c2963f00
time 523.403901, pid 0: fshs_FindHost, cookie c2963f00
time 523.407807, pid 0: find a prime host c291a110
time 523.407807, pid 0: find a host in fast path c291a110
time 523.407807, pid 0: fshs_FindPrincipal ..
time 523.407807, pid 0: found a princ c294e06c ref 1
time 523.407807, pid 0: find a princ (fast path) c294e06c, ref 1
time 523.407807, pid 0: fshs_GetPrincipal END c294e06c, ref 1
time 523.407807, pid 0: fshs_PutPrincipal c294e06c ref 1
time 523.407807, pid 0: AFS_LookupRoot returning Vnode 3982e8ff, Unique c14ef744
, code 691089410
time 523.419525, pid 251: end AFS_LookupRoot, code 691089410
time 523.419525, pid 251: cm_Analyze: conn c290c800, code 691089410, user 109051
9047
time 523.419525, pid 251: cm_Analyze: volerr subcode 1
time 523.419525, pid 251: cm_ConnByMHosts server type 10000
time 523.419525, pid 251: cm_ConnByHosts server type 0x100, connp 0
time 523.419525, pid 251: cm_ConnByHost using conn c290c780, service 0x10000
time 523.419525, pid 251: beign VL_GetEntryByID
time 523.540611, pid 251: end VL_GetEntryByID, code 0
time 523.540611, pid 251: cm_Analyze: conn c290c780, code 0, user 0
time 523.540611, pid 251: Install vol entry for volume ID 8
time 524.548423, pid 0: flushactivescaches starting 0 concurrent storebacks
time 524.548423, pid 0: running write through dslots
time 524.556235, pid 0: servertokenmgt running 6 subops
time 524.556235, pid 0: running major renewlazyreps
time 524.556235, pid 0: Renewlazyreps starts 0 subjobs
time 524.556235, pid 0: in cm_FlushQueuedServerTokens for server c2791800
time 524.556235, pid 0: in cm_FlushQueuedServerTokens for server c2943100
time 524.556235, pid 0: in cm_FlushQueuedServerTokens for server c2943200
time 524.556235, pid 0: in cm_FlushQueuedServerTokens for server c2943300
time 524.556235, pid 0: in cm_FlushQueuedServerTokens for server c290be00
time 524.560141, pid 0: in cm_FlushQueuedServerTokens for server c2949e00
time 524.560141, pid 251: cm_Analyze: moved volume 8
time 527.567466, pid 251: cm_ConnByMHosts server type 20000
time 527.571372, pid 251: cm_ConnByMHosts: all filesets bad
time 527.571372, pid 251: cm_Analyze: conn 0, code -1, user 1090519047
time 527.571372, pid 251: mount point lookup failed
time 527.571372, pid 251: checkerror returning code 19
time 533.683883, pid 342: cm_lookup c3b2c1f8 dfstrace
time 533.683883, pid 342: gettokens vp c3b2c1f8, rights.low 0x404
time 533.683883, pid 342: nh_dolookup dvp c3b2c1f8, name dfstrace
time 533.683883, pid 342: gettokens vp c3b2c1f8, rights.low 0x404
time 533.687788, pid 342: cm_ConnByMHosts server type 20000
time 533.687788, pid 342: cm_ConnByHosts server type 0x200, connp 0
time 533.687788, pid 342: cm_ConnByHost using conn c290c740, service 0x20000
time 533.687788, pid 342: nh_dolookup calling AFS_Lookup
time 533.719028, pid 342: nh_dolookup back from AFS_Lookup, code 2
time 533.719028, pid 342: cm_Analyze: conn c290c740, code 2, user 1090519047
time 533.719028, pid 342: cm_Analyze: volerr subcode -1011480852
time 533.719028, pid 342: in nh_delete, scp c3b2c1f8, name dfstrace
time 533.719028, pid 342: checkerror returning code 2
time 533.719028, pid 342: checkerror returning code 2
DFS Trace Dump - Completed
root@shotz  # fts lsfldb
epi.1  
        readWrite   ID 0,,7  invalid
        readOnly    ID 0,,8  valid
        backup      ID 0,,9  invalid
number of sites: 1
  Release repl: maxAge=2:00:00; failAge=1d0:00:00; reclaimWait=18:00:00
   server           flags     aggr   siteAge principal      owner               
shotz.osf.org       RO       lfs_aggr2 0:00:00 hosts/shotz    <nil>               
epi.2  
        readWrite   ID 0,,10  valid
        readOnly    ID 0,,11  valid
        backup      ID 0,,12  invalid
number of sites: 2
  Sched repl: maxAge=2:00:00; failAge=1d0:00:00; reclaimWait=18:00:00; minRepDelay=0:05:00; defaultSiteAge=0:30:00
   server           flags     aggr   siteAge principal      owner               
shotz.osf.org       RW       lfs_aggr2 0:00:00 hosts/shotz    <nil>               
singsing.osf.org    RO       lfs_aggr 0:30:00 hosts/singsing <nil>               
root.dfs  
        readWrite   ID 0,,1  valid
        readOnly    ID 0,,2  invalid
        backup      ID 0,,3  invalid
number of sites: 1
   server           flags     aggr   siteAge principal      owner               
singsing.osf.org    RW       lfs_aggr 0:00:00 hosts/singsing <nil>               
shotz_set  
        readWrite   ID 0,,4  valid
        readOnly    ID 0,,5  invalid
        backup      ID 0,,6  invalid
number of sites: 1
   server           flags     aggr   siteAge principal      owner               
shotz.osf.org       RW       lfs_aggr2 0:00:00 hosts/shotz    <nil>               
ufs_set  
        readWrite   ID 0,,17  valid
        readOnly    ID 0,,18  invalid
        backup      ID 0,,19  invalid
number of sites: 1
   server           flags     aggr   siteAge principal      owner               
explorer.osf.org    RW       /u0     0:00:00 hosts/explorer <nil>               
----------------------
Total FLDB entries that were successfully enumerated: 5 (0 failed)

[5/11/93 public]
Filled in Interest List CC with `cfe@transarc.com, kazar@transarc.com' 
Changed Responsible Engr. from `pakhtar@transarc.com' to `tu@transarc.com' 
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `' 
Added field Transarc Status with value `'

[5/11/93 public]
Assuming that you deleted the R/W copy with ``fts delete'', then this is a
known and documented limitation on replication.  It's documented in the
release notes that deleting the R/W for a fileset will cause all repservers
to delete the secondaries that they're managing.  Presumably you deleted
the R/W for a fileset with ``fts delete'' and then deleted the designated
replica (on the server where the R/W was).  This is a known limitation of
the current repserver.
 
There's no need to delete the R/W fileset if you're trying to check
whether the CM will switch between replicas.  It never switches to the
R/W copy of a fileset; particularly in a release-replication scenario,
there could be big semantic differences between the R/W copy and the
R/O copies.  It's just as good a test to add a second rep site, wait for it
to be created, and then delete the first rep site.

[5/17/93 public]
Given that nobody else has made noises about this one, I'm dup'ing it to 7735.
Changed Status from `open' to `dup' 
Filled in Duplicate Of with `7735'



CR Number                     : 7948
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : dts
Subcomponent Name             : 
Short Description             : /etc/rc.dts fails to get machine
context while executing dtscp.
Reported Date                 : 5/6/93
Found in Baseline             : 1.0.2b23
Found Date                    : 5/6/93
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 7547
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.2
Affected File(s)              : 
Sensitivity                   : public

[5/6/93 public]

Bringing up dtsd from /etc/rc.dce gives the following messages:
warning - DTS control program is not authenticated:
        auth ticket expired (dce / rpc)
error executing command:
        must have write permission to the DTS entity (dce / dts)
        *** dtsd did not configure properly

This failure occures when the ticket granting ticket for the login
principal expires.  If I dce_login as cell_admin, kill the DCE daemons,
and wait until the ticket granting ticket for cell_admin expires, then
execute /etc/rc.dce dts will not configure properly.

dtscp inherits the login context instead of the machine context so 
/etc/rc.dts fails to configure properly when the login context's 
ticket granting ticket expires.

The solution is not to have dtscp inherit the machine context since
joe user may be able to make modification that will violate other users.

One solution is to unset the KRB5CCNAME environment variable in /etc/rc.dts
so that dtscp can configure dts correctly.  This allows dtscp to 
configure using the machine context instead of the login context.  This
fix allows dts to configure properly and retains dtscp security.

[05/25/93 public]
Actually, I added a 'fix' to /etc/rc.dce to prevent this problem:
----------------------
#       Bug 7547:
#        - Protect the user from starting DCE while in a dce_login shell.
#       [1993/03/19  19:02:29  tom]

# Try to help the user
if [ -n "$KRB5CCNAME" ]
then
        echo "Warning - KRB5CCNAME environment variable set."
        echo "Possibly in an invalid dce_login shell, exit before starting DCE."
        exit 1
fi
------------------------

This will prevent the problem you describe above.
I am dup-ing this to bug 7547, please re-open if you feel this will
not fix the problem.



CR Number                     : 7935
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : dfs
Subcomponent Name             : bak
Short Description             : bak restoreft with invalid options returns 0
Reported Date                 : 5/5/93
Found in Baseline             : 1.0.2
Found Date                    : 5/5/93
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 7934
Fix By Baseline               : 1.0.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : vijay-ot7934-bak-return-appropriate-exit-code
Transarc Herder               : 
Transarc Status               : 

[5/5/93 public]
bak restoreft with either an invalid extension or an invalid tcid returns 0.
This should be returning a non-zero return code.
Added field #Transarc Deltas with value `' 
Added field #Transarc Herder with value `jaffe@transarc.com' 
Added field #Transarc Status with value `open'

[5/5/93 public]
Changed Responsible Engr. from `jaffe@transarc.com' to `vijay@transarc.com' 
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `' 
Added field Transarc Status with value `'

[5/12/93 public]
This is essentially the same problem as OT 7934. I have checked in a fix for
that OT. I'm dup'ing this to 7934.
Changed Status from `open' to `dup' 
Filled in Duplicate Of with `7934' 
Filled in Transarc Deltas with `vijay-ot7934-bak-return-appropriate-exit-code'



CR Number                     : 7930
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : cfg
Subcomponent Name             : dce_config
Short Description             : Does not create CacheInfo file for memory cache.
Reported Date                 : 5/4/93
Found in Baseline             : 1.0.2
Found Date                    : 5/4/93
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 2511
Fix By Baseline               : 1.0.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : mason@transarc.com
Transarc Status               : open

[5/4/93 public]
In the config_dfs_client function of dce_config, it creates the CacheInfo
file for disk based DFS caches, but does not for memory based caches.  
The cache manager will attempt to read this file for either cache type.
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `mason@transarc.com' 
Added field Transarc Status with value `open'

[6/7/93 public]
This is a dup of 2511, which is fixed as of today.



CR Number                     : 7853
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : lfs
Short Description             : episode should allow more than 20 mounted filesets
Reported Date                 : 5/3/93
Found in Baseline             : 1.0.2
Found Date                    : 5/3/93
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 3816
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : file/episode/vnops/efsmount.h
Sensitivity                   : public
Transarc Deltas               : rajesh-increase-efsmount-table-size
Transarc Herder               : jaffe@transarc.com
Transarc Status               : import

[5/3/93 public]
Dfs currently limits the number of locally mounted episode filesets
to 20.  This delta increases the limit to 100.
Added field Transarc Deltas with value `rajesh-increase-efsmount-table-size' 
Added field Transarc Herder with value `jaffe@transarc.com' 
Added field Transarc Status with value `import'

[5/4/93 public]
Changed Status from `open' to `dup' 
Filled in Duplicate Of with `3816'



CR Number                     : 7850
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : thr
Subcomponent Name             : 
Short Description             : problem in cma__io_available() on closed filedescriptors.
Reported Date                 : 4/30/93
Found in Baseline             : 1.0.2b23
Found Date                    : 4/30/93
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 6886
Fix By Baseline               : 1.0.2a
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[4/30/93 public]

The defect was found while testing dfs on AIX. The problem can be seen simply
by creating two threads, one thread doing read() (on stdin) and another
thread closing the stdin. The thread that did read() gets blocked. The
close of stdin generates assertion warnings on AIX reference paltform.
When the null thread runs the infinite wait via select(), on AIX, select() returns
and this causes a SIGSEGV alter in the cma__io_available(). 

The problem can be fixed by: ensuring that when cma_close() is called, the waiters are
woken up  for that file descriptor. This ensures that threads doing I/O waits
are woken up with error code correctly.   Also, cma__io_available() assumes that
masks are not changed if the select() fails. This is paltform specific and prone to error.

The code in cam__io_available() needs to be robust so that   
if a file descriptor is closed, cma does not dereference 
the cma__g_file[] structure for it.


I can provide all the changes required to fix the problem.                            

You can reach me at:512-838-8298 for more details

[05/03/93 public]
This came in as 6886 a bit late in 1.0.2. I looked at it then and will
revisit it early in 1.0.3. I'll look at your suggested fix then.



CR Number                     : 7807
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : other
S/W Ref Platform              : osf1
Component Name                : sec
Subcomponent Name             : secd
Short Description             : on 486 rep. master crashes under stress
Reported Date                 : 4/27/93
Found in Baseline             : 1.0.2
Found Date                    : 4/27/93
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 8214
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[4/27/93 public]
This is probably a dup. of 7642 except the platform difference (486) and no
noticeable errors were reported by registry servers. The test cell 
configuration was one master registry and one replica, secds' executing 
without debug output. The sec.rgy.7 test was executing for two loops of the 
test_drv.ksh script using the command line: "test_drv.ksh -u balder_ts -p pass 
-A 1000 -T 1 -i 2". The master update sequence number was roughly 600 behind 
when the secd crashed. The test server reported the failure:

DCE logged in as balder_ts

DCE logged out as balder_ts
        secrgy_server: Doing add_account, basename: sif
        secrgy_server: Doing remove_acct, basename: sif
sec_rgy_pgo_add: connection request rejected (dce / rpc)
sec_rgy_pgo_add failed:382312514
add_account_user: connection request rejected (dce / rpc)

The sec_admin program reported:

sec_admin> lrep -all
Default replica:  /.../balder_cell/subsys/dce/sec/master
Default cell:     /.../balder_cell


subsys/dce/sec/sif_rep
          Instance id: 00647f6d-3c1e-1bdd-a237-0000c0c74944
          Addresses:               ncacn_ip_tcp:130.105.5.25[]
                                   ncadg_ip_udp:130.105.5.25[]
          State:                   in service - slave
          Last update received at: Tue Apr 27 10:17:09 1993
          Last update's seqno:     0.33210
          Propagation state:       ready for updates
          Last update delivered:   Tue Apr 27 10:17:09 1993
          Last update's seqno:     0.33207
          Number of outstanding updates: 604
          Last comm status:        successful completion

subsys/dce/sec/master (master)
          Instance id: 003086f9-55ca-1bd5-8af3-0000c0b34944
          Addresses:               ncacn_ip_tcp:130.105.5.12[]
                                   ncadg_ip_udp:130.105.5.12[]
          State:                   in service - master
          Last update received at: Tue Apr 27 10:19:25 1993
          Last update's seqno:     0.33817
sec_admin> lrep -all
Default replica:  /.../balder_cell/subsys/dce/sec/master
Default cell:     /.../balder_cell
ERROR - communications failure (dce / rpc)

[4/27/93 public]

This bug report is incomplete; the output from sec_admin is nice, but
possibly irrelevant.

relevant data like a traceback of the secd core dump, or even the existance
or lack of a core dump, are missing..

[4/27/93 public]
Right! I've had little luck finding the secd core file. It sure would be nice 
for it to be written to some standard spot. Either there is none or it was
overwritten by some X11 prog. dump or I have a propensity to start secd from
a spot that doesn't have enough space, which is the more likely case. 
	This is the best I can do for the moment (secd -d -v):

Registry: Fatal Error - Prop task aborting
 at line 764 of file /project/dce/build/dce1.0.2/src/security/server/rs/rs_prop_tasks.c
Registry: Fatal Error - DT exiting with alert exception
 at line 487 of file /project/dce/build/dce1.0.2/src/security/server/rs/rs_main.c - 0x00000000 - successful completion
Registry: Fatal error in main thread; exiting

[7/13/93 public]
This was also yet another occurance of the prop task aborting, which has been
addressed in CR8214.  Dup'd this one to that.



CR Number                     : 7793
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : pmax
S/W Ref Platform              : osf1
Component Name                : dfs
Subcomponent Name             : 
Short Description             : unable to reach ufs aggregate/fileset via mount point
Reported Date                 : 4/23/93
Found in Baseline             : 1.0.2a
Found Date                    : 4/23/93
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 7762
Fix By Baseline               : 1.0.2a
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : 
Transarc Status               : 

[4/23/93 public]
 
BUILD:	102a available 4/20/93
CONFIG:	3 pmax cell, 3 flservers, 1 pmax w/ ufs aggregate
 
Idle cell - all machines rebooted and dce/dfs restarted ~19 hours ago.
Both with and without dce credentials, can't reach ufs aggregate/fileset
through mount point.
 
root@valentine> cd /:/root_dfs/dce12_u3
dfs: fileset (0,,4) error (code 691089410) on server 130.105.202.31 in cell p102a_cell.qadce.osf.org.
/:/root_dfs/dce12_u3: No such device
 
but aggregate is exported and fldb aggrees:
 
root@dce12> dfsexport
dfsexport: /dev/rz3c, ufs, 3, 0,,0
root@dce12> fts lsfldb dce12.u3
        readWrite   ID 0,,4  valid
        readOnly    ID 0,,5  invalid
        backup      ID 0,,6  invalid
number of sites: 1
   server           flags     aggr   siteAge principal      owner               
dce12.osf.org       RW       /u3     0:00:00 hosts/dce12    <nil>               
 
Dumps from the 3 pmax machines are in ~notuser/gmd/(this CR number)/*.dump.
Unable to gather more data due to CR 7767.

[4/23/93 public]
Unless dce12_u3 is a mount point for fileset dce12.u3 (note the difference
between dot and underscore) this looks like pilot error.  To verify, something
like ``fts lsmount /:/root_dfs/dce12_u3'' should do it.
 
Ah, another possibility, given what ``dfsexport'' says.  Looks like this
UFS fileset was exported incorrectly, since the fileset ID given by
dfsexport is 0,,0.  At best, you'll have to un-export /u3, correct the
dfstab entry to give the correct fileset ID, then re-export /u3.
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `' 
Added field Transarc Status with value `'

[4/23/93 public]
Hmm - yes, the dfstab was corrupt - it was written by dce_config so I'd
prefer to think to myself as an accomplice ... detach'ing and re-exporting
WOULD probably have cleared everything up except now:
root@valentine> fts lsmount -dir /:/root_dfs/dce12_u3
dfs: the fx server 130.105.5.27 in cell p102a_cell.qadce.osf.org is in TSR mode!
fts lsmount: error for file '/:/root_dfs/dce12_u3': Connection timed out
root@valentine> fts lsmount -dir /:/root_dfs/dce12_u3
dfs: fileset (0,,2) error (code 691089410) on server 130.105.5.27 in cell p102a_cell.qadce.osf.org.
fts lsmount: error for file '/:/root_dfs/dce12_u3': No such device
ie. now I'm getting complaints about fileset 0,,2, the root.dfs replica ...
sigh ... I'll look around a bit more and see what's up - this is the same
cell that's been experiencing 7767 assertions and that has the 7762
corruption.

[4/26/93 public]
Looks like the next step is for Gail to collect additional information.
Reassigned to her.
Changed Responsible Engr. from `pakhtar' to `gmd' 
Changed Resp. Engr's Company from `tarc' to `osf'

[4/26/93 public]
Dup'ing this to 7762 since the fileset moved or deleted complaints have
disappeared under similar testing AFTER newaggr'ing away the 7762 state
of replication.



CR Number                     : 7787
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : cds
Subcomponent Name             : control
Short Description             : list object does not display
consistent information on identical calls
Reported Date                 : 4/22/93
Found in Baseline             : 1.0.2
Found Date                    : 4/22/93
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 3159
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[4/22/93 public]

I was checking out the usage of wildcard characters (* ?) as normal
characters in the rightmost position of an rpccp entry name.  The following
occurred during my session:

[root@yale:10] /
> rpccp add entry /.:/star*

>>> entry added

[root@yale:10] /
> cpccp add entry /.:/stars
/bin/ksh: cpccp:  not found.

[root@yale:10] /
> rpccp add entry /.:/stars

>>> entry added

[root@yale:10] /
> set dir /.: to skulk

[root@yale:10] /
> cdscp list obj /.:/star*
                        LIST
                      OBJECT   /.../xinu.cell
                          AT   1993-04-22-10:58:29
star*
stars

[root@yale:10] /
> cdscp list obj /.:/star\*
                        LIST
                      OBJECT   /.../xinu.cell
                          AT   1993-04-22-10:58:41

[root@yale:10] /
> cdscp list obj /.:/star\s
                        LIST
                      OBJECT   /.../xinu.cell/stars
                          AT   1993-04-22-10:59:15
stars

[root@yale:10] /
> cdscp list obj /.:/star\*
                        LIST
                      OBJECT   /.../xinu.cell
                          AT   1993-04-22-10:59:35
star*
stars

[root@yale:10] /

According to the documentation, cdscp list obj /.:/star\* should only
return "star*".  Neither object and both objects are not correct answers.

[4/22/93 public]
Yes wildcards are broken. We believe we have a fix but it has been deemed to
risky for inclusion in 1.0.2 at this time. We plan to bsubmit to 1.0.3. I
have trouble with a B1 sev/priority...



CR Number                     : 7756
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : pmax
S/W Ref Platform              : osf1
Component Name                : dfs
Subcomponent Name             : 
Short Description             : fts addsite hang
Reported Date                 : 4/19/93
Found in Baseline             : 1.0.2b23
Found Date                    : 4/19/93
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 7656
Fix By Baseline               : 1.0.2a
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : 
Transarc Status               : 

[4/19/93 public]
 
Craig - assigned directly to you - reassign if appropriate.
 
CONFIG:	3 pmax cell, 3 flservers
BUILD:	b23
TEST:	admin_checklist/repfs_checklist type stuff
 
root@valentine> fts create epi.4 -server valentine -aggr lfs_aggr3
        readWrite   ID 0,,25  valid
        readOnly    ID 0,,26  invalid
        backup      ID 0,,27  invalid
number of sites: 0    number of addresses: 1
   server           flags     aggr   siteAge principal      owner               
valentine.osf.org   RW       lfs_aggr3 0:00:00                <nil>               
Fileset 0,,25 created on aggregate lfs_aggr3 of valentine
root@valentine> fts setrepinfo epi.4 -release
fts setrepinfo: Using default value for maxage of 2:00:00
fts setrepinfo: Using derived value for failage of 1d0:00:00
fts setrepinfo: Using default value for reclaimwait of 18:00:00
root@valentine> fts addsite epi.4 -server valentine -aggr lfs_aggr2
<hang>
 
The only potentially interesting thing I can think of that's gone on
previously in this cell is that root.dfs is replicated.
 
root@dce5> fts crmount -dir /:/root_dfs -fileset root.dfs
root@dce5> fts setrepinfo -fileset root.dfs -release
fts setrepinfo: Using default value for maxage of 2:00:00
fts setrepinfo: Using derived value for failage of 1d0:00:00
fts setrepinfo: Using default value for reclaimwait of 18:00:00
root@dce5> fts addsite root.dfs -server dce5 -aggr lfs_aggr
Added replication site dce5 lfs_aggr for fileset root.dfs
root@dce5> fts addsite root.dfs -server valentine -aggr lfs_aggr2
Added replication site valentine lfs_aggr2 for fileset root.dfs
 
Debug info:
root@dce12> fts statrep -server valentine 
Status of rep server valentine (valentine.osf.org) at Mon Apr 19 18:15:58 1993
Replicas managed: 1; host/connection blocks: 2
IDs: 0 allocated, 0 in use, 0 re-used
Next forced keep-alive in 83330 secs, at Tue Apr 20 17:24:48 1993
Primary comm blocks: 0 done, 0 oversize; 0 tot overage, (0:0) squared.
Primary keep-alive blocks: 0 done, 0 oversize; 0 tot overage, (0:0) squared.
 
ps on valentine shows the fts addsite command is sleeping.
fts lsheader of lfs_aggr2 shows epi.4.readonly has not yet been created

[4/20/93 public]
More debug info:
 
The ftserver and repserver on another machine within the cell were
hung:
 
root@dce5> fts statft dce5
Total transactions: 1
--------------------------------------
trans: 7  created: Mon Apr 19 14:31:44 1993
descriptor: 0; ref count 1;  last call: Mon Apr 19 14:31:44 1993
fileset: 0,,10  aggregate Id: 1   aggrtype: 2/1
action: repserver forward fileset (dfs / xvl); ops: Dump, GetStatus
Fileset status 0x18014005: R/W, busy, know dally, type-RW
--------------------------------------
 
Shutting down the repserver on dce5 unhung the addsite command - even 
though the addsite command did NOT involve dce5 (contention over FLDB
lock(s)?).
 
The ORIGINAL problem here may have something to do with local scheduled
replicas - the activity in this cell has NOT been stressful - but I
have been testing replication by hand.

[4/20/93 public]
I expect that, as far as this cascade of hung processes goes, the ultimate
hangup is that a worker thread in the repserver on dce5 got an exception
from FTSERVER_Forward and was cancelled, a bug that should have been fixed
by the fix for OT 7656 submitted to 1.0.2a.  This thread, though, had
claimed a lock in repserver that was also needed by the server stub (again
in the repserver on dce5) to answer an RPC from the peer repserver on
valentine.  The single worker thread in the repserver on valentine got
stuck waiting for the answer from this RPC, while holding a different
lock in repserver on valentine (the callRootLock).  Then, all calls
to SREP_AllCheckReplicationConfig() (e.g. this one, from fts) will hang
waiting to acquire the callRootLock in the repserver on valentine.
 
There's already a fix for the ultimate hang-up here.  Some defensive
coding could be added to repserver and/or fts to implement a call timeout,
so that either repserver or the user running fts doesn't really wait forever,
but ultimately, this is a dup of 7656, and the defensive coding should go
in under a different OT.
Changed Status from `open' to `dup' 
Filled in Duplicate Of with `7656' 
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `' 
Added field Transarc Status with value `'



CR Number                     : 7719
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : cds
Subcomponent Name             : 
Short Description             : null CDS_Towers attr in CDS cache
Reported Date                 : 4/14/93
Found in Baseline             : 1.0.2
Found Date                    : 4/14/93
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 7759
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[4/14/93 public]
We have a test scenario in which we create a new user, create 3 new 
clearinghouses and a directory, and then change the permissions on the
clearinghouses and directory.  The results are frequently as follows:

Creating the New User testuser...   done
Creating the Directory /.:/testacl...   done
Creating the Clearinghouse /.:/ch2_ch...   done
Creating the Clearinghouse /.:/ch3_ch...   done
Creating the Clearinghouse /.:/ch4_ch...   done

Changing the Permissions on /.:/jsirkin_ch...   done
Changing the Permissions on /.:/testacl...   done
Changing the Permissions on /.:/ch2_ch...ERROR: acl object not found (dce /
sec)
Unable to bind to object /.:/ch2_ch

Changing the Permissions on /.:/ch3_ch...ERROR: acl object not found (dce /
sec)
Unable to bind to object /.:/ch3_ch

Changing the Permissions on /.:/ch4_ch...ERROR: acl object not found (dce /
sec)
Unable to bind to object /.:/ch4_ch

This does not happen every time on every clearinghouse or directory, as you
can see.  However, it is not limited to clearinghouses, it does happen with
directories, too.

We have chased it through the cds server, and believe it is not in there.
This is consistently recreatable, and was first reported as intermittent
here on March 24 (approximately the B19 build)  The results reported above
are from the B21 build.

If the above scenario does not recreate the problem for you, give me a call
at (512)838-8130 and I'll get you a version of the shell script I've been
using.

[4/14/93 public]
I don't have the time to chase this down right now, so why don't you send me
the shell script anyway (burati@apollo.hp.com) so that when I do get a chance
to look into it, I'll be able to reproduce it (or not) much faster...  Could
you try setting the env variable DEBUG_ACL to 5 (actually anything over 3 is
probably the same at the moment) for one of the acl_edit's that's failing with
the object not found errors (not for all of them because it will be too much
redundant data).

[4/14/93 public]
Status is changed to defer; i.e. it means that this bug is not open for
1.0.2, but will be fixed by 1.0.3.

[5/12/93 public]
This note is from Curt Rouse (512)838-8154 who worked on this problem:

 The cmd I issued to reproduce the problem was:
     cdscp cre clear /.:/chx_ch

 Followed by the cmd:
     acl_edit /.:/chx_ch -m user:cell_admin:rwdtc

 Intermittently (approx 1 out of 4 times), I then got the msg:
     ERROR: acl object not found (dce / sec)
     Unable to bind to object /.:/chx_ch

 The problem is caused by a null attr value (x'0100000000') being cached
 in the CDS cache for the CDS_Towers attribute (for the /.:/chx_ch object).
 This only happens occasionally.  Sometimes CDS_Towers is never cached at
 all.

 After the acl_edit cmd is issued:  daclbind.c (approx line #543)
 issues an:  "rpc_ns_binding_import_next"   call.

 Later, rpc__nsattr_read_value  then issues a:  dnsReadAttrValue   call
 and gets back a "DNS_EMPTY" (x'282110109')   return code.

 The CDS clerk receives the request and looks in the cache and occasionally
 it's got a null value.  If it's not cached it completes successfully.  If
 cached with a null value, then clerk returns to the library w/a successful
 return code and library changes it to DNS_EMPTY.  I have not been able to
 determine why it's cached w/a null value, but it also is frequently done
for
 RPC_Profile & RPC_Group.

[5/13/93 public]
Given Jean's latest note (5/12), I'm reassigning this
bug to CDS and correcting the description.

[9/23/93 public]
The main problem here is that cannot create more than two clearinghouse
which is the OT#7759. And DCE has had a fix to it. So mark this one
as dup of OT#7759



CR Number                     : 7688
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : cds
Subcomponent Name             : 
Short Description             : cdscp displays RPC_ObjectUUIDs incorrectly
Reported Date                 : 4/12/93
Found in Baseline             : 1.0.2
Found Date                    : 4/12/93
Severity                      : C
Priority                      : 3
Status                        : dup
Duplicate Of                  : 7690
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[4/12/93 public]
RPC_ObjectUUIDs are not printed out in UUID string representation.  E.g.

# cdscp show obj /.:/warden_ch

                        SHOW
                      OBJECT   /.../dce101.cell.austin.ibm.com/warden_ch
                          AT   1993-04-12-18:59:13
            RPC_ClassVersion = 0100
             RPC_ObjectUUIDs = 92be0e0099c8c51b866e10005ac92d3d
                     CDS_CTS = 1993-04-09-19:03:53.088663100/10-00-5a-c9-2d-3d
                     CDS_UTS = 1993-04-09-20:03:59.525969100/10-00-5a-c9-2d-3d
                   CDS_Class = CDS_Clearinghouse
            CDS_ClassVersion = 2.0
              CDS_ObjectUUID = 000ebe92-c899-1bc5-866e-10005ac92d3d
                  CDS_Towers = :
                       Tower = ncacn_ip_tcp:129.35.68.156[]
                  CDS_Towers = :
                       Tower = ncadg_ip_udp:129.35.68.156[]
           CDS_CHDirectories = :
<list of directories elided>

The RPC_ObjectUUID and CDS_ObjectUUID should be the same.
However, the RPC_ObjectUUID is not being printed out in proper string
representation.

[4/12/93 public]

This is a dup of 7690, which is a more complete description.



CR Number                     : 7683
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : pmax
S/W Ref Platform              : osf1
Component Name                : dfs
Subcomponent Name             : cm
Short Description             : panic in cm_ReleToken
Reported Date                 : 4/12/93
Found in Baseline             : 1.0.2b22
Found Date                    : 4/12/93
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 5677
Fix By Baseline               : 1.0.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : shl@transarc.com
Transarc Status               : open

[4/12/93 public]
Configuration: standard 4 machine cho 
Tests runnning: standard cho
During the course of the cho testing the pmax client only (M4) panic'd in 
cm_ReleToken.  This client was running a connectathon to a pmax server
and a low.moderate (executing prog5) to a rios server.
cm_UpdateTokenLifeTime  (line 904)
cm_ReleToken
panic
Here's the code clip from cm_UdateTokenLifeTime so you can see which
cm_ReleToken caused the problem:
   900                              return;   /* The server is down */
   901                          }
   902                      }
   903                      nlp = (struct cm_tokenList *) tlp->q.next;
   904                      cm_ReleToken(tlp);
   905                  } /* for */
   906                  lock_ReleaseWrite(&scp->llock);
   907                  lock_ObtainWrite(&cm_scachelock);
   908                  CM_RELE(scp);
I will see if we can get any other useful information out of this crash.

[4/12/93 public]
Changed Responsible Engr. from `jsk@transarc.com' to `kazar@transarc.com' 
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `shl@transarc.com' 
Added field Transarc Status with value `open'

[04/12/93 public]
Possibly interesting stack traces of other processes:
cm_DoPartialWrite
cm_GetToken
cm_GetTokensRange
AFS_GetToken
rpc_call_transcieve
rpc__dg_call_transcieve
rpc__dg_call_receive_init
rpc__dg_call_wait
pthread_cond_wait
syscall
execve
common_exec
xglue_getattr
nosf_getattr
cm_GetTokens
cm_GetTokensRange
AFS_GetToken
rpc_call_transcieve
rpc__dg_call_transcieve
rpc__dg_call_receive_init
rpc__dg_call_wait
pthread_cond_wait
Don tells me he's also seen this recently as well.

[4/12/93 public]
Changed Responsible Engr. from `kazar@transarc.com' to `tu@transarc.com'

[4/12/93 public]
I take it that you are running against dfs 2.9. True ? 
thanks, 
tu

[04/21/93 public]
We've hit it again.  This code which is post b23 (this is the
first 1.0.2a build - theoretically this build syncs us up with Transarc).

[4/21/93 public]
Just spoke with Diane on the phone. I now understand what she was doing:
she was running the CHO test while moving the fileset and eventually the 
panic occurred. 
                                                                           
I have seen this during my own testing while moving the fileset. However, 
this fix is in part of the current CM work responding to an abnormal fileset 
move. I will talk to Prevaze or Elliot to see how we could deliver this fix
to OSF.

[4/21/93 public]
Filled in Interest List CC with `pakhtar'

[4/23/93 public]
Tu has fixed this defect as part of the fixes for ot 5677.  That ot happens
to fix a large number of problems related to TSR and fts move.  I will
upgrade its priority to A1 to reflects its current severity, and tu will
add more text describing the scope of problems that it fixes.
Changed Status from `open' to `dup' 
Filled in Duplicate Of with `5677'



CR Number                     : 7642
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : osf1
Component Name                : sec
Subcomponent Name             : secd
Short Description             : propagation task crashes under stress
Reported Date                 : 4/2/93
Found in Baseline             : 1.0.2
Found Date                    : 4/2/93
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 8214
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[4/2/93 public]
Stress test failure while using replicated registries.
Security servers were configured on three PMAXs master server on RIOS. This
configuration was then subjected to a stress test: executing sec.rgy.7 test
server and the test_drv.ksh on each PMAX. The test_drv.ksh command line:
"test_drv.ksh -t 1 -u <machine_name_server> -p password -A 1000 -T 5 -c <cell_name>"; executes 5 login-logout operations then adds and deletes 1000 principals and accounts.  Sec_admin in monitor on master and one replica.
	The test executed for about 15 minutes then reported: 
(RPC_CN_AUTH_VFY_CLIENT_REQ) on server failed status = 14129090
sec_rgy_pgo_add_member: bad state (dce / sec)

Finally the master server recursively (about one hour finally killed) reports:
Registry: Error - prop_driver_sleep - error from pthread_cond_timedwait

[4/2/93 public]
sec_admin] last lrep -all output:
admin> lrep -all
Default replica:  /.../soldier_cell.qadce.osf.org/subsys/dce/sec/master
Default cell:     /.../soldier_cell.qadce.osf.org


subsys/dce/sec/blueberry_sl
          Instance id: 00191644-6512-1bbc-8cc9-08002b106b00
          Addresses:               ncacn_ip_tcp:130.105.5.28[]
                                   ncadg_ip_udp:130.105.5.28[]
                    State:         unavailable - connection closed (dce / rpc)
          Propagation state:       marked for initialization

subsys/dce/sec/dce7_sl
          Instance id: 0027bb18-5f2b-1bbc-a42f-08002b24cf9f
          Addresses:               ncacn_ip_tcp:130.105.202.27[]
                                   ncadg_ip_udp:130.105.202.27[]
site
                    State:         unavailable - connection closed (dce / rpc)
          Propagation state:       ready for updates
          Last update delivered:   Fri Apr  2 10:54:34 1993
          Last update's seqno:     0.6733
          Number of outstanding updates: 5659
          Last comm status:        successful completion

subsys/dce/sec/master (master)
          Instance id: 00479294-4d15-1bbc-ba04-02608c2ff62e
          Addresses:               ncacn_ip_tcp:130.105.202.6[]
                                   ncadg_ip_udp:130.105.202.6[]
                    State:         unavailable - connection closed (dce / rpc)

subsys/dce/sec/claus_sl
          Instance id: 007e1d5a-57b3-1bbc-8b99-08002b24cf9d
          Addresses:               ncacn_ip_tcp:130.105.201.9[]
                                   ncadg_ip_udp:130.105.201.9[]
                    State:         unavailable - connection closed (dce / rpc)
          Propagation state:       ready for updates
          Last update delivered:   Fri Apr  2 10:55:42 1993
          Last update's seqno:     0.7075
          Number of outstanding updates: 5317
          Last comm status:        bad state (dce / sec)

[4/5/93 public]
Using the same test and config as described above.
The sleep errors appear to be gone, however I'm still getting a large number of
"bad state" errors shown on master and replicas, test server output:

DCE logged out as soldier_ts
sec_rgy_pgo_add: bad state (dce / sec)
sec_rgy_pgo_add failed:387063988
add_account_user: bad state (dce / sec)
        secrgy_server: Doing remove_acct, basename: blueberryA
        secrgy_server: Doing remove_acct, basename: new
sec_rgy_pgo_delete: bad state (dce / sec)
remove_acct: bad state (dce / sec)
sec_rgy_pgo_delete: bad state (dce / sec)
remove_acct: bad state (dce / sec)
        secrgy_server: Valid and certified id
        secrgy_server: network wide creds

The bad state might be tied to the initialization sequence as these started
appearing during a replica init, as described by the sec_admin -lrep all
output. Is it impossible to modify the master registry during a replica 
initialization phase?

[04/05/93 public]
The master tries to have another replica initialize a new replica.
But if the master is the only other replica, then it must init
a new replica.  When a replica (master or slave) is copying its 
database to
another replica (ie. when it is initing a replica) it cannot
accept any updates and returns the bad state error.

BTW, Did today's test run include the change I submitted on Friday?
I'm hoping that fixed the sleep problem.

[4/5/93 public]
I'm sorry I forgot to mention that this last run is with the latest 
build/includes the sleep fix. The sleep error is no longer apparent which is
why I've changed the short description above. The test however still reports
failures during stress. The test failures happen apparently because of/during
the bad state period. Additionally I'm seeing now communication errors which
were not apparent before. The test C-S is using CN with the test_drv.ksh
invoked runs. 

	The master is not the only active replica there are four replicas
available in the cell. The init of any slave however seems to effect the master
such that I begin seeing "bad state" on or about the time of an initialization. 
	Is it possible that the master performs the init if it happens to be
the only replica with current updates; all others are well behind in update seq.
number?

[4/6/93 public]
Append of Mike's suggestions and results:

sec_admin lrep -all output soon after start of test:

Default replica:  /.../soldier_cell.qadce.osf.org/subsys/dce/sec/master
Default cell:     /.../soldier_cell.qadce.osf.org


subsys/dce/sec/dce7_rep
          Instance id: 004fa9d4-d545-1bc1-b96b-08002b24cf9f
          Addresses:               ncacn_ip_tcp:130.105.202.27[]
                                   ncadg_ip_udp:130.105.202.27[]
          State:                   in service - slave
          Last update received at: Tue Apr  6 15:23:35 1993
          Last update's seqno:     0.221
          Propagation state:       ready for updates
          Last update delivered:   Tue Apr  6 15:23:35 1993
          Last update's seqno:     0.221
          Number of outstanding updates: 8522
          Last comm status:        successful completion

subsys/dce/sec/master (master)
          Instance id: 0062683a-9daa-1bc1-925e-02608c2ff62e
          Addresses:               ncacn_ip_tcp:130.105.202.6[]
                                   ncadg_ip_udp:130.105.202.6[]
          State:                   in service - master
          Last update received at: Tue Apr  6 15:57:14 1993
          Last update's seqno:     0.8750

subsys/dce/sec/claus_rep
          Instance id: 007231ca-d466-1bc1-ac11-08002b24cf9d
          Addresses:               ncacn_ip_tcp:130.105.201.9[]
                                   ncadg_ip_udp:130.105.201.9[]
          State:                   in service - slave
          Last update received at: Tue Apr  6 15:39:52 1993
          Last update's seqno:     0.3935
          Propagation state:       ready for updates
          Last update delivered:   Tue Apr  6 15:39:51 1993
          Last update's seqno:     0.3929
          Number of outstanding updates: 4814
          Last comm status:        successful completion

subsys/dce/sec/blueberry_rep
          Instance id: 0080cd5c-d538-1bc1-a774-08002b106b00
          Addresses:               ncacn_ip_tcp:130.105.5.28[]
                                   ncadg_ip_udp:130.105.5.28[]
          State:                   in service - slave
          Last update received at: Tue Apr  6 15:23:35 1993
          Last update's seqno:     0.221
          Propagation state:       ready for updates
          Last update delivered:   Tue Apr  6 15:23:35 1993
          Last update's seqno:     0.221
          Number of outstanding updates: 8522
          Last comm status:        successful completion

***************test server output on master rep (RIOS)***********************
DCE logged in as soldier_ts

DCE logged out as soldier_ts
        secrgy_server: Doing add_account dce70
sec_rgy_pgo_add: Name already exists (dce / sec)
Registry: Fatal Error - Prop task aborting
 at line 759 of file ../../../../../src/security/server/rs/rs_prop_tasks.c
Registry: Fatal Error - DT exiting with alert exception
 at line 481 of file ../../../../../src/security/server/rs/rs_main.c - 0x0000000
0 - successful completion
Registry: Fatal error in main thread; exiting
sec_rgy_pgo_add_member: connection request rejected (dce / rpc)
sec_rgy_site_open_update: connection request rejected (dce / rpc)
do_site_open_update: connection request rejected (dce / rpc)
add_account_user: connection request rejected (dce / rpc)
sec_rgy_acct_add: connection request rejected (dce / rpc)
sec_rgy_site_open_update: connection request rejected (dce / rpc)
do_site_open_update: connection request rejected (dce / rpc)
add_account_user: connection request rejected (dce / rpc)
        secrgy_server: Doing remove_acct, basename: blueberryA
sec_rgy_site_open_update: connection request rejected (dce / rpc)

******************** final sec_admin lrep -all output ********
eperkins@soldier>sec_admin -s /.../soldier_cell.qadce.osf.org/subsys/sec/dce/mas
ter                      <
Unable to bind to registry at /.../soldier_cell.qadce.osf.org/subsys/sec/dce/mas
ter
ERROR - Registry server unavailable (dce / sec)
eperkins@soldier>

Same output as above on all replicas.

[4/9/93 public]
Updated the Short Description to more accurately describe the stress test
failure we are now experiencing with replicated registries (Prop task abort).

[7/13/93 public]
This prop task aborting was later addressed in 8214.  Dup'd this to that.



CR Number                     : 7638
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : cfg
Subcomponent Name             : /diskless/swap/kernel
Short Description             : Error in token processing; number of tokens exceeds maximum of (8)
Reported Date                 : 4/2/93
Found in Baseline             : 1.0.2
Found Date                    : 4/2/93
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 6417
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[4/2/93 public]
[ /diskless/swap/kernel at 03:43 (AM) Friday ]
makepath kernel/. && cd kernel &&  exec make MAKEFILE_PASS=BASIC     build_all
cc -c        -D_KERNEL -DKERNEL  -DDEBUG_DSWC -D_ALL_SOURCE -DAIX32   -I. -I/u1/devobj/sb/nb_rios/src/diskless/swap/kernel -I../user -I/u1/devobj/sb/nb_rios/src/diskless/swap/user -I/u1/devobj/sb/nb_rios/export/rios/usr/include  ../../../../../src/diskless/swap/kernel/dswc.c
/u1/devobj/sb/nb_rios/tools/rios/bin/idl      -I/u1/devobj/sb/nb_rios/export/rios/usr/include `genpath -I../config`  -keep c_source -header ./dswd.h   -I/u1/devobj/sb/nb_rios/export/rios/usr/include ../../../../../src/diskless/swap/user/dswd.idl -server none
cc -c        -D_KERNEL -DKERNEL  -DDEBUG_DSWC -D_ALL_SOURCE -DAIX32   -I. -I/u1/devobj/sb/nb_rios/src/diskless/swap/kernel -I../user -I/u1/devobj/sb/nb_rios/src/diskless/swap/user -I/u1/devobj/sb/nb_rios/export/rios/usr/include  dswd_cstub.c
cc     -edswc_config -bI:/lib/kernex.exp -bI:/lib/syscalls.exp  -bloadmap:dswc.ldmap -bI:../../../../../src/diskless/swap/kernel/extras.exp     -L../RIOS -L/u1/devobj/sb/nb_rios/src/diskless/swap/RIOS -L/u1/devobj/sb/nb_rios/export/rios/usr/lib -o dswc.X dswc.o dswd_cstub.o   -lkidl -lknck -lkdes  
0706-154 ERROR:  Error in token processing; 
		  number of tokens exceeds maximum of (8)
0706-154 ERROR:  Error in token processing; 
		  number of tokens exceeds maximum of (8)
0706-154 ERROR:  Error in token processing; 
		  number of tokens exceeds maximum of (8)



CR Number                     : 7614
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : sec
Subcomponent Name             : 
Short Description             : rgy_edit sends error msgs to stdout
Reported Date                 : 3/30/93
Found in Baseline             : 1.0.2
Found Date                    : 3/30/93
Severity                      : D
Priority                      : 4
Status                        : dup
Duplicate Of                  : 12476
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[3/30/93 public]
At times it's nice to redirect stdout to /dev/null, but to let error msgs
be displayed on the screen.  As is, this can't be easily done with rgy_edit 
because rgy_edit outputs *all* messages to stdout.
 
This is a problem with several DCE commands.  Note also OT CR #3426 (currently
marked as an enhancement.)

[8/2/93 public]

Changed to enhancement for 1.1.  Responsible -> mob.

[10/3/94 public]
Made a 'dup' of 12476, since that one has more info on other things that
would need to change if this enhancement is made.  This may not get fixed
because dcecp has replaced rgy_edit as the supported registry admin tool.



CR Number                     : 7575
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : rpc
Subcomponent Name             : sys_idl/stubbase.h
Short Description             : nested comment in source file
Reported Date                 : 3/23/93
Found in Baseline             : 1.0.2b19
Found Date                    : 3/23/93
Severity                      : E
Priority                      : 3
Status                        : dup
Duplicate Of                  : 8289
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : stubbase.h
Sensitivity                   : public

[3/23/93 public]

When the GNU C compiler is run with high-paranoia, it detected a nested
comment in stubbase.h:

/*
   v1_enum macros are missing for CRAY;
   the whole CRAY section is untested and should probably be 
  excised from

/*
 * ndr_small_int is larger than 8 bits
 */

I back dated all revisions of stubbase.h to ensure that no other source
text was lost, this seems to be an isolated and benign editing error.



CR Number                     : 7505
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : fts
Short Description             : fts dump/restore use of vnode type isn't portable
Reported Date                 : 3/15/93
Found in Baseline             : 1.0.2b17
Found Date                    : 3/15/93
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 7362
Fix By Baseline               : 1.0.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Status               : import
Transarc Deltas               : dimitris-dump-vnode-device
Transarc Herder               : jaffe@transarc.com

[3/15/93 public]
Another portability problem in the dump/restore interface is that dump
puts the local system's idea of the vnode "type" (enum vtype, vattr
member va_type) into the dump image, and that restore puts the dumped
vnode type into a newly-created vnode with no interpretation.  If a
dump is restored onto a system with a different set of vnode types than
the originating machine, this can lead to bogus vnodes being
generated.
In the case of the two reference platforms, the differences between the
local enum vtype definitions are minor, so I assume resolving this
problem can wait till after 1.0.2.  If anyone feels otherwise, feel
free to raise the priority of the bug.
For reference, the two definitions of enum vtype follow:
	AIX:
		enum vtype { VNON, VREG, VDIR, VBLK, VCHR,
			VLNK, VSOCK, VBAD, VFIFO, VMPC };
	OSF/1:
		enum vtype { VNON, VREG, VDIR, VBLK, VCHR,
			VLNK, VSOCK, VFIFO, VBAD };
As you can see, of the common vnode types only VFIFO has a different
value in the two systems.  (And OSF/1 doesn't support type VMPC.)  So
this bug in and of itself would prevent only vnodes of type VFIFO (or
VMPC, of course) from being transmitted between architectures or
from causing a clean failure, if the vnode type were not supported
on the target system.

[3/16/93 public]
Don's comments are on the money.  Will handle, but probably not for 1.0.2;
I plan to fold this work into the dump/restore of special file types.
Changed Interest List CC from `cfe@transarc.com' to `pakhtar@transarc.com, 
 jdp@transarc.com' 
Changed Responsible Engr. from `pakhtar@transarc.com' to `cfe@transarc.com' 
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `jaffe@transarc.com' 
Added field Transarc Status with value `open'

[4/14/93 public]
Defect Closure Form
-------------------
--Regression test program below--
--Verification procedure below--
In an episode fileset create a named pipe. Copy the fileset using 
'fts dump | fts restore' from a RIOS to a PMAX/OSF1 
--Other explanation below--
Associated information:
Tested on TA build:  
dfs-102-2.8
Tested with backing build:  
dce1.0.2b19
Changed Interest List CC from `pakhtar@transarc.com, jdp@transarc.com' to 
 `pakhtar@transarc.com, jdp@transarc.com, cfe@transarc.com' 
Changed Responsible Engr. from `cfe@transarc.com' to `dimitris@transarc.com' 
Filled in Transarc Deltas with `dimitris-dump-vnode-device' 
Changed Transarc Status from `open' to `export'

[4/14/93 public]
Changed Status from `open' to `dup' 
Filled in Duplicate Of with `7362'



CR Number                     : 7480
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 7476,7477,7478,7479
Project Name                  : dce
H/W Ref Platform              : pmax
S/W Ref Platform              : osf1
Component Name                : sec
Subcomponent Name             : 
Short Description             : sec_rgy_name_to_unix_num
documents output parameter as long
Reported Date                 : 3/11/93
Found in Baseline             : 1.0.2
Found Date                    : 3/11/93
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 7476
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[3/11/93 public]

sec_rgy_pgo_name_to_unix_num documents output param. item_unix_id as
long , but the idl specifies ndr_long_int.

This doesn't port to a machine where a long is not 32 bits.
SEE CR7476

Janet

[3/15/93 public]

see 7476 and 7477



CR Number                     : 7479
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 7476,7477,7478,7480
Project Name                  : dce
H/W Ref Platform              : pmax
S/W Ref Platform              : osf1
Component Name                : sec
Subcomponent Name             : 
Short Description             : sec_rgy_pgo_id_to_unix_num
documents item_unix_id as long
Reported Date                 : 3/11/93
Found in Baseline             : 1.0.2
Found Date                    : 3/11/93
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 7476
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[3/11/93 public]
sec_rgy_pgo_id_to_unix_num documents output parameter item_unix_id as long
but the idl specifieds ndr_long_int.

This is not portable to a machine where long is not 32 bits.
Since this is an output parameter, their is not workaround.
SEE CR7476

janet

[3/15/93 public]

see 7476, 7477



CR Number                     : 7478
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 7476,7477,7479,7480
Project Name                  : dce
H/W Ref Platform              : pmax
S/W Ref Platform              : osf1
Component Name                : sec
Subcomponent Name             : 
Short Description             : sec_rgy_pgo_get_members
documents parameters as long, but uses then as ndr_long_int
Reported Date                 : 3/11/93
Found in Baseline             : 1.0.2
Found Date                    : 3/11/93
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 7476
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[3/11/93 public]

sec_rgy_pgo_get_members documents max_members, number_supplied and
number_members as long.  This is inconsistant with the idl which specifieds
then as ndr_long_int.

This doesn't port to machines where long is not 32 bits
SEE CR7476

janet

[3/15/93 public]

see 7476 and 7477



CR Number                     : 7477
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 7476,7478,7479,7480
Project Name                  : dce
H/W Ref Platform              : pmax
S/W Ref Platform              : osf1
Component Name                : sec
Subcomponent Name             : 
Short Description             : sec_rgy_acct_get_by_unix_num
documents unix_num as long
Reported Date                 : 3/11/93
Found in Baseline             : 1.0.2
Found Date                    : 3/11/93
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 7476
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[3/11/93 public]

sec_rgy_pgo_get_by_unix_num documents input parameter unix_num as a
long, but treats it as an ndr_long_int.  Since these are not
necessarily the same, they need to be made consistant.  

Since it is only an input parameter, their is a workaround.

janet

Add sec_rgy_pgo_unix_num_to_id and sec_rgy_pgo_unix_num_to_name to this list

[3/15/93 public]

combined all of the "long" changes into a single report - this is a 
component-wide change, no real point in having an OT report for each
occurance.



CR Number                     : 7354
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : other
S/W Ref Platform              : aix
Component Name                : cds
Subcomponent Name             : 
Short Description             : cdsResolveName does not return partial result
Reported Date                 : 2/25/93
Found in Baseline             : 1.0.2
Found Date                    : 2/25/93
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 5596
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[2/25/93 public]

We tested CDS over the XDS interface. We created a soft link 

link1="/.../localcell/link1"

that points to an object

obj1="/.../localcell/obj1". This object does not exist.

We set :

dns_opq_fname part_result;
...
flags->fsPartialRes = &part_result;
flags->fsResLength = sizeof (part_result);

Then we called cdsResolveName with link1 und expected to get DNS_ERROR and

flags->dsPartialRes="/.../localcell".

We got DNS_ERROR but

flags->d2PartialRes="".

For more informations please contact : Jochen Keutel
					(Jochen.Keutel@ap.mchp.sni.de)
					( Phone : +49 89 636 49514)



CR Number                     : 7315
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : cfg
Subcomponent Name             : dce_config
Short Description             : In-memory DFS cache still needs CacheInfo file
Reported Date                 : 2/22/93
Found in Baseline             : 1.0.2b16
Found Date                    : 2/22/93
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 2511
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[2/22/93 public]
Our DFS team here points out that dfsd needs the CacheInfo file even
if using an in-memory cache.  The format is still the same, giving the
mount point /..., a cache dir location (they suggest using the default
/opt/dcelocal/var/adm/dfs/cache), and the cache size.

[05/25/93 public]
Since this is DFS related, Ron should look at it....

[6/7/93 public]
This is a dup of 2511 which is fixed as of today.



CR Number                     : 7226
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : pmax
S/W Ref Platform              : osf1
Component Name                : cds
Subcomponent Name             : 
Short Description             : missing access check in 'new
epoch'
Reported Date                 : 2/15/93
Found in Baseline             : 1.0.2
Found Date                    : 2/15/93
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 6506
Fix By Baseline               : 1.0.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[2/15/93 public]
The 'set directory to new epoch' command is missing a security check.
The user issuing the command must have write access to the clearinghouse
if it is being changed from a read-only to a master.



CR Number                     : 7124
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : pmax
S/W Ref Platform              : osf1
Component Name                : cds
Subcomponent Name             : cdscp
Short Description             : no status from cdscp without LANG set
Reported Date                 : 2/3/93
Found in Baseline             : 1.0.2
Found Date                    : 2/3/93
Severity                      : C
Priority                      : 3
Status                        : dup
Duplicate Of                  : 9857
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[2/3/93 public]

If LANG not set, 
    % cdscp show server
?
                        SHOW
                      SERVER  
                          AT   1993-02-03-13:04:15
			...

If LANG set, 
% setenv LANG en_US.ISO8859-1
% cdscp show server
Warning: you have no network credentials. All requests will be unauthenticated.
                        SHOW
                      SERVER  
                          AT   1993-02-03-13:05:35
			...

It should provide a status code even if the right message
can't be found.

[2/5/93 public]
Will be addressed with other serviceability/I18N issues in DCE V1.1.

[6/16/94 public]
Duplicate of 9857, fixed in 1.1b9



CR Number                     : 7048
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : gds
Subcomponent Name             : xds,xom
Short Description             : headers not installed
Reported Date                 : 1/28/93
Found in Baseline             : 1.0.2
Found Date                    : 1/28/93
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 6818
Fix By Baseline               : 1.0.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[1/28/93 public]
The header files for xds and xom are not copied into the install tree by
the build process.  The makefiles in src/directory/xds and
src/directory/xom do not set ILIST or IDIR (not the former does but only
for TARGET_MACHINE==SVR4).  The list of files in the export tree (this
seems to work fine) is:

    xds.h
    xdsbdcp.h
    xdscds.h
    xdsgds.h
    xdsmdup.h
    xmhp.h
    xmsga.h
    xom.h
    xomi.h

I don't know if this is the complete list of what *should* be installed or
not.  DME originally reported this bug.

[2/2/93 public]
And DME will be happy to know that, not only is this a known problem,
but it will be fixed for 1.0.2.  In fact, it's already been submitted.
Marked dup.



CR Number                     : 6970
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : cfg
Subcomponent Name             : dce_config
Short Description             : cannot use dce_config to do in-memory DFS cache
Reported Date                 : 1/22/93
Found in Baseline             : 1.0.2
Found Date                    : 1/22/93
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 2511
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[1/22/93 public]

I was doing dce_config on a RIOS from the 1/15 osf build, and to be
adventurous, decided to do an in-memory cache instead of an on-disk one.
Observe:

        Should this machine be configured as a DFS client? (n) y
        Is the cache :
        1. in memory
        2. on the local disk
selection:  1
        Enter the RAM size of the cache (1000):
        starting dfsd...
dfsd: can't read cache info file '/opt/dcelocal/etc/CacheInfo' (code 2)
dfsd: failed to open cacheinfo file

...and of course, I can't get into root.dfs.

[6/7/93 public]
This is a dup of 2511 which is fixed as of today.



CR Number                     : 6808
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 8651
Project Name                  : dce
H/W Ref Platform              : other
S/W Ref Platform              : osf1
Component Name                : sec
Subcomponent Name             : 
Short Description             : macro NAMED_ITEM_LEN wrong on
64 bit machines
Reported Date                 : 1/12/93
Found in Baseline             : 1.0.2b1
Found Date                    : 1/12/93
Severity                      : D
Priority                      : 3
Status                        : dup
Duplicate Of                  : 8651
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.0.3
Affected File(s)              : rsdb_pvt.h
Sensitivity                   : public

[1/12/93 public]

The size calculation in file rsdb_pvt.h macro NAMED_ITME_LEN doesn't
produce the correct results on a 64bit machine where the alignment
for the union is longword.

[1/12/93 public]

There is no such marco - I just checked security/h/rsdb_pvt.h in the 1.0.2
source tree. Please double check and update this OT report. If there is no
macro then I will cancel it.

Converted to an enhancement (and lowered in priority and severity) since it
is not an issue for the reference platforms.

[1/13/93 public]
Fixed macro name to NAMED_ITEM_LEN

I'd argue it is of high severity and priority if this problem is reflected
in the on-disk structure.  It would prevent customers from moving their
databases.  If this isn't the case, great.

[1/13/93 public]
The registry database cannot be moved directly across
platforms anyway.  The sec_salvage_db tool must be used to translate
the database to ASCII before moving to a different platform and
translating back.

[10/7/93]
This is being fixed as part of 8651. marking as duplicate



CR Number                     : 6790
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : file exporter
Short Description             : Needs to install error code mappings
Reported Date                 : 1/11/93
Found in Baseline             : 1.0.1
Found Date                    : 1/11/93
Severity                      : D
Priority                      : 3
Status                        : dup
Duplicate Of                  : 5131
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : mason@transarc.com
Transarc Status               : closed

[1/11/93 public]

Currently the standardized error code mappings used by the file exporter
to encode errno type errors are not installed.  These mappings are needed
by any person wishing to develop a cache manger that communicates with the
file exporter.

Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `mason@transarc.com' 
Added field Transarc Status with value `open'

[2/9/93 public]
This is a duplicate of 5131, insofar as the correct fix for 5131 will
fix this also.
Changed Defect or Enhancement? from `def' to `enh' 
Changed Status from `open' to `dup' 
Filled in Duplicate Of with `5131' 
Changed Transarc Status from `open' to `closed'



CR Number                     : 6787
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 6822
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : fts
Short Description             : Must detect restores with missing incrementals
Reported Date                 : 1/11/93
Found in Baseline             : 1.0.2
Found Date                    : 1/11/93
Severity                      : D
Priority                      : 3
Status                        : dup
Duplicate Of                  : 6049
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : jaffe@transarc.com
Transarc Status               : closed

[1/11/93 public]
There is currently no code that prevents fts from restoring full and
incremental dumps incorrectly.  In particular, fts/test21 was doing a
restore of a dump consisting of a full and two incrementals but skipping
the first increemental.  This results in an inconsistent file system but
the INCONSISTENT bit is off.  Attempting to modify such a file system
will certainly result in a panic.
There has been some discussion that restoring part of a dump (or not all
of a dump) would be a valuable thing to do.  I suggest that if we want
to support this that we allow an inconsistent file system to be
mountable (exportable) as a read-only file system.  We will need to test
it to make sure that Episode (perhaps UFS is problematic) doesn't panic
when reading an inconsistent file system even if it does produce odd
error codes.  This should be straightforward "merely" a testing problem.
We must make sure, however, that when the ftutil module is asked to
restore a dump out of order or with missing pieces it detects this and
does not clear the inconsistent bit when the fileset is close.  Further
it must remember this and not clear the inconsistent bit following some
subsequent fileset operation that completes successfully (say the
restore of another incremental dump).  I suggest the creation of another
on-disk fileset status bit that means "MISSING_SOME_VVs".  This bit
would inhibit clearing the INCONSISTENT bit and would stay set until the
fileset was restored from a full dump (or deleted or recloned into or
that sort of thing).
Contrary to what Vijay, Jeff and I determined last week, Craig claims
that the VV-dumpted-from is stored in the dump header, so we can easily
verify that there is an overlap between the incoming restore and the
on-disk fileset.
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `jaffe@transarc.com' 
Added field Transarc Status with value `open'

[1/13/93 public]
I'd like to address this work in two phases, and I'd like to make this defect
be associated with the later phase.  Thus, I've created OT 6822 to cover the
first phase and have down-graded the priority of this one.
In particular, OT 6822 covers detecting the bad application of incremental
dumps, and returning failure.  This OT will be used to make it possible to
use these incremental dumps more gracefully, possibly with the
MISSING_SOME_VVS option or its analogue.
Filled in Inter-dependent CRs with `6822' 
Changed Severity from `B' to `D' 
Changed Priority from `1' to `3'

[2/24/93 public]
There had been an earlier version of this defect entered as OT 6049.
I'm dup'ing this one to it, and including the discussion from this to
its OT report.
Changed Status from `open' to `dup' 
Filled in Duplicate Of with `6049' 
Changed Fix By Baseline from `1.0.2' to `1.1' 
Changed Transarc Status from `open' to `closed'



CR Number                     : 6683
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 6548
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : dfs acls
Short Description             : Not returning distinct enough errors
Reported Date                 : 12/29/92
Found in Baseline             : 1.0.2
Found Date                    : 12/29/92
Severity                      : D
Priority                      : 3
Status                        : dup
Duplicate Of                  : 5955
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : security/client/acl/dfs_dce_acl.c,file/...?
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : jaffe@transarc.com
Transarc Status               : open

[12/29/92 public]
For OT6548, I'm replacing a hardcoded return of sec_acl_no_acl_found with
a call to a routine that converts errcodes to DCE acl errors.  Unfortunately,
as I found out via mail from Bruce Leverett, the syscalls are overloading
the errno/errcodes so much that you can't really tell what happened.  This
should be fixed by Transarc on the DFS side of things (not security), to
pass back more errcodes if possible, or add a status parameter for more
versatility if there aren't enough errcodes.  After I submit the dfs_dce_acl.c
with the conversion routine, feel free to update it and submit it when you
have error codes that are more meaningful.

[12/31/92 public]
Given that fixing this would require an API-level change (we'd have to
pass back an extended error code, as the heart of the above complaint
is the 8 bits which we have to work with isn't enough), either this
happens now, or it cannot possibly happen until 1.1

I've also noted that this is an enhancement, not a defect.
Changed Defect or Enhancement? from `def' to `enh' 
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `jaffe@transarc.com' 
Added field Transarc Status with value `open'

[1/4/93 public]
This is a dup of 5955... made it so...



CR Number                     : 6506
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : cds
Subcomponent Name             : cdsd
Short Description             : User without write permission to clearinghouse can set dir to new epoch
Reported Date                 : 12/16/92
Found in Baseline             : 1.0.2b6
Found Date                    : 12/16/92
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 7226
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[12/16/92 public]
'cdscp set dir to new epoch' succeeds when a user has "rwdtcia" permissions to
the directory and no permissions to the newly designated master clearinghouse.
The man page says write permission to the clearinghouse is required for the
command to succeed.  Could be a doc bug.  Console follows:

	- As cell_admin -
# acl_edit /.:/aaa -m user:testuser:a
# cdscp set dir /.:/aaa to skulk
# dce_login testuser testuser
	- As testuser -
# cdscp set dir /.:/aaa to skulk
# cdscp set dir /.:/aaa to new epoch master /.:/dls_ch readonly /.:/octagon_ch
Error on entity: /.../oct/aaa
Insufficient rights to perform requested operation (dce / cds)
Function: dnsReadAttrValue

# ^D
	- As cell_admin -
# acl_edit /.:/aaa -m user:testuser:rwdtcia
# dce_login testuser testuser
	- As testuser -
# cdscp set dir /.:/aaa to new epoch master /.:/dls_ch readonly /.:/octagon_ch
#

[7/15/93 public]
Marked as duplicate of 7226 (which has been fixed).



CR Number                     : 6504
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dcecp
Subcomponent Name             : rpccp
Short Description             : rpccp should allow unauthenticated ns access
Reported Date                 : 12/16/92
Found in Baseline             : 1.0.2b9
Found Date                    : 12/16/92
Severity                      : C
Priority                      : 3
Status                        : dup
Duplicate Of                  : 10442
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[12/16/92 public]

rpccp should provide some option to call rpc_ns_set_authn (false, ..., ...);
to allow testing of unauthenticated cds access.

(I had to code up a patched version of rpccp which allowed this for the
show profile command in order to help debug an inter-cell access problem).

[07/20/93 public]
Bill S. though he could take a stab at this and points out that in
an integrated environment, it might be difficult to get unauthenticated.

[7/23/94 public]
A year later....  This gets punted over to dcecp.

[8/9/94 public]
Marked as dup of 11442 which is somewhat more general for all bindings in
dcecp.



CR Number                     : 6467
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : lfs
Short Description             : episode computes caller access incorrectly for machine/self id
Reported Date                 : 12/15/92
Found in Baseline             : 1.0.2
Found Date                    : 12/15/92
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 5631
Fix By Baseline               : 1.0.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : jaffe@transarc.com
Transarc Status               : open

[12/15/92 public]
This bug seems trivially duplicatable.

I created a brand-new fileset, whose mode bits appear to be 777, owned by root.

I then cd'd to the directory and tried to list it.  Since I have "r"
access, I should be able to, but I was getting a protection failure in
the SAFS_Readdir RPC call.  According to kdbx, the return result from
VOPX_GETATTR (called with a 1 value for the "use extended fields"
attribute) was: 

(dataVersion = (high = 0, low = 12), fileID = (high = 1, low = 1), volVersion =
(high = 0, low = 4010), author = 4294967295, callerAccess = 0, anonAccess = 55,
parentVnode = 4294967295, parentUnique = 4294967295, serverModTime = (sec = 7244
31796, usec = 803955), fstype = 2, objid = (time_low = 120, time_mid = 0, time_h
i_and_version = 0, clock_seq_hi_and_reserved = '\0', clock_seq_low = '\0', node
= ""), timeUncertainty = 0, representationFlags = 319, backingIndex = 2, backing
VolIndex = 5, aclIx = 0, initDirAclIx = 0, initFileAclIx = 0, plistIx = 0, uPlis
tIx = 0, spare1 = 804780392)

Note that callerAccess (0) is less than anonAccess (55), which is by
definition wrong.

This this access is being used by the cache manager as the cached
access, this is causing confusion by the cache manager with respect to
protection checks.

Running as cell-admin, I looked at the directory in question:

# SEC_ACL for .:
# Default cell = /.../alfalfa.com
user_obj:rwxcid
group_obj:rwx-id
other_obj:rwx-id
sec_acl_edit> ab
# ls -lid .
65570 drwxrwxrwx   8 root     transarc     512 Dec 15 10:03 .
# suspend

Basically, it looks like Episode is computing the callerRights
incorrectly.
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `jaffe@transarc.com' 
Added field Transarc Status with value `open'

[12/15/92 public]
This bug is the same as 5631, too.  I'm duping it in the only order I can.
Changed Status from `open' to `dup' 
Filled in Duplicate Of with `5631' 
Changed Responsible Engr. from `kazar@transarc.com' to `bwl'

[12/16/92 public]
Changed Subcomponent Name from `episode' to `lfs'



CR Number                     : 6373
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dced
Subcomponent Name             : secval serviceability
Short Description             : sec_clientd does not print a warning on clock skew
Reported Date                 : 12/8/92
Found in Baseline             : 1.0.2
Found Date                    : 12/8/92
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 11725
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : jaffe@transarc.com
Transarc Status               : open

[12/8/92 public]
Occasionally, I will restart a pmax after having it in the debugger.  This
causes the clock to be severely wrong.

When I restart the machine, and run rc.dce, the script hangs waiting for 
sec_clientd to reset its credentials.  If I run sec_clientd with the -d
switch, I get the following output:

root@osf.transarc.com  #  /opt/dcelocal/bin/sec_clientd -d
/opt/dcelocal/bin/sec_clientd 12/07/92 21:26:57 - Unable to validate machine con
text
... Clock skew too great (dce / krb)

This is very nice, and the enhancment is to print this message to the 
console even when not in debugging mode so that the user has some hope
of noticing the problem.

Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `jaffe@transarc.com' 
Added field Transarc Status with value `open'

[12/8/92 public]
It's an enhancement for security, not DFS, to make.
Changed Component Name from `dfs' to `sec' 
Changed Subcomponent Name from `sec' to `' 
Filled in Interest List CC with `bb+transarc.afs.ot-notices@transarc.com' 
Changed Responsible Engr. from `sehkar@osf.org' to `' 
Changed Resp. Engr's Company from `osf' to `'

[08/26/94 public]
I think John will fix this as part of doing dced serviceability.
sec_clientd is superceded in DCE 1.1 by dced's secval service.



CR Number                     : 6359
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : cfg
Subcomponent Name             : config
Short Description             : 'clear' loses information when config problems occur
Reported Date                 : 12/7/92
Found in Baseline             : 1.0.1b25
Found Date                    : 12/7/92
Severity                      : E
Priority                      : 4
Status                        : dup
Duplicate Of                  : 582
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[12/7/92 public]
Some complaints around here that all the 'clear' commands in dce_config
lose information when configuration problems occur.  Replace them with
some other mechanism (perhaps a prompt before the 'clear')?

[1/5/93 public]

This is a duplicate of 582 (although the proposed solution differs).

[03/18/93 public]
This will be fixed in 1.0.3 with the loggin dce_config from HP.
Marked as duplicate.



CR Number                     : 6341
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : sec/server
Short Description             : a fatal() call causes deadlock in server
Reported Date                 : 12/4/92
Found in Baseline             : 1.0.2
Found Date                    : 12/4/92
Severity                      : C
Priority                      : 1
Status                        : dup
Duplicate Of                  : 7763
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : jaffe@transarc.com
Transarc Status               : open

[12/4/92 public]
  In rs_lock.h, unlocking is defined with a series of CATCH,
CATCH_ALL, and ENDTRY:
	       ---- ---- ---- ---- ---- ---- ---- ----
#define UNLOCK \
    } CATCH(pthread_cancel_e) { \
        unlock(save_lock_type, save_lock_mode); \
        RERAISE; \
    } CATCH_ALL { \
        char LOCKbuf[512]; \
        sprintf(LOCKbuf, "Fatal exception while holding %s %s lock", \
                mode_string(save_lock_mode), type_string(save_lock_type)); \
        fatal(LOCKbuf); \
    } ENDTRY; \
(*) unlock(save_lock_type, save_lock_mode); \
    }
	       ---- ---- ---- ---- ---- ---- ---- ----
  If within a LOCK/UNLOCK scope, a subroutine calls fatal() to cause
that its thread to exit, raising an exit (not a cancel) exception. We
are unwound into the CATCH_ALL clause. Unfortunately, that clause also
calls fatal(), which evidently starts another exit-unwind which causes
the trailing call to unlock() to be skipped. I understand that a
FINALLY clause is required to execute that particular unlock() (see
line (*)). The starred line is actually unreachable.
  This was found after Erik (eeb) accidentally passed a zero-length
string to sec_pgy_pgo_delete() (to delete a principal). The first
fatal() occurs after get_credentials_by_unix_id() fails in
export_pgo() (get_credentials_by_unix_id() was given an id of
something like 2886142). The database lock was left stuck in
write-mode and the server began to accumulate waiters.  The chain of
command will be fully described in another defect, as a null pgo name
should have been caught earlier, perhaps by the client-side code.
 
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `jaffe@transarc.com' 
Added field Transarc Status with value `open'

[12/9/92 public]
Reassigned to ahop.

[12/9/92 public]
This report refers to a problem that occurs after
a call to fatal (which kills the entire secd process) has been made.
Since secd is expected to die in this case, the problem severity/priority
has been reduced to C 2.  The workaround is to avoid the bad-input
to sec_rgy_pgo_delete (this fatal bug addressed elsewhere) 
that results in a call to fatal.

The error is actually in the secd shutdown-cleanup code which
erroneously tries to promote a lock.  The UNLOCK macro should
be left as is; the (*)unlock call should not be necessary
in the fatal case.

[12/15/92 public]
  I don't understand the explanation of the 'real' error, which is
described as a lock promotion occuring in the shutdown-cleanup logic.
  (I really have to know that we are talking about the same problem.)
  What I am seeing is that the database lock was promoted before the
initial call to fatal(). It is initially obtained in RIW mode and
upgraded before modifying the rsdb. The fatal() call unwinds the stack
and executes another fatal() call in the CATCH_ALL clause of the
UNLOCK for the RIW-locked scope; this causes the existing thread to
not execute the line I flagged (*) above. The thread finally exits and
the database lock is stranded at WRITE. The server immediately begins
to jam other threads which queue up waiting for READ protection to the
database. 'gdb' reveals no other known_locks stuck after the erroneous
thread has exited.
  I cannot understand why there would not be a fix to make the above
line reachable, or to remove it. If the approach is that locks need
not be cleaned up because the image is performing a hard exit (crash),
then the LOCK/UNLOCK macros are unnecessarily complex, but more
importantly the RS isn't being crashed by the existing logic! If the
approach is that locks should be cleaned up on crash, then UNLOCK does
appear to be incorrect.
  Of equal interest would be a discussion about why errors of this
magnitude (a client-provided PGO index not being present in the rsdb)
should belly-up the entire server, as opposed to returning an error
(or even an exception) to the client-side thread. In this case, a very
modest error is geared to interrupt the security service.
  I accept that there is a workaround for this (don't send nil names
to the rs) and cannot promote this above 'C', but I do think C1 is
justified
Changed Priority from `2' to `1'

[1/4/93 public]
This is not a "high priority" defect because it is rarely encountered.
It only occurs during a call to fatal() which is only called when internal
corruption of the database indicates that further execution of secd
could cause more damage.  The above-mentioned case of bad client-input
causing a fatal() was a bug that (I'll spare you the details) looked like
database corruption; it has since been fixed.  Changed priority to 2.
Also, my initial assessment of a problem with lock promotion was wrong.
I removed the "Affected Files" entry.

Just to make sure I understand the initial defect description:
Have you seen the secd server hang after a call to fatal even outside of the
debugger?

[1/5/93 public]
  Yes, this bug is reproducible with or without the presence of GDB.
Without GDB, one can confirm the diagnosis with some confidence by
running "secd -lock_debug" . We can provide a sample application if
one is needed.
  Thanks for reviewing this problem.

[9/24/93 public]
The call to fatal() ends up in rs_task_fatal() which was fixed on 8/23/93
see defect number 7763.



CR Number                     : 6317
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dced
Subcomponent Name             : secval serviceability
Short Description             : sec_clientd as liveness agent
Reported Date                 : 12/3/92
Found in Baseline             : 1.0.2
Found Date                    : 12/3/92
Severity                      : E
Priority                      : 4
Status                        : dup
Duplicate Of                  : 11725
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Status               : open
Transarc Deltas               : 
Transarc Herder               : jaffe@transarc.com

[12/3/92 public]
  A seviceability enhancement appears to be worth investigating:
sec_clientd is in an appropriate environment to monitor the liveness
of the registry master database (and, implicitly, the communications
path to it). We have encoutnered situations in which security clients
(applications) are burdened with this task. Encapsulating this within
sec_clientd would permit a uniform response to unexpected and
prolonged registry outages. While individual routines of the sec
library cannot display warnings or use more conventional means of
informing the outer world what has happened (and what ought to be
done), sec_clientd could cleanly log system notices when the registry
master becomes unreachable or unresponsive. This would permit direct
notification of an external operator or monitor, and allow a fair
amount of detail to be included in the notification without
transporting these details through the applications.
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `jaffe@transarc.com' 
Added field Transarc Status with value `open'

[08/26/94 public]
This is almost a dup of 6373.  I think John should fix this as part
of the SVC work for dced's secval, the DCE 1.1 replacement for sec_clientd.

[8/31/94 public]
Changed Interest List CC from `travis@transarc.com, sanzi@transarc.com, 
 bb+transarc.kansas.sfs@transarc.com' to `travis@transarc.com, 
 sanzi@transarc.com'

[09/13/94 public]
The secval validate, enable, disable and status operations, in conjunction
with the SVC logging, should meet this need.  Marking as a dup of the
svc work.



CR Number                     : 6313
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : lfs
Short Description             : newaggr should not proceed when the aggr is attached.
Reported Date                 : 12/3/92
Found in Baseline             : 1.0.2
Found Date                    : 12/3/92
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 4378
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : jaffe@transarc.com
Transarc Status               : closed

[12/3/92 public]

Currently, the DFS allows 'newaggr' to init an aggregate while the aggregate,
is ,in fact, alreay attached. The 'newaggr' command does not give any warning
or even stops doing it. We should think of a way to enhance it in the future
release. 

Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `jaffe@transarc.com' 
Added field Transarc Status with value `open'

[12/3/92 public]
Changed Subcomponent Name from `epi' to `lfs' 
Changed Interest List CC from `pakhtar@transarc.com' to `pakhtar, ota, jdp' 
Changed Status from `open' to `dup' 
Filled in Duplicate Of with `4378' 
Changed Transarc Status from `open' to `closed'



CR Number                     : 6301
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : rgy_edit
Short Description             : 
Unable to null optional attributes once they have been assigned a value
Reported Date                 : 12/2/92
Found in Baseline             : 1.0.1
Found Date                    : 12/2/92
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 5359
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[12/2/92 public]

In the principal domain of rgy_edit, once you assign a "Fullname" to
a principal, you can neither delete the Fullname attribute from the
principal, nor assign the null string as the value of the "Fullname"
attribute.

In the account domain, essentially the same problem exits for
the "shell" and "misc info" attributes.

rgy_edit does not seem to provide a way to reassign the "missing value"
to these attributes.

for example:

rgy_edit=> do p
Domain changed to: principal
rgy_edit=> add sally
rgy_edit=> view sally -f
sally                                        112
  Uuid:       00000070-3601-2B1D-AB00-02608C2F5DA0
  Primary:  pr   Reserved:   --
  Quota: unlimited
rgy_edit=> change
Change Principal=> Enter name: sally
Enter new name: (sally)
Enter new UNIX number: (112) cannot be changed
Enter new full name in quotes: () Sally Brown
Enter object creation quota: (unlimited)
Change Principal=> Enter name:
rgy_edit=> view sally -f
sally                                        112
  Full name:  Sally Brown
  Uuid:       00000070-3601-2B1D-AB00-02608C2F5DA0
  Primary:  pr   Reserved:   --
  Quota: unlimited
rgy_edit=> change sally
Enter new name: (sally)
Enter new UNIX number: (112) cannot be changed
Enter new full name in quotes: (Sally Brown) *** what do you enter to return to () ***
Enter object creation quota: (unlimited)
rgy_edit=>

[12/2/92 public]
You assign the null string "" if you want nothing in the field.
(ie: change sally -f "").
You should be able to do it interactively too, but there's a problem in
the command parser that's not stripping off quotes, but that's being handled
along with the \ char not working correctly in CR 5359, so I'm dup'ing this
to that one.



CR Number                     : 6285
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : 
Short Description             : dtsd does not reliably start upon reboot
Reported Date                 : 12/2/92
Found in Baseline             : 1.0.2
Found Date                    : 12/2/92
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 6102
Fix By Baseline               : 1.0.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : jaffe@transarc.com
Transarc Status               : open

[12/2/92 public]
After configuring DCE and DFS for DFS smoke tests, if I reboot the RIOS
and invoke /etc/rc.dce, the attempt to run dtsd sometimes produces the
following messages:

dtscp cannot get rpc binding to dts daemon - reason:
        connection closed (dce / rpc)
error executing command:
        time service has not been created (dce / dts)

This doesn't happen every time, but I have seen it fairly often.  Just now,
when it happened, I invoked /opt/dcelocal/bin/dtsd myself, and it returned
without producing any more messages.
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `jaffe@transarc.com' 
Added field Transarc Status with value `open'

[12/2/92 public]
Changed Component Name from `dfs' to `dts' 
Changed Subcomponent Name from `dts' to `' 
Changed Responsible Engr. from `bwl@transarc.com' to `' 
Changed Resp. Engr's Company from `tarc' to `'

[12/2/92 public]

[12/2/92 public]
Filled in Interest List CC with `bb+transarc.afs.ot-notices@transarc.com'

[12/2/92 public]
This is a duplicate of CR #6102.
I am currently investigating it.
A short term fix would be to add a sleep for, say, 10 seconds in /etc/rc.dce
after it starts up dtsd, but before it runs the commands in /etc/rc.dts.  
Dtsd, however, has code which should make this a silly thing to have.  
It is unclear why this code is not working.



CR Number                     : 6271
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : lfs
Short Description             : reserving frags in COW file gets too few frags
Reported Date                 : 12/1/92
Found in Baseline             : 1.0.2
Found Date                    : 12/1/92
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 5926
Fix By Baseline               : 1.0.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : jaffe@transarc.com
Transarc Status               : open

[12/1/92 public]
The code in epia_Reserve that handles extending a fragmented file
doesn't check to see if the file's block is InBacking or not.  It only
reserves those needed to extent the length.  This will results in too
few fragments being reserved which will then result in various problems
if the volume is really so full it can not allocate the space.
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `jaffe@transarc.com' 
Added field Transarc Status with value `open'

[2/12/93 public]
Is this getting fixed for 1.0.2.  It seems important since it
can lead to problems as a volume is filling up.
Changed Interest List CC from `ota' to `ota,demail1!carl' 
Changed Severity from `C' to `B' 
Changed Priority from `2' to `1'

[2/12/93 public]
After discussion with Transarc, I agree this is not pri 1
material.
Changed Priority from `1' to `2'

[5/26/93 public]
This was fixed by Ted as part of the changes to fix OT 5926.  So I have
dup'ed it to 5926.
Changed Status from `open' to `dup' 
Filled in Duplicate Of with `5926'



CR Number                     : 6184
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : 
Short Description             : DFS include file install directory changed
Reported Date                 : 11/23/92
Found in Baseline             : 1.0.2
Found Date                    : 11/23/92
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 5131
Fix By Baseline               : 1.0.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[11/23/92 public]

This "defect" is just a placeholder to record the fact that the
installation directory for DFS include files is being changed,
from .../afs to .../dcedfs.

[11/23/92 public]
Oops... 5131 describes this change (along with others).  So
close the present defect.



CR Number                     : 6031
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 5708
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : cm
Short Description             : panic in RecoverSCacheToken
Reported Date                 : 11/11/92
Found in Baseline             : 1.0.2
Found Date                    : 11/11/92
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 6017
Fix By Baseline               : 1.0.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : mcinerny@transarc.com
Transarc Status               : open

[11/11/92 public]

While running the defect closure verification procedures for OT CR
number 5708, I was able to panic my RIOS with the following stack trace:

    brkpoint() at 0x5a54
    panic(0xb) at 0x60178
    cm_RecoverSCacheToken(scp = 0x657c480, Flags = 257, renew = 1), line 1597 in "cm_tokens.c"
    cm_RestoreMoveTokens(volp = 0x6597108), line 1523 in "cm_tokens.c"
    RevokeHereToken(scp = 0x657c5a0, volp = 0x6597108), line 794 in "cm_tknimp.c"
    RevokeOneToken(scp = 0x657c5a0, baseIDp = 0x65bb034, typep = 0x2ff7fad4, rlockerp = 0x2ff7faec, colAp = (nil), colBp = (nil), flagsp = 0x2ff7fae8), line 826 in "cm_tknimp.c"
    STKN_TokenRevoke(h = 0x65b8b80, descp = 0x65bb018), line 535 in "cm_tknimp.c"
    op2_ssr(0x65b8b80, 0x6528a00, 0x2ff7fdfc, 0x2ff7fdd8, 0x60a2dd8, 0x5d45504, 0x2ff7fd80) at 0x604cb54
    rpc__dg_execute_call(0x6528a00, 0x0) at 0x5fee6ac
    cthread_call_executor(0x5d45584) at 0x5fe104c
    thread_boot(0x0, 0x2ff7fff0, 0x8) at 0x5fa9a04
    procentry(0xb, 0x2ff7f6d8, 0x2ff98000, 0xb) at 0x2aa94

The test was run:

RIOS client running
	<cwd is in bazset>
	% tsrtest -verbose -files 10 -flock -dir .
	<wait for pause>
	% fts move bazset echo echo.epi0 puzzle puzzle.epi0 -verbose
	Cloning fileset 0,,24 to 0,,28 (name bazset.move-temp, Reclone=0)
	Creating token keep-alive thread.
	Revocation socket is: inet/192.55.207.156/1070
	Creating RPC listener thread.
	About to get token 404 for fileset 0,,24 from echo.transarc.com.
	Listening for net calls (calling rpc_server_listen)
	Connecting to file server on echo.transarc.com...STKN_InitTokenState called with flags of 0x0
	STKN_InitTokenState() called: clearing token state.
	done (result 0)
	Token 721495363,,6031, type 0x404, obtained on fileset 0,,24.
	Releasing token (1) for fileset 0,,24 from echo.transarc.com.
	Releasing token on file server...done.
	Creating dest fileset 0,,24...done
	Creating tag keep-alive thread.
	Dumping from clone 0,,28 (src) to fileset 0,,24 (dest)...done
	Deleting the clone 0,,28...done
	About to get token 404 for fileset 0,,24 from echo.transarc.com.
	Connecting to file server on echo.transarc.com...STKN_InitTokenState called with flags of 0x0
	STKN_InitTokenState() called: clearing token state.
	done (result 0)
	Token 721495363,,6034, type 0x404, obtained on fileset 0,,24.
	Dumping from original 0,,24 (src) (incr from VV 0,,949) to fileset 0,,24 (dest).
	..About to get token 4808 for fileset 0,,24 from echo.transarc.com.

The cell was configured:

PMAX-core-scm-fl-ft(ufs,lfs)-dfs
RIOS-ft(ufs,lfs)-dfs

The PMAX is still up.
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `mcinerny@transarc.com' 
Added field Transarc Status with value `open'

[11/11/92 public]
Changed H/W Ref Platform from `rs6000' to `all' 
Changed S/W Ref Platform from `aix' to `all' 
Changed Status from `open' to `dup' 
Filled in Duplicate Of with `6017'



CR Number                     : 6025
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : dfs
Subcomponent Name             : fts
Short Description             : fts lsq caused error 691089516 message from dfs
Reported Date                 : 11/10/92
Found in Baseline             : 1.0.2
Found Date                    : 11/10/92
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 5114
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : jaffe@transarc.com
Transarc Status               : open

[11/10/92 public]
Senario:	Running moderate mode testing in DFS/LFS on AIX (dfs-102-1.55)
		Tests currently in test7.

	Log into machine, and type 

		fts lsq /:/.

	Some DFS component prints out the following error on its controlling
	terminal:

	dfs: fileset (id = 1) is busy with error 691089516
	dfs: waiting (691089516) for busy fileset 0,,0

The error translates into:

	translate_et: 691089516: get status on fileset (dfs / xvl)

The bug is that this does not seem to be an error.  The first question is
why did fts lsq cause this message?  The second is why should a fileset
busy message claim that there is an error, when it may just be that the
fileset was legally busy?
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `jaffe@transarc.com' 
Added field Transarc Status with value `open'

[11/11/92 public]
This is fundamentally a dup of OT 5114, which is an enhancement request.
I'll append the text of this OT to that one, suggesting that the CM also
be changed so that ``busy''-style codes don't get reported as ``error''s.
Changed Defect or Enhancement? from `def' to `enh' 
Changed Status from `open' to `dup' 
Filled in Duplicate Of with `5114'



CR Number                     : 6022
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : pmax
S/W Ref Platform              : osf1
Component Name                : sec
Subcomponent Name             : rgy_edit
Short Description             : rgy_edit - multiple registry updates only partially succesful
Reported Date                 : 11/10/92
Found in Baseline             : 1.0.2
Found Date                    : 11/10/92
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 5878
Fix By Baseline               : 1.0.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[11/10/92 public]

(osf1 1.0.4 b8)

I was going to modify the account "root" thru rgy_edit, and decided not to
in the middle, but I hit the yes values to simply row thru it, changing
nothing major:

rgy_edit=> cha
Change Account=> Enter account id [pname]: root
Enter account group [gname]:
Enter account organization [oname]:
Enter new misc info:
Enter new home directory:
Enter new shell:
Password valid [y/n]? y
Enter new expiration date [yy/mm/dd or 'none']: none
Allow account to be server principal [y/n]? y
Allow account to be client principal [y/n]? y
Account valid for login [y/n]? y
Allow account to obtain post-dated certificates [y/n]? y
Allow account to obtain forwardable certificates [y/n]? y
Allow certificates to this account to be issued via TGT authentication [y/n]? y
Allow account to obtain renewable certificates [y/n]? y
Allow account to obtain proxiable certificates [y/n]? y
Allow account to obtain duplicate session keys [y/n]? y
Good since date [yy/mm/dd or 'now']: now
Create/Change auth policy for this acct [y/n]? (n)
Change account "root system none" [y/n/g/q]? y

  I recieved the following error:

?(rgy_edit) Unable to change "root" - Operation involving multiple registry upda
tes was only partially successful (Registry Edit Kernel) (dce / sad)
?(rgy_edit)  - connection request rejected (dce / rpc)
Change Account=> Enter account id [pname]:

 and I assume it wants me to try again.

[11/10/92 public]
I assigned this to Sekhar, to figure out what kenny is really trying to report,
and clarify it.  Yes, it wants you to try again.  The change command in
interactive mode always offers to let you change another account without
having to type change again.  If you just hit return when it says "Enter acct
id [pname]" it will exit the change subcommand.  This is documented.   If you
can't get any changes to work because you keep getting "connection request
rejected" then there may be a problem, but that may have just been a problem
that's addressed in the rebinding code fixes for CR4043 (rebind wasn't taking
"connection request rejected" into account).  If that's the only problem you're
trying to report here, then just dup this to 4043.

[11/11/92 public]

>If you
>can't get any changes to work because you keep getting "connection request
>rejected" then there may be a problem, but that may have just been a problem
>that's addressed in the rebinding code fixes for CR4043 (rebind wasn't taking
>"connection request rejected" into account).

>If that's the only problem you're trying to report here, then just dup this
>to 4043.

That's the problem. Will dup.

[11/12/92 public]

This is not a dup of 4043. It is a dup of 5878. 

Since the responses to the questions in the administrative part of the change
cmd was "y" (which means some change was made to the administrative part 
because some of the questions have a default of n ). And changing the 
administrative part currently causes secd to crash . This is the same as
the problem reported in OT 5878.

I confirmed this 'theory' by having Kenny reproduce this problem (by
repeating the change cmd exactly as shown above) and verifying
that secd crashed after the error message about "connection refused"

Bumped up the severity and priority to that of 5878.



CR Number                     : 5915
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 9700
Project Name                  : dce
H/W Ref Platform              : other
S/W Ref Platform              : other
Component Name                : cds
Subcomponent Name             : cdsd,cdsclerk
Short Description             : Clearinghouse relocation does not work.
Reported Date                 : 11/3/92
Found in Baseline             : 1.0.1
Found Date                    : 11/3/92
Severity                      : C
Priority                      : 1
Status                        : dup
Duplicate Of                  : 9700
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[11/3/92 public]



I tried relocating a clearinghouse by following the instructions in the
admin guide.  I was successfully able to move a clearinghouse to another
machine and bring it up.  However, after the clearinghouse was up on the
new machine, I was no longer able to skulk the root directory.  Attempts
to do so yielded the error:

cdscp> set directory /.: to skulk
set directory /.: to skulk
Error on entity: /.../iowa_cell
Specified clearinghouse does not exist (dce / cds)
Function: dnsSkulkDir

I am not sure if this is the cause of the problem, but I noticed that
after relocating the clearinghouse, the clearinghouse entry in the
cache contained the new address.  However, the root directory entry
for that clearinghouse still contained the old address.

[11/11/92 public]

After a clearinghouse has been relocated from one CDS server machine
to another, The tower information for the clearinghouse in the root
directory, /.: , is not updated immediately.  "set dir /.: to skulk"
command would fail.  But after certain time, the background propagation
does seem to get the tower information in the root directory updated.
Then the command "set dir /.: to skulk" will work again.  This is
a case which the background propagation can do properly, while the
manual skulking fails [for root directory].

[1/15/93 public]
We believe that Sev/Pri of this CR should be C2. The problem corrects
itself after approximately 1 hour and during that time read operations
are serviced correctly. We are currently investigating the fix for this
defect.

[1/22/93 public]
Changed sev/pri as per agreement at this week's tech call.

[9/10/93 public]
[Based on the OSF/DCE 1.0.2 DCE Admin. Guide - Core Components Pg11-10 - 11-12]
Before you relocate a cleringhouse, use the "clear clearinghouse" command to
update the clearinghous files (especially the *checkpoint.* file) and ensure
that the files are consistent. We did this on both 486 and HP_UX and relocate
clearinghouses successfully as well as the "set dir /.: to skulk". Can anyone
who saw this problem before give a try please. If we do not hear any problem
in a week, we'll just cancel this bug.

[9/10/93 public]
Oops, My test wasn't right. I will check this out on Monday.

[10/20/93 public]
We are still working this and 5915 but if we get a resolution it 
will go in the unintegrated tree.

[8/3/94 public]
this is a dup of 9700.  We are trying to fix currently.  Includes changes
to gda and adver to update there mgmt entries when the address changes.



CR Number                     : 5913
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 3159
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : cds
Subcomponent Name             : 
Short Description             : SHOW command does not work well with wildcard/metacharacters
Reported Date                 : 11/3/92
Found in Baseline             : 1.0.1
Found Date                    : 11/3/92
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 3159
Fix By Baseline               : 1.0.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[11/3/92 public]


  (4) Creating object with '*' and showing it:
      -----------------------------------------------------------------
      cdscp> create obj /.:/FVT/te*
      cdscp> list obj /.:/FVT/te\*
                              LIST
                            OBJECT   /.../c=ca/o=cell2/FVT
                                AT   1992-10-23-14:56:03
      te*
      cdscp> show obj /.:/FVT/te*

                              SHOW
                            OBJECT   /.../c=ca/o=cell2/FVT/te*
                                AT   1992-10-23-14:56:23
                           CDS_CTS = 1992-10-23-19:58:17.469518100/c9-c2-d4-ff-
                           CDS_UTS = 1992-10-23-19:58:17.482572100/c9-c2-d4-ff-
      cdscp> show obj /.:/FVT/te\*

                              SHOW
                            OBJECT   /.../c=ca/o=cell2/FVT/te\*
                                AT   1992-10-23-14:56:31
      Error on entity: /.../c=ca/o=cell2/FVT/te\*
      Requested entry does not exist (dce / cds)
      Function: dnsEnumAttr
      dnsEnumAttr: partial results = /.../c=ca/o=cell2/FVT

      cdscp>
      -----------------------------------------------------------------
      NOTE:  Documentation(Application Development Guide, Chapter 24,
             pages 418 and 419) states that 'when entering a name
             as part of a CDSCP show or list command, you must use a
             backslash (\) to escape any * or ? character in the
             rightmost simple name.'  The example shows that the '*'
             character is not being interpreted as a metacharacter.
             This same results are also found for the '?' character.

Effects:
We are unable to use metacharacters in cds names

[11/24/92 public]

SOme more:

   part b)
   =======
      cdscp> create obj /.:/FVT/te\*
      cdscp> list obj /.:/FVT/te\*
                              LIST
                            OBJECT   /.../c=ca/o=cell2/FVT
                                AT   1992-10-23-14:56:03
      cdscp> show obj /.:/FVT/te*

                              SHOW
                            OBJECT   /.../c=ca/o=cell2/FVT/te\*
                                AT   1992-10-23-14:56:23
                           CDS_CTS = 1992-10-23-19:58:17.469518100/c9-c2-d4-ff-
                           CDS_UTS = 1992-10-23-19:58:17.482572100/c9-c2-d4-ff-
>      cdscp> show obj /.:/FVT/te\*
>
>                              SHOW
>                            OBJECT   /.../c=ca/o=cell2/FVT/te\*
>                                AT   1992-10-23-14:56:31
>                           CDS_CTS = 1992-10-23-19:58:17.469518100/c9-c2-d4-ff-
>                           CDS_UTS = 1992-10-23-19:58:17.482572100/c9-c2-d4-ff-
      cdscp> show obj /.:/FVT/te\\*

                              SHOW
                            OBJECT   /.../c=ca/o=cell2/FVT/te\*
                                AT   1992-10-23-14:56:42
                           CDS_CTS = 1992-10-23-19:58:17.469518100/c9-c2-d4-ff-
                           CDS_UTS = 1992-10-23-19:58:17.482572100/c9-c2-d4-ff-
      cdscp> delete obj /.:/FVT/te\*
       OR
      cdscp> delete obj /.:/FVT/te\\*
       will delete the created object.



CR Number                     : 5877
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : lfs
Short Description             : The system is looping inside episode
Reported Date                 : 10/30/92
Found in Baseline             : 1.0.2
Found Date                    : 10/30/92
Severity                      : B
Priority                      : 0
Status                        : dup
Duplicate Of                  : 5508
Fix By Baseline               : 1.0.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : mason@transarc.com
Transarc Status               : open

[10/30/92 public]

I was running two copies of low test again 1.53 build and the system
was hung (looping) after 20 mins of running. Through the kdbx
I noticed that the system was looping between 

   GC_Tran and ComputeActiveLog.

(Sorry, I lost the stack trace, but the Ted asked to report it anyway.)

It is reproducible (at leaset two for two runs). 

Here is how I ran the test;

  - run the first low test with moderate mode through DFS, ie., the
    test dir is /:/testdir

  -run another copy of low test through the glue layer, ie., epimount the same
   fileset (root.dfs) and aggregate on /mnt

   The test dir is in /mnt/testdir1.

Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `mason@transarc.com' 
Added field Transarc Status with value `open'

[11/2/92 public]
I'm quite sure this is fixed by (super-)delta
ota-ot3804-new-block-security.  When this delta appears in a
configuration (dfs-102-1.55?) this should be checked.
Changed Subcomponent Name from `epi' to `lfs'

[11/4/92 public]
 I certainly saw this failure in 1.51; it was fixed in the delta
subsumed by the NBS super-delta.  I'm marking this as a duplicate of
5508.
Changed Status from `open' to `dup' 
Filled in Duplicate Of with `5508'



CR Number                     : 5874
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : sec
Subcomponent Name             : rgy_edit
Short Description             : clock skew errors not reported clearly
Reported Date                 : 10/30/92
Found in Baseline             : 1.0.2
Found Date                    : 10/30/92
Severity                      : C
Priority                      : 1
Status                        : dup
Duplicate Of                  : 5750
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : internal_binding.c
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : mason@transarc.com
Transarc Status               : open

[10/30/92 public]
Synposis:
Clock skew is expected to cause authentication problems, unfortunately it
isn't reported as skew. Consequently, diagnosing a skew problem is by 
inference. The actual problem report that I received is attached below. I 
would expect this to happen on all platforms.

-----------------------------
Another problem I noticed today was, running /etc/rc.dce on a pmax client failed
to start sec_clientd. I think sec_clientd is waiting for the 
creds/dcecred_ffffffff files and can't get them. Rebooting and 
reconfiguring the machine as a client didn't help. The problem turned 
out to be a badly out of sync system clock. The error messages from 
rgy_edit are completely non-intuitive. It says something like this.
Fixing the clock solved the problem.

?(rgy_edit) Warning - binding is not authenticated - Cant establish authentication to registry (Registry Edit Kernel) (dce / sad)
Domain changed to: principal
?(rgy_edit) Unable to add principal  "hosts/elbereth/self" - Principal quota exhausted (dce / sec)
Domain changed to: account
?(rgy_edit) Unable to add account "hosts/elbereth/self" - Principal does not exist (Registry Edit Kernel) (dce / sad)
?(rgy_edit) Unable to add key - Registry object not found (dce / sec)
?(rgy_edit) Unable to add key - Registry object not found (dce / sec)
bye.
                starting sec_clientd
sec_clientd 10/27/92 11:27:03 - Unable to register authentication info
... status 00000002 (unknown facility)

Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `mason@transarc.com' 
Added field Transarc Status with value `open'

[10/30/92 public]
This may explain a lot of other problems people have seen with sec_clientd
not communicating from a client machine, but then not being able to reproduce
the problem later...  By the way, rgy_edit has nothing to do with how it gets
reported;  All it can do is print out the errors that the auth RPC layer or
secd itself returns.

[10/11/93 public]
	Could you post the args that you gave to rgy_edit?

[10/11/93 public]
Looking at the above output again, I noticed that it's from dce_config
(so he must have been trying to configure a client machine that had a clock
that was out of sync).  Note that dce_login does seem to give the incorrect
error message when the clocks are skewed, but for some reason, dce_config
throws out dce_login error messages, so the user never sees them.  Then what
happened is rgy_edit was run without credentials, and thus defaulted to the
machine credentials, which weren't obtained yet, since sec_clientd couldn't
create them because of the clock skew.  So, the rgy_edit error messages were
ok in this case, the problem is that the dce_login failed because of clock
skew and dce_config hid the error.  Could someone at Transarc please try this
again with a recent 1.0.3 dce_config, which I believe checks clock skew before
doing anything?  Also, to correctly see if rgy_edit is reporting clock skew
in a usable manner, get credentials on a non-skewed client, then  skew it by
hand (run date xxxxx as root), then run rgy_edit and see what it gives for an
error message on why it can't get an authenticated binding.

[10/11/93 public]
This bug will be fixed when the service ability changes are made
in the 1.1 time frame.  The dcelogin messages are no longer suppressed,
in the dce_config program.



CR Number                     : 5846
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : pmax
S/W Ref Platform              : osf1
Component Name                : dfs
Subcomponent Name             : zlc
Short Description             : zlc_init calls osi_NewProc - bad
Reported Date                 : 10/28/92
Found in Baseline             : 1.0.2
Found Date                    : 10/28/92
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 
Fix By Baseline               : 1.0.2
Fixed In Baseline             : 
Affected File(s)              : zlc_mgr.c
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : 
Transarc Status               : 

[10/28/92 public]

zlc_init() should call osi_ThreadCreate, not osi_NewProc.
Also must #include <dce/ker/pthread.h> for KERNEL builds.

[10/28/92 public]
This is a dup of 5839.  A fix for 5839 has already been submitted.
Changed Status from `open' to `dup' 
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `' 
Added field Transarc Status with value `'



CR Number                     : 5702
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : rpc
Subcomponent Name             : runtime
Short Description             : max_call_requests value in the
API rpc_server_use_all_protseqs() not implemented.
Reported Date                 : 10/19/92
Found in Baseline             : 1.0.1
Found Date                    : 10/19/92
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 
Fix By Baseline               : 1.0.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[10/19/92 public]

The APIs for the functions rpc_server_use_*protseq*() take the
argument max_call_requests.

By looking at the runtime code, it seems to me that the value 
max_call_requests is not taken into account in the current implementation 
of these APIs.

For example, let's take the following call:

rpc_server_use_all_protseqs( unsigned32  max_calls,
		             unsigned32  *status) 

Tracing what happens to max_calls here, I found out that in 
rpc_server_use_protseq_ep() max_calls gets assigned 
rpc_c_protseq_max_reqs_default, which happens to have the
value of zero. Here is what seems to be happening according
to the code.

Excerpt form the file src/rpc/runtime/comnet.c

...
PUBLIC void rpc_server_use_protseq_ep
    (rpc_protseq, max_calls, endpoint, status)

...
...
    /*
     * Until both protocol services fully implement this argument, we'll
     * ignore the value provided and use the default instead.
     */
    max_calls = rpc_c_protseq_max_reqs_default;

...
...

Does this mean that the protocols do not implement this argument yet? 
So making the number of concurrent requests that the server can accept 
equal to zero?  How are the perf tests affected by this bug? 

The documentation indicates everywhere that this value can be set to a 
number greater than zero by the application programmer.
 

Martha DasSarma - dassarma@osf.org

[10/20/92 public]

Please cancel this one.  It's a duplicate of CR #4704, which was cancelled.



CR Number                     : 5679
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : pmax
S/W Ref Platform              : osf1
Component Name                : dfs
Subcomponent Name             : 
Short Description             : Remote client sees old file contents when file overwritten
Reported Date                 : 10/16/92
Found in Baseline             : 1.0.2b4
Found Date                    : 10/16/92
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 5664
Fix By Baseline               : 1.0.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : mcinerny@transarc.com
Transarc Status               : open

[10/16/92 public]
Another data consistency problem, probably related to OT 5664.  Two
machine cell, both PMAX (same one as in 5664) -- one machine running
core + DFS servers, exporting root.dfs; other machine running clients
only.

By accident, on the local DFS client I overwrote a log file used in
a previous test.  Though the new file contents were visible in ufs
and on the local client, the remote client still saw (and still sees
now, maybe half an hour later) the old contents of this file.

The attributes of the file on the remote client have been updated
correctly, but its contents are unchanged from its previous 
incarnation.  There's no corruption visible, just a mismatch between
the attributes and the file contents.

[10/19/92 public]
Assigned to Mike 'cuz 5664 was assigned to him.  Reassign if inappropriate, 
of course.

Filled in Interest List CC with `pakhtar@transarc.com' 
Filled in Responsible Engr. with `kazar' 
Filled in Resp. Engr's Company with `tarc' 
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `mcinerny@transarc.com' 
Added field Transarc Status with value `open'

[10/27/92 public]

I tried this in a two machine cell, one a PMAX and the other an RS/6000,
and it worked.  I was running against the Transarc 1.53 code.  I have marked
it as a dup of 5664 since they are the same problem, inconsistent caches.

Also changed the responsible engineer to kazar@transarc.com.

Changed Status from `open' to `dup' 
Filled in Duplicate Of with `5664' 
Changed Responsible Engr. from `kazar' to `kazar@transarc.com'



CR Number                     : 5643
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : cm
Short Description             : CM loses authentication spuriously
Reported Date                 : 10/14/92
Found in Baseline             : 1.0.2
Found Date                    : 10/14/92
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 5631
Fix By Baseline               : 1.0.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : jaffe@transarc.com
Transarc Status               : open

[10/14/92 public]
Scenario: three machine cell, machine "A" is the primary DFS and DCE server
machine, machine "B" is a DCE client and secondary DFS file server (no
flserver), machine "C" is a DCE and DFS client machine.

As an authenticated user I'd been looking at a source file in the sandbox
(fileset located on machine "B") from machine "C".  I typed the following:

(...)
% cd /:
% cd usr
% ls
aprasad  blumer   bww      fred     jess     ota      travis
azs      bob      cfe      jaffe    jsk      rajesh   tu
bab      bruce    comer    jdp      kazar    sanzi    vijay
blake    bwl      foo      jeff     mason    saxena
% cd mason
% ls
bar  bin  dfs  ff   foo
% cd dfs
% ls
export    link      obj       rc_files  src       tools
% cd src
% ls
Makeconf  file
% cd file/episode/async
% ls
Makefile         asevent.c        async.p.h        us_io.c
RCS              asevent_debug.h  us.h
asev_errs.et     astest.c         us_conf.c
% more asevent.c
(file contents omitted)
% cd ../..
dfs: set auth binding failed (code 12)
dfs: Warning: created unauthenticated binding
../..: The file access permissions do not allow the specified action.
% ls
Makefile         asevent.c        async.p.h        us_io.c
RCS              asevent_debug.h  us.h
asev_errs.et     astest.c         us_conf.c
% cd ../..
../..: The file access permissions do not allow the specified action.
% cd ..
..: The file access permissions do not allow the specified action.
2 Tea-Sea-Shell>dce_login mason mason
% cd /:
% cd usr
% cd mason
% cd dfs
% cd src/file
% cd episode

I suspect the mere fact I can examine the directory after being informed I am
no longer authenticated is because of the bug reported in OT 5625.

I've grabbed the icldump log from machine "C".  Once I've got the OT #, I'll
name it and then edit the OT report to include the location of the icldump
log.

Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `jaffe@transarc.com' 
Added field Transarc Status with value `open'

[10/14/92 public]
I've placed the icldump log in /afs/tr/usr/mason/debug-info/icldump as
ot5643-rios145-14oct92-spurious-building-failure.Z

[12/15/92 public]
This looks like yet another security returning ENOMEM problem.
Changed Status from `open' to `dup' 
Filled in Duplicate Of with `5631'



CR Number                     : 5559
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : pmax
S/W Ref Platform              : osf1
Component Name                : dfs
Subcomponent Name             : /file/episode/libefs/OSF1
Short Description             : Numerous undefined symbols trying to link vmunix.sys.
Reported Date                 : 10/5/92
Found in Baseline             : 1.0.2
Found Date                    : 10/5/92
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 
Fix By Baseline               : 1.0.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[10/5/92 public]
 [ /file/episode/libefs/OSF1 ]
makepath OSF1/. && cd OSF1 &&  exec make MAKEFILE_PASS=BASIC     build_all
/project/dce/build/nb_pmax/tools/pmax/gcc/ld -G 18 -N -T 80030000  -e start -o s
efsvmunix -L/project/dce/build/nb_pmax/export/pmax/usr/lib  ../../../../../../ob
j/pmax/kernel/DCE/vmunix.sys  -lkdfskutil -lktkm -lktpq -lvolreg -lkfp  -lefs -l
kefsops -lkdir -lkeacl -lkanode  -lklogbuf -lkasync -lktools -lkolddacl -lxvnode
 -lktkc -lvolume -lkdacl -lkdacllfs -lkdfskutil  -laggr -lufsops -lkdacl -lknck 
-lkxcred -lkicl -lkosi
/project/dce/build/nb_pmax/tools/pmax/gcc/ld:
Undefined:
rpc_ss_swap_client_alloc_free
rpc_ss_allocate
rpc_ss_free
des_key_sched
sec_des_is_weak_key
des_cbc_cksum
des_ecb_encrypt
des_cbc_encrypt
rpc_ss_register_node
rpc_ss_marsh_change_buff
rpc_ss_return_pointer_to_node
rpc_ss_mem_alloc
rpc_ss_new_recv_buff
rpc_ss_lookup_pointer_to_node
rpc_ss_server_is_set_up
rpc_ss_init_server_once
rpc_ss_create_support_ptrs
rpc_ss_init_node_table
rpc_x_ss_pipe_comm_error
rpc_ss_send_server_exception
rpc_ss_destroy_support_ptrs
rpc_ss_mem_free
rpc_x_ss_remote_comm_failure
rpc_ss_strsiz
rpc_x_invalid_bound
rpc_x_no_memory
rpc_ss_client_is_set_up
rpc_ss_init_client_once
rpc_ss_client_establish_alloc
rpc_ss_call_end
rpc_ss_report_error
ndr_g_ebcdic_to_ascii
ndr_g_ascii_to_ebcdic
*** Error code 1 (continuing)

[10/05/92 public]
Dup of OT 5554.



CR Number                     : 5487
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : pmax
S/W Ref Platform              : osf1
Component Name                : dfs
Subcomponent Name             : tkm
Short Description             : panic in tkm_OutRPC_ReAdd
Reported Date                 : 9/29/92
Found in Baseline             : 1.0.2b2
Found Date                    : 9/29/92
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 4833
Fix By Baseline               : 1.0.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[9/29/92 public]
A panic with the following stack trace occurred on a PMAX running 
Transarc 1.50. 

tkm_OUtRPC_ReAdd
tkm_HostRevokeList_DoRevoke
tpq_Pardo_DoOp
tpq_HelperThread
osi_ThreadBase (called from osi_NewProc_ReleaseCallSpecCell)

The panic was caused by a reference to address zero.  I have seen
this exactly once.  If I see it again, I will bump the priority.

[9/29/92 public]

Well, it appears this is a dup of 4833, which I just re-opened from
"fix".  Since it has been seen twice, I bumped it to B1.  Enjoy.



CR Number                     : 5389
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : thr
Subcomponent Name             : 
Short Description             : intermittent assertion failure in cma
Reported Date                 : 9/15/92
Found in Baseline             : 1.0.2
Found Date                    : 9/15/92
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 2995
Fix By Baseline               : 1.0.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[9/15/92 public]

I have seen intermittently assertion failures from cma:

digital5# cd fs
**** Assertion failure. About to enter kernel when already in kernel.
     at line 409 in ../../../src/threads/cma_errors.c
%Internal DCE Threads problem (version CMA BL10+), terminating execution.
% Reason: assertion failure:  About to enter kernel when already in kernel.
        at line 409 in ../../../src/threads/cma_errors.c
% See 'cma_dump.log' for state information.


We have also seen this on the rios as well.  This shows up randomly during
during the course of configuring and/or running a cell.

[09/16/92 public]
This particular assertion failure is both annoying and misleading,
since it occurs along an error reporting path but is not related to
whatever error has occurred.  The function cma__error() is used
throughout CMA to raise "client-caused errors" as exceptions.  It
asserts that the CMA "kernel" (scheduling database) is not active when
it's called.  This is the assertion that's failing above; naturally,
the failure is masking whatever caused cma__error() to be called in the
first place.

In 1.0.1, this was especially nasty because assertion output involved a
call to cma__error(), meaning that assertion failures at any point
where the CMA database was locked became problematic.  This is no
longer a problem in 1.0.2.

Because I have looked at this already, I'll see if I can come up with
an updated list of "bad" places from which cma__error() can be called
and pass that info to Sekhar (proud new owner of CMA).  The fundamental
choice that needs to be made is either a) to remove the assertion check
from cma__error() or b) to avoid calling cma__error() from any point at
which the scheduling database can be locked.

I will ask Brian Keane of DEC for input on this.

[10/19/92 public]

OT cleanup 1 : Severity = unchanged(B) ; Priority = unchanged(1)
               Assigned to Brian keane.

[10/20/92 public]
This defect is really a dup of 2995.  I'm not marking it that way,
though, so as to preserve the additional information present here.

I did indeed ask Brian about this problem some time ago.  His group
points out that the assertion check in cma__error() is valable, since
the function can be called with the CMA kernel locked.  If thread
rundown tried to lock the kernel again, things would hang.  So I
took choice b) above and tried to locate calls to cma__error() that
could occur with the kernel locked.  The only ones I found were in
cma_defer.c.  For now, I didn't try to eliminate the cma__error()
calls, but preceded them with assertion warnings, so that there would
be explicit output identifying which problematic cma__error()
call was made before the function failed.  (See the source file
for details.)

I think all that can be done for now is to sit back and wait for a
new failure to occur, and see if it happened along one of the code
paths I identified.  If not, there's more analysis to be done, since
presumably I would have missed something.

[11/03/92 public]
Made this a dup of 2995.



CR Number                     : 5316
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 3820, 3773, 5070
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : lfs
Short Description             : Use unified event set handling in FsyncForce
Reported Date                 : 9/2/92
Found in Baseline             : 1.0.2
Found Date                    : 9/2/92
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 5508
Fix By Baseline               : 1.0.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : jaffe@transarc.com
Transarc Status               : open

[9/2/92 public]
The new event set handling code in HandleLogFull (OT 5070) should be
adopted by the FsyncForce code.  This will go a long ways to addressing
the concerns of OT 3820.  See also OT 3773 for some discussion of this
issue.
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `jaffe@transarc.com' 
Added field Transarc Status with value `open'

[9/2/92 public]
Filled in Interest List CC with `mason@transarc.com'

[10/22/92 public]
This work was implemented as part of the delta for OT 5508.

Particularly, I added fsync calls in several places in mp.int.test.
This caused mp.test and mp_repeat.test to fail.  These tests are part of
all_tests.
Changed Status from `open' to `dup' 
Filled in Duplicate Of with `5508'



CR Number                     : 5307
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : lfs
Short Description             : power1 invalid log 920812
Reported Date                 : 9/2/92
Found in Baseline             : 1.0.2
Found Date                    : 9/2/92
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 1020
Fix By Baseline               : 1.0.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : jaffe@transarc.com
Transarc Status               : open

[9/2/92 public]
Copied aggregate to:
    ~ota/de/salvage-data/power1.920812.invalid-log.no_rcvr.Z
Patched AVL_FLAGS to 0.  Running recovery gets:
    CheckAggregate: Unknown code DFS:lgb 6 (609947654) initializing log and running recovery
    Message for 609947654 is 'the specified log was not valid (dfs / lgb)'

Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `jaffe@transarc.com' 
Added field Transarc Status with value `open'

[9/2/92 public]
Changed aggregate name above and added error code translation.

[11/4/92 public]
 The failure here was fixed under 5508 (the pass # field was set to 0,
even though 0 was not valid).

Marked as duplicate.

It really is a dup of 5508; OT will not allow me to mark it as a dup
of 5508 because 5508 > 5307, even though the fix is already done and
about to be submitted to OSF.

Changed Status from `open' to `dup' 
Filled in Duplicate Of with `1020'



CR Number                     : 5249
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : lfs
Short Description             : completed trans handling is badly confused
Reported Date                 : 8/28/92
Found in Baseline             : 1.0.2
Found Date                    : 8/28/92
Severity                      : C
Priority                      : 1
Status                        : dup
Duplicate Of                  : 5508
Fix By Baseline               : 1.0.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : jaffe@transarc.com
Transarc Status               : open

[8/28/92 public]
The handling of completed transactions is very confused.  It was thought
that a transaction had to pin the log until the end record was
successfully written to the disk.  This is only true for external
observers (i.e. a human that is about to pull the power plug from the
wall).  For internal consistency all that is required is that the end
record be successfully formatted into the current log page.  This is
because of the innate serialization of log records.

The result of this confusion is a lot of thrashing around trying to
track completed but uncommitted transactions.  It doesn't presently seem
as if this is causing any bugs but it greatly complicates and confuses
the code.
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `jaffe@transarc.com' 
Added field Transarc Status with value `open'

[10/22/92 public]
This work was completed as part of the delta for 5508.
Changed Status from `open' to `dup' 
Filled in Duplicate Of with `5508'



CR Number                     : 5188
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : bld
Subcomponent Name             : make
Short Description             : exported .h files generated from .idl are re-exported even though .idl unchanged
Reported Date                 : 8/24/92
Found in Baseline             : 1.0.2
Found Date                    : 8/24/92
Severity                      : D
Priority                      : 1
Status                        : dup
Duplicate Of                  : 2135
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : jaffe@transarc.com
Transarc Status               : open

[8/24/92 public]

Because the .h and .c rules for IDL are split, the make process first
builds a .h file in pass one, and then re-creates the .h file in pass
two when client and server stubs are created. If the .h file is
exported it will be spuriously re-exported upon a subsequent build,
although a subsequent build should do nothing if the first one
succeeded.

Were we to ever implement .h file dependencies, this problem will
cause spurious-rebuilds of anything which depends upon it.

Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `jaffe@transarc.com' 
Added field Transarc Status with value `open'

[1/28/93 public]
Deferring this until 1.0.3.  Actually, this will probably be dupped out
eventually because this whole IDL issue will be obsoleted with some of the
code cleanup work scheduled for 1.0.3/1.1.  (I.e., an IDL pass added to the
build procedures.)

[10/15/93 public]

Deferring this for the 1.1 code cleanup.

[1/21/94 public]

Re-assigning this to Mario Moreira who is also working on other idl pass
issues.

[1/24/94 public]
Fixed the misleading description and incorrect inter-related defects line,
dup-ed this to 2135.

I just couldn't resist commenting on this defect since I spent about 2
weeks on it (if not more... my memory is going) when I was a RAT, without 
solving it.  Here is the history:

   This was originally (as indicated by the "Dup of" line value I entered)
reported by IBM as defect 2135.  I think this was during the 1.0.1
timeframe.  At that time, I came up with a solution that addressed the
problem of the files being re-exported, but did not fully address the
secondary issue of .h files generated using .ACF files that are used by
more than one file in a directory to compile (this is explained further
below).  At the time, it was determined that this defect constituted an 
annoyance rather than something that actually caused build errors.  The 
potential for this situation to cause build errors does exist, it has just
never occured.  The behavior causing the defect is described by the
following note that I attached to defect 6709 to prove that 6709 was not a
dup of 5188, but which really ought to be here:

      During the EXPORT includes (FIRST/EXPINC) pass
        idl runs and generates a .h in the obj tree, which is then exported
        to the export tree.  So the dates for the .idl and the two .h files
        now looks like this:
          src              obj               export
         .idl older than   .h  same date as   .h

      During some subsequent pass (ie: EXP[SH]LIB or BASIC):
        idl runs to generate a *_cstub.c, *_sstub.c or some such.  In the
        course of doing this, idl generates a new .h file (generally
        because there is no way to tell idl not to generate a ".h" file,
        though this is not always the case) .  So NOW the 
        dates for the .idl and the two .h's looks like this:
          src              obj               export
         .idl older than   .h  NEWER THAN     .h

      The next time the EXPORT includes (EXPINC/FIRST) pass is run, make 
      performs the following sequence of checks:
         i.  I want to build ../export_tree/.h, it depends on .h. where is 
             .h?  It is here in the obj tree.  
         
        ii.  .h in the obj tree depends on the .idl file.  Where is the .idl
             file?  It is in the src tree.  Is it newer than the .h in the obj
             tree? No.  So the .h in the obj tree is up to date.  (Which is 
             why idl does not regenerate the .h on each EXPORT pass).

       iii.  Is the .h in the obj tree newer than the .h in the export tree?
             YES!  I better tar it/copy -p it out to the export tree.

     So the problem here is how to either make the export version of the
     .h depend on  the .idl file in the src tree, or to avoid changing the
     date on the .h file in the obj tree when the .*stub.c is generated.

     There is another problem hidden in defect 5188 as well.  When the 
     subsequent pass causes idl to regenerate the .h file, it may pick a 
     .acf file that could change the contents of the .h file that is 
     eventually, as described above, to the export tree.

To summarize: there are two problems here:

   1. The annoyance/inefficiency of having the ".h" files re-exported.
   2. The potential for incorrect .h files (ie: incorrect prototypes, etc.)
      to end up out in the export area.  This can happen if:
        i. the .h is exported during the EXPINC pass, and is used to create
           a [cs]stub.c file during a subsequent build pass.
       ii. when the second "idl" is done, a .ACF file is specified for the 
           .idl file  (through ifdefs in the Makefile, changes in the
           search path for idl imports, etc.).
  
Additionally, there is at least one constraint on the solution:

   1. Any .h generated from a .idl during the creation of a [cs]stub.c file
      should remain in the object tree for at least the duration of the
      current build pass in that directory, and possibly for the duration
      of the current build pass (though I would doubt that the latter is
      necessary ).  This is necessary to handle the following case:
         - a .acf is specified for a .idl
         - a number of files in the directory depend on the presence, in the
           generated .h file, of the attribute information from the .acf to
           compile correctly.
      My solution to 2135 did not not handle this case.  My solution was of
      the ilk of my solution to the DATAFILES pass; ie: if the .h I am
      going to generate in the course of generating some [cs]stub.c already
      exists in this directory, then mv (to preserve the mtime) it out of the
      way, generate the [cs]stub.c and the new .h, compile the [cs]stub.o,
      and the move the original .h back.  I was only able to make this work
      on a file by file basis (though I think it could be done for the
      directory as I think of it now).

This defect could conceivably addressed with a combination of the
following:
   1. Education  - make sure developers understand the problem and help
                   them to structure their makefiles and directory trees so
                   as to avoid the problem.
   2. IDL mods   - allow idl to either not generate a .h file, or make it
                   possible to specify the name of the generated .h. 
   3. Makefile mods - I can't think of any politically correct makefile
                      mods that will solve this problem (though of course
                      that does not mean such are non-existant).  I could
                      probably produce at least one politically incorrect 
                      solution if it was absolutely necessary.
   4. "make" mods - This whole area is pretty un-PC these days, but I
                    opened a defect on make while working on this defect
                    because one general solution was unavailable to me due
                    to a limitation in the behavior of the ":M" expansion 
                    modifier in "make".  It is not clear from the
                    description of the ":M" modifier that what I perceived
                    as a defect in fact was such, but if the finctionality
                    requested in the defect report was available, the
                    problem could be addressed in the Makefiles.  
                    You could also add the forbidden "only look in the 
                    source tree for this thing" semantic of the CMU make
                    to our make.

Or we could just not do anything until this is proven to be more than an 
annoyance issue.   Good Luck Mario.



CR Number                     : 5025
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : dfs
Subcomponent Name             : cm
Short Description             : Cache manager failed to pass cthon/test3 on the client(rios).
Reported Date                 : 8/12/92
Found in Baseline             : 1.0.2
Found Date                    : 8/12/92
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 5292
Fix By Baseline               : 1.0.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : jaffe@transarc.com
Transarc Status               : closed

[8/12/92 public]
It is four machine cell configured by dfs-102-1.46 backed by 0730 osf daily.
Running cthon/test3 on a rios client against a rios server results a failure
of "getwd()" in the test.

./test3: Calls to getwd() and stat()
./test3: getwd failed
0.2u 0.17s 0:02 6% 13+2k 0+0io 2pf+0w
Exit status was 1

Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `jaffe@transarc.com' 
Added field Transarc Status with value `open'

[9/2/92 public]
This is a dup of the ENOTTY bug.
Filled in Duplicate Of with `5292' 
Changed Transarc Status from `open' to `export'

[9/2/92 public]
changing Status to ``dup'' so it doesn't look open.
Changed Status from `open' to `dup' 
Changed Transarc Status from `export' to `closed'



CR Number                     : 4821
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : repserver
Short Description             : repserver multi-threading support broken
Reported Date                 : 7/24/92
Found in Baseline             : 1.0.1
Found Date                    : 7/24/92
Severity                      : D
Priority                      : 3
Status                        : dup
Duplicate Of                  : 1132
Fix By Baseline               : 1.0.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : jaffe@transarc.com
Transarc Status               : closed

[7/24/92 public]
I thought that this was already in the OT database, but I could be wrong.
The replication server (repserver) cannot currently be run with more than
one main process thread due to some deficiencies in the locking model that
it uses.  There's a small matter of programming to make it do the
assembly of lots of tasks together in a multi-thread-safe manner.
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `jaffe@transarc.com' 
Added field Transarc Status with value `open'

[8/13/92 public]
This is a duplicate of (deferred) bug 1132.
Changed Status from `open' to `dup' 
Filled in Duplicate Of with `1132' 
Changed Transarc Status from `open' to `closed'



CR Number                     : 4622
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : other
S/W Ref Platform              : other
Component Name                : cfg
Subcomponent Name             : dce_config
Short Description             : Client configuration dependent on -dce- password.
Reported Date                 : 7/6/92
Found in Baseline             : 1.0.1
Found Date                    : 7/6/92
Severity                      : C
Priority                      : 1
Status                        : dup
Duplicate Of                  : 576
Fix By Baseline               : 1.0.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[7/6/92 public]

dce_config assumes a password for cell_admin of -dce- when
configuring DCE client nodes.  If you change the password
for cell_admin, you are unable to configure dce clients.

This is a security hole in dce_config.  If it is possible,
calls to dce_login_noexec should be made to prompt for
the password.

[7/7/92 public]
This is a dup of OT576 which is an enhancement.  The workaround is 
to change the value of $cellpw in dce_config before config'ing the
client.

[7/7/92 public]

This defect covers more area that 576.  OT576 stated that
cdsd would not start if the cell_admin password is changed.
However, a bigger problem is that once a cell is up
and running, an administrator is forced to change the
password back to -dce- in order to configure a node as
a client of an existing cell.  

I believe this should be a bug rather than an enhancement.
In addition, I do not believe that the workaround is acceptable
for 1.0.1.  Even with the workaround, the cell_admin password has to
be available in the script during the time that an
administrator is configuring a new client.  That means another person
could look at the script during this time and then dce_login
as cell_admin.  Once in, the person could set acls and
compromise the security of the cell.  Even if the password were
set by an environment variable, this compromise could still occur.
Since any user can dce_login as cell_admin on any node that
is a member of the cell such a compromise could easily be achieved.

If the 1.0.1 DCE offering is intended to be used by customers
in a production environment, a security hole such as this
needs to be closed up.

This defect should be reopened and fixed for 1.0.1 .



CR Number                     : 4525
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : other
S/W Ref Platform              : other
Component Name                : cds
Subcomponent Name             : cdscp,cdsd
Short Description             : Allows modification of CDS_ObjectUUID for child entries.
Reported Date                 : 6/30/92
Found in Baseline             : 1.0.1b19
Found Date                    : 6/30/92
Severity                      : C
Priority                      : 1
Status                        : dup
Duplicate Of                  : 3523
Fix By Baseline               : 
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[6/30/92 public]

CDS curently allows the user to modify the CDS_ObjectUUID attribute
of a child entry.  This should not be allowed.

Steps to Reproduce:

cdscp create directory /.:/test
cdscp set child /.:/test CDS_ObjectUUID 0AC90A68-D545-11CA-800C-080009123495



CR Number                     : 4459
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 3383, 8133
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : cds
Subcomponent Name             : cdsd
Short Description             : mem leak create/del objects
Reported Date                 : 6/25/92
Found in Baseline             : 1.0
Found Date                    : 6/25/92
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 3383
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[6/25/92 public]

cdsd will double in size after two hours of heavy maniputlation
of objects, the space is not reclaimed after all the objects are
deleted.  If the test is run again, cdsd will continue to 
grow bigger.  Ron Karr (sni) examined the chain of memory (created
by dns_malloc) and found (after the first 10 enties) all the 
leftover memory had been created by a routine build_record in the
file db_entry at line 421 (a call to dns_malloc_tmp).

[7/13/92 public]

See comment in CR 3383. Basically the fix for this problem requires
architectural work in the server. We will address it in a subsequent
version of CDS. This was agreed to at last Thursday's project management
meeting.



CR Number                     : 4302
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : cds
Subcomponent Name             : cdsd
Short Description             : CDS not responding.
Reported Date                 : 6/17/92
Found in Baseline             : 1.0.1b18
Found Date                    : 6/17/92
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 4741
Fix By Baseline               : 1.0.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : mason@transarc.com
Transarc Status               : open

[6/17/92 public]

I was attempting to run some DFS tests on a single machine to see just how
long the tests would run.  Well, after about 2 hours the tests got hung up.
I looked around to see what was going on, and it appeared that CDS was not
responding, nor timing out.  Here are the results of a show dir inside of
cdscp.

cdscp> show dir /.../dfstest.transarc.com

                        SHOW
                   DIRECTORY   /.../dfstest.transarc.com
                          AT   1992-06-15-12:36:14
Error on entity: /.../dfstest.transarc.com
Error with socket (dce / cds)
Function: dnsEnumAttr

The error messages only appeared after I hit CTRL-C.  At that point I had
waited over a minute.  A show dir on /.../dfstest.transarc.com/fs had the 
same results.  Also any attempt to cd to, or ls files in DFS just hung.
While the above command was executing I issued some ps calls to see what
cds was doing.  Here are the results.

ps axuw | fgrep cds
    root  2152 1.6%   5%  2456  1548      -    S 62:36 /opt/dcelocal/bin/cdscler
k -U root -u 0 -m 2
    root  4704 1.3%   2%   940   792      -    S 49:12 cdsadv
    root  5478 0.9%   7%  2948  2248      -    S 33:36 cdsd
    root 18107 0.2%   2%   476   788      -    S  0:03 /opt/dcelocal/bin/cdscler
k -U DNS$SERVER -u 0 -m 2
    root 18651 0.2%   2%   528   744  pts/2    S  0:01 cdscp
    root 19694 0.0%   0%    96   132  pts/3    S  0:00 fgrep cds
# !!
ps axuw | fgrep cds
    root  2152 1.6%   5%  2456  1548      -    S 62:36 /opt/dcelocal/bin/cdscler
k -U root -u 0 -m 2
    root  4704 1.3%   2%   940   792      -    S 49:12 cdsadv
    root  5478 0.9%   7%  2948  2248      -    S 33:37 cdsd
    root 18107 0.2%   2%   476   788      -    S  0:03 /opt/dcelocal/bin/cdscler
k -U DNS$SERVER -u 0 -m 2
    root 18651 0.2%   2%   528   744  pts/2    S  0:01 cdscp
    root 19696 0.0%   0%    96   132  pts/3    S  0:00 fgrep cds
# !!
ps axuw | fgrep cds
    root  2152 1.6%   5%  2456  1548      -    S 62:37 /opt/dcelocal/bin/cdscler
k -U root -u 0 -m 2
    root  4704 1.3%   2%   940   792      -    S 49:12 cdsadv
    root  5478 0.9%   7%  2948  2248      -    S 33:37 cdsd
    root 18107 0.2%   2%   476   788      -    S  0:03 /opt/dcelocal/bin/cdscler
k -U DNS$SERVER -u 0 -m 2
    root 18651 0.2%   2%   528   744  pts/2    S  0:01 cdscp
    root 19698 0.0%   0%    96   132  pts/3    S  0:00 fgrep cds
# !!
ps axuw | fgrep cds
    root  2152 1.6%   5%  2456  1548      -    S 62:38 /opt/dcelocal/bin/cdscler
k -U root -u 0 -m 2
    root  4704 1.3%   2%   940   792      -    S 49:12 cdsadv
    root  5478 0.9%   7%  2948  2248      -    S 33:37 cdsd
    root 18107 0.2%   2%   476   788      -    S  0:03 /opt/dcelocal/bin/cdscler
k -U DNS$SERVER -u 0 -m 2
    root 18651 0.3%   2%   528   744  pts/2    S  0:02 cdscp
    root 19700 0.0%   0%    96   132  pts/3    S  0:00 fgrep cds
# !!
ps axuw | fgrep cds
    root  2152 1.6%   5%  2456  1548      -    S 62:38 /opt/dcelocal/bin/cdscler
k -U root -u 0 -m 2
    root  4704 1.3%   2%   940   792      -    S 49:14 cdsadv
    root  5478 0.9%   7%  2948  2248      -    S 33:37 cdsd
    root 18107 0.2%   2%   476   788      -    S  0:03 /opt/dcelocal/bin/cdscler
k -U DNS$SERVER -u 0 -m 2
    root 18651 0.3%   2%   528   744  pts/2    S  0:02 cdscp
    root 19702 0.0%   0%    96   132  pts/3    S  0:00 fgrep cds
# !!
ps axuw | fgrep cds
    root  2152 1.6%   5%  2456  1548      -    S 62:40 /opt/dcelocal/bin/cdscler
k -U root -u 0 -m 2
    root  4704 1.3%   2%   940   792      -    S 49:14 cdsadv
    root  5478 0.9%   7%  2948  2248      -    S 33:38 cdsd
    root 18107 0.2%   2%   476   788      -    S  0:03 /opt/dcelocal/bin/cdscler
k -U DNS$SERVER -u 0 -m 2
    root 18651 0.3%   2%   528   744  pts/2    S  0:02 cdscp
    root 19704 0.0%   0%    96   132  pts/3    S  0:00 fgrep cds
# !!
ps axuw | fgrep cds
    root  2152 1.6%   5%  2456  1548      -    S 62:41 /opt/dcelocal/bin/cdscler
k -U root -u 0 -m 2
    root  4704 1.3%   2%   940   792      -    S 49:16 cdsadv
    root  5478 0.9%   7%  2948  2248      -    S 33:39 cdsd
    root 18107 0.2%   2%   476   788      -    S  0:03 /opt/dcelocal/bin/cdscler
k -U DNS$SERVER -u 0 -m 2
    root 18651 0.2%   2%   528   744  pts/2    S  0:02 cdscp
    root 19707 0.0%   0%    96   132  pts/3    S  0:00 fgrep cds
# !!
ps axuw | fgrep cds
    root  2152 1.6%   5%  2456  1504      -    S 62:44 /opt/dcelocal/bin/cdscler
k -U root -u 0 -m 2
    root  4704 1.3%   2%   940   792      -    S 49:18 cdsadv
    root  5478 0.9%   7%  2948  2192      -    S 33:40 cdsd
    root 18107 0.2%   2%   476   788      -    S  0:04 /opt/dcelocal/bin/cdscler
k -U DNS$SERVER -u 0 -m 2
    root 18651 0.3%   2%   572   788  pts/2    S  0:03 cdscp
    root 19981 0.0%   0%    96   132  pts/3    S  0:00 fgrep cds

I should point out that this system was installed/configured with the
RPC_SUPPORTED_PROTSEQS variable set to ncadg_ip_udp.  However prior to
starting the tests I re-booted the machine, just to make sure I was starting
clean.  When I ran the rc.dce and rc.dfs files after re-boot I did not set the 
RPC_SUPPORTED_PROTSEQS variable.
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `mason@transarc.com' 
Added field Transarc Status with value `open'

[10/12/92 public]
Dup of 4741.



CR Number                     : 4194
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : lfs
Short Description             : salvage refuses to fix allocation mismatch
Reported Date                 : 6/10/92
Found in Baseline             : 1.0.1
Found Date                    : 6/10/92
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 4192
Fix By Baseline               : 1.0.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : jdp@transarc.com
Transarc Status               : open

[6/10/92 public]
We encountered an aggregate which, after fixing many indirect block
errors, cannot be salvaged into an error free condition.  It looks like
it is trying to repair the allocated field of two anodes twice, once
from 0 to 1(2) and then later from 1(2) back to zero.  The output looks
like this:
    W% $epiobj/salvage/salvage /tmp/salvage-data/lastIndex
    Salvaging /tmp/salvage-data/lastIndex
    Will run recovery on /tmp/salvage-data/lastIndex
    epia_VerifyAnode: anode allocated (0)/calculcated (1) mismatch
    Repairing allocated mismatch
    epia_VerifyAnode: anode allocated (0)/calculcated (2) mismatch
    Repairing allocated mismatch
    epia_VerifyAnode: anode allocated (1)/calculcated (0) mismatch
    Repairing allocated mismatch
    epia_VerifyAnode: anode allocated (2)/calculcated (0) mismatch
    Repairing allocated mismatch
    Processed 2 vols 106 anodes 7 dirs 113 files 0 acls
    Done.  /tmp/salvage-data/lastIndex checks out as Episode aggregate.
    W%

The offending aggregate is taking up space in:
    ~ota/de/salvage-data/gemini.920610.alloc_mismatch.Z.
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `jdp@transarc.com' 
Added field Transarc Status with value `open'

[6/12/92 public]
Changed Status from `open' to `dup' 
Filled in Duplicate Of with `4192'



CR Number                     : 4143
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : dfs
Subcomponent Name             : cm
Short Description             : DFS cache manager generates authentication warnings.
Reported Date                 : 6/9/92
Found in Baseline             : 1.0.1b18
Found Date                    : 6/9/92
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 4026
Fix By Baseline               : 1.0.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : mason@transarc.com
Transarc Status               : open

[6/9/92 public]

I was running test in a two  machine cell, one a server the other a
client.  The tests were being run from the client in a UFS fileset.  I was
also running unauthenticated and had set the environment variable
RPC_SUPPORTED_PROTSEQS to ncadg_ip_udp.  I got the following error message.

dfs: set authen binding failed (code 12)
dfs: Warning: create an unauthenticated binding

Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `mason@transarc.com' 
Added field Transarc Status with value `open'

[6/9/92 public]
I believe that this may duplicate an existing defect. I'm unable to find
the duplicate at this time.
Filled in Interest List CC with `kazar@transarc.com' 
Changed Responsible Engr. from `pakhtar@transarc.com' to `tu@transarc.com'

[6/9/92 public]
This is actually a duplication of OT#4026. It looks like the problem 
could result from a "bad" environment. Error code (=12) indicated that 
the system did not have enough core memory.

[6/9/92 public]
This defect is the same as in OT 4026. Hence copying all the entries in this
defect to OT 4026 and marking this a duplicate as suggested by Mr. Akhtar.

Changed Interest List CC from `kazar@transarc.com' to `kazar@transarc.com, 
 rajesh@transarc.com, bk@transarc.com' 
Changed Status from `open' to `dup' 
Filled in Duplicate Of with `4026'



CR Number                     : 4094
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : pmax
S/W Ref Platform              : osf1
Component Name                : dfs
Subcomponent Name             : episode
Short Description             : dfsexport on episode returns ENXIO
Reported Date                 : 6/5/92
Found in Baseline             : 1.0.1b18
Found Date                    : 6/5/92
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 
Fix By Baseline               : 1.0.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[6/5/92 public]
More precisely, the error message is:

dfsexport: Failed to attach /dev/rz1d:/episode (err=6).  Ignoring it.

This is using the kernel out of the 6/4 nightly build with core components 
out of last weekend's nightly build.  I started tracking the problem using 
kdb and the error appears to be coming from epig_InitAggregate() within 
ag_efsAttach().

I am able to export UFS partitions (at least root.dfs) just fine.

The partition being exported was not mounted locally at the time.
"salvage -verify" reports that the partition "checks out" as an
Episode aggregate.

[6/5/92 public]
This is a dup of 3839.



CR Number                     : 3980
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : aix
Component Name                : dfs
Subcomponent Name             : cm
Short Description             : DFS cache manager loses context with fx server.
Reported Date                 : 6/2/92
Found in Baseline             : 1.0.1b17
Found Date                    : 6/2/92
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 
Fix By Baseline               : 1.0.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : tu-ot3048-cm-stateserver-wrong 1.4
Transarc Herder               : mason@transarc.com
Transarc Status               : submit

[6/2/92 public]

I get the following message after I have had a DFS system up for awhile.

dfs: Warning: losts the context from fx server192.55.207.63 in cell dfstest.transarc.com !

I then tried to do an ls inside of a DFS directory and got the following 
message

ls: 0653-341 The file . does not exist.

A pwd returns,

pwd: A remote host did not respond within the timeout period.

This occurs on a single machine.

Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `mason@transarc.com' 
Added field Transarc Status with value `open'

[06/02/92 public]

This is a duplicate of 3968

[6/2/92 public]
This one is fixed. The fix has been already been in Transarc's 
May 29 submit to OSF. 
Changed H/W Ref Platform from `rs6000' to `all' 
Filled in Interest List CC with `cfe@transarc.com' 
Filled in Responsible Engr. with `tu@transarc.com' 
Filled in Transarc Deltas with `tu-ot3048-cm-stateserver-wrong 1.4' 
Changed Transarc Status from `open' to `'

[6/3/92 public]
This was submitted 6/1.
Filled in Transarc Status with `submit'



CR Number                     : 3875
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 2306
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : rpc
Subcomponent Name             : 
Short Description             : 
Failure when generating a login context with a long PAC.
Reported Date                 : 5/27/92
Found in Baseline             : 1.0
Found Date                    : 5/27/92
Severity                      : C
Priority                      : 3
Status                        : dup
Duplicate Of                  : 2306
Fix By Baseline               : 1.0.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[5/27/92 public]

Full Description:

        Registry data setup:

        Principal   : user1
        Groups      : group_001  to group_1000  (1000 groups)
        Orgs        : org_001    to org_1000    (1000 orgs)

        Steps :
        1.  Make user1 be member of group_001 to group_1000
        2.  Make user1 be member of org_001 to org_1000
        3.  Create an account user1.group_001.org_001
        4.  Logon to the account.

        Outputs : Fatal error rpc_mem_alloc. Memory allocation failed at
                  rpcmem.c \31.

Proposed Solution:

        None researched.

[5/27/92 public]
Changed to C3 from B1 since it's not preventing anybody from getting work done,
and the workaround is "don't do that".  This is caused by the same problem as
CR2306, so marked as a 'dup' of that and deferred it since it will not be fixed
in 1.0.1.  See writeup in 2306 for the upper bound on PAC sizes.



CR Number                     : 3815
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dfs
Subcomponent Name             : lfs
Short Description             : Re-evaluate episode open file limit.
Reported Date                 : 5/26/92
Found in Baseline             : 1.0.1
Found Date                    : 5/26/92
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 2340
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : mason@transarc.com
Transarc Status               : open

[5/26/92 public]
This is tr defect #2042.
The current Episode open file limit is 128.  What should it be?
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `mason@transarc.com' 
Added field Transarc Status with value `open'

[7/20/92 public]
Changed "Fix by" to 1.0.2

[11/2/92 public]
This defect deserves a priority much higher than a D 3!  128 simultaineous
opens is no where near enough.  For example the AIX JFS supports
a base of 4000 opens + a number based on the amount of physical
memery on the machine (approx. 32 more opens for each meg).
I would say Episode at least needs to support at least 2000 simultaneous
opens on a moderatly configured machine (ie. 16+ meg).
Filled in Interest List CC with `demail1!carl' 
Changed Severity from `D' to `A' 
Changed Priority from `3' to `1'

[11/3/92 public]
 I'm reassigning to myself; while we can change the limits
artificially by increasing the defaults, I believe the real solution
here is to modify dce_config to ask on setup; I've just finished
changing rc.dfs and dce_config to use dcelfs on AIX and epiinit on
OSF/1; the next task is to add some additional steps when setting up
LFS to prompt for the requisite information and use that as the
initialization parameters.
In the meantime, the work-around is to modify your rc.dfs to use the
correct switches.  For AIX:
  /opt/dcelocal/ext/cfglfs -a <filename> [-single] [-remote] [-bcache
  <1K blocks>] [-vnodes <num vnodes>] [-anodes <num anodes>] [-dircache
  <buffers>] [-locks <num locks>]
For OSF/1:
  /opt/dcelocal/bin/epiinit [-single] [-remote] [-bcache <1K blocks>]
  [-vnodes <num vnodes>] [-anodes <num anodes>] [-dircache <buffers>]
  [-locks <num locks>]
(note the similarity between the two systems...)
I'd suggest the following for a typical 32MB AIX system:
cfglfs -a dcelfs.ext -vnodes 2000 -anodes 2000 -dircache 32 -locks 32
Increase the # of locks if you expect to use flock substantially.
For OSF/1 I'd suggest:
epiinit -bcache 1024 -vnodes 1000 -anodes 1000 -dircache 32 -locks 32
because LFS buffers data as well as meta-data.
Finally, FYI, the default is:
<initcmd> -bcache 384 -vnodes 128 -anodes 1024 -dircache 15 -locks 15
src/file/episode/utils/epiinit.c
I've lowered severity because the tools are there and are even
documented.  The problem is really in the configuration stuff.
Changed Interest List CC from `demail1!carl' to `demail1!carl,bwl,ota,rsarbo' 
Changed Severity from `A' to `B' 
Changed Responsible Engr. from `bwl@transarc.com' to `mason@transarc.com'

[11/16/92 public]
 This really is a dup of 2340.  The facilities for using a higher
limit are there.  Each vendor is going to have to decide on the
"right" set of limits.  Setting it artificially high means that a
vendor might miss setting it correctly, while setting it low assures
someone will stumble across it and try to make the right decision.
Changed Status from `open' to `dup' 
Filled in Duplicate Of with `2340'



CR Number                     : 3720
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : dfs
Subcomponent Name             : tkm
Short Description             : tkm_test.l and tkm_test.y were defuncted but not removed out of machine dependenct Makefile
Reported Date                 : 5/21/92
Found in Baseline             : 1.0.1
Found Date                    : 5/21/92
Severity                      : A
Priority                      : 0
Status                        : dup
Duplicate Of                  : 
Fix By Baseline               : 1.0.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : 
Transarc Status               : 

[5/21/92 public]
There were two instances of make: don't know how to make, one
each for tkm_test.l and tkm_test.y in file/tkm.  According to
the submit log the two files were defuncted, apparently the
RIOS/Makefile in file/tkm was not updated and expected to
build them.

[5/21/92 public]
This is a duplicate of 3719 a fix for which has already been submitted.
Changed Status from `open' to `dup' 
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `' 
Added field Transarc Status with value `'



CR Number                     : 3480
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : other
S/W Ref Platform              : other
Component Name                : sec
Subcomponent Name             : security/client/key_mgmt/keymgmt.c
Short Description             : In keymgmt.c, argument passed
by reference when it should not be.
Reported Date                 : 5/14/92
Found in Baseline             : 1.0
Found Date                    : 5/14/92
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 3145
Fix By Baseline               : 1.0.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[5/14/92 public]

Full Description:

        In function sec_key_mgmt__login, a sec_login_handle_t * is passed
        by reference to sec_login_purge_context. Passing the
        sec_login_handle_t * on its own is correct.
Proposed Solution:

        The line

        sec_login_purge_context(&lc, &lst);

        ought to be replaced by

        sec_login_purge_context(lc, &lst);

[5/14/92 public]
This is a duplicate of 3145 that was closed on 4/30/92



CR Number                     : 3476
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : pmax
S/W Ref Platform              : osf1
Component Name                : cds
Subcomponent Name             : cdscp
Short Description             : Apparent server crash after
stress test
Reported Date                 : 5/14/92
Found in Baseline             : 1.0.1b15
Found Date                    : 5/14/92
Severity                      : A
Priority                      : 1
Status                        : dup
Duplicate Of                  : 3383
Fix By Baseline               : 1.0.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[5/14/92 public]
Running a looping test which contains the commands listed below the
error "RPC protocol not supported by this auth protocol (dce / rpc)"
occurred after 10 hours of running on a single machine cell.  The
test had looped 135+ times before the error appeared.  Once the error
occurred all the following commands also failed.  The error "Unable to
communicate with any CDS server (dce / cds)" also appeared several times.

Looping Test Commands:

cdscp create directory /.:/TESTDIR
cdscp list dir /.:/TESTDIR
cdscp set dir /.:/TESTDIR to skulk
cdscp create directory /.:/TESTDIR/testdir
cdscp show dir /.:/TESTDIR/testdir
cdscp cre dir /.:/TESTDIR/testdir/w0
cdscp list dir /.:/TESTDIR/testdir/w0
cdscp cre obj /.:/TESTDIR/testdir/w0/x0.object CDS_Class = object_class CDS_ClassVersion = 1.0
cdscp show obj /.:/TESTDIR/testdir/w0/x0.object
cdscp cre link /.:/TESTDIR/testdir/w0/x0.softlink CDS_LinkTarget = /.:/TESTDIR/testdir/w0/x0.object
cdscp show link /.:/TESTDIR/testdir/w0/x0.softlink
cdscp del link /.:/TESTDIR/testdir/w0/x0.softlink
cdscp show link /.:/TESTDIR/testdir/w0/x0.softlink
cdscp del obj /.:/TESTDIR/testdir/w0/x0.object
cdscp show obj /.:/TESTDIR/testdir/w0/x0.object
cdscp del dir /.:/TESTDIR/testdir/w0
cdscp show dir /.:/TESTDIR/testdir/w0
cdscp delete directory /.:/TESTDIR/testdir
cdscp show dir /.:/TESTDIR/testdir
cdscp delete directory /.:/TESTDIR
cdscp show dir /.:/TESTDIR

[5/14/92 public]
Not sure why this is should be an A0.

[05/14/92 public]
I made this an A0 because I felt that our system tests will not function
for the required 48 hours if this 21 command test can only run 10 hours
on a single machine cell.  The system tests will involve running at least
four looping cds tests on eight machines in one cell accessing one CDS
server.

[05/15/92 public]
Discussed priority with Mark Fox, agreed to lower priority from 0 to 1.

[5/18/92 public]

Changed short description to: Apparent server crash after stress test.

The issue of error "RPC protocol not supported by this auth protocol" is
not related and fixed in RPC.  The issue of the server not reachable is the
crux of this bug.

[5/19/92 public]
This is a dup of 3383.



CR Number                     : 3441
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : cds
Subcomponent Name             : cdscp
Short Description             : cdscp writes error output to stdout
Reported Date                 : 5/13/92
Found in Baseline             : 1.0.1b14
Found Date                    : 5/13/92
Severity                      : D
Priority                      : 3
Status                        : dup
Duplicate Of                  : 3426
Fix By Baseline               : 1.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[5/13/92 public]
Cdscp writes its error output to stdout, for instance:

# cdscp sho dir /.:/nonexistent >/dev/null
# 

This prevents system tests from filtering its copious normal output.

[5/13/92 public]
Duplicate of 3426 - cdscp outputs errors to stdout instead of stderr



CR Number                     : 3405
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : cds
Subcomponent Name             : cdsclerk
Short Description             : Seems to be spinning after running dce_config.
Reported Date                 : 5/12/92
Found in Baseline             : 1.0.1b13
Found Date                    : 5/12/92
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 
Fix By Baseline               : 1.0.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : mason@transarc.com
Transarc Status               : open

[5/12/92 public]

After running dce_config and configuring the mahcine as a DCE/DFS server
CDS seems to be lost.  I try to ls my cell directory (/.../<cellname>)
and it never returns.  I noticed that cdsclerk is using 11 percent of 
the cpu, so I ran dbx and attached to it.  Here's the stack trace.

(dbx) where
cma__io_available(0x0, 0x0, 0x200ce970) at 0xd030c6dc
cma___null_thread(0x0) at 0xd0309a00
cma__thread_base(0x20084b18) at 0xd0317690
cma__restore_thread_ctx() at 0xd030fa00
cma__io_available(0x0, 0x0, 0xaceface) at 0xd030c6dc

I don't know if this helps since my understanding is dbx does not 
understand dce threads.

Once I reboot the machine and restart the dce and dfs everything is OK.

Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `mason@transarc.com' 
Added field Transarc Status with value `open'

[4/12/92 public]
This is a duplicate of CR 2435 - cdsclerk runs on and on... A work-around
is to set BIND_PE_SITE.



CR Number                     : 3209
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : other
S/W Ref Platform              : other
Component Name                : dts
Subcomponent Name             : src/time/common/utcapi.c
Short Description             : DTS...utc_mkgmtime accepts invalid tm struct (e.g. tm_sec = -1)
Reported Date                 : 5/2/92
Found in Baseline             : 1.0
Found Date                    : 5/2/92
Severity                      : B
Priority                      : 2
Status                        : dup
Duplicate Of                  : 
Fix By Baseline               : 1.0.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[5/2/92 public]

Full Description:

  No checking on the range of each individual member of the tm structure.
  For example, utc_mkgmtime() accepts a time structure with tm_sec = -1
  and returns a utc binary time.

  The expected result in this case is utc_mkgmtime() returns -1.


Proposed Solution:

 Add parameter checking in the mergetime routine called by utc_mkgmtime.



/*
 *++
 *  mergetime()
 *
 *  Functional Description:
 *
 *      Merges a time in a tm struct into a 64-bit time
 *
 *  Inputs:
 *
 *      tm - pointer to tm struct which contains time
 *      tns - longword which contains nanosec of time
 *
 *  Implicit Inputs:
 *
 *
 *  Outputs:
 *
 *      timep - pointer to 64-bit time value
 *      seconds - pointer to 64-bit seconds since UNIX epoch
 *                (used for TDF calculations)
 *
 *  Implicit Outputs:
 *
 *
 *  Value Returned:
 *      0 - if the operation is successful                    <== NEW*
 *          if seconds is NULL, no value returns in seconds   <== NEW*
 *          and timep                                         <== NEW*
 *      operation fail if there is no tm input                <== NEW*
 *
 *  Side Effects:
 *
 *
 *--
 */
static int mergetime(tm, tns, timep, seconds)

struct tm *tm;
long tns;
UTCValue *timep;
UTCValue *seconds;

{
    long        year, month, days;

    if (tm == NULL) {                 /* any tm input ?       <== NEW*/
DBG(("mergetime: err tm is NULL\n"));                      /*<== NEW*/
       return(-1);                    /* error if none        <== NEW*/
    }                                                      /* <== NEW*/

    year = tm->tm_year + 1900;
    if (year < -27646 || year > 30809) {                   /* <== NEW*/
DBG(("mergetime: err year out of range\n"));               /*<== NEW*/
        return(-1);
    }                                                      /* <== NEW*/

    month = tm->tm_mon + 1;
    days = tm->tm_mday + 365*(year - 1) + (year - 1)/4;
    if (year > 1582 ||
        (year == 1582 && (month > 10 ||
                          (month == 10 && tm->tm_mday > 14)))) {
        days += - (year - 1)/100 + (year - 1)/400;
        days -= GREGORIAN_OFFSET;
    } else {
        if (year == 1582 && month == 10 &&
            tm->tm_mday > 4 && tm->tm_mday < 15) {         /* <== NEW*/
DBG(("mergetime: err invalid 1582 date\n"));               /*<== NEW*/
                return (-1);
             }                                             /* <== NEW*/
        days -= JULIAN_OFFSET;
    }

/*  if (month > 2 && IsLeapYear(year))         (Ref P00188)   <== NEW*/
/*      days += 1;                             (Ref P00188)   <== NEW*/
    if (days > 0) {                        /* -ve days ?      <== NEW*/
       if (month > 2 && IsLeapYear(year))  /* leap year ?     <== NEW*/
          days += 1;                       /* add day if req  <== NEW*/
    } else {                               /* +ve day         <== NEW*/
       if (month <= 2 && IsLeapYear(year)) /* leap year ?     <== NEW*/
          days -= 1;                       /* dec day for -ve <== NEW*/
    }                                      /* (-ve day)       <== NEW*/
    days += monthToDays[tm->tm_mon];

    if (seconds == NULL)              /* if output nothing    <== NEW*/
       return(0);                     /*    return            <== NEW*/
    emul(days, SECS_PER_DAY, seconds);
    UTCiAdd(seconds, (tm->tm_hour * MINS_PER_HOUR +
                      tm->tm_min) * SECS_PER_MIN +
                      tm->tm_sec, seconds);

    if (timep != NULL) {              /* output timep ?       <== NEW*/
       UTCiMul(seconds, K_100NS_PER_SEC, timep);
       UTCiAdd(timep, (tns + 50)/100, timep);
    }                                 /* (output timep)       <== NEW*/
    UTCadd(seconds, &diff_UTC_UNIX_secs, seconds);

    return(0);
}
/* End of routine mergetime */

[5/5/92 public]

    This is an EXACT duplicate of defect 2832. I've changed it Status,
    duplicate. FURTHER, I strongly feel this is a completely inappropriate
    fix. It reduces performance and generates behaviour which is incompatible
    with UNIX mktime. This defect should be canceled.



CR Number                     : 3188
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : other
S/W Ref Platform              : other
Component Name                : dts
Subcomponent Name             : dtsd
Short Description             : DTS...A Clock Drift of zero causes a divide-by-zero condition [Could be related to CR# 2862]
Reported Date                 : 4/30/92
Found in Baseline             : 1.0
Found Date                    : 4/30/92
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 
Fix By Baseline               : 1.0.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[4/30/92 public]

One Line Description:

    A Clock Drift of zero causes a divide-by-zero condition

Full Description:

    No check performed against ClockDrift = 0 in routine ReadHwclkParams
    that can cause divide by zero condition.

Proposed Solution:

In src/time/service/clock_adjust_ultrix.c

 *
 * Description:
 *
 *     Read the hardward clock parameters drift and resolution.
 *
 * Inputs:
 *
 *      none
 *
 * Outputs:
 *
 *     clockResolution -  the resolution of the clock in nano seconds
 *     clockDrift - the maximum clock drift in parts per billion (10**9).
 *
 * Return Value:
 *
 *      none
 *
 */
StatusBlk ReadHWclkParams(clockResolution,clockDrift)
unsigned long *clockResolution;
unsigned long *clockDrift;
{
union adjunion Adj;
StatusBlk statusBlk;

    if (utc_adjtime (getresolution, &Adj)) {
        statusBlk.status = K_SYS_ERROR;
        statusBlk.sysStatus = errno;
        return( statusBlk );
    }

    *clockResolution = Adj.resolution;           /* in NS */

    if (utc_adjtime (getdrift, &Adj)) {
        statusBlk.status = K_SYS_ERROR;
        statusBlk.sysStatus = errno;
        return( statusBlk );
    }

    if (Adj.maxdrift)                 /* avoid div by 0      <== NEW */
       *clockDrift = K_ONE_BILLION / (unsigned long int)Adj.maxdrift;
                                      /*  In PPB             */
    ReturnDTSSstatus(DTSS_SUCCESS, statusBlk);

}

[5/4/92 public]
This is a duplicate of CR 2140. Please close it.



CR Number                     : 2927
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : thr
Subcomponent Name             : src/test/threads/prvb_thd_006.c
Short Description             : Threads test failed; Test "PRVB_THD_006": Unequal distribution of execution.
Reported Date                 : 4/20/92
Found in Baseline             : 1.0
Found Date                    : 4/20/92
Severity                      : B
Priority                      : 0
Status                        : dup
Duplicate Of                  : 2283
Fix By Baseline               : 1.0.1
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[4/20/92 public]


Full Description:

	START,  Test "PRVB_THD_006":    Test for timeslicing fairness.
Starting......done.

     Thread          Iterations
        0               100348
        1               098330
        2               098980
        3               098840
        4               098943
        5               097193
        6               098555
        7               078344
        8               099038
        9               098707

For 10 threads, running for 61 seconds:
        Average: 96724
        Maximum: 100348
        Minimum: 78344
Deviation: 19%  (Threshold: 10%)

FAILED, Test "PRVB_THD_006":    Unequal distribution of execution.

Repeat By:

	run the test case on the RS-6000



CR Number                     : 2862
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : other
S/W Ref Platform              : other
Component Name                : dts
Subcomponent Name             : src/time/service/dtss_service_main.c
Short Description             : DTS...Divide-by-zero situation.
Reported Date                 : 4/17/92
Found in Baseline             : 1.0
Found Date                    : 4/17/92
Severity                      : B
Priority                      : 1
Status                        : dup
Duplicate Of                  : 
Fix By Baseline               : 1.0.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[4/17/92 public]

Full Description:

        The function ScheduleNextSynch() uses the value of the hardware
        clock's drift as a divisor to calculate the reciprocal of the
        maximum drift. The drift value is obtained via calls to
        utc_adjtime(). Default values are are set in utc_adjtime() and
        can be overridden by an external source.

        During initalization of the Server/Clerk, InitializeService()
        calls ReadHWclkParams() to obtain the clock drift value.
        ReadHWclkParams() calls utc_adjtime() to obtain the drift value.
        If the call fails, ReadHWclkParams() returns an error to
        InitializeService(). If the call succeeds, the value of the clock
        drift is updated in the synchronization database (sdb).
        Unfortunately, InitializeService() does not check the
        return value from ReadHWclkParams() and proceeds with
        initialization, although the value of the clock drift value in
        the sdb could be zero.

        When a synchronization completes, ScheduleNextSynch() is called
        and uses the clock drift value in the sbd as a divisor. If this
        value is zero, a divide-by-zero condition ocurs and the thread
	

Repeat the problem by:


        - error creating shared memory in utc_adjtime()
            - shmget() failure
        - error locking shared memory in utc_adjtime()
            - semop() failure

Proposed Solution:

        - check the return value of ReadHWclkParams() and exit
          initialization if an error occurs.

                             OR

        - set default values for sbd clock drift so that a failure
          does not cause the value to remain zero.

[5/5/92 public]

 This is a duplicate of CR 2140. I'm changing this to duplicate.

[10/19/92 public]
Changed priority = 1 for all bugs > 6 months old.



CR Number                     : 2851
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : other
S/W Ref Platform              : other
Component Name                : dts
Subcomponent Name             : src/time/control/prscmd.c & src/time/control/dtsprs.c
Short Description             : DTS...DTSCP does not recognize low case characters.
Reported Date                 : 4/17/92
Found in Baseline             : 1.0
Found Date                    : 4/17/92
Severity                      : C
Priority                      : 1
Status                        : dup
Duplicate Of                  : 3496
Fix By Baseline               : 1.0.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[4/17/92 public]

        DTSSCP command processor did not recognize low case character
        set when DTSSCP was running in EBCDIC machine.
        DTSSCP command processor supported only ASCII character set.
        When verifying valid characters range it assumed ASCII
        character or code page.  This caused the code very machine
        dependent.

Proposed Solution:

        The code should not be machine dependent.  One may use
        standard C library function isxxxx macro to check for
        character type. For instance under SAA standard, we can use
        isxdigit macro to verify a valid hex digit or character
        (0..9, A..F, a..f).  For the full detail on SAA standards or
        supported macro library please refer to SAA Common Programming
        interface C Ref - level 2 chapter 10 page 257.

        Note that If we were using C macro is isalnum to isxdigit
        macros, character type difference would be handled by C
        library and hence the code would not be function for ASCII
        machine only.

        Another alternative is to use code page table for different
        National Language (Please refer to previous append of BUG
        REPORT for National Language Support NLS).

        The following are suggested changes to the codes:

  =====> prscmd.c <======

struct prs *context;
int base;
{
  ....
    if (base == 10)
    {
        while (isdigit(*work_element))       /* Is digit   @P000262KN*/
        ....
    if (base == 16)
    {
/*      while ( ((*work_element >= '0') && (*work_element <= '9')) ||  */
/*               ((*work_element >= 'A') && (*work_element <= 'F')) || */
/*               ((*work_element >= 'a') && (*work_element <= 'f')) )  */
        while (isxdigit(*work_element))      /* hex digit  @P000262KN*/
        {
            context->num <<= 4;
            if (isdigit(*work_element))      /* begin digit@P000262KN*/
        ....
}

static int pr_cmatch(char_address, list_address, alpha_match, case_match)
char *(*char_address);
char *(*list_address);
int alpha_match;
int case_match;
{ 
....
/* if ((alpha_match == 0) && (*list_char >= 'A') && (*list_char <= 'Z'))*/
        if ((alpha_match == 0) && (isupper(*list_char))) /*@P000262KN*/
        {
           ....
                case 'A':
/*      if ((upper_char >= 'A') && (upper_char <= 'Z')) got_match = YES;*/
                        if (isupper(upper_char))         /*@P000262KN*/
                           got_match = YES;              /*@P000262KN*/
        ....
                case 'D':
/*      if ((*user_char >= '0') && (*user_char <= '9')) got_match = YES;*/
                        if (isdigit(*user_char))         /*@P000262KN*/
                           got_match = YES;              /*@P000262KN*/
        ....
                case 'H':
/*      if ((*user_char >= '0') && (*user_char <= '9')) got_match = YES;*/
/*      if ((upper_char >= 'A') && (upper_char <= 'F')) got_match = YES;*/
                        if (isxdigit(*user_char))        /*@P000262KN*/
                           got_match = YES;              /*@P000262KN*/
        ....
                case 'L':
/*      if ((*user_char >= 'a') && (*user_char <= 'z')) got_match = YES;*/
                        if (islower(*user_char))         /*@P000262KN*/
                           got_match = YES;              /*@P000262KN*/
        ....
                case 'N':
/*      if (upper_char > ' ') got_match = YES; */
                        if (isgraph(upper_char))         /*@P000262KN*/
                           got_match = YES;              /*@P000262KN*/
        ....
                case 'P':
/*      if ((*user_char > ' ') && (*user_char < '0')) got_match = YES; */
/*      if ((*user_char > '9') && (*user_char < 'A')) got_match = YES; */
/*      if ((*user_char > 'Z') && (*user_char < 'a')) got_match = YES; */
/*      if ((*user_char > 'z') && (*user_char < DEL)) got_match = YES; */
                        if (ispunct(*user_char))         /*@P000262KN*/
                           got_match = YES;              /*@P000262KN*/
        ....
                case 'S':
/*      if ((*user_char <= ' ') && (*user_char > '\0')) got_match = YES;*/
                        if ((iscntrl(*user_char)         /*@P000262KN*/
                             || isspace(*user_char))     /*@P000262KN*/
                            && *user_char != '\0')       /*@P000262KN*/
                           got_match = YES;              /*@P000262KN*/
        ....
                case 'U':
/*      if ((*user_char >= 'A') && (*user_char <= 'Z')) got_match = YES;*/
                        if (isupper(*user_char))         /*@P000262KN*/
                           got_match = YES;              /*@P000262KN*/
        ....
/*  if (upper_char > ' ')       user_char++; */
    if (isgraph(upper_char))                             /*@P000262KN*/
       user_char++;                                      /*@P000262KN*/
    else
       user_char = pr_nonblank(user_char);
    ....
}

static int pr_upper(character)
register char character;
{
/*  register int result;                                                     */
/*                                                                           */
/*  if ((character >= 'a') && (character <= 'z')) result = character & 0337; */
/*  else                                          result = character & 0377; */
/*                                                                           */
/*  return (result);                                                         */
    return ( (int) ((islower(character))                 /*@P000262KN*/
                         ? toupper(character)            /*@P000262KN*/
                         : (int) character) );           /*@P000262KN*/
}

static char *pr_nonblank(string)
register char *string;
{
/*  while ((*string <= ' ') && (*string > '\0')) string++; */
    while ((iscntrl(*string) || isspace(*string))        /*@P000262KN*/
           && *string != '\0')                           /*@P000262KN*/
       string++;                                         /*@P000262KN*/
    return (string);
}

  =====> prs.c   (Ref PTR 262 or PTR 290) <======
static int trn_file()
{
 ....
/*
 *          if ( (*pnt1 < ' ') || ((*pnt1 > 0x7E) && (*pnt1 < 0xA0)) )
 */
            if ( !(isspace(*pnt1) || isgraph(*pnt1)) )   /*@P000262KN*/
            {                                            /*@P000262KN*/
                printf("Illegal control character in text (octal code = %o).\n",
*pnt1);
                dis_err(pnt1);
                *pnt1 = ' ';
            }
 ....
}

static char trn_upper(cc)
register char   cc;
{
/*      if (cc >= 'a' && cc <= 'z')  return (cc &= 0xDF);   */
/*      return (cc);                                        */
    return ( (char) ((islower(cc)) ? (char) toupper(cc)  /*@P000262KN*/
                                   : cc) );              /*@P000262KN*/
}

static long trn_number(min0, max0, trm0)
long min0;
long max0;
char trm0;

{
   ....
        if (base == 10)
        {
/*          if ((*cp < '0') || (*cp > '9'))              */
            if (!(isdigit(*cp)))                         /*@P000262KN*/
                break;
        }

        if (base == 16)
        {
/*          if ((*cp < '0') || (trn_upper(*cp) > 'F'))   */
/*                break;                                 */
/*                                                       */
/*          if ((*cp > '9') && (trn_upper(*cp) < 'A'))   */
/*              break;                                   */
/*                                                       */
/*          if (*cp > '9')                               */
/*          {                                            */
/*              *cp = trn_upper(*cp) - 'A' + '9' + 1;    */
/*          }                                            */

            if (!(isxdigit(*cp)))                        /*@P000262KN*/
               break;                                    /*@P000262KN*/

            if (isalpha(*cp))                            /*@P000262KN*/
               *cp = trn_upper(*cp) - 'A' + '9' + 1;     /*@P000262KN*/
        }
   ....
}

static int add_string(off0, typ0)
int off0;
int typ0;
{
   ....
/*      case 6: if ( (*pnt0 < '0') || (trn_upper(*pnt0) > 'Z') ||  */
/*                  ((*pnt0 > '9') && (trn_upper(*pnt0) < 'A')) )  */
        case 6: if (!(isalnum(*pnt0)))                   /*@P000262KN*/
                ....
}

static int chk_match(key0, trm0, len0)
register char *key0;
char trm0;
int  len0;
{
   ....
/*  if ( ((trn_upper(*str0) >= 'A') && (trn_upper(*str0) <= 'Z')) || */
/*       ((*str0 >= '0')            && (*str0 <= '9')) )             */
    if (isalnum(*str0))                                  /*@P000262KN*/
   ....
}

[5/5/92 public]

 Support for EBCDIC character sets is not a goal of DCE 1.0. This is an
 enhancement. This defect should have it's priority changed to `E5' and
 be marked enhancement.

[Baryiames 5/12/92]
 I put the required changes into prscmd.c, and that has been bsubmitted.
 But dts does not control prs.c to complete the fix.

[05/12/92 public]
    The file directory/cds/control/prs.c should be upgraded to
    use the <ctype.h> macros.  Changed area to DTS.

[05/14/92 public]
 Defect 3496 describes the problem and assigns it to the proper section,
 so I'm closing this as a dup, even though it's earlier.

[10/19/92 public]
Changed priority = 1 for all bugs > 6 months old.



CR Number                     : 2793
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : pmax
S/W Ref Platform              : osf1
Component Name                : dts
Subcomponent Name             : 
Short Description             : Bad facility generated
Reported Date                 : 4/15/92
Found in Baseline             : 1.0.1b11
Found Date                    : 4/15/92
Severity                      : C
Priority                      : 1
Status                        : dup
Duplicate Of                  : 
Fix By Baseline               : 1.0.2
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[4/15/92 public]
dce_config on PMAX client loops waiting for DTS server. 
Currently, DTS server does not come up on PMAX and a PMAX client
cannot talk to a RIOS cds server, which leaves dce_config broken. 
Workaround is to ^C dce_config on the PMAX client when it hangs
looking for the DTS server.

---------------------- dce_config log begin -------------------------

         DCE Configuration Menu


         1. Initial Cell Configuration
         2. Additional Server Configuration
         3. DCE Client


        98. Return to previous menu
        99. Exit



        selection:  3
... clear ...


        Enter the name of your cell: darkman_cell.osf.org
        What is the name of the Security Server for this cell?
darkman.osf.org
        Ensure the /opt/dcelocal/etc/security/pe_site file
        matches that on the server...
        Press <ENTER> to continue

                creating /krb5/krb.conf file...
                adding kerberos entry to /etc/services ...
Current site is: registry server at /.../darkman_cell.osf.org
Domain changed to: principal
Domain changed to: account
bye.
                starting sec_clientd
        This machine is now a security client...
        Press <ENTER> to continue

... clear ...
Current site is: registry server at /.../darkman_cell.osf.org
Domain changed to: principal
Domain changed to: account
bye.
        Creating the cds.conf file...
        Enter name of primary CDS server:  darkman.osf.org
        Creating hosts/pluto objects in name space

>>> binding information and objects exported

                Creating /.:/hosts/<hostname>/profile

>>> default profile element added


>>> binding information exported

        This machine is now a CDS client...
        Press <ENTER> to continue

        start dtsd
dtscp cannot get rpc binding to dts daemon - reason:
status 7fffe9e0 (unknown facility)
dtscp create type clerk failed
        Press <ENTER> to continue

dtscp cannot get rpc binding to dts daemon - reason:
status 7fffea00 (unknown facility)
dtscp enable failed
        Press <ENTER> to continue

---------------------- dce_config log end -------------------------

[4/15/92 public]
This in itself is not a bug.  The problem here is that the dts client when
coming up, could not find a dts server, so it failed.  That's fine.  Now
what problems does this show:

  The status code from something is giving a bad facility.

I left this as dce since I don't know what is generating the problem,
changed the short description, and removed myself as the responcible
engineer.

[4/17/92 public]
lowered severity to C

[4/17/92 public]
The problem above should read that the dtscp command could not find the
dtsd daemon.  There is not a requirement that a clerk communicate with
a server to be configured.

[5/1/92 public]
Changed to DTS since that's what failed.

[5/4/92 public]
This is a duplicate of 2792 (the bad status code came from an uninitialized
variable). Please close this defect.

[10/19/92 public]
Changed priority = 1 for all bugs > 6 months old.



CR Number                     : 2468
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : pmax
S/W Ref Platform              : osf1
Component Name                : cds
Subcomponent Name             : cdscp,cdsd
Short Description             : Escaping of * wildcard does not work in show commands
Reported Date                 : 3/31/92
Found in Baseline             : 1.0.1
Found Date                    : 3/31/92
Severity                      : B
Priority                      : 3
Status                        : dup
Duplicate Of                  : 3159
Fix By Baseline               : 1.0.1
Fixed In Baseline             : 1.0.1
Affected File(s)              : directory/cds/server/names_lib.c
Sensitivity                   : public

[3/31/92 public]
    Reported by John Grober.  Waiting for OT to recognize my name.

Escaping the * wildcard appears to work for list commands but does
not work for show commands.

Steps to Reproduce:

- "create directory /.:/t1*"

- "list directory /.:/t1\*"
     This command works.

- "show directory /.:/t1\*"
    This command fails with the error DNS_UNKNOWNENTRY 

The same also appears to be true for the "show object" command.

[4/30/92 public]
From directory/cds/server/names_lib.c log:
Gak! I'm losing my touch.  We must break out of the for() loop
in dowild() if we run out of name, and *then* we can return FALSE.

Also while here, testing showed up another bug which I discovered
was reported in OT#2468 and OT#3071.  This bug was in names_s_compare()
where no '*' was found.  It was checking that both strings were the
same length, which is not true with escaped wildcard specs.  Instead,
check if the match used up all of the name string.

While I'm here, break down and insert the use of const everywhere.
Also some reformatting for clarity.


Reopened.  Here are the result's I'm getting in 1.0.1b14:

    cdscp> list dir /.:/t1\*
    LIST
    DIRECTORY   /.../macaroni_cell.osf.org/t1\*
    AT   1992-05-12-20:57:11
    t1*
    cdscp> show dir /.:/t1\*

    SHOW
    DIRECTORY   /.../macaroni_cell.osf.org/t1\*
    AT   1992-05-12-20:57:18
    Error on entity: /.../macaroni_cell.osf.org/t1\*
    Requested entry does not exist (dce / cds)
    Function: dnsEnumAttr
    dnsEnumAttr: partial results = /.../macaroni_cell.osf.org

    cdscp>

[10/13/92 public]
Alan did fix the original problem, but it was masking a problem with
wildcard handling in the API, since reported in CR3159.



CR Number                     : 1133
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : dfs
Subcomponent Name             : 
Short Description             : add support for read-only aggregates
Reported Date                 : 12/19/91
Found in Baseline             : .60d
Found Date                    : 
Severity                      : C
Priority                      : 2
Status                        : dup
Duplicate Of                  : 1115
Fix By Baseline               : 
Fixed In Baseline             : 
Affected File(s)              : 
Sensitivity                   : public

[01/29/92 public]

Orbit reference number 4309
reference     
product
phaseFound    development

History:
lastUpdate    91/12/19 13:41:24
endDate                                
assignDate    91/12/19 13:41:24   





    addDate              action          userLogin (userName)
    -------------------- --------------- ----------------------------------
    91/12/19 13:41:24    create          hirsch (Phil Hirsch)

[12/19/91 public]

If you export a UFS partition that is locally mounted as a read-only
filesystems, the exported aggregate will be writable. There should be
a way to specify that an aggregate is to be exported in a read-only
manner.

[03/19/92 public]
Duplicate of 1115, which has been deferred into the 1.1 timeframe.




CR Number                     : 12835
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : dts_ntp_provider
Short Description             : SATAN can potentially disrupt DCE cell
Reported Date                 : 4/5/95
Found in Baseline             : 1.1
Found Date                    : 4/5/95
Severity                      : B
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1maint
Affected File(s)              : time/service/dts_ntp_provider.c
Sensitivity                   : public

[4/5/95 public]

As was reported by a member company's beta testing of SATAN on DCE cell,
we have opened a defect to tighten up the loophole exposed by SATAN:

       ===========================================================
****** P O T E N T I A L   D A N G E R   O F   D I S R U P T I O N ******
 *****   T O  D C E  C E L L  F R O M  S A T A N  Q U E R I E S    *****
       ===========================================================

					           Date: April 4, 1995

"SATAN, a network security tool, can potentially disrupt your DCE 
 cell's functioning if you are using Distributed Time Service's NTP 
 provider functionality".

As a DCE Software Support organization at Open Software Foundation, we 
are obliged to disclose a potential vulnerability of DCE cell in presence 
of SATAN queries for security holes.

SATAN is a network security tool that is being released for public use via
Internet on April 5, 1995.  This tool throws all sorts of "bad" packets at 
various TCP/UDP/IP ports on a system and tries to find security holes.  
For a just-released announcement about SATAN, you can look at the CERT 
archives.

"Among many other tricks SATAN plays, the one that affects DCE cell is when
it sends spurious data to an NTP (Network Time Protocol) daemons you might
be running. If your DCE cell has a DTS (Distributed Time Service) Daemon
that has an NTP time provider running, SATAN can cause the NTP provider to
abruptly change the system clock by up to several years. This could cause
many problems in CDS (Cell Directory Service), including corruptions of the
clearinghouse database."

This is because:
  - SATAN is not trying to "lie" to NTP, it merely sends a one byte "NULL"
    to each UDP port, scanning for responses. dts_ntp_provider does not
    "digest" this really well...
  - we have not fully qualified the impact on CDS in case there is no CDS
    server on the DTS "master"
  - various implementations can react to the "0" differently depending on 
    the system and the order and number of packets.

If you have already hit this problem by the time you read this email, only
choice you have is to restore CDS database from your cell backup. If you
have not hit this problem yet then please turn off the NTP time provider 
functionality of your DTS Daemon to disallow such an unauthorized disruption
of your DCE cell.

To date, this is the only problem we are aware of that was exposed by beta
testing of Satan on DCE cell functioning.

[4/7/95 public]

A fix from IBM (bachmann@austin.ibm.com):

Short Description	: dts_ntp_provider is not secure against bogus packets

The code in dts_ntp_provider.c that talks to NTP servers (in QueryProvider)
does not sanity check the packets received and can be confused if it receives
bad packets, with disastrous results.  If it receives a zero-length packet,
e.g. from the SATAN security probing tool, it will try to extract data from
a non-existent packet and has been reported to return timestamps well into the
future, which dtsd believes and uses to sync the machine's clock.  Obviously,
this can be very bad if your CDS server is running on the same machine.

The following context diff updates the 1.1 code to make the sanity checks
recommended in RFC 1769, Simple Network Time Protocol, in addition to the
obvious one of checking for runt packets.

*** dts_ntp_provider.c.1.6	Thu Apr  6 23:13:37 1995
--- dts_ntp_provider.c.1.7	Thu Apr  6 23:14:46 1995
***************
*** 283,289 ****
  /*
   *	NTP message parameters
   */
! #define K_NTP_VERSION1	     (0x08)	   /* Status bits that encode	*
  					    * version			*/
  #define K_NTP_UNSPECIFIED    (0)	   /* Stratum unspecified	*/
  
--- 283,289 ----
  /*
   *	NTP message parameters
   */
! #define K_NTP_VERSION1	     (0x0b)	   /* Status bits that encode	*
  					    * version			*/
  #define K_NTP_UNSPECIFIED    (0)	   /* Stratum unspecified	*/
  
***************
*** 1310,1315 ****
--- 1310,1316 ----
      utc_t ref, t1, t2, t3, t4;		/* NTP timestamps                  */
      timespec_t synchdist;		/* NTP synchronization distance    */
      timespec_t timesp, inaccsp;		/* Temps for time computation      */
+     enum utc_cmptype relation;          /* temp for sanity checking response */
  
      memset((char *)pkt, 0, sizeof(ntp_data));
      FD_ZERO(&readfds);
***************
*** 1348,1359 ****
  	return(1);
      }
  
!     if ((recvfrom(fd, (char *)pkt, sizeof (ntp_data), 0,
  	          (struct sockaddr *) &sockin, &dstlen)) < 0) {
  	PrintError("dtsprovider: NTP recvfrom");
  	exit(1);
      }
  
      /*
       * Record 'after' timestamp
       */
--- 1349,1364 ----
  	return(1);
      }
  
!     if ((n = recvfrom(fd, (char *)pkt, sizeof (ntp_data), 0,
  	          (struct sockaddr *) &sockin, &dstlen)) < 0) {
  	PrintError("dtsprovider: NTP recvfrom");
  	exit(1);
      }
  
+     if (n < sizeof(ntp_data)) {
+         return(1);                      /* got a bad packet */
+     }
+ 
      /*
       * Record 'after' timestamp
       */
***************
*** 1372,1382 ****
  	return(-1);
  
      /*
       * Compute ntp time from information in the ntp message
       */
  
      cvt_ntp_utc(&ref, &pkt->reftime);
!     t1 = *beforeTime;
      cvt_ntp_utc(&t2, &pkt->rec);
      cvt_ntp_utc(&t3, &pkt->xmt);
      t4 = *afterTime;
--- 1377,1405 ----
  	return(-1);
  
      /*
+      * Sanity checks according to RFC 1769
+      * LI field not 3
+      * Stratum field not out of range
+      * Transmit Timestamp not 0
+      */
+ 
+     if (((pkt->status&0xc0) == 0xc0) || (pkt->stratum == 0)
+        || (pkt->xmt.int_part == 0)) return(1);
+ 
+     /*
       * Compute ntp time from information in the ntp message
       */
  
      cvt_ntp_utc(&ref, &pkt->reftime);
!     cvt_ntp_utc(&t1, &pkt->org);
! 
!     /*
!      * Sanity check the data: org should be what we sent.
!      */
! 
!     if (utc_cmpmidtime(&relation, &t1, beforeTime)==-1) return(1);
!     if (relation != utc_equalTo) return(1);
! 
      cvt_ntp_utc(&t2, &pkt->rec);
      cvt_ntp_utc(&t3, &pkt->xmt);
      t4 = *afterTime;
***************
*** 1400,1406 ****
  		      synchdist.tv_sec, synchdist.tv_nsec);
      );
  
!     (void) utc_bintime(&timesp, (timespec_t *)0, (long *)0, &t2);
  
      inaccsp = INACC;
      inaccsp.tv_sec += synchdist.tv_sec;
--- 1423,1429 ----
  		      synchdist.tv_sec, synchdist.tv_nsec);
      );
  
!     (void) utc_bintime(&timesp, (timespec_t *)0, (long *)0, &t3);
  
      inaccsp = INACC;
      inaccsp.tv_sec += synchdist.tv_sec;

[9/14/95 public]

Following was submitted to the 1.1 maintenance code:

*** /project/dce/build/dce1.1-maint/src/time/service/dts_ntp_provider.c	Wed Jul 20 16:24:41 1994
--- time/service/dts_ntp_provider.c	Wed Apr 26 12:27:23 1995
***************
*** 254,260 ****
  /*
   *	NTP message parameters
   */
! #define K_NTP_VERSION1	     (0x08)	   /* Status bits that encode	*
  					    * version			*/
  #define K_NTP_UNSPECIFIED    (0)	   /* Stratum unspecified	*/
  
--- 254,263 ----
  /*
   *	NTP message parameters
   */
! #define K_NTP_MODCLI	     (0x03)	   /* Status bits that encode	*
! 					    * mode   			*/
! #define K_NTP_VERSION1	     (0x08 | K_NTP_MODCLI)
! 					   /* Status bits that encode	*
  					    * version			*/
  #define K_NTP_UNSPECIFIED    (0)	   /* Stratum unspecified	*/
  
***************
*** 1271,1276 ****
--- 1274,1280 ----
      utc_t ref, t1, t2, t3, t4;		/* NTP timestamps                  */
      timespec_t synchdist;		/* NTP synchronization distance    */
      timespec_t timesp, inaccsp;		/* Temps for time computation      */
+     enum utc_cmptype relation;          /* temp for sanity checking resp   */
  
      memset((char *)pkt, 0, sizeof(ntp_data));
      FD_ZERO(&readfds);
***************
*** 1295,1343 ****
      }
  
      /*
!      * Wait for the reply by watching the file descriptor
       */
!     if ((n = select(FD_SETSIZE, (fd_set_t *)&readfds, 0, 0, &timeout)) < 0) {
! 	PrintError("dtsprovider: NTP select");
! 	exit(1);
!     }
  
!     if (n == 0) {
! 	BEGIN_NONREENTRANT
! 	(void) fprintf(stderr, "\n\t* Timeout *\n");
! 	END_NONREENTRANT
! 	return(1);
!     }
  
!     if ((recvfrom(fd, (char *)pkt, sizeof (ntp_data), 0,
! 	          (struct sockaddr *) &sockin, &dstlen)) < 0) {
! 	PrintError("dtsprovider: NTP recvfrom");
! 	exit(1);
      }
  
-     /*
-      * Record 'after' timestamp
-      */
-     (void) utc_gettime(afterTime);
- 
-     TraceIf(
- 	(void) printf("Packet from: [%s]\n", inet_ntoa(sockin.sin_addr));
- 	(void) printf("Status: %d\tStratum: %d\n",
- 		      (int)(pkt->status & 0x03f), pkt->stratum); );
- 
-     /*
-      * Check stratum of timestamp
-      */
- 
-     if (pkt->stratum >= K_DTS_NTP_STRATUM)
- 	return(-1);
- 
-     /*
-      * Compute ntp time from information in the ntp message
-      */
- 
-     cvt_ntp_utc(&ref, &pkt->reftime);
-     t1 = *beforeTime;
      cvt_ntp_utc(&t2, &pkt->rec);
      cvt_ntp_utc(&t3, &pkt->xmt);
      t4 = *afterTime;
--- 1299,1380 ----
      }
  
      /*
!      * Loop checking incoming packets until no more or good packets
       */
!     while ( TRUE ) {
  
!         /*
!          * Wait for the reply by watching the file descriptor
!          */
!         if ((n = select(FD_SETSIZE, (fd_set_t *)&readfds, 0, 0,
!                         &timeout)) < 0) {
!             PrintError("dtsprovider: NTP select");
!             exit(1);
!         }
! 
!         if (n == 0) {
!             BEGIN_NONREENTRANT
!             (void) fprintf(stderr, "\n\t* Timeout *\n");
!             END_NONREENTRANT
!             return(1);
!         }
! 
!         if ((n = recvfrom(fd, (char *)pkt, sizeof (ntp_data), 0,
!     	          (struct sockaddr *) &sockin, &dstlen)) < 0) {
!             PrintError("dtsprovider: NTP recvfrom");
!             exit(1);
!         }
! 
!         if (n < sizeof(ntp_data)) {
!             return(1);                      /* got a bad packet */
!         }
! 
!         /*
!          * Record 'after' timestamp
!          */
!         (void) utc_gettime(afterTime);
! 
!         TraceIf(
!             (void) printf("Packet from: [%s]\n", inet_ntoa(sockin.sin_addr));
!             (void) printf("Status: %d\tStratum: %d\n",
!     		      (int)(pkt->status & 0x03f), pkt->stratum); );
! 
!         /*
!          * Check stratum of timestamp
!          */
! 
!         if (pkt->stratum >= K_DTS_NTP_STRATUM)
!             return(-1);
! 
!         /*
!          * Sanity checks according to RFC 1769
!          * LI field not 3
!          * Stratum field not out of range
!          * Transmit Timestamp not 0
!          */
! 
!         if ((pkt->status & 0xc0) == 0xc0 || pkt->stratum == 0
!             || pkt->xmt.int_part == 0)
!             continue;
!     
!         /*
!          * Compute ntp time from information in the ntp message
!          */
!     
!         cvt_ntp_utc(&ref, &pkt->reftime);
!         cvt_ntp_utc(&t1, &pkt->org);
!     
!         /*
!          * Sanity check the data: org should be what we sent.
!          */
!     
!         if (utc_cmpmidtime(&relation, &t1, beforeTime) == -1)
!             continue;
  
!         if (relation == utc_equalTo)
!             break;
      }
  
      cvt_ntp_utc(&t2, &pkt->rec);
      cvt_ntp_utc(&t3, &pkt->xmt);
      t4 = *afterTime;
***************
*** 1361,1367 ****
  		      synchdist.tv_sec, synchdist.tv_nsec);
      );
  
!     (void) utc_bintime(&timesp, (timespec_t *)0, (long *)0, &t2);
  
      inaccsp = INACC;
      inaccsp.tv_sec += synchdist.tv_sec;
--- 1398,1407 ----
  		      synchdist.tv_sec, synchdist.tv_nsec);
      );
  
!     /*
!      * Use Transmit Timestamp per RFC 1769
!      */
!     (void) utc_bintime(&timesp, (timespec_t *)0, (long *)0, &t3);
  
      inaccsp = INACC;
      inaccsp.tv_sec += synchdist.tv_sec;

[9/19/95 public]

Just confirmed with the following test that the fix above fixes the bug.
Tested on AIX 3.2.5. Cell without the fix changes the clock to year 2036.

How to test:
	cc -o ntp_test ntp_test.c
	Configure DCE cell
	dce_login cell_admin -dce-
	ntp_test 123 &
	dtscp
	dtscp> show cur time
	dtscp> sync
	dtscp> sync
	dtscp> show cur time   <--------- time should not change to year 2036.

----source for ntp_test.c--------
#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <sys/types.h>
#include <sys/time.h>
#include <sys/socket.h>
#include <netinet/in.h>
#include <fcntl.h>
#include <unistd.h>

#include <sys/select.h>
#include <netinet/in.h>
#include <errno.h>

main(int argc, char **argv)
{

    int                s, rc, num;
    struct sockaddr_in addr, bind_addr;
    char               buf = '\0';

    memset((char *)&addr, 0, sizeof(addr));
    memset((char *)&bind_addr, 0, sizeof(bind_addr));

    s = socket(AF_INET, SOCK_DGRAM, 0);
    if (s == -1) {
       printf("Error creating socket %d.\n", errno);
       exit(-1);
    }

    if (argc < 2) {
       printf("Usage xxx port#.\n");
       exit(-1);
    }

    num = atoi(argv[1]);
    addr.sin_family = AF_INET;
    addr.sin_addr.s_addr = 0x0;
    addr.sin_port = htons(num);

    bind_addr.sin_family = AF_INET;
    bind_addr.sin_addr.s_addr = htonl(INADDR_ANY);
    bind_addr.sin_port = htons(0);

    rc = bind(s, (struct sockaddr *) &bind_addr, sizeof(struct sockaddr_in) );
    if (rc == -1) {
       printf("Error binding to socket %d, error %d.\n", s, errno);
       exit(-1);
    }

    while (1) {
       printf("Writing 1 byte NULL to ntp_provier.\n");
       rc = sendto( s, &buf, 1, 0, (struct sockaddr *) &addr,
                    sizeof(struct sockaddr_in) );
       if (rc == -1) {
          printf("Error writing to socket %d errno %d.\n", s, errno);
       }

       printf("Sleeping 10.\n");
       sleep(10);
    }
}

[12/22/95 public]
Fix included in DCE 1.2.1
Closed



CR Number                     : 12498
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 12493
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : dtsd
Short Description             : HYP: dtsd calls dce_aud_open too early
Reported Date                 : 10/4/94
Found in Baseline             : 1.1
Found Date                    : 10/4/94
Severity                      : A
Priority                      : 0
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b21
Affected File(s)              : dtss_service_main.c, transport_rpc.c
Sensitivity                   : public

[10/4/94 public]

dtsd call dts_aud_init() too early so if you set the environment
variable DCEAUDITFILTERON, it will fail to open the trail file.
This is because it call dce_aud_open() too early, before it
has registered any rpc interfaces.

The fix, remove the call to dts_aud_init from main and put it
right before we call rpc_server_listen:

====== ./time/service/dtss_service_main.c
*** /project/dce/build/dce1.1/src/./time/service/dtss_service_main.c	Fri Sep 30 16:14:02 1994
--- ./time/service/dtss_service_main.c	Tue Oct  4 16:38:09 1994
***************
*** 650,658 ****
  
      dce_aud_open(aud_c_trl_open_write, "dts_aud_trail", 
  	DTS_AUD_FIRST_EVT_NUMBER, DTS_AUD_NUM_OF_EVTS, &dts_aud_trail, &st);
!     if (st != error_status_ok) 
          dce_svc_printf(DCE_SVC(dts_svc_handle, ""), dts_s_general,
         	        svc_c_sev_error, dts_s_aud_open_file_failed, "dts_aud_trail");
      return;
  }
  #endif	/* defined(DCE_AUD_POINTS) */
--- 650,660 ----
  
      dce_aud_open(aud_c_trl_open_write, "dts_aud_trail", 
  	DTS_AUD_FIRST_EVT_NUMBER, DTS_AUD_NUM_OF_EVTS, &dts_aud_trail, &st);
!     if (st != error_status_ok) {
          dce_svc_printf(DCE_SVC(dts_svc_handle, ""), dts_s_general,
         	        svc_c_sev_error, dts_s_aud_open_file_failed, "dts_aud_trail");
+ 	exit(1);
+     }
      return;
  }
  #endif	/* defined(DCE_AUD_POINTS) */
***************
*** 697,706 ****
      InitUnix(argc,argv,parent_child_pipe, argptr);
  
      /* N.B. at this point, we are running in the child process */
- 
- #if	defined(DCE_AUD_POINTS)
-     dts_aud_init();
- #endif	/* defined(DCE_AUD_POINTS) */
  
  #ifdef K_DTSS_STACKSIZE 
      /*
--- 699,704 ----
 
 
====== ./time/service/transport_rpc.c
*** /project/dce/build/dce1.1/src/./time/service/transport_rpc.c	Tue Aug 23 16:32:45 1994
--- ./time/service/transport_rpc.c	Tue Oct  4 16:41:21 1994
***************
*** 227,232 ****
--- 227,236 ----
  
  void get_security_config_info (sec_id_t *, sec_id_t *,error_status_t *);
  
+ #if     defined(DCE_AUD_POINTS)
+ void dts_aud_init(void);
+ #endif /* defined(DCE_AUD_POINTS) */
+ 
  globalref time_service_v1_0_epv_t time_service_epv;
  globalref gbl_time_service_v1_0_epv_t gbl_time_service_epv;
  globalref time_control_v2_0_epv_t time_control_epv;
***************
*** 427,432 ****
--- 431,439 ----
  		       dce_dts_error_text( st, tempString ));
      }
  
+ #if     defined(DCE_AUD_POINTS)
+     dts_aud_init();
+ #endif  /* defined(DCE_AUD_POINTS) */
  
      /* Listen for RPC calls from clients.  There are two types of
       * clients that can send RPC requests to a DTSS daemon, depending on

[10/5/94 public]
Fixed as shown, but surrounded prototype in dtss_service_main.c with
#if also.



CR Number                     : 12491
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : dtsd
Short Description             : Remove {lo,hi} assignments from dtss_service_main.c
Reported Date                 : 10/4/94
Found in Baseline             : 1.1
Found Date                    : 10/4/94
Severity                      : C
Priority                      : 3
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.2
Fixed In Baseline             : 1.2.1
Affected File(s)              : dtss_service_main.c
Sensitivity                   : public

[10/4/94 public]

York Lo at DEC pointed out that these lines will fail on 64 bit platforms:

    shmBuf.mgtParams.LANtimeOut.lo            = K_LAN_TIMEOUT_LO;
    shmBuf.mgtParams.LANtimeOut.hi            = K_LAN_TIMEOUT_HI;

    shmBuf.mgtParams.WANtimeOut.lo            = K_WAN_TIMEOUT_LO;
    shmBuf.mgtParams.WANtimeOut.hi            = K_WAN_TIMEOUT_HI;

    shmBuf.mgtParams.syncHold.lo              = K_SYNC_HOLD_CLERK_LO;
    shmBuf.mgtParams.syncHold.hi              = K_SYNC_HOLD_CLERK_HI;

These lines should be deleted and the #ifdef BIT64_CHANGES code immediately
following should be made unconditional:

    UTCassign (&shmBuf.mgtParams.LANtimeOut,K_LAN_TIMEOUT_LO,K_LAN_TIMEOUT_HI);
    UTCassign (&shmBuf.mgtParams.WANtimeOut,K_WAN_TIMEOUT_LO,K_WAN_TIMEOUT_HI);
    UTCassign (&shmBuf.mgtParams.syncHold,K_SYNC_HOLD_CLERK_LO,
                K_SYNC_HOLD_CLERK_HI);

[12/19/95 public]
Fixed in DCE 1.2.1
Closed



CR Number                     : 12474
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : test
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : dtscp test
Short Description             : dtscp test needs updating
Reported Date                 : 10/3/94
Found in Baseline             : 1.1b20
Found Date                    : 10/3/94
Severity                      : B
Priority                      : 0
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b21
Affected File(s)              : ./test/time/control/Makefile
./test/time/control/README
./test/time/control/dtscp.ksh
./test/time/control/test_dtscp_clerk.templ
./test/time/control/test_dtscp_server.templ
Sensitivity                   : public

[10/3/94 public]

The dtscp test scripts need updating for 1.1.
Among the things to be fixed:
	- expected output differs with new svc messages (capitalizations mostly)
	- A few sleeps needed to be added for show state tests
	- A README file needs to be added and installed

[10/3/94 public]
Fixed up the test so they pass.

[10/3/94 public]
A note after the fact to denote this bug was approved hypercritical.



CR Number                     : 12438
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : aud
Short Description             : dtsd trail file not in standard location
Reported Date                 : 9/30/94
Found in Baseline             : 1.1b20
Found Date                    : 9/30/94
Severity                      : C
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b21
Affected File(s)              : dtss_service_main.c
Sensitivity                   : public

[9/30/94 public]
The dtsd audit trail file is being left in the current directory.  The
audit trail files from the other components (audit and sec) are left
in ...dcelocal/var/<component>.

For consistency, dtsd should be modified to place its trail file in
...dcelocal/var/dtsd.

[9/30/94 public]
The audit trail should probably go in /opt/dcelocal/var/adm/time
which is where dtsd cd's to at startup.  When the call to dts_aud_init()
was put in to dtss_service_main.c, it was put in before the call
to InitUnix(), which does the chdir().

Is this important enough to fix in 1.1?  Has to be done today...

[9/30/94 public]
Risk is low, importance is high.
Moving the call to dce_aud_init 2 lines lower in source file.

[9/30/94 public]
Moved call and turned on ifdef in Makefile for audit.



CR Number                     : 12371
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : dtscp
Short Description             : dtscp/dcecp doesn't report last objserved skew
Reported Date                 : 9/27/94
Found in Baseline             : 1.1b19
Found Date                    : 9/27/94
Severity                      : B
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b20
Affected File(s)              : dtsscp.c / dts_util.c
Sensitivity                   : public

[9/27/94 public]

This code is missing a negation on the if:
        (void) printf("\tLast Observed Skew\t\t");
        utc_comptime( &tvalue, &inacc, (long *)0, &ServTime);
        if ( U64FITSIN32(tvalue) )
         {
            (void) utc_subtime(&utcDiff, &ServTime, &SyncTime);
            (void) utc_abstime(&utcDiff, &utcDiff);
            PrintAttrValue(0,
                           K_TYPE_BINRELTIME,
                           (VOID *)&utcDiff);
        }
        else
        {
            (void)printf("\n");
        }

If the value fits in 32 bits, it should not be printed.
The correct code should be:
        if ( ! U64FITSIN32(tvalue) )

dcecp also shows this defect.

[9/27/94 public]
Submitted changes to both control programs.



CR Number                     : 12325
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : dtsd
Short Description             : Startin dtsd from dced will generate WARNING from querydced.c
Reported Date                 : 9/23/94
Found in Baseline             : 1.1
Found Date                    : 9/23/94
Severity                      : C
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b19
Affected File(s)              : querydced.c
Sensitivity                   : public

[9/23/94 public]

If you configure dtsd to start from dced, it will complain
if you don't have any attibutes in xattrschema/dtsconfig:

1994-09-23-15:28:15.334-04:00I----- dtsd WARNING dts dtserror querydced.c 99 0xa44dc9a8
Failure in retrieving DTS attributes from dced: Cannot find desired attribute in server_t structure (dce / dhd)

I don't know if this is important enough to get in to 1.1.

dtsd should check for this status and treat it as OK.

[9/23/94 public]
Since this is high visibility dced functionality, raising to a 1 and I will fix.
code change:

*** /project/dce/build/dce1.1/src/time/service/querydced.c	Thu Aug 25 17:47:51 1994
--- querydced.c	Fri Sep 23 16:25:59 1994
***************
*** 90,103 ****
      }
      else 
      {
! 	if (dce_server_inq_attr( &dced_g_uuid_dtsconfattr, 
  				&dts_attr_values, 
! 				stp), 
! 	*stp != rpc_s_ok)
  	{
  	    dce_error_string_t tempstring;
! 	    dce_svc_printf( DTS_S_INQ_ATTR_MSG, 
! 			   dce_dts_error_text( *stp, tempstring ));
  	    return ;
  	}
  
--- 91,108 ----
      }
      else 
      {
! 	dce_server_inq_attr( &dced_g_uuid_dtsconfattr, 
  				&dts_attr_values, 
! 				stp);
! 	if (*stp != rpc_s_ok)
  	{
  	    dce_error_string_t tempstring;
! 	    if (*stp != dced_s_server_attr_not_found)
! 	    {
! 		/* OK if nothing there */
! 	    	dce_svc_printf( DTS_S_INQ_ATTR_MSG, 
! 			        dce_dts_error_text( *stp, tempstring ));
! 	    }
  	    return ;
  	}

[9/23/94 public]
Done.



CR Number                     : 12271
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : i486
S/W Ref Platform              : osf1
Component Name                : dts
Subcomponent Name             : dtscp
Short Description             : show Enable Directives Completed reports bad number
Reported Date                 : 9/20/94
Found in Baseline             : 1.1b18
Found Date                    : 9/20/94
Severity                      : A
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b19
Affected File(s)              : dtss_service_ncl.c
Sensitivity                   : public

[9/20/94 public]

The counters are comming back correctly:

dtscp> show all count
Creation Time             = 1994-09-20-14:01:32.870-04:00I3.313
Local Times Not Intersecting = 0
Server Times Not Intersecting = 0
Different Epochs Detected = 0
Too Few Servers Detected  = 0
Time Provider Timeouts Detected = 0
Protocol Mismatches Detected = 0
Time Representation Mismatches Detected = 0
No Global Servers Detected = 0
Servers Not Responding    = 0
Clock Settings            = 0
Epoch Changes Completed   = 0
System Errors Detected    = 0
Synchronizations Completed = 2
Updates Initiated         = 0
Enable Directives Completed = 2
Disable Directives Completed = 1
Insufficient Resources Detected = 0
Time Provider Failures Detected = 0
Local server not in group = 0
Servers not in group      = 0

dtscp> show Time Representation Mismatches Detected 
Time Representation Mismatches Detected = 0

dtscp> sho Disable Directives Completed 
Disable Directives Completed = 4294967296

dtscp> show Servers not in group   
Servers not in group      = 0

The 'all' group comes back right, but the individual counters don't.

[9/20/94 public]
Modified CopyInt64toBuff macro to explicitly copy high and low components.

For the 'all counters' case, idl does the work, but in the 64 bit
counters case, we convert them to/from idl_uhyper_int so idl only does
half the work.



CR Number                     : 12186
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : 
Short Description             : timespec_t definition wrong
Reported Date                 : 9/14/94
Found in Baseline             : 1.1b17
Found Date                    : 9/14/94
Severity                      : B
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b18
Affected File(s)              : time/common/utc.h
Sensitivity                   : public

[9/14/94 public]
The definition of timespec_t should be changed from:
         typedef struct timespec {
             unsigned long tv_sec;
             long tv_nsec;
         } timespec_t;
to:
	typedef struct timespec {
		time_t  tv_sec;         /* seconds */
		long    tv_nsec;        /* nanoseconds */
	} timespec_t;

this is the Posix definition.  Note that time_t is defined to be 32 signed
bits, and it is on our reference platforms.

Note that there should be no interop problems since timespec_t is not
transmitted over the wire.  It is used in the conversion routines
found in the library for the time service that make it easier for a
user to get from/to a DCE time service timestamp to the common POSIX
representations of time. e.g. utc_bintime.

It would be great if we could get this into 1.1.

[9/15/94 public]
Changed timespec as above.
Also changed reltimespec to make tv_sec from long to time_t.



CR Number                     : 12065
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : dts
Subcomponent Name             : rpc dg calls
Short Description             : dtsd core dumps on restart (HP)
Reported Date                 : 9/6/94
Found in Baseline             : 1.1b16
Found Date                    : 9/6/94
Severity                      : A
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b19
Affected File(s)              : libutc/user/utc_adjtime_user.c
Sensitivity                   : public

[9/6/94 public]

Feel like this is a duplicate but can't find the other so here goes:

build: bl-16.3

Restarting cell after taking it down hard (attempted /etc/dce_shutdown -f
got nowhere and since it's a dfs cell, have to reboot anyway so I did :-)

dtsd core dumped immediately with:

Copyright Hewlett-Packard Co. 1985,1987-1992. All Rights Reserved.
<<<< XDB Version A.09.01 HP-UX >>>>
Core file from:  dtsd
Child died due to: segmentation violation
Procedures:      0
Files: 0
>trace
 0 rpc__naf_addr_free@libdce + 0x00000008 (hp-ux export stub)
 1 cma__block@libdce + 0x000007a4 (0x400df800, 0x3, 0x400d517c, 0x7)
 2 rpc__dg_ccall_free@libdce + 0x0000014c (0x400df800, 0x96, 0x4004a4e4, 0)
 3 rpc__dg_ccall_timer@libdce + 0x00000140 (0x400df800, 0x7af3736a, 0x400d1070, 0x5)
 4 rpc__timer_callout@libdce + 0x000000c0 (0x7aff0c58, 0x7afed550, 0x4004a49c, 0)
 5 timer_loop@libdce + 0x0000007c (0x4004a0e0, 0x7af4f1b0, 0x400284c0, 0x3)
 6 cma__thread_base@libdce + 0x0000021c (0x400284c0, 0, 0, 0)
 7 cma__thread_start1@libdce + 0x0000004c (0x400284c0, 0, 0, 0)
 8 cma__thread_start0@libdce + 0x00000008 (0x400284c0, 0, 0, 0)
 9 cma__thread_start0@libdce + 0x00000008 (0x400284c0, 0, 0, 0)
10 cma__thread_start0@libdce + 0x00000008 (0x400284c0, 0, 0, 0)

This dtsd was one of 3 local servers in the cell - all HPs - others came
up fine.

[9/20/94 public]
This looks like memory corruption, which in several places (security)
has been fixed.
I restarted dtsd several times on an HP(bl-18) and I am unable to reproduce
Any status?  Has this been seen lately?

[9/20/94 public]
I haven't seen this on bl-18 either ... and I had to take things down
again just as before ... maybe it IS gone ...

[9/21/94 public]
Just seen today on the HP on startup:

Bus error
>trace
 0 utc_adjtime@libdce + 0x00000db4 (0x2, 0, 0xfffffed4, 0xffffff10)
 1 AdjustClkEnd ()    [/project/dce/build/dce1.1/src/time/service/clock_adjust_u
ltrix.c: 368]
 2 Synchronize (stimulus = INsynchTimer, eblkPtr = 0x400ce378)    [/project/dce/
build/dce1.1/src/time/service/dtss_service_state.c: 753]
 3 ProcessEvent (eblkPtr = 0x400ce378)    [/project/dce/build/dce1.1/src/time/se
rvice/dtss_service_main.c: 610]
 4 main (argc = 2, argv = 0x7b03313c)    [/project/dce/build/dce1.1/src/time/ser
vice/dtss_service_main.c: 507]

[9/21/94 public]
This will happen if utc_gettime() gets called before utc_adjtime
in dtsd, for instance, if any serviceability is turned on for RPC.
Added a static flag private to utc_adjtime_user.c which will
indicate if we need to unmap utc_sharedptr and re-map it read/write.

I know this will fix what I saw above, but it doesn't really look
close to the trace Gail provides.  Since we haven't seen it recently
we'll just call it even.



CR Number                     : 11967
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : test
Short Description             : test-kernel fails on AT386,RIOS
Reported Date                 : 8/30/94
Found in Baseline             : 1.1b16
Found Date                    : 8/30/94
Severity                      : B
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b17
Affected File(s)              : time/common/utcapi.c
Sensitivity                   : public

[8/30/94 public]

The test-kernel DTS funtional test fails on the RIOS and on AT386. 
This is believed to be caused by a null pointer passed in as an 
argument to utc_getzone() which is then passed to memcpy().

[8/31/94 public]
Fixed. Add dummy argument to call to utc_getnextzone().



CR Number                     : 11905
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : libutc
Short Description             : semaphore operations
should include SEM_UNDO flag
Reported Date                 : 8/26/94
Found in Baseline             : 1.1b16
Found Date                    : 8/26/94
Severity                      : B
Priority                      : 2
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b17
Affected File(s)              : 
time/libutc/user/utc_shared_map.c,
time/libutc/user/utc_shared_create.c
Sensitivity                   : public

[8/26/94 public]

As currently written, on a system that uses the user-mode version of 
utc_gettime() and utc_adjtime(), a program that crashes when accessing
the shared memory segment will leave the read/write semaphores in a
state such future calls to utc_gettime() will hang the caller. 

Solution: use the SEM_UNDO flag such that, upon process exit, the
kernel will automatically (and appropriately) adjust the values of the
semaphore.

[8/30/94 public]
Submitted to nightly build on 8/29/94. Will close once we can
configure from the nightly bits. Hand tested on HPUX and works fine.



CR Number                     : 11900
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : dtscp show sync complete
Short Description             : "dtscp show sync complete"
stays in zero
Reported Date                 : 8/25/94
Found in Baseline             : 1.1b16
Found Date                    : 8/25/94
Severity                      : A
Priority                      : 0
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b17
Affected File(s)              : 
time/common/dtss_ctrl.idl,
time/control/dtsscp.c
Sensitivity                   : public

[8/25/94 public]

Using BL16, dcetmsyn failed to pass the sanity tests. I am looking at
the scripts to see why.

[8/25/94 public]

The reason why the test is failing is because the command

	dtscp show sync complete

is always returning 0. The test expects this value to be one greater than
the last value checked, after executing "dtscp synchronize".

Example:

root@west>  dtscp show sync complete
Synchronizations Completed = 0
root@west> dtscp synchronize       
root@west> dtscp show sync complete
Synchronizations Completed = 0

I must add that the NTP provider is getting a lot of timeouts - I am 
using pooch. However, the output of "dtscp show last sync" shows that
a synch happened.

[8/26/94 public]
The "show <attribute>" command didn't have an entry for 64bit
counters. Only 4 bytes (32 bits) were being sent, which happened to be
OK prior to the 64 bit changes. This only showed up when printing the 
hyperints directly; when displayed using the ShowAllCounters()
command, they were displayed correctly.

Added a union discriminator for a hyperint, and modified dtscp to 
mark the 64bit fields with this value. dtsd was going the right thing;
IDL just wasn't sending the bytes.



CR Number                     : 11867
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : dtscp
Short Description             : dtsscp core dumps if dtsd
binding file not found on local machine
Reported Date                 : 8/24/94
Found in Baseline             : 1.1b16
Found Date                    : 8/24/94
Severity                      : B
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b17
Affected File(s)              : time/control/dtsscp.c
Sensitivity                   : public

[8/24/94 public]

dtsscp will core-dump if the dtsd bindings file is not found.

[8/25/94 public]

Fixed. Check logical return value and exit if an error occurred
reading the bindings from the file.



CR Number                     : 11856
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : dtsdate
Short Description             : dtsdate -q doesn't return error status
Reported Date                 : 8/24/94
Found in Baseline             : 1.1b16
Found Date                    : 8/24/94
Severity                      : B
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b17
Affected File(s)              : time/service/dtss_service_main.c
Sensitivity                   : public

[8/24/94 public]

The dtsdate command has to way to tell if the host you are trying
to query was reached.

root@surf# dtsdate -q goober 10
root@surf# echo $status
1

Does this mean I need to set the clock or that I couldn't reach goober.
It should exit with status 2 or something so I can tell whats happening.

I need this for dce_config.

[8/25/94 public]

Now returns 2 if the time is out of range ; 1 means an error.



CR Number                     : 11855
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : doc
Inter-dependent CRs           : 11127
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : ref_guide
Short Description             : dtsdate man page example say dtstime
Reported Date                 : 8/24/94
Found in Baseline             : 1.1
Found Date                    : 8/24/94
Severity                      : C
Priority                      : 2
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1doc
Affected File(s)              : dce_books/command_ref/man8dce/dtsdate.8dts
Sensitivity                   : public

[8/24/94 public]

The dtsdate man page examples section refers to the command as dtstime.

[8/23/94 public]

In addition, please change the doc to read that dtsdate now returns a 
status value of 2 if the query flag is asserted and the time on the 
remote machine is more than <seconds> different from the local host.

[08/25/94 public]
Assigned to myself.  Changed priority to "2" and severity to "C".

[08/25/94 public]
Reassigned to writer Peter Neilson as part of his work
on open CR 11127.

[09/30/94 public]
Verified by Tom Jordahl.

[10/27/94 public]
Closed bug.



CR Number                     : 11845
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : test/time/service/dtss-graph.c
Short Description             : Unexpected symbols
Reported Date                 : 8/24/94
Found in Baseline             : 1.1
Found Date                    : 8/24/94
Severity                      : A
Priority                      : 0
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b17
Affected File(s)              : test/time/service/dtss-graph.c
Sensitivity                   : public

[8/24/94 public]

c89 -c    -D_SHARED_LIBRARIES    -D__hppa -Dhp9000s800 -Dhp9000s700 -D__hp9000s800 -D__hp9000s700 -DHPUX -D__hpux -Dunix +DA1.0 -D_HPUX_SOURCE    -I. -I/u3/devobj/sb/nb_ux/src/test/time/service -I/project/dce/build/dce1.1-snap/src/test/time/service  -I../../../time/common -I/u3/devobj/sb/nb_ux/src/time/common -I/project/dce/build/dce1.1-snap/src/time/common -I/u3/devobj/sb/nb_ux/export/hp800/usr/include -I/project/dce/build/dce1.1-snap/export/hp800/usr/include    /project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 314: error 1000: Unexpected symbol: "(".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 314: error 1000: Unexpected symbol: ")".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 313: warning 557: Missing declaration specifiers, "int" assumed.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 313: error 1677: Invalid storage class specifier "static".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 313: error 1574: Unknown size for "UpdateMinMaxTime".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 317: error 1000: Unexpected symbol: "(".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 317: error 1000: Unexpected symbol: ")".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 316: warning 557: Missing declaration specifiers, "int" assumed.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 316: error 1677: Invalid storage class specifier "static".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 316: error 1711: Inconsistent parameter list declaration for "prototype".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 319: error 1000: Unexpected symbol: "(".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 319: warning 557: Missing declaration specifiers, "int" assumed.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 319: error 1677: Invalid storage class specifier "static".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 319: error 1573: Type of "<<<NULL_SYMBOL>>>" is undefined.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 319: error 1711: Inconsistent parameter list declaration for "prototype".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 322: error 1000: Unexpected symbol: "(".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 321: warning 557: Missing declaration specifiers, "int" assumed.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 321: error 1677: Invalid storage class specifier "static".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 321: error 1574: Unknown size for "ScanServerArray".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 322: error 1573: Type of "<<<NULL_SYMBOL>>>" is undefined.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 321: error 1711: Inconsistent parameter list declaration for "prototype".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 324: error 1000: Unexpected symbol: "(".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 324: warning 557: Missing declaration specifiers, "int" assumed.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 324: error 1677: Invalid storage class specifier "static".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 324: error 1573: Type of "<<<NULL_SYMBOL>>>" is undefined.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 324: error 1711: Inconsistent parameter list declaration for "prototype".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 326: error 1000: Unexpected symbol: "(".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 326: warning 557: Missing declaration specifiers, "int" assumed.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 326: error 1677: Invalid storage class specifier "static".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 326: error 1573: Type of "<<<NULL_SYMBOL>>>" is undefined.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 326: error 1711: Inconsistent parameter list declaration for "prototype".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 328: error 1000: Unexpected symbol: "(".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 328: warning 557: Missing declaration specifiers, "int" assumed.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 328: error 1677: Invalid storage class specifier "static".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 328: error 1573: Type of "<<<NULL_SYMBOL>>>" is undefined.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 328: error 1711: Inconsistent parameter list declaration for "prototype".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 330: error 1000: Unexpected symbol: "(".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 330: warning 557: Missing declaration specifiers, "int" assumed.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 330: error 1677: Invalid storage class specifier "static".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 330: error 1573: Type of "<<<NULL_SYMBOL>>>" is undefined.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 330: error 1711: Inconsistent parameter list declaration for "prototype".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 333: error 1000: Unexpected symbol: "(".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 332: warning 557: Missing declaration specifiers, "int" assumed.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 332: error 1677: Invalid storage class specifier "static".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 332: error 1574: Unknown size for "PrintPage".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 333: error 1573: Type of "<<<NULL_SYMBOL>>>" is undefined.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 332: error 1711: Inconsistent parameter list declaration for "prototype".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 337: error 1000: Unexpected symbol: "(".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 336: warning 557: Missing declaration specifiers, "int" assumed.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 336: error 1677: Invalid storage class specifier "static".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 337: error 1573: Type of "<<<NULL_SYMBOL>>>" is undefined.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 336: error 1711: Inconsistent parameter list declaration for "prototype".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 341: error 1000: Unexpected symbol: "(".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 340: warning 557: Missing declaration specifiers, "int" assumed.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 340: error 1677: Invalid storage class specifier "static".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 341: error 1573: Type of "<<<NULL_SYMBOL>>>" is undefined.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 340: error 1711: Inconsistent parameter list declaration for "prototype".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 345: error 1000: Unexpected symbol: "(".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 344: warning 557: Missing declaration specifiers, "int" assumed.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 345: error 1573: Type of "<<<NULL_SYMBOL>>>" is undefined.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 344: error 1711: Inconsistent parameter list declaration for "prototype".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 349: error 1000: Unexpected symbol: "(".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 348: warning 557: Missing declaration specifiers, "int" assumed.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 348: error 1677: Invalid storage class specifier "static".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 349: error 1573: Type of "<<<NULL_SYMBOL>>>" is undefined.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 348: error 1711: Inconsistent parameter list declaration for "prototype".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 353: error 1000: Unexpected symbol: "(".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 353: warning 557: Missing declaration specifiers, "int" assumed.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 353: error 1677: Invalid storage class specifier "static".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 353: error 1574: Unknown size for "ReadTraceVersion".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 353: error 1573: Type of "<<<NULL_SYMBOL>>>" is undefined.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 353: error 1711: Inconsistent parameter list declaration for "prototype".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 356: error 1000: Unexpected symbol: "(".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 355: warning 557: Missing declaration specifiers, "int" assumed.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 355: error 1677: Invalid storage class specifier "static".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 356: error 1573: Type of "<<<NULL_SYMBOL>>>" is undefined.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 355: error 1711: Inconsistent parameter list declaration for "prototype".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 359: error 1000: Unexpected symbol: "(".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 359: error 1000: Unexpected symbol: ")".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 358: warning 557: Missing declaration specifiers, "int" assumed.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 358: error 1574: Unknown size for "BuildLocalStats".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 362: error 1000: Unexpected symbol: "(".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 363: error 1000: Unexpected symbol: ")".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 361: warning 557: Missing declaration specifiers, "int" assumed.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 361: error 1574: Unknown size for "BuildNodeStats".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 361: error 1711: Inconsistent parameter list declaration for "prototype".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 366: error 1000: Unexpected symbol: "(".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 365: warning 557: Missing declaration specifiers, "int" assumed.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 365: error 1574: Unknown size for "FindNodeName".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 366: error 1573: Type of "<<<NULL_SYMBOL>>>" is undefined.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 365: error 1711: Inconsistent parameter list declaration for "prototype".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 371: error 1000: Unexpected symbol: "(".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 370: warning 557: Missing declaration specifiers, "int" assumed.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 370: error 1574: Unknown size for "WriteCenteredString".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 371: error 1573: Type of "<<<NULL_SYMBOL>>>" is undefined.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 370: error 1711: Inconsistent parameter list declaration for "prototype".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 376: error 1000: Unexpected symbol: "(".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 375: warning 557: Missing declaration specifiers, "int" assumed.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 375: error 1574: Unknown size for "WriteRightedDouble".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 376: error 1573: Type of "<<<NULL_SYMBOL>>>" is undefined.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 375: error 1711: Inconsistent parameter list declaration for "prototype".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 381: error 1000: Unexpected symbol: "(".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 381: error 1000: Unexpected symbol: ")".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 380: warning 557: Missing declaration specifiers, "int" assumed.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 380: error 1574: Unknown size for "ZeroStats".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 380: error 1711: Inconsistent parameter list declaration for "prototype".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 677: warning 562: Redeclaration for "MakePostscriptGraph"; "static" used.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 723: error 1584: Inconsistent type declaration: "PrintPage".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 756: warning 562: Redeclaration for "MakePostscriptSummary"; "static" used.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 790: warning 562: Redeclaration for "MakePostsriptPage"; "static" used.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 848: error 1554: Indirection must be through a pointer.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 1075: error 1554: Indirection must be through a pointer.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 1116: warning 562: Redeclaration for "LoadServerArray"; "static" used.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 1204: error 1584: Inconsistent type declaration: "ScanServerArray".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 1271: error 1588: "SortCompare" undefined.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 1304: error 1584: Inconsistent type declaration: "BuildLocalStats".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 1323: error 1584: Inconsistent type declaration: "BuildNodeStats".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 1397: error 1584: Inconsistent type declaration: "UpdateMinMaxTime".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 1461: warning 562: Redeclaration for "ReadInputLine"; "static" used.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 1572: error 1584: Inconsistent type declaration: "FindNodeName".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 1617: warning 562: Redeclaration for "LabelY"; "static" used.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 1763: warning 562: Redeclaration for "MakeSummaryPage"; "static" used.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 1888: error 1554: Indirection must be through a pointer.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 1901: error 1554: Indirection must be through a pointer.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 1999: warning 562: Redeclaration for "WriteSummaryLine"; "static" used.
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 2110: error 1584: Inconsistent type declaration: "ReadTraceVersion".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 2149: error 1584: Inconsistent type declaration: "ConvertFloatToTm".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 2159: error 1584: Inconsistent type declaration: "WriteCenteredString".
cc: "/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line 2170: error 1584: Inconsistent type declaration: "WriteRightedDouble".
cc: Panic 2161: Maximum allowed number of errors exceeded.
*** Error code 1
`build_all' not remade because of errors.
*** Error code 1

[8/23/94 public]

remove prototype macro; add prototypes, ANSI'fy function definitions. 
Compiles. Fixed.



CR Number                     : 11760
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : dtsd
Short Description             : global mutex not initialized
Reported Date                 : 8/18/94
Found in Baseline             : 1.1
Found Date                    : 8/18/94
Severity                      : A
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b15
Affected File(s)              : time/service/dtss_service_main.c
Sensitivity                   : public

[8/18/94 public]

dtsd is trying to lock DDGD.dtsd_global_mutex before it has been 
initialized.  In fact the function to initialize the mutex,
dts_dtsd_init_mutex(), is never called.

[8/18/94 public]

Absolutely correct. Added call to dts_dtsd_init_mutex() after the call 
to dts_svc_init().



CR Number                     : 11514
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 9380
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : dts
Subcomponent Name             : dtsd/libutc
Short Description             : Assertion failure: utc !=
NULL in utc_mkcomptime() function
Reported Date                 : 8/1/94
Found in Baseline             : 1.1
Found Date                    : 8/1/94
Severity                      : A
Priority                      : 0
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b14
Affected File(s)              : time/service/dtss_service_state.c,
  time/common/utcapi.c
  time/service/dts_provider_util.c
  time/service/logevent_v_ultrix.c
Sensitivity                   : public

[8/1/94 public]

CR 9380 was fixed by adding an assert that the output parameter passwd
to the utc_mkcomptime() function was not null. When dtsd is run with 
a time provider on the HP, this assertion is triggered. 

Below is the stack backtrace from the core-dump generated from the 
abort

2 _abort@libc + 0x00000078 (0x7b0338fa, 0x7b034ff0, 0x4000e690, 0)
 3 _assert@libc + 0x00000128 (0x7afae714, 0x20a477, 0x9680, 0x98)
 4 TMEM@libdce + 0x0034f370 (0, 0x7b034f08, 0x7b034f10, 0xffffb9b0) <= utc_mkcomptime ??? 
 5 TMEM@libdce + 0x00357844 (0, 0x7b0349d4, 0x7b0342a8, 0)
 6 DoSynch (IcompPtr = 0x7b0342a8)    [../../../../src/time/service/dtss_service_state.c: 2526]
 7 Synchronize (stimulus = INrcvdTPresponse, eblkPtr = 0x400b75e0)    [../../../../src/time/service/dtss_service_state.c: 889]
 8 ProcessEvent (eblkPtr = 0x400b75e0)    [../../../../src/time/service/dtss_service_main.c: 475]
 9 main (argc = 3, argv = 0x7b033a0c) [../../../../src/time/service/dtss_service_main.c: 416]

[8/2/94 public]

Modified calls to utg_getnextzone() and utc_pointtime() to not pass
NULL pointers for output parameters. This should fix the problem, at
least with the time provider interface.



CR Number                     : 11495
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : dtsd
Short Description             : some fprintf(stderr,...)
still left in code
Reported Date                 : 7/29/94
Found in Baseline             : 1.1
Found Date                    : 7/29/94
Severity                      : B
Priority                      : 2
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b17
Affected File(s)              : time/service/dtss_service_main.c
time/common/dts.sams
Sensitivity                   : public

[7/29/94 public]

There are still several instances of fprintf(stderr, left in the dtsd 
code. These should be converted to use the serviceability API instead.

[8/23/94 public]

Fixed as suggested.



CR Number                     : 11494
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 11451
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : 
Short Description             : 64-bit porting changes
Reported Date                 : 7/29/94
Found in Baseline             : 1.1
Found Date                    : 7/29/94
Severity                      : B
Priority                      : 2
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b15
Affected File(s)              : ./dce/AT386/dce.h
./dce/PMAX/dce.h
./dce/RIOS/dce.h
./dce/SVR4/dce.h
./dce/utils/misc/dce64.h
./time/common/arith.c
./time/common/dtss_attr_ranges.h
./time/common/dtss_ctrl.idl
./time/common/dtss_includes.h
./time/common/dtss_threads.h
./time/common/dtssdef.h
./time/common/dtssmacros.h
./time/common/time_support.c
./time/common/tzset.c
./time/common/utc.h
./time/common/utc_arith.h
./time/common/utcapi.c
./time/control/dtsscp.c
./time/service/clock_adjust.c
./time/service/clock_adjust_ultrix.c
./time/service/dts_provider_util.c
./time/service/dtss_malloc.c
./time/service/dtss_service.h
./time/service/dtss_service_main.c
./time/service/dtss_service_ncl.c
./time/service/dtss_service_state.c
./time/service/events.c
./time/service/logevent_v_ultrix.c
./time/service/mgtrpc.c
./time/service/provider_interface.c
./time/service/time_request.c
./time/service/timers.c
./time/service/transport_rpc.c
./time/time.mk
Sensitivity                   : public

[7/29/94 public]

This CR is a place-holder for the work that is being done at DEC to 
support the DTS component on architectures that support 64bit
longwords. 

The thrust of this effort is to move differences between 32 and 64 bit
platforms into as few locations as possible, and to hide the details 
via data abstraction. This will require the following changes.

1. define a 128 bit data type analagous to the 64 bit data type 
already in dce.h.

2. Add a U64ISNEG() macro to dce64.h for 32bit machines. DEC will add 
parallel macros for 64 bit machines to this file. 

Within the DTS component, we will redefine the Bit64 and Bit128
structures to be typedefs, and, as much as possible, use the defined 
macros for calculation. DEC will be providing the majority of changes 
to the DTS component: most of the work will occur in the time/common
subdirectory, although there will be (hopefully minor) changes to the
dtscp and dtsd modules as well.

[8/16/94 public]

The 64bit changes submitted by DEC have been merged and submitted into
the the 1.1tree. Major changes include 

+ typedefs for signed128 and unsigned128 added to dce.h
+ new macros defined for 64bit and 32bit architectures in dce64.h
+ new UTC macros added to utc_arith.h in the time subtree 
+ modifications to dts files to support these changes.



CR Number                     : 11452
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : dts
Subcomponent Name             : libutc-user
Short Description             : dtsd won't start from rc.dce with SVC_DTS_DBG
Reported Date                 : 7/26/94
Found in Baseline             : 1.1b12
Found Date                    : 7/26/94
Severity                      : B
Priority                      : 3
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b19
Affected File(s)              : time/libutc/utc_adjtime_user.c
Sensitivity                   : public

[7/26/94 public]

Exhibited by systest svccfg005  running nightly from
7/22 on HPUX (passes on osf/1).

When started from /etc/rc.dce with following specification
  SVC_DTS_DBG=dts:*.2:FILE:/dcetest/dcelocal/status/svc_logs/DBGENV/dtsd
  export SVC_DTS_DBG
  daemonrunning $DCELOCAL/bin/dtsd -s

dtsd fails to start (and fails to create debug log as specified)
but no error is reported
(Same results if DBG string is quoted or not)

yosemite / K# /etc/rc.dce
        /opt/dcelocal/bin/dced
DCED listening...
        /opt/dcelocal/bin/sec_clientd
        /opt/dcelocal/bin/cdsadv
        /opt/dcelocal/bin/dtsd -s
        /opt/dcelocal/bin/dtstimed
yosemite / K# dce.ps

The following DCE components are running on "yosemite".
   PID     STIME   TIME COMMAND
  4908  16:44:37   0:00 /opt/dcelocal/bin/sec_clientd
  4904  16:44:34   0:00 /opt/dcelocal/bin/dced
  4913  16:44:40   0:00 /opt/dcelocal/bin/cdsadv
  4922  16:45:34   0:00 /opt/dcelocal/bin/dtstimed
ERROR: "dtsd" is NOT running on "yosemite" as it should be.
ERROR: DCE on "yosemite" is NOT running as configured!

However, when subsequently started by hand using same svc spec, dtsd 
starts and records debug data 

yosemite / K# grep SVC_DTS /etc/rc.dce
SVC_DTS_DBG=dts:*.2:FILE:/dcetest/dcelocal/status/svc_logs/DBGENV/dtsd
export SVC_DTS_DBG 
yosemite / K# SVC_DTS_DBG=dts:*.2:FILE:/dcetest/dcelocal/status/svc_logs/DBGENV/dtsd
yosemite / K# export SVC_DTS_DBG 
yosemite / K# ls -l /dcetest/dcelocal/status/svc_logs/DBGENV/dtsd
/dcetest/dcelocal/status/svc_logs/DBGENV/dtsd not found
yosemite / K# /opt/dcelocal/bin/dtsd -s
yosemite / K# ls -l /dcetest/dcelocal/status/svc_logs/DBGENV/dtsd
-rw-rw-rw-   1 root     sys         4849 Jul 26 17:04 /dcetest/dcelocal/status/svc_logs/DBGENV/dtsd
yosemite / K# 
yosemite / K# dce.ps

The following DCE components are running on "yosemite".
   PID     STIME   TIME COMMAND
  5427  16:59:28   0:00 /opt/dcelocal/bin/sec_clientd
  5443  17:00:25   0:00 /opt/dcelocal/bin/dtstimed
  5511  17:04:04   0:02 /opt/dcelocal/bin/dtsd -s
  5423  16:59:25   0:01 /opt/dcelocal/bin/dced
  5432  16:59:31   0:00 /opt/dcelocal/bin/cdsadv
DCE on "yosemite" seems to be running as configured.
Configured: dtstimed dtsd cdsadv sec_clientd dced 
CDSCP says "yosemite" is responding in the cell "/.../marthal_cell.osf.org".
DTSCP says the time is:  1994-07-26-17:05:05.300-04:00I0.945

[7/26/94 public]

Well, this looks like a serviceability problem to me, since dtsd would
have made the same sequence of calls regardless of how it's started,
and especially since it works on one platform (osf1) and not the other (hp).
It sounds like an uninitialized data problem to me. 

John, do you have time to take a look at this? I'll keep this as dts 
for the moment, and assign it to me for the time being. I'll look into
a little bit, but, as I said, it sounds like a serviceability problem
to me.

One final thought, though: You might want to quote the argument for
the environment variable, however (call me paranoid).

SVC_DTS_DBG='dts:*.2:FILE:/dcetest/dcelocal/status/svc_logs/DBGENV/dtsd'

[7/26/94 public]

Some further info. I just configured an HP cell using bl-12. I tried 
running dtsd both by hand, using the following value 

SVC_DTS_DBG='dts:*.1:FILE:/opt/dcelocal/var/adm/time/dtsd.debug.log'
export SVC_DTS_DBG

This worked fine by hand. 

I then entered this same value into a test rc.dce script, and
restarted cell via that script. 

Same results. Worked fine. 

So it's a flakey. I guess we know that already.

[7/27/94]

Hmmm.  I tried it with double quotes and with no quotes and could
recreate it every time on my machine.  I'll try again with single
quotes.  By the way, in the same test it works fine for cds.

[7/27/94]
I tried it again, from rc.dce, with single quotes and got a core dump produced.

Child died due to: floating point exception

>t
 0 ReadHWclkParams + 0x00000068 (0x40010250, 0x40010254, 0x7b033b34, 0x7b033868)
 1 InitializeService + 0x000004c8 (0x2, 0x7b033690, 0x7b033868, 0)
 2 main + 0x00000114 (0x2, 0x7b033690, 0, 0)
>

[7/27/94]
Seems it doesn't show this behavior when only the SVC_DTS_DBG lines
are added to /etc/rc.dce.  However, when SVC_CDS_DBG is set similarly
before starting up cdsadv I was able to recreate this on another systest
HP, 'west', which was running split server config as sec master.
So the rc file section leading to the core dump looks like:

SVC_CDS_DBG="cds:*.2:FILE:/dcetest/dcelocal/status/svc_logs/DBGENV/cds"
export SVC_CDS_DBG
daemonrunning $DCELOCAL/bin/cdsadv
#daemonrunning $DCELOCAL/bin/cdsd
#daemonrunning $DCELOCAL/bin/auditd -a
#daemonrunning $DCELOCAL/bin/gdad
SVC_DTS_DBG="dts:*.2:FILE:/dcetest/dcelocal/status/svc_logs/DBGENV/dtsd"
export SVC_DTS_DBG
daemonrunning $DCELOCAL/bin/dtsd -s
daemonrunning $DCELOCAL/bin/dtstimed

[7/27/94 public]

John Bowe and I have both run the dtsd using the SVC_DTS_DBG
environment variables, and we cannot duplicate the core dump behavior.

The above info leaves me even more puzzled, since I can't fathom why
the presence of an environment variable that should only be read by
the 1st program should cause the 2nd program to crash. 

Therefore, I'm lowering the priority of this CR to 3, but we should
leave it open. This behavior should be tested again when we get a good
baseline (bl13) (and I sincerely hope that it goes away).

[7/28/94 public]

More info. Using the bl12 libdce.sl, the program reliably gets wrong
data back from the utc_adjtime() call (a value of 0), which causes a 
divide-by-zero error (the SIGFPE). This happens when both SVC_DTS_DBG
and SVC_CDS_DBG are set, but not when only SVC_DTS_DBG is set.

[7/28/94 public]

And yet more info. It appears to be the case that global memory is
being overwritten, since the routine that is being called (utc_adjtime
[in user space]) initializes a set of global variables, which are then
returned to the user via the utc_adjtime() API. This data is being
returned as 0.

[08/27/94 public]
Can we close or cancel this due to other fixes now?

[8/29/94 public]
No, not yet. I tried running this same scenario on my HP machine last 
Friday, and got a core-dump on the dtsd - not as quickly, but
eventually. So this needs to remain open: I'm still looking into it. 

N.B The above info was incorrect: this was an ordering
(initialization) problem in the user mode implementation of
utc_gettime/ utc_adjtime, and has been fixed. Maybe not well enough.
Stay tuned.

[8/31/94 public]

I just tried this again using the bl16.2 bits. When SVC_DTS_DBG is
set, dtsd works fine. When SVC_CDS_DBG is set
("cds:library.2:STDERR:") dtsd gets a bus error at a very strange place
(utc_adjtime() call, in what looks like a structure copy).

This issue here is that dtsd itself doesn't do anything differently...
it still makes the same sequence of API calls that it would have made
regardless of whether SVC_CDS_DBG is set or not. The only code that
should be affected by this environment variable is serviceability. 

Re-assigning this one to utils.

[9/22/94 public]
Charlie hit this on on the head when he said it was core dumping in
a structure copy.  The copy was going to a read-only shared memory
segment, and only when cds svc was turned on because it called
utc_gettime() before dtsd calls utc_adjtime(), attaching to the
shared memory segment read-only!!

Mystery solved!
Marking fixed, moving back to dts.



CR Number                     : 11391
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : dts
Subcomponent Name             : time/service
Short Description             : Undeclared identifier
Reported Date                 : 7/22/94
Found in Baseline             : 1.1
Found Date                    : 7/22/94
Severity                      : A
Priority                      : 0
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b13
Affected File(s)              : time/servicer/dts_provider_util.c
Sensitivity                   : public

[7/22/94 public]

[ /time/service ]

"/project/dce/build/dce1.1-snap/src/time/service/dts_provider_util.c", line \
 156.12: 1506-007 (S) Struct or union cma_sigaction is undefined.
"/project/dce/build/dce1.1-snap/src/time/service/dts_provider_util.c", line \
 161.5: 1506-045 (S) Undeclared identifier action.
"/project/dce/build/dce1.1-snap/src/time/service/dts_provider_util.c", line \
 162.18: 1506-045 (S) Undeclared identifier action.
"/project/dce/build/dce1.1-snap/src/time/service/dts_provider_util.c", line \
 163.5: 1506-045 (S) Undeclared identifier action.
*** Error code 1

[7/25/94]

fixed. <pthread.h> must be the first file in one's "#include" list,
since redefines every system call in site. In this case, the token 
"sigaction" is defined to be "cma_sigaction". Unfortunately, there is 
also a "structure sigaction" that get's modified as well. Sigh.



CR Number                     : 11382
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : doc
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : command_ref
Short Description             : dtsd man page needs updating
Reported Date                 : 7/21/94
Found in Baseline             : 1.1
Found Date                    : 7/21/94
Severity                      : C
Priority                      : 2
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1doc
Affected File(s)              : dce_books/command_ref/man8dts/dtsd.8dts
Sensitivity                   : public

[7/21/94 public]


The dtsd manual page should be updated to contain the following
information, which is new for DCE 1.1.

dtsd <args> [-d] [-w <serviceability string>] 

-d      debug mode. Command will run in the foreground. 
-w      <serviceability string>. See svc_route(5) for a description of the 
	appropriate format for this entry.


Running dtsd as a server 

dtsd [ -s [-k courier|noncourier] [ -g ] [ -o ]]

-s      run as a server. Default is noncourier, local server 
-g      run as a global server 
-k      <courier|noncourier>  run as either a courier, or as a non-courier.
-o      when enabling as a server, set the clocks immediately. Equivalent 
        to the dtscp "enable set clock true" or the dcecp command 
        "dts activate -abruptly"
 
Running dtsd as a clerk

dtsd -c 

dtsd can still be started in the old 1.0.x, with no command line arguments. 
(except for -d and -w). This will require that dcecp be used to start 
the server. 

Note that the dce_config program will automatically provide the appropriate 
arguments automatically depending on the choice of configuration options.

These command line arguments can also be provided as part of the fixed
configuration strings provided to dced, if dced is configured to
automatically start the dtsd.

[7/25/94 public]

Assigned this CR to Peter Neilson (OSF DTS writer).

[08/25/94 public]
Filled in Fix By Baseline field for housekeeping purposes.

[09/30/94 public]
Verified by Tom Jordahl.

[10/27/94 public]
Closed bug.



CR Number                     : 11374
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : time/service/dts_provider_util.c
Short Description             : Unable to find include file 'dce/pthread.h
Reported Date                 : 7/21/94
Found in Baseline             : 1.1
Found Date                    : 7/21/94
Severity                      : A
Priority                      : 0
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b13
Affected File(s)              : time/service/dts_provider_util.c
Sensitivity                   : public

[7/21/94 public]

build.log

c89 -c    -D_SHARED_LIBRARIES   -Dunix -D_POSIX_SOURCE  -D__hppa -Dhp9000s800 -Dhp9000s700 -D__hp9000s800 -D__hp9000s700 -DHPUX -D__hpux -Dunix +DA1.0 -D_HPUX_SOURCE    -I. -I/u3/devobj/sb/nb_ux/src/time/service -I/project/dce/build/dce1.1-snap/src/time/service  -I. -I/u3/devobj/sb/nb_ux/src/time/service -I/project/dce/build/dce1.1-snap/src/time/service -I../common/HP800 -I/u3/devobj/sb/nb_ux/src/time/common/HP800 -I/project/dce/build/dce1.1-snap/src/time/common/HP800 -I../common -I/u3/devobj/sb/nb_ux/src/time/common -I/project/dce/build/dce1.1-snap/src/time/common -I../common/POSIX -I/u3/devobj/sb/nb_ux/src/time/common/POSIX -I/project/dce/build/dce1.1-snap/src/time/common/POSIX -I/u3/devobj/sb/nb_ux/export/hp800/usr/include -I/project/dce/build/dce1.1-snap/export/hp800/usr/include    /project/dce/build/dce1.1-snap/src/time/service/dts_provider_util.c
dts_provider_util.c: 55: Unable to find include file 'dce/pthread.h'.
*** Error code 1

install.log

[ /time/service at 22:52 (PM) Wednesday ]
makepath service/. && cd service &&  exec make MAKEFILE_PASS=BASIC     install_all
make: don't know how to make dts_acts_provider (continuing)

[7/21/94 public]
My favorite topic :-)

The #include for pthread.h should NOT have "dce/" in it.
POSIX specifies the location of this file.

[7/21/94 public]
Modified dts_provider_util.c to include <pthread.h>, not
<dce/pthread.h>.



CR Number                     : 11304
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : acl manager support
Short Description             : Modify all DTS ACL
manager names and helpstrings as described below.
Reported Date                 : 7/14/94
Found in Baseline             : 1.1b11
Found Date                    : 7/14/94
Severity                      : E
Priority                      : 2
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 
Fixed In Baseline             : 1.1b12
Affected File(s)              : time/service/mgtacl.c
Sensitivity                   : public

[7/14/94 public]

BACKGROUND:
 A polymorphic object, as in DCE 1.1, can be a principal name and a 
 principal directory and therefore have 2 ACL managers. 

 In "dcecp", the ACL manager name can be obtained by invoking the
 "acl show -managers" command.  The other "acl" commands can
 accept a -type option to specify the manager name.  Previously, 
 this ACL manager name was really only informational and not visible
 to the end user, but now it is.

 Below, I have compiled a list of the ACL manager names and their 
 "helpstrings" that will be displayed to the user.

CDS ACL Managers:
    GDA managment ACL manager:
        dcecp> acl show /.:/hosts/<hostname>/cds-gda -managers
        {GDA              Change ACL for gda management}

    CDS Server Management ACL manager:
        dcecp> acl show /.:/hosts/<hostname>/cds-server -managers
        {CDS Server       Change ACL for server management}

    CDS Directory entry ACL manager:
        dcecp> acl show /.:/cell-profile -managers -entry
        {Directory entry  Change ACL for CDS directory entry}

    CDS Directory ACL manager:
        dcecp> acl show /.:/hosts -managers
        {Directory        Change ACL for CDS directory}

    CDS Clearinghouse ACL manager:
        dcecp> acl show /.:/<hostname>_ch -managers
        {Clearinghouse    Change ACL for CDS clearinghouse}

    CDS Clerk management ACL manager:
        dcecp> acl show /.:/hosts/<hostname>/cds-clerk -managers
        {CDS Clerk        Change ACL for clerk management}


Security ACL Managers:
    Security Directory ACL manager:
	dcecp> acl show /.:/sec/principal -managers
	dcecp> acl show /.:/sec/group -managers
	dcecp> acl show /.:/sec/org -managers
        {Sec Directory    Manage directory object acls.}

    Security Principal ACL manager:
        dcecp> acl show /.:/sec/principal/<name> -managers
        {Sec Principal    Manage principal object acls.}

        A polymorphic object will look like this:
	dcecp> acl show /.:/sec/principal/<princ-dir-name> -managers
	{Sec Principal    Manage principal object acls.}
	{Sec Directory    Manage directory object acls.}

    Security Group ACL manager:
        dcecp> acl show /.:/sec/group/<name> -managers
        {Sec Group        Manage group object acls.}

        A polymorphic object will look like this:
	dcecp> acl show /.:/sec/group/<group-dir-name> -managers
	{Sec Group        Manage group object acls.}
	{Sec Directory    Manage directory object acls.}

    Security Organization ACL manager:
        dcecp> acl show /.:/sec/org/<name> -managers
        {Sec Org          Manage org object acls.}

        A polymorphic object will look like this:
	dcecp> acl show /.:/sec/org/<org-dir-name> -managers
	{Sec Org          Manage org object acls.}
	{Sec Directory    Manage directory object acls.}

    Security Replica List ACL manager:
        dcecp> acl show /.:/sec/replist -managers
        {Sec Replist      Manage the replist object acl.}

    Security Policy ACL manager:
        dcecp> acl show /.:/sec/policy -managers
        {Sec Policy       Manage the policy object acl.}

    Security Extended Attribute Schema ACL manager:
        dcecp> acl show /.:/sec/xattrschema/<name> -managers
        {Sec Attr_schema  Manage the attr_schema object acl.}


DTS ACL manager:
    dcecp> acl show /.:/hosts/<hostname>/dts-entity -managers
    {dtsd             DTSD DCE Time Service daemon}


Auditing ACL manager:
    dcecp> acl show /.:/hosts/<hostname>/aud-acl -managers
    {audit            Audit daemon ACL manager}


DCED ACL managers:

    Generic ACL managers for DCED:
	dcecp> acl sh /.:/hosts/<hostname>/self -m
	dcecp> acl sh /.:/hosts/<hostname>/config -m
        {dced-mgmt        DCED manager}

        dcecp> acl show /.:/hosts/<hostname>/config/srvrconf -managers
        dcecp> acl show /.:/hosts/<hostname>/config/srvrexec -managers
	dcecp> acl show /.:/hosts/<hostname>/config/hostdata -managers
        dcecp> acl show /.:/hosts/<hostname>/config/keytab -managers
        dcecp> acl sh /.:/hosts/<hostname>/config/attr_schema -managers
        dcecp> acl show /.:/hosts/<hostname>/config/secval -managers
        {dced-managers    DCED manager Pseudo-object}

    Server configuration ACL manager:
        dcecp> acl show /.:/hosts/<hostname>/config/srvrconf/<name> -managers
        {srvrconf         Server Configuration}

    Server execution ACL manager:
        dcecp> acl show /.:/hosts/<hostname>/config/srvrexec/<name> -managers
        {srvrexec         Server Execution}
    
    Hostdata configuration ACL managers:
        dcecp> acl show /.:/hosts/<hostname>/config/hostdata/<name> -managers
        {hostdata         Host Data}

    Keytab configuration ACL manager:
        dcecp> acl show /.:/hosts/<hostname>/config/keytab/<name> -managers
        {rkeytab          Key Management}

    Extended Attribute Schema configuration ACL manager:
        dcecp> acl sh /.:/hosts/<hostname>/config/xattrschema/<name> -managers
        {attr_schema      Attribute Schema}

    Secval configuration ACL manager:
        dcecp> acl show /.:/hosts/<hostname>/config/secval/<name> -managers
        {secval           Security Validation}


DFS ACL manager:
    dcecp> acl show /.:/fs/<name> -managers
    {DFS              DFS ACL manager}


Misc:
    dcecp> acl show <application-specific ACL object>  -managers
    {general          General ACL Manager}
    Note that there is nothing DCE ships that uses this ACL manager.
    This is part of the ACL manager library for application
    developers.

____________________________________________________________
NEW GUIDELINES FOR ACL MANAGER NAMES:

We would like to enforce guidelines for all DCE ACL
managers.  These are not architectural and dcecp will accept 
any valid ACL manager names, but we would like DCE-named ACL 
managers to be named consistently and in an easily
usable manner.  Since dcecp is what will make these names
visible to a user, we are using dcecp attribute naming
conventions:

ACL manager names for all of DCE must be:
1) lowercase
2) no underscores
3) no spaces
4) 16 bytes (sizeof "sec_acl_printstring_len").
5) Choose names similiar to object command names supported in
   dcecp wherever possible.
   For example, the ACL manager name "principal" refers to
   the object that contains registry information about principals;
   /.:/sec/principal.
   Note that dcecp will allow abbreviations. For example, a user
   can specify "org" for the ACL manager name "organization".
6) Names must be unique within a component's ACL manager but not
   within DCE. 
   For example, "xattrschema" can be used for a DCED Extended
   Attribute Configuration Schema ACL object and for a Security 
   Extended Registry Attribute Schema ACL object.
7) The helpstring for an ACL manager must specify the component
   that owns or manages the objects in questions, since this 
   information cannot always be derived from the ACL manager name.
____________________________________________________________
PROPOSAL:

Below are the current DCE ACL manager names/helpstrings and their 
proposed names/helpstrings following the above guidelines.

  Old names        New names/helpstrings
--------------    ---------------------------
GDA               {gda           Global Directory Agent server}
CDS Server        {cdsserver     Cell Directory Service server}
Directory entry   {entry         CDS namespace entry ACLs}
Directory         {directory     CDS directory ACLs}
Clearinghouse     {clearinghouse CDS clearinghouse ACLs}
CDS Clerk         {cdsclerk      Cell Directory Service clerk}
Sec Principal     {principal     Registry principal object ACLs}
Sec Directory     {secdirectory  Registry directory object ACLs}
Sec Group         {group         Registry group object ACLs}
Sec Org           {organization  Registry organization object ACLs}
Sec Replist       {replist       Registry replica list object ACL}
Sec Policy        {policy        Registry policy object ACL}
Sec Attr_schema   {xattrschema   Registry extended attribute schema object ACLs}
dtsd              {dts           Distributed Time Service server or clerk}
audit             {audit         Audit server}
dced-mgmt         {dced          DCED server}
dced-managers     {container     DCED container ACLs}
srvrconf          {srvrconf      DCED server configuration object ACLs}
srvrexec          {srvrexec      DCED server execution object ACLs}
hostdata          {hostdata      DCED host data object ACLs}
rkeytab           {keytab        DCED key management object ACLs}
attr_schema       {xattrschema   DCED extended attribute schema object ACLs} 
secval            {secval        DCED security validation service}
DFS               {dfs           Distributed File Service server}
general           {generic       Generic ACL server}

[7/18/94 public]
Fixed name and help string in dtsd.  Submitted to nightly build of 7-18-94.



CR Number                     : 11290
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : dce_shutdown
Short Description             : dce_shutdown -f causes dts error messages
Reported Date                 : 7/14/94
Found in Baseline             : 1.1
Found Date                    : 7/14/94
Severity                      : B
Priority                      : 2
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b17
Affected File(s)              : time/common/dts.sams
Sensitivity                   : public

[7/14/94 public]

From 11119:

[7/13/94 public]

/etc/dce_shutdown 5 times - no dts error messages
/etc/dce_shutdown -f 2 times - got dts error messages

Says to me if you let things shut down in order useing the command
programs to shut all of the servers down things work. If you send
kills to the servers at least dts isn't finished with the namespace
and or dced when they go away. I'll see what I can do to sequence things
so the forced shutdown works a bit better but the message here is
don't use forced shutdown. The non forced shutdown attempts to bring
things down gracefully and if anything is left it then and only then
dispatches it with a signal. This takes a bit longer but it works much
better. The -f option tells shutdown to send the signals now - make
no attempt to take the servers down gracefully.

[7/14/94 public]
I don't know the current state of things and am not trying to comment on
them.   I'll just say this:  If use of dce_shutdown -f causes the cell
to be in such a state that it cannot be restarted, then the command is
broken.  If it cannot be fixed it should be removed.  Of course if this
is not the case then please simply state this and ingore my comment.  :-)

[7/14/94 public]
This defect is to get rid of the warning messages on shutdown.
This is cause by dtsd trying to unregister stuff and meanwhile
dce_shutdown has already killed cds.
It has nothing to do with startup.

There is another defect for the problem of cdsadv not allowing cds 
operations on startup. (ie all the errors can be traced back to
cdsadv being hosed).

[8/24/94 public]
Assigning this to DTS so the component owner can decide if
dts should complain about unregistering things when it gets killed.

[8/26/94 public]

The real issue here is: how much should a daemon try to clean up 
after itself when sent a SIGTERM? Should it not 1) unexport its
entries from the namespace? Remove endpoints from the endpoint map? 
Just exit()? 

Any of these are possible. I could be persuaded that a simple exit() 
is the right thing to do here.

[08/26/94 public]
I think the most correct thing to do is clean up as much as possible
and report errors unless they're "service not available" errors.
Not surprisingly, I think this is the most amount of work of the
various options. :(

[8/31/94 public]
OK. What I've done is to track the error messages that (could) get 
generated during this shutdown call, and changed the severity to 
warnings. That way, a sys admin can determine if they want to see 
warnings or not, and route them accordingly.  This is a compromise. 

Marking as closed.



CR Number                     : 11275
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : doc
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : app_ref
Short Description             : utc_reltime does not allow NULL input
Reported Date                 : 7/13/94
Found in Baseline             : 1.0.3
Found Date                    : 7/13/94
Severity                      : B
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1doc
Affected File(s)              : dce_books/app_ref/man3dts/utc_ascreltime.3dts, utc_reltime.3dts
Sensitivity                   : public

[7/13/94 public]

Full Description:

        The api utc_reltime and utc_ascreltime returns (-1)
        when the input utc time is NULL. The OSF documentation
        says that NULL input is allowed as a default for the
        current time.  However in utc_reltime, NULL input is checked for
        and (-1) is returned.

Repeat By:


Proposed Solution:
       Change the OSF documentation to require a valid utc
       structure containing a relative time. This would be
       more inline with the use of relative time structures.

[8/29/94 public]
Removed reference to NULL utc input.  Verified by Nick Dokos.

[09/01/94 public]
Closed bug.



CR Number                     : 11254
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : svc
Short Description             : Typo -> Too fews servers
Reported Date                 : 7/12/94
Found in Baseline             : 1.1
Found Date                    : 7/12/94
Severity                      : E
Priority                      : 4
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b12
Affected File(s)              : time/common/dts.sams
Sensitivity                   : public

[7/12/94 public]

Hardly a priority but something that catches your eye when
you configure as often as I do:

1994-07-12-09:35:32.605-04:00I----- dtsd WARNING dts config 0x200aaef8
Too fews servers (1), need 3 servers

should be "Too few servers ..."

[7/12/94 public]

Yes, I've noticed it too. I will fix it as part of my next submission (whatever
that will be).

[7/18/94 public]

Fixed in nightly build of 7-18-94.



CR Number                     : 11240
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : dtsd
Short Description             : dtsd needs to be able to
retrieve configuration information from dced
Reported Date                 : 7/11/94
Found in Baseline             : 1.1
Found Date                    : 7/11/94
Severity                      : C
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b19
Affected File(s)              : querydced.c
Sensitivity                   : public

[7/11/94 public]
The dtsd needs new functionality to allow configuration information to
be stored via the new functionality provided by dced for DCE 1.1. This
CR is a placeholder for adding that new functionality.

dtsd already allows a sequence of command line arguments that allow
it to initialize with the appropriate "personality" (i.e. a particular
server incarnation, or a clerk). These arguments can be provided
either via dce_config of via a remote administrator modifying the
fixed arguments for a given server entry.

However, there are several other attributes ("characteristics") that
it would be useful to allow a systems administrator to set (see
table 15-2 in section 15.3 in the DCE Administration Guide). The goal
of this enhancement is to provide that functionality.

[8/30/94 public]
Changed to defect, and raised to Priority 1 for tracking purposes,
since this is part of new functionality for DCE1.1

[9/20/94 public]
Charlie implemented this functionality and I have verified that it works.
Marking fixed.



CR Number                     : 11154
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : pmax
S/W Ref Platform              : osf1
Component Name                : dts
Subcomponent Name             : 
Short Description             : timer thread expires before sync thread and causes server binding to be released twice.
Reported Date                 : 6/30/94
Found in Baseline             : 1.0.3
Found Date                    : 6/30/94
Severity                      : C
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b13
Affected File(s)              : time/service/time_request.c
Sensitivity                   : public

[6/30/94 public]

When a sync takes place, there is timer thread goes off too.  The problem
occures when timer threads expires before the sync (RPC call) thread (could
be server went away or other reasons).  Once timer thread expires, it'll
lock a mutex and release the server binding then destroy the mutex too.
Later, the sync thread comes back to do the release.  It'll try to lock 
the mutex which was already destroied.  And that is when the failure occurs.

The fix is in module time/service/time_request.c to add a check whether the
server is still on response queue before it's released.

The change is in function GetTimeFromServerRPC at arounf line 647.
The diff looks like this:


change - 

    if (rpcStatus != rpc_s_ok) {
        /*
         * TBD - Do we try to recover here if we get a "wrong boot time" error?
         */
        LogEventDCEerror (rpcStatus, "Error requesting time from server :");

        FreeTimeReqEvent (eblkPtr);
        ReleaseServerBinding (bindPtr);
        return ((pthread_addr_t)NULL);
    }

    ReleaseServerBinding (bindPtr);

to -

    /*
     * Check to see if the server is still on the response queue.
     * The server could have been removed due to the timer expiring.
     * If the server is no longer on the response queue then we
     * don't have to do a ReleaseServerBinding.
     */
    if (FindResponseElement(reqPtr->synchSerialNo, reqPtr->msgIdSerial))
       ReleaseServerBinding (bindPtr);

    if (rpcStatus != rpc_s_ok) {
        /*
         * TBD - Do we try to recover here if we get a "wrong boot time" error?
         */
        LogEventDCEerror (rpcStatus, "Error requesting time from server :");

        FreeTimeReqEvent (eblkPtr);
        return ((pthread_addr_t)NULL);
    }

[07/27/94 public]

Incorporated the above fix into nightly build of 7/27/94, so it will
show up (officially) in baselevel13.



CR Number                     : 11149
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : api
Short Description             : utc_mkasctime accepts a relative timestamp
Reported Date                 : 6/30/94
Found in Baseline             : 1.1b10
Found Date                    : 6/30/94
Severity                      : C
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b15
Affected File(s)              : time/common/utc_cvt.c
Sensitivity                   : public

[6/30/94 public]
utc_mkasctime accepts a relative timestamp, where is should reject it.

For reference, utc_mkascreltime correctly accepts relative times and
rejects absolute ones.

Test program to demonstrate the problem:

#include <dce/utc.h>

main () {
    utc_t time_out;

    static char *rt = "+0-00:00:01.201I-----";
    static char *at = "1994-06-30-16:23:20.665+00:00I-----";

    if (utc_mkascreltime(&time_out, rt) == 0) {
        printf ("rt was accepted by ascreltime\n");
    }
    else {
        printf ("rt was not accepted by ascreltime\n");
    }

    if (utc_mkascreltime(&time_out, at) == 0) {
        printf ("at was accepted by ascreltime\n");
    }
    else {
        printf ("at was not accepted by ascreltime\n");
    }

    if (utc_mkasctime(&time_out, rt) == 0) {
        printf ("rt was accepted by asctime\n");
    }
    else {
        printf ("rt was not accepted by asctime\n");
    }

    if (utc_mkasctime(&time_out, at) == 0) {
        printf ("at was accepted by asctime\n");
    }
    else {
        printf ("at was not accepted by asctime\n");
    }
}

[ninja]:/tmp> a.out
rt was accepted by ascreltime
at was not accepted by ascreltime
rt was accepted by asctime
at was accepted by asctime

[8/8/94 public]

This bug is tricky, because of the ISO rules regarding truncation and 
handling of defaults.

I've made the following determination, and will probably submit this
fix soon.

I can catch strings that start with a '+', and flag those as an error
(there are no absolute time strings that can legally start with a '+')

Relative time strings (RTS) that start with a hyphen ('-'), indicating
a negative relative time, are already flagged as an error by the 
parser. 

However, that leaves a class of strings (such as
"1-09:30:10.01I-----") that can be legally parsed as either a relative
timestamp or an absolute timestamp), and can only be differentiated by
context (e.g. a call to utc_mkasctime() or utc_mkascreltime()). Hence,
since the input is ambiguous, it's pretty hard (without) making up
some very arbitrary rules, to determine that a particular date string
isn't really what the user meant.



CR Number                     : 11127
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : doc
Inter-dependent CRs           : 10792,11855
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : dtsdate
Short Description             : dtsdate command needs documentation
Reported Date                 : 6/29/94
Found in Baseline             : 1.1
Found Date                    : 6/29/94
Severity                      : C
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1PH
Fixed In Baseline             : 1.1doc
Affected File(s)              : dce_books/command_ref/man8dce/dtsdate.8dts
Sensitivity                   : public

[6/29/94 public]

The dtsdate command, which allows a local clock to be set from that of
a host running a dtsd server, needs to be documented. This requires
that a manual page should be written, and the following general document
areas should be updated to reflect how and when to utilize this command 

  Installation

  Administration 
     DTS
     DFS

Specifically, the clock constraints amongst the various DCE servers
and hosts need to be more fully documented. Specifically, the clocks
among all DCE components must be within 5 minutes of each other, or
CDS and security will fail. However, DFS file servers have more
stringent requirements (clocks must be within 10 seconds of each
other).

Problems that can arise by setting clocks backwards need to be
emphasized.

[6/29/94 public]

From Charlie Brooks, I have learned that dtsdate is a utility
on the order of getip and dce_config (i.e., it has no relation
to dtscp and/or dcecp). It is primarily used during initial cell
configuration and/or host instantiation into a cell to ensure
that CDS, security, and especially DFS configuration do not
"bog down" due to clock skew.

I'm assigning this CR to Peter Neilson (OSF DTS writer). Charlie
will provide detailed information to help get the command documented.
It looks to me like the man page for dtsdate belongs
in /command_ref/man8dce and the guide information belongs in
the Admin Guide - Introduction in the "Configuring and Starting
Up DCE" part.

[09/30/94 public]
Reference page created.  Verified by Tom Jordahl.

[10/27/94 public]
Re-opened this CR for 1.1PH.
Everything looks fine, we just need to enclose this 
reference page in .zA/.zZ change markers to reflect the
fact that it is new for 1.1.

[10/27/94 public]
Since (in theory) the 1.1 markers should be stripped for the 1.2 docs,
I'm closing this one.



CR Number                     : 11112
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : serviceability
Short Description             : additional serviceability messages needed
Reported Date                 : 6/28/94
Found in Baseline             : 1.1
Found Date                    : 6/28/94
Severity                      : C
Priority                      : 2
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b11
Affected File(s)              : common/dts.sams
dts/service/dtss_service_global_set.c
dts/service/dtss_service_main.c
dts/sevice/dtss_service_ncl.c
dts/service/mgtacl.c
dts/service/mgtrpc.c
dts/service/provider_interface.c
dts/service/time_request.c
Sensitivity                   : public

[6/28/94 public]

The LogEventDCEerror() function, as written, only prints out the DCE 
error message retrieve from dce_error_inq_text() with no explanatory
text, unless DCE_DEBUG is defined, in which case the messages are not
internationalized. All instances of this call should be replaced by 
a call to dce_svc_printf() with an appropriate error message and 
severity code.

[7/15/94 public]

This was submitted and is included in bl11.



CR Number                     : 11089
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : 
Short Description             : change default "error tolerance" setting to 5 minutes instead of 10, and change documentation.
Reported Date                 : 6/27/94
Found in Baseline             : 1.1
Found Date                    : 6/27/94
Severity                      : C
Priority                      : 3
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b14
Affected File(s)              : time/common/dtss_attr_ranges.h
Sensitivity                   : public

[6/27/94 public]

Existing DCE 1.0.3 Administration documentation indicates that certain
applications, such as the CDS server, require that systems have no
more than 5 minutes skew between clocks. Since the expectation is tha
DTS will probably be running in a cell where this restriction applies,
it makes sense to set the maximum inaccuracy to this value by default,
instead of the current 10 minutes.

[7/28/94 public]

Modified default error tolerance value to be 5 minutes rather than 10
minutes.



CR Number                     : 11085
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : 
Short Description             : duplicate definitions in dtssdef.h
Reported Date                 : 6/27/94
Found in Baseline             : 1.1
Found Date                    : 6/27/94
Severity                      : D
Priority                      : 3
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1
Affected File(s)              : time/common/dtssdef.h
Sensitivity                   : public

[6/27/94 public]

The header file dtssdef.h contains duplicate type definitions for
types defined in dtss_ctrl.idl when the macro CONFIG_RPC is defined.
Since this is the default case for DCE DTS, these definitions should
be removed.

[cbrooks 6/29/94] 

Removed duplicate structure definitions, typedefs, etc. from
dtssdef.h.

Other uses of the CONFIG_RPC macro (currently the default for DCE)
will be removed as part of the code cleanup task (CR10457).



CR Number                     : 11026
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : test
Inter-dependent CRs           : 12474
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : test_dtscp.ksh
Short Description             : dts dtscp tests need re-work
Reported Date                 : 6/21/94
Found in Baseline             : 1.1
Found Date                    : 6/21/94
Severity                      : C
Priority                      : 2
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b21
Affected File(s)              : dtscp.ksh test_dtscp.*
Sensitivity                   : public

[6/21/94 public]

The dtscp interface tests need updating. 

1) The help command sections modification to pick up minor changes in syntax
between 1.0.x and 1.1.

2) It may be worth thinking about updating the test to make it less
sensitive to minor changes in values. At present, the tests are very
sensitive to "off by one" errors and timing problems which do not 
represent errors in the interface, but differences in state.

3) All of the above should be considered in light of the the fact that 
dtscp is deprecated in DCE 1.1 and will ultimately be replaced by
dcecp.

[10/4/94 public]
1. - modified expected results
2. - Added a few sleeps to make sure state tests come out correct
3. - the dtscp test tests specific commands dcecp test don't.

Did all three of these things under OT 12474.
Marking as fixed since this is more detailed.



CR Number                     : 10945
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : svc
Short Description             : TP errors should be ERROR in svc
Reported Date                 : 6/14/94
Found in Baseline             : 1.1
Found Date                    : 6/14/94
Severity                      : C
Priority                      : 3
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b13
Affected File(s)              : ./time/common/dts.sams
./time/service/dts_acts_provider.c
./time/service/dts_hopf_provider.c
./time/service/dts_ntp_provider.c
./time/service/dts_null_provider.c
./time/service/dts_provider_util.c
./time/service/dts_provider_util.h
./time/service/dts_spectracom_provider.c
./time/service/dts_traconex_provider.c
Sensitivity                   : public

[6/14/94 public]

If you configure a Time Provider in your cell, then kill it,
dtsd reports SVC ERRORs when it probably shouldn't:

orange>dtscp sync
1994-06-14-13:29:24.042-04:00I0.956 dtsd ERROR dts events 0x202432b8
DCE error failure in TP rpc_mgmt_inq_server_princ_name: : connection request rej
ected (dce / rpc)
orange>1994-06-14-13:29:26.374-04:00I0.958 dtsd WARNING dts config 0x200ab388
Too fews servers (1), need 3 servers


If dtsd doesn't find a TP, this shouldn't be a problem and it shold
probably only be a notice.  

Looking at the provider code, it registers it endpoint with the ep map.
When the process is kill'd, it does not unregister the endpoint, which
is probably the source of the error.

From rpccp show mapping:
  <object>         nil
  <interface id>   bfca1238-628a-11c9-a073-08002b0dea7a,1.0
  <string binding> ncacn_ip_tcp:130.105.5.21[2767]
  <annotation>     NTP Time Provider

  <object>         nil
  <interface id>   bfca1238-628a-11c9-a073-08002b0dea7a,1.0
  <string binding> ncadg_ip_udp:130.105.5.21[1928]
  <annotation>     NTP Time Provider

[cbrooks 07/20/94] 

Changed severity of TP messages in common/dts.sams to severity
warning. In addition, added functionality to all sample Time provider 
programs to generate a thread that traps external signal (INT, QUIT,
HUP, TERM) and issues an rpc_mgmt_stop_server_listening() call. The 
rpc_server_listen() call then returns, and unregisters its endpoint 
from the endpoint map.



CR Number                     : 10890
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : doc
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : update(8dts) ref page
Short Description             : Synopsis does not include "time"
Reported Date                 : 6/8/94
Found in Baseline             : 1.0.3
Found Date                    : 6/8/94
Severity                      : E
Priority                      : 4
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1doc
Affected File(s)              : dce_books/command_ref/man8dts/update.8dts
Sensitivity                   : public

[6/8/94 public]

The SYNOPSIS of the update.8dts reference page is missing the identifier
"time", and should read

dtscp update time "absolute-time"

Also, the treatment of the subhead "OPTIONS" versus "ARGUMENTS" appears to
be confusing and inconsistent among all the 8dts reference pages.

[10/18/94 public]
Added the word.  Verified by Jordahl.

[10/27/94 public]
Closed bug.



CR Number                     : 10860
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : control/dtsscp.c
Short Description             : "help show" missing an item
Reported Date                 : 6/3/94
Found in Baseline             : 1.0.3
Found Date                    : 6/3/94
Severity                      : D
Priority                      : 3
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1
Affected File(s)              : 
	time/control/dtsscp.c
	test/time/control/test_dtscp_server.templ
	test/time/control/test_dtscp_clerk.templ
Sensitivity                   : public

[6/3/94 public]

The list printed out when entering "help show" does not include
 "clock resolution".

[cbrooks 6/29/94] 
Fixed in nightly build of June 29, 1994



CR Number                     : 10836
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : dtsd -s
Short Description             : dtsd dumps core on all platforms
Reported Date                 : 6/2/94
Found in Baseline             : 1.1
Found Date                    : 6/2/94
Severity                      : A
Priority                      : 0
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1beta
Fixed In Baseline             : 1.1
Affected File(s)              : mgtacl.c
Sensitivity                   : public

[6/2/94 public]

Using the nightly build available 06/02, dtsd -s dumps core on HP-UX and
OSF/1 and does not start on AIX.

[06/02/94 public]

It appears as though once enough local servers are available to complete
a successful synch or a manual dtscp synch command is done dtsd dumps core.

Some svc information:

::::::::::::::
/opt/dcelocal/var/adm/logs/dts.ERROR
::::::::::::::
1994-06-02-11:23:35.417-04:00I----- dtsd ERROR dts events 0x200e0018 DCE error C
ouldn't export time server mgmt interface: : entry not found (dce / rpc)
1994-06-02-11:23:35.460-04:00I----- dtsd ERROR dts events 0x200e0018 DCE error C
an't export time control interface: : entry not found (dce / rpc)
1994-06-02-11:23:40.969-04:00I----- dtsd ERROR dts events 0x200aa840 LAN profile
 not found
1994-06-02-11:23:41.567-04:00I----- dtsd ERROR dts events 0x200aa840 DCE error C
an't unexport time server mgmt interface: : entry not found (dce / rpc)
1994-06-02-11:23:41.683-04:00I----- dtsd ERROR dts events 0x200aa840 DCE error F
ailure in rpc_ep_unregister: : not registered in endpoint map (dce / rpc)
1994-06-02-11:23:41.819-04:00I----- dtsd ERROR dts events 0x200aa840 DCE error F
ailure in TService interface rpc_ns_binding_unexport: : entry not found (dce / r
pc)

[06/02/94 public]
It's not the dtscp synch command which causes dtsd to dump core, it's any
dtscp command (i.e. dtscp show all).

[6.2.94 public]
The problem is in mgt_acl_init().  If you don't have a new acl file
or an old acl file, the code nevers calls dce_db_open() to set acl_db.
Thus it is null, and a core dump follows.

I will speak with Charlie, and we will fix ASAP.

[6/2/94 public]
Fix submitted.

[06/07/94 public]
Closed.



CR Number                     : 10802
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : error message
Short Description             : Bad error message with no dtsd running
Reported Date                 : 5/27/94
Found in Baseline             : 1.1
Found Date                    : 5/27/94
Severity                      : B
Priority                      : 2
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1
Affected File(s)              : 
	time/common/write_bindings.c
	time/control/dtsscp.c
Sensitivity                   : public

[5/27/94 public]

On 1.0.3 the error message you got from dtscp when dtsd was not running was:

root@tahiti> dtscp show all
dtscp cannot get rpc binding to dts daemon - reason:
        binding incomplete (no object ID and no endpoint) (dce / rpc)

Now all you get is:

root@west> dtscp show all
dts_read_bindings:: No such file or directory

This message isn't very good compared to the original one.

[cbrooks 6/25/94] 
fixed.



CR Number                     : 10792
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : dtsd
Short Description             : need multi-host time sync capability for dfs
Reported Date                 : 5/26/94
Found in Baseline             : 1.1
Found Date                    : 5/26/94
Severity                      : A
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b12
Affected File(s)              : dts/service/dtss_service_main.c
config/dce_config
Sensitivity                   : public

[5/26/94 public]

Charlie - opening this to reflect our discussions on dts and the
dfs flserver requirement of no more than 10 second clock skew. These
discussions were prompted by a power outage here at OSF that left
the self-host cell unable to achieve quorum (40 second clock skew).

Please add you ideas here so that Craig, Diane and myself can help
come up with the scripts and/or documentation w/r/to additional dts
capabilities that dfs administrators would need - thanks!

[05/26/94 public]
I'm not Charlie, but here's my idea.  Add a new flag to dtsd:
	dtsd -slam XXX
where XXX is a string binding (perhaps it could be a DCE hostname and
then we import -- will import work without cdsclerk running?).  It contacts
a time provider on the specified host, gets the time, and does forces
the local time to be that time.

[05/26/94 public]
To prevent slamming security and CDS I would like a tool that updates the
time before any of DCE gets started.  This is already done by dce_config
using telnet daytime but it is only done once when you configure DCE.  It
would be nice if we took the time synch'ing section of dce_config and made
it the first thing in /etc/rc.dce.

[5/26/94 public]
Charlie and I have talked about this.  Here is my take.
We need a tool that runs outside of DTS and DCE.  It must be
able to check/sync the clock before security is configured (for dce_config)
and before DCE is started (for rc.dce).  

Making this a config utility just like getip will allow other non-UNIX
platforms (OS/2) to write a similar appropriate to their OS.  It also
removes the circular dependancy: DCE needs the clocks sync'd, DTS needs
DCE to sync to clocks.

I belive Charlie and I have a method to set the clocks correctly
during configure and upon startup using his 'remdate' program.

[05/26/94 public]
I don't think you understood my idea:  don't ship yet another little tcp/ip
program.  Instead, have the -slam flag BYPASS security and do the moral
equivalent of remdate using DCE communications.

[07/15/94 public]

A new command called dtsdate has been created. This command is an
alias for the dtsd command, and takes the following arguments:


dtsdate [-u] [-s] [-q] <hostaddress | IP address> [seconds]

Usage: 
	-u	print out time in UTC (GMT); else use localtime
	-s	operate silently; do not print out time 
	-q	query only ; don't try and set the time on the local
		host. However, if the time differs by more than
		<seconds>, return a value of 1; else return 0. This is
		only tested if a non-zero value of <seconds> is specified.
		Seconds must be a positive integer.		
	

remote host	host to query for the time 
name or IP 
address

seconds 	optional field: if specified. and the time is on the
		local host differs from the remote host by more than
		<seconds> seconds, the local host will set the time 
		to that of the remote host.  If not specified, treated
		as 0, which translates to infinity (absolute inaccuracy)
	
The default behavior. e.g. 

    dstdate remotehost 

is to print out the time on the remote host. 

   dstdate -u remotehost 

print out time in UTC (GMT) 

      dstdate -s -q remotehost 10

Don't print out time on remote host; if time differs by more than 10
seconds, return value of 1, else 0. 

	 dstdate -s remotehost 10 

Don't print out the time on remote; set the clock if more than 10
seconds difference.


Implementation

This is implemented by creating a link to the dtsd program called 
dtsdate. The links is automatically installed in /usr/bin by the
dce_config script.

Caveats: the remote host _must_ be running as a DTS *server*. This
means that the dtsd on that system must have registered the dts
management interface, since we use the management call to get the
current time on that host.



CR Number                     : 10767
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : dts
Subcomponent Name             : dtscp show cur time
Short Description             : DTS is outputting GMT time only on HP-UX
Reported Date                 : 5/25/94
Found in Baseline             : 1.1
Found Date                    : 5/25/94
Severity                      : A
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1beta
Fixed In Baseline             : 1.1
Affected File(s)              : time/common/tzset.c
Sensitivity                   : public

[5/25/94 public]

In the NB available 05-25am the dtscp show current time is outputting
the time in GMT instead of EST5EDT:

root@west> dtscp show cur time
Current Time              = 1994-05-25-16:03:43.191+00:00I0.389
root@west> dtscp show local servers

Known Servers
============================================================

Local  /.../dce3_cell.qadce.osf.org/hosts/soldier/self
        Last Time Polled         = 1994-05-25-16:03:16.129+00:00I0.595
        Last Observed Time       = 1994-05-25-16:03:16.319+00:00I3.681
        Last Observed Skew               = +0-00:00:00.190I4.275
        Used in Last Synchronization     = FALSE
        Transport Type          = RPC

Local  /.../dce3_cell.qadce.osf.org/hosts/dce3/self
        Last Time Polled         = 1994-05-25-16:03:16.129+00:00I0.595
        Last Observed Time       = 1994-05-25-16:03:16.254+00:00I3.581
        Last Observed Skew               = +0-00:00:00.125I4.175
        Used in Last Synchronization     = FALSE
        Transport Type          = RPC

root@west> dtscp show all
Check Interval            = +0-01:30:00.000I-----
Epoch Number              = 0
Error Tolerance           = +0-00:10:00.000I-----
Local Time Differential Factor = +0-00:00:00.000I-----
Maximum Inaccuracy        = +0-00:00:00.100I-----
Servers Required          = 3
Query Attempts            = 3
Local Set Timeout         = +0-00:00:05.000I-----
Global Set Timeout        = +0-00:00:15.000I-----
Synchronization Hold Down = +0-00:02:00.000I-----
Type                      = Server
Courier Role              = Backup Courier
Acting Courier Role       = NonCourier
Clock Adjustment Rate     = 40000000  nsec/sec
Maximum Clock Drift Rate  = 1000000  nsec/sec
Clock Resolution          = 10000000  nsec
DTS Version               = V1.0.1
Time Representation Version = V1.0.0
Time Provider Present     = TRUE
Automatic TDF Change      = FALSE
Next TDF Change           = 1994-05-25-16:06:44.692+00:00I0.000
Server Principal Name     = hosts/west/self
Server Entry Name         = hosts/west/dts-entity
Server Group Name         = subsys/dce/dts-servers
root@west> echo $TZ
EST5EDT
root@west> date
Wed May 25 12:08:11 EDT 1994
root@west> ls -ald /etc/zoneinfo
lrwxrwxrwx   1 root     sys           26 May 25 11:35 /etc/zoneinfo -> /opt/dcelocal/etc/zoneinfo
root@west> ls /opt/dcelocal/etc/zoneinfo
Australia   GMT+11      GMT-11      GMT12       Israel      Turkey
Brazil      GMT+12      GMT-12      GMT13       Jamaica     UCT
CET         GMT+13      GMT-2       GMT2        Japan       US
Canada      GMT+2       GMT-3       GMT3        Libya       UTC
Chile       GMT+3       GMT-4       GMT4        MET         Universal
Cuba        GMT+4       GMT-5       GMT5        Mexico      W-SU
EET         GMT+5       GMT-6       GMT6        NZ          WET
Egypt       GMT+6       GMT-7       GMT7        Navajo      Zulu
Factory     GMT+7       GMT-8       GMT8        PRC         localtime
GB-Eire     GMT+8       GMT-9       GMT9        Poland      posixrules
GMT         GMT+9       GMT0        Greenwich   ROC
GMT+0       GMT-0       GMT1        Hongkong    ROK
GMT+1       GMT-1       GMT10       Iceland     Singapore
GMT+10      GMT-10      GMT11       Iran        SystemV

[5/26/94 public]

This appears to be the result of conflicting values for the FILENAME_MAX
as found in stdio.h. This fix has been submitted in the build of 5/25,
and will be checked as soon as possible (functional test that did not 
run on the HP did run with this fix installed.

[5/27/94 public]

The above fix worked on the hp (tested with nightly build of Thursday,
26 May). The output of dtscp on falcon (an HP running in EDT) is 
as follows: 

Current Time              = 1994-05-27-10:02:42.497-04:00I-----

This is also the case on bran as well.

[5/27/94 public]
Please note: The time shown by 'show current time' will now reflect
the timezone that the *dtsd* is running in, not the dtscp/dcecp.
Now that you can talk to any dtsd on any random host in a cell, 
we felt it would be correct to see the local time *on that system*.

We should open a doc bug to make sure this is called out
in both dtscp and dcecp man pages.



CR Number                     : 10698
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : dts_provider_util.c
Short Description             : dts_provider_util.c doens't build on HP
Reported Date                 : 5/19/94
Found in Baseline             : 1.1
Found Date                    : 5/19/94
Severity                      : A
Priority                      : 0
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1
Affected File(s)              : dts_provider_util.c
Sensitivity                   : public

[5/19/94 public]

PATH_MAX isn't defined by HP-UX in limits.h.
The code should check to make sure the system defines it and
if not, provide a reasonable value.

[5/19/94 public]
Submitted.



CR Number                     : 10656
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : test
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : dts
Subcomponent Name             : test/time/service
Short Description             : Undeclared identifier
DCELOCAL_PATH in dtss-graph.c
Reported Date                 : 5/16/94
Found in Baseline             : 1.1
Found Date                    : 5/16/94
Severity                      : A
Priority                      : 0
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1
Affected File(s)              : time/service/dtss-graph.c
Sensitivity                   : public

[5/16/94 public]

[ /test/time/service at 11:10 (AM) Sunday ]

"/project/dce/build/dce1.1-snap/src/test/time/service/dtss-graph.c", line \
 436.28: 1506-045 (S) Undeclared identifier DCELOCAL_PATH.



CR Number                     : 10651
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : dts
Subcomponent Name             : time/libutc/kernel
Short Description             : syntax errors with common DTS
include files
Reported Date                 : 5/16/94
Found in Baseline             : 1.1
Found Date                    : 5/16/94
Severity                      : A
Priority                      : 0
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1
Affected File(s)              : dts.h, time/common/commondef.h, time/common/utcapi.c
Sensitivity                   : public

[5/16/94 public]

[ /time/libutc/kernel at 22:33 (PM) Saturday ]

cc -c -g -DBIG_ENDIAN_ARCHITECTURE \
 -DDCESHARED_PATH=\"/opt/dce\" -DDCELOCAL_PATH=\"/opt/dcelocal\" -Dunix \
 -D_BSD -D_ALL_SOURCE -D_ALL_SOURCE -DAIX32 -I. \
 -I/u1/devobj/sb/nb_rios/src/time/libutc/kernel \
 -I/project/dce/build/dce1.1-snap/src/time/libutc/kernel -I../../common \
 -I/u1/devobj/sb/nb_rios/src/time/common \
 -I/project/dce/build/dce1.1-snap/src/time/common -I../../common/RIOS \
 -I/u1/devobj/sb/nb_rios/src/time/common/RIOS \
 -I/project/dce/build/dce1.1-snap/src/time/common/RIOS -I../user \
 -I/u1/devobj/sb/nb_rios/src/time/libutc/user \
 -I/project/dce/build/dce1.1-snap/src/time/libutc/user \
 -I/u1/devobj/sb/nb_rios/export/rios/usr/include \
 -I/project/dce/build/dce1.1-snap/export/rios/usr/include \
/project/dce/build/dce1.1-snap/src/time/common/utcapi.c 1501-106: (S) \
 Include file dts.h not found.
"/project/dce/build/dce1.1-snap/src/time/common/commondef.h", line 83.1: \
 1506-045 (E) Undeclared identifier pointer_t.
"/project/dce/build/dce1.1-snap/src/time/common/commondef.h", line 83.11: \
 1506-046 (S) Syntax error.
"/project/dce/build/dce1.1-snap/src/time/common/commondef.h", line 84.7: \
 1506-046 (S) Syntax error.
"/project/dce/build/dce1.1-snap/src/time/common/utcapi.c", line 922.29: \
 1506-068 (S) Operation between types integer and struct is not allowed.
"/project/dce/build/dce1.1-snap/src/time/common/utcapi.c", line 922.46: \
 1506-046 (S) Syntax error.
"/project/dce/build/dce1.1-snap/src/time/common/utcapi.c", line 922.57: \
 1506-081 (S) Discarding previously defined typedef identifier: utc_t 
"/project/dce/build/dce1.1-snap/src/time/common/utcapi.c", line 922.63: \
 1506-046 (S) Syntax error.
"/project/dce/build/dce1.1-snap/src/time/common/utcapi.c", line 1071.19: \
 1506-182 (S) Arguments missing for builtin function __memcpy.
"/project/dce/build/dce1.1-snap/src/time/common/utcapi.c", line 1071.29: \
 1506-046 (S) Syntax error.
"/project/dce/build/dce1.1-snap/src/time/common/utcapi.c", line 1071.63: \
 1506-046 (S) Syntax error.
*** Error code 1

"/project/dce/build/dce1.1-snap/src/time/libutc/kernel/RIOS/dtsload.c", \
 line 57.22: 1506-045 (S) Undeclared identifier dcelocal_path.
*** Error code 1

[5/25/94 public]
cbrooks fixed this, I believe.



CR Number                     : 10631
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa,i486,rs6000
S/W Ref Platform              : hpux,osf1,aix
Component Name                : dts
Subcomponent Name             : /time/zoneinf0/zic
Short Description             : Unable to find include file 'dce/dce.h
Reported Date                 : 5/13/94
Found in Baseline             : 1.1
Found Date                    : 5/13/94
Severity                      : A
Priority                      : 0
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1
Affected File(s)              : zic.c
Sensitivity                   : public

[5/13/94 public]

[ /time/zoneinfo/zic ]
makepath zic/. && cd zic &&  exec make MAKEFILE_PASS=SETUP     setup_all
zic: created directory
c89 -c    -D_SHARED_LIBRARIES   -Dunix -D_POSIX_SOURCE -D__hppa -Dhp9000s800 -Dhp9000s700 -D__hp9000s800 -D__hp9000s700 -DHPUX -D__hpux -Dunix +DA1.0 -D_HPUX_SOURCE    -I. -I/u3/devobj/sb/nb_ux/src/time/zoneinfo/zic -I/project/dce/build/dce1.1-snap/src/time/zoneinfo/zic  -I. -I/u3/devobj/sb/nb_ux/src/time/zoneinfo/zic -I/project/dce/build/dce1.1-snap/src/time/zoneinfo/zic -I../../common -I/u3/devobj/sb/nb_ux/src/time/common -I/project/dce/build/dce1.1-snap/src/time/common -I../../common/POSIX -I/u3/devobj/sb/nb_ux/src/time/common/POSIX -I/project/dce/build/dce1.1-snap/src/time/common/POSIX -I/u3/devobj/sb/nb_ux/export/hp800/usr/include -I/project/dce/build/dce1.1-snap/export/hp800/usr/include    /project/dce/build/dce1.1-snap/src/time/zoneinfo/zic/zic.c
dts.h: 34: Unable to find include file 'dce/dce.h'

[5/13/94 public]

Fixed by removing indirect dependency on dce.h from time/common/private.h
by cbrooks.



CR Number                     : 10627
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 10628
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : time providers
Short Description             : Time providers should put themselves in the backround
Reported Date                 : 5/12/94
Found in Baseline             : 1.1
Found Date                    : 5/12/94
Severity                      : B
Priority                      : 2
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1
Affected File(s)              : ./time/service/Makefile
./time/service/Makefile.tp
./time/service/dts_acts_provider.c
./time/service/dts_hopf_provider.c
./time/service/dts_ntp_provider.c
./time/service/dts_null_provider.c
./time/service/dts_provider_util.c
./time/service/dts_provider_util.h
./time/service/dts_spectracom_provider.c
./time/service/dts_traconex_provider.c
Sensitivity                   : public

[5/12/94 public]

The time providers all fail to put themselves in the backround,
making it a problem to correctly deal with them on startup.

They should all call a (common) routine to fork and exit.

[5/18/94]
Added dts_provider_utils.[ch] to give the providers a common
function (daemon()) to call.  This function will fork and exit,
changing to a known directory (<dcelocal>/var/adm/time), and optionally
closing file descriptors.

In addition, I installed all time provider source files and rewrote
the Makefile.tp to correctly build the TP's on an installed DCE system.

Code submitted.
Support in dce_config for TP going in to the background was done under
OT #10628.



CR Number                     : 10611
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : dtsd
Short Description             : dtsd needs new ACL library
Reported Date                 : 5/11/94
Found in Baseline             : 1.0.3
Found Date                    : 5/11/94
Severity                      : C
Priority                      : 3
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1
Affected File(s)              : time/service/mgtacl.c
Sensitivity                   : public

[5/11/94 public]

The dtsd needs to be upgraded to use the DCE 1.1 ACL library and the 
DCE 1.1 backing store library. This means that the libdpeacl code in 
time/common can be deleted.

[6/16/94 public]

The 1.1beta version of the dtsd has been upgraded to use the new ACL 
library and the backing store library. See the file
time/service/mgtacl.c for the changes.



CR Number                     : 10457
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : 
Short Description             : Code Cleanup Task
Reported Date                 : 4/26/94
Found in Baseline             : 1.1
Found Date                    : 4/26/94
Severity                      : C
Priority                      : 3
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b17
Affected File(s)              : 
./admin/dcecp/dts_util.c
./dce/utils/misc/dce64.h
./time/common/POSIX/dts.h
./time/common/arith.c
./time/common/commondef.h
./time/common/dts.sams
./time/common/dtss_attr_ranges.h
./time/common/dtss_config.h
./time/common/dtss_mgmt_support.h
./time/common/dtss_rpc.h
./time/common/dtssdef.h
./time/common/dtssdef_ultrix.h
./time/common/dtssmacros.h
./time/common/private.h
./time/common/sysdep.h
./time/common/threadsafe_ultrix.c
./time/common/tzfile.h
./time/common/tzset.c
./time/common/utc_arith.h
./time/common/utc_cvt.c
./time/common/utcapi.c
./time/common/write_bindings.c
./time/control/POSIX/dtsscp_aux.c
./time/control/check_status.h
./time/control/dtsscp.c
./time/control/prscmd.c
./time/control/prsrea.c
./time/libutc/user/utc_adjtime_user.c
./time/libutc/user/utc_gettime_user.c
./time/libutc/user/utc_shared_create.c
./time/libutc/user/utc_shared_map.c
./time/service/acl_compat.c
./time/service/clock_adjust.c
./time/service/dts_acts_provider.c
./time/service/dts_provider_util.c
./time/service/dtss_service.h
./time/service/dtss_service_global_set.c
./time/service/dtss_service_main.c
./time/service/dtss_service_ncl.c
./time/service/dtss_service_state.c
./time/service/mgtacl.c
./time/service/mgtrpc.c
./time/service/querydced.c
./time/service/setVars.c
./time/service/timers.c
./time/service/transport_rpc.c
./time/time.mk
./time/zoneinfo/zic/ialloc.c
./time/zoneinfo/zic/scheck.c
./time/zoneinfo/zic/zic.c
Sensitivity                   : public

[4/26/94 public]

This is a placeholder for the DTS code cleanup work

cbrooks 8/23/94 public]

This is the 2nd and last submission for the code cleanup work. The 
highlights are as follows:

time/time.mk 
   use xlc for IBM compiler; and STRICT_COMPILER_WARNINGS to the AT386
   build. define macro ADJTIME_NOT_SUPPORTED instead of __hpux. 

dtss_config.h 
  removed all transport macros; CONFIG_RPC code is not the default. 
  CONFIG_NCL is gone; we are now only CONFIG_CP (control program).

general.
  add prototypes. change macros to upper case. Removed machine
  dependent code (e.g. #ifdef vms). Add UL qualifier to large 
  constants. Make sure all function definitions are ANSI style.



CR Number                     : 10449
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 6770
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : common, zones
Short Description             : Obsolete files should be deleted from the source tree
Reported Date                 : 4/22/94
Found in Baseline             : 1.1
Found Date                    : 4/22/94
Severity                      : C
Priority                      : 3
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b14
Affected File(s)              : time/common/Makefile
time/common/posixrules
time/common/localtime
time/zone/*
Sensitivity                   : public

[4/22/94 public]

The following files are obsolete and should be deleted from the
source tree:

	time/common/localtime
	time/common/posixrules
	time/zones/*

In addition, the Makefile in time/common needs cleaning up - currently, it
installs localtime and posixrules directly from the source tree.

There is an old bug (6770) that points out that time/zones/* is obsolete,
- it was marked fixed and closed but the files are still there.

[7/28/94 public]

Defuncted time/common/{localtime,posixrules}, and all files int
time/zones. Modified Makefile to no longer install localtime and
posixrules from the time/common directory.



CR Number                     : 10448
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : 
Short Description             : utc.h is listed twice in time/common/Makefile
Reported Date                 : 4/22/94
Found in Baseline             : 1.1b7
Found Date                    : 4/22/94
Severity                      : A
Priority                      : 0
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b8
Affected File(s)              : time/common/Makefile
Sensitivity                   : public

[4/22/94 public]
utc.h was listed twice in the INCLUDES line of the time/common/Makefile. It
was also listed twice as utc.h_EXPDIR = {blah} . This caused the 486 to
fail on a top-down build.

[4/22/94 public]
Submitted changes.



CR Number                     : 10446
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : 
Short Description             : sysdep.h needs to include sysdep_ultrix.h with dce/ prefix
Reported Date                 : 4/22/94
Found in Baseline             : 1.1b7
Found Date                    : 4/22/94
Severity                      : B
Priority                      : 0
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b8
Affected File(s)              : time/common/sysdep.h
Sensitivity                   : public

[4/22/94 public]
dcecp includes the sysdep.h file from the time service. sysdep.h needs to
include sysdep_ultrix.h with a dce/ prefix. This is currently breaking the
build for dcecp.

[4/22/94 public]
Submitted changes.



CR Number                     : 10438
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : 
Short Description             : failure of CDS library broke libdce
Reported Date                 : 4/22/94
Found in Baseline             : 1.1
Found Date                    : 4/22/94
Severity                      : A
Priority                      : 0
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1
Affected File(s)              : formatts.c, time/common/dtssdef.h
Sensitivity                   : public

[4/22/94 public]

A compilation error in "formatts.c" broke the cds library which
in turn broke libdce:

[ /libdce at 20:19 (PM) Thursday ]

cc: "/project/dce/build/dce1.1-snap/src/directory/cds/library/formatts.c", \
 line 72: error 10
 00: Unexpected symbol: "*".
cc: "/project/dce/build/dce1.1-snap/src/directory/cds/library/formatts.c", \
 line 73: error 15
73: Type of "<<<NULL_SYMBOL >>>" is undefined.
*** Error code 1

[04/22/94 public]

THe offending line is 
int utc_comptime (
    UTCValue_t *,
    ExtInacc_t *,           <- undefined
    long       *,
    utc_t      *);

Charlie Brooks believes this is a dts problem. Reassigning.

[4/22/94 public]

Some typedefs are removed from time/common/dtss_ctrl.idl and are now
defined in dtssdef.h . However, neither of dtss_ctrl.idl or utctypes.idl
include dtssdef.h . Thus, UTCValue_t is undefined. (Well, it should be
"UTCValue", not "UTCValue_t", anyway. Or should it really be "UTCValue_t"?)

[4/22/94 public]

Correct. This was changed to UTCValue, and the file changed to includes
dtssdef.h 

Comment: this is an awkward way to get this definition. There should 
be a better way to get components specific into without having to 
make the full API public (via /usr/include/dce). That's why Bjarne
created "protected", right? ;-)

[4/22/94 publioc]

The real porblem here is that CDS is using utc_comptime at all. This is NOT a
public API and it's use is DANGEROUS. The type UTCValue can't be sent over the
wire. The correct code cleanup change here is to remove usages of utc_comptime.



CR Number                     : 10417
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : doc
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : 
Short Description             : dtscp show last sync updated wrong
Reported Date                 : 4/20/94
Found in Baseline             : 1.0.3
Found Date                    : 4/20/94
Severity                      : D
Priority                      : 2
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1doc
Affected File(s)              : dce_books/command_ref/man8dts/show.8dts
Sensitivity                   : public

[4/20/94 public]
The "dtscp show last synchronization" command indicates that a sync has
completed even when the sync fails.
The testcase tests the value in "dtscp show last synchroniization" and
"dtscp show synchronizations complete" before and after issuing the
"dtscp sync" command.  The "sync complete" did not get updated because
too few servers were detected, but the "last sync" value was updated
to the last attempted sync.  The documentation indicates that this value
should only be updated if the sync is complete, not just attempted.

The system test group has to work around this to get the test to complete.

[04/20/94 public]
I believe this is the last time a syncronization was *attempted*.
I do not believe (and it it hasn't been the case since it was written)
this indicated the last time a successful sync was completed.

Your test should not depend on this.

I tend to think this is a doc bug.  The OSF docs say:
"Specifies the computed time at the last syncronization."

What do the IBM docs say?

[04/21/94 public]
 The IBM docs say: "Specifies the computed time at the last syncronization"
 The IBM docs say: "Specifies the computed time at the last syncronization"
 If the sync had not been successful it would not have syncronized, thus
 would not be the last syncronization. Also when the "dtscp show last sync"
 command is issued it reads "Last Syncronization =" also indicating that
 the sync completed.

 I agree that it might be a doc problem but I think that the OSF docs need 
 to read attempted sync, and change the output from dtscp to also read
 Last Attempted Sync.    What are your thoughts?

[04/21/94 public]

I agree, it has always annoyed me that the last sync time isn't the time
of the last successful sync.  Perhaps it should say "Last Attempted
Synchronization" instead of "Last Synchronization"?

[04/21/94 public]
I think the doc is certainly unclear and should be fixed.
I am less sure that any code needs to be changed.

[8/11/94 public]
yes this is a doc bug.  The attribute is the time of the last ATTEMPTED
synchronization.

[08/11/94 public]
Assigned to writer Peter Neilson.

[10/18/94 public]
Fixed the doc.  Verified by Jordahl.

[10/25/94 public]
Closed bug.



CR Number                     : 10290
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : doc
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : 
Short Description             : Problems with DTS section of Admin Guide
Reported Date                 : 4/5/94
Found in Baseline             : 1.1
Found Date                    : 4/5/94
Severity                      : C
Priority                      : 2
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1doc
Affected File(s)              : dce_books/admin_gd/dts/dts/2_prep_for_dts.gpsml
Sensitivity                   : public

[4/5/94 public]
In working on the DTS error messages, I came across some confusing items in
the OSF DCE Administration Guide--Core Components concerning DTS>

1.  Page 14-5 states:

    For each remote clerk, set the servers required characteristic in the
    range 3g, where g equals the number of global servers that are in the
    network. 

    It is not clear to me how the user sets these global servers.  The
    syntax for set servers required [integer] doesn't explain how to set
    the value for g as indiacted in the Admin Guide.  Given the statement
    above, it would appear someone would say

    set required servers 35 where 5 would be the number of global servers,
    but I don't believe that's correct.

2.  Page 15-16 states:

    ...use the set command with the epoch number characteristic to isolate
    probelm servers...

    From the syntax shown in the Admin Reference, the set command doesn't
    take epoch number as a modifiable characteristic.  I suspect this should
    say the show command with epoch number.

[4/5/94 public]

Assigned this CR to Peter Neilson (OSF DTS writer).

[10/03/94 public]

Corrected the first problem by removing the paragraph, which Tom Jordahl
said was not helpful.  The second problem was already repaired and required
no change.  Verified by Tom.

[10/25/94 public]
Closed bug.



CR Number                     : 10284
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : doc
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : admin_gd
Short Description             : figure in Intro showing DTS
relationships needs correction
Reported Date                 : 4/4/94
Found in Baseline             : 1.0.3
Found Date                    : 4/4/94
Severity                      : C
Priority                      : 3
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1doc
Affected File(s)              : ./dce_books/admin_gd/overview/overview/2_comp.gpsml
Sensitivity                   : public

[4/4/94 public]

The arrows between DTS servers in Figure 2-5 
(in /admin_gd/overview/overview/2_comp.gpsml)
need to go both ways because DTS servers send
information to each other. Also, it might help
to note in the accompanying text that the arrows
in the figure reflect the flow of information, rather
than the flow of requests, between clerks and servers.
(because time clerks have to query time servers for time
in order to get them to send the time.) Also, the "API" boxes
(except for API/client circle) should be deleted
because they aren't relevant to sys admins.

[4/18/94 public]

Reassigning this CR to Peter Neilson (OSF DTS writer).

[09/20/94 public]
Figure 2-2 (not 2-5 as stated above) corrected by adjusting the pic
code that is included directely in 2-comp.gpsml.  Although the pic code is
obviously output from xpic, no xpic files were discovered in the nearby
"xpic" or "pic" directories, and there was no "figures" directory.

Verified by tom.

[09/20/94 public]
Corrected "Verified by" line above.  Tom Jordahl, not rsalz, verified it.

[10/25/94 public]
Closed bug.

The file 2_comp.gpsml has since been defuncted (see CR 7501),
so, sadly, the improvements to this figure have also disappeared.
I did a quick scan of the Intro book, and the only DTS figure
in it seems to have the server arrows going both ways, so
we can be reasonably confident that the misleading figure does 
not appear elsewhere in the DCE doc.



CR Number                     : 10282
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : 
Short Description             : Error messages need cleanup
Reported Date                 : 4/4/94
Found in Baseline             : 1.1
Found Date                    : 4/4/94
Severity                      : C
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b17
Affected File(s)              : dts.sams
Sensitivity                   : public

[4/4/94 public]
There are a number of problems with the dts.sams file messages.  In
general, there is a need for elaboration in the explanation and action
fields.  A complete list of suggested changes has been gievn to Rich Salz.

[06/20/94 public]
I gave my copy to Roger Woodbury, who has since left.  As has Lisa.
I hope Roger handed it off before he left...

[06/20/94]

Roger handed me the hardcopy of the dts.sams changes. I will work with
Susan Teto (who has taken over the Problem Determination Guide from
Kathy Digan) on this. 

Who is Lisa?

[06/20/94 public]
Lisa is, of course, Lisa Zahn.  But I meant Kathy Digan. :-)

[8/25/94 public]

Added Kathy's changes and suggestions; changed to use dcecp command 
syntax, etc.  Fixed.



CR Number                     : 10134
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : time/control
Short Description             : dtscp failed because "prs" was not
changed to "cmdprs"
Reported Date                 : 3/15/94
Found in Baseline             : 1.1
Found Date                    : 3/15/94
Severity                      : A
Priority                      : 0
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1
Affected File(s)              : directory/cds/control/Makefile
Sensitivity                   : public

[3/15/94 public]

dtscp broke because "prs" was not changed to "cmdprs":

[ /time/control at 23:29 (PM) Monday ]

make: /u1/devobj/sb/nb_486/tools/at386/bin/prs: No such file or directory
*** Error code 1
`build_all' not remade because of errors.
*** Error code 1

[3/15/94 public]
Last week while verifying the DEC drop I got a very mysterious source
control syntax error or something of the sort from the prs command. It 
turns out that for some reason, its unclear now as to what reason , I
failed to pick up the prs command from $DEFTOOLBASE and instead picked
up /bin/prs which is apparently part of the berkley source control set.
I though it would have saved me considerable time truing to figure out
what the problem was if it had just said file not found. I suggested
to DEC that rather than risk possible conflict with a known name lets
change the name and Alan Peckham did as part of the recent drop. I didn't
know that dts shares the executable.Its used by both cds and dts to 
generate their respective parse tables and get built during the setup 
pass and installed in the tools directory. So....
dts now can't find prs because its now called cdsprs. Marcy is a bit
nervous with the change and I'm told that build should never have gone
to /bin for something in the tools directory. Its easy to put it back 
and probably just as easy to change dts. I'm going to leave the call to
Marcy. We need to decide today.

[3/15/94 public]
Since this is an A0 and the build is broken, how about we back out the
change so that the tree builds.  We can then decide what the new name
should be and figure out why ODE was looking in /bin without holding people
up.  The doc impact can also be determined.

[3/15/94 public]
At Marcy's request I put cdsprs back to prs.

[3/16/94 public]

"time/control" is still broken.  Here are some of the error messages from
the overnight build:

[ /time/control at 23:13 (PM) Tuesday ]

makepath control/. && cd control &&  exec make MAKEFILE_PASS=BASIC
build_al\
l
cp /project/dce/build/dce1.1-snap/src/time/control/dtsscp.cdt dtscp.txt
/u3/devobj/sb/nb_ux/tools/hp800/bin/prs dtscp.txt

Missing prompt string delimiter (use non-alphanumeric).
Error in line 84:
ELEMENT * PROMPT "dtscp> "
                 ^
Unrecognized or duplicated keyword.
Error in line 84:
ELEMENT * PROMPT "dtscp> "
                         ^
....

Unrecognized or duplicated keyword.
Error in line 316:
ELEMENT setServer PROMPT "(PRINCIPAL, ENTRY, GROUP, REQUIRED):"
                                      ^
Missing prompt string delimiter (use non-alphanumeric).
Error in line 456:
ELEMENT showServer  PROMPT "(PRINCIPAL, ENTRY, GROUP, REQUIRED, NOT \
  RESPONDING, TIMES NOT INTERSECTING, NOT IN GROUP): "

[03/16/94 public]
Fixed prs not to generate errors.



CR Number                     : 10123
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : svc
Short Description             : wrong parameter to dce_msg_define_msg_table
Reported Date                 : 3/11/94
Found in Baseline             : 1.1
Found Date                    : 3/11/94
Severity                      : A
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1
Affected File(s)              : time/service/dtss_service_main.c
Sensitivity                   : public

[3/11/94 public]
This is SO embarassing.  In dtss_service_main.c:
    dce_msg_define_msg_table(dts_svc_table,
	sizeof dts_svc_table / sizeof dts_svc_table[0], &st);
That should, of course, be dts__table not dts_svc_table in all three
places.

[03/11/94 public]
Fix submitted.  I had to re-order a few #includes.



CR Number                     : 9932
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : IDL files
Short Description             : Need fault_status comm_status
Reported Date                 : 2/10/94
Found in Baseline             : 1.1
Found Date                    : 2/10/94
Severity                      : A
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1
Affected File(s)              : 
time/common/dtss_ctrl.{idl|acf}		# the DTS "management" interface
time/service/dtsprovider.{idl|acf}	# Time Provider Interface 
time/service/dtsstime_req.{idl|acf}	# clerk time request interface 
time/service/dtss_globaltime_req.{idl|acf} # global time request
Sensitivity                   : public

[2/10/94 public]
All IDL files that are part of libdce should be compiled with ACF files
that have the [fault_status,comm_status] attributes.  Without this, a
failing RPC could cause client code to core dump when there is a perfectly
good error_status_t parameter available.  When adding the ACF files, it is
important to make sure that no API changes.  As most routines probably
already have an "error_status_t *st" parameter this will probably not be
an issue; routines that don't will have to be handled on a case-by-case,
probably by adding a new routine that DOES have the status param and
changing our existing code to call that routine.

[6/16/94 public]

I have inspected the following .idl files and associated .acf files 
in the DTS source code 

time/common/dtss_ctrl.{idl|acf}		# the DTS "management" interface

time/service/dtsprovider.{idl|acf}	# Time Provider Interface 
time/service/dtsstime_req.{idl|acf}	# clerk time request interface 
time/service/dtss_globaltime_req.{idl|acf} # global time request 

DTS, as a DCE daemon, also uses the Serviceability interface, and the 
rdacl interfaces. These have not been checked as part of the DTS
effort. 


All the above interfaces provide the [fault_status, comm_status]
attribute for each interface.

[6/21/94 public]
Mark this bug as closed.



CR Number                     : 9911
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : serviceability
Short Description             : A few TraceIf calls still exist in the DTS code
Reported Date                 : 2/8/94
Found in Baseline             : 1.1
Found Date                    : 2/8/94
Severity                      : B
Priority                      : 2
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b13
Affected File(s)              : time/service/timers.c
Sensitivity                   : public

[02/08/94 public]

There are still a few calls to TraceIf in the DTS code, these should be
replaced with serviceability calls.

[07/27/94 public]
Submitted to nightly build of Wednesday, July 27, 1994. Will appear
officially in baselevel13. 

Changed all existing TraceIf() code in timeer.c to used 
DCE_SVC_DEBUG(...) calls.



CR Number                     : 9875
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : 
Short Description             : dts needs to export
dtss_ctrl.idl and dtss_ctrl.acf
Reported Date                 : 2/2/94
Found in Baseline             : 1.1
Found Date                    : 2/2/94
Severity                      : B
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1
Affected File(s)              : ./time/common/Makefile
Sensitivity                   : public

[2/2/94 public]

./time/common/Makefile needs to export dtss_ctrl.{idl,acf} for dcecp's 
consupmtion. I will make this change if there are no complaints.

[2/3/94 public]

The changes listed above were submitted and built on 3 platforms.



CR Number                     : 9822
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : src/time/service
Short Description             : don't know how to make dcedtsmac.h
Reported Date                 : 1/26/94
Found in Baseline             : 1.1
Found Date                    : 1/26/94
Severity                      : A
Priority                      : 0
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1
Affected File(s)              : time/service/Makefile, dcedtsmac.h
Sensitivity                   : public

[1/26/94 public]

 [ /time/service at 22:21 (PM) Tuesday ]

....
Graph cycles through `dtsprovider.h'
Graph cycles through `dtsprovider_sstub.o'
Graph cycles through `dtsprovider_sstub.c'
make: don't know how to make dcedtsmac.h (continuing)

[1/26/94 public]

time/service/Makefile has been fixed.

There was also a problem with the submission where dcedts.cat 
was not appearing in the install tree. To fix that, 
time/common/Makefile has been changed.

[1/27/94 public]

Also, time/common/Makefile needs to have dcedtssvc.h added to INCLUDES so it
is properly exported.

[1/27/94 public]

Bug still occurs.  Errors now are---on the HP:

 [ /time/service at 22:37 (PM) Wednesday ]

dtss_service_main.c: 143: Unable to find include file 'dcedtssvc.h'.
*** Error code 1
mgtrpc.c: 69: Unable to find include file 'dcedtssvc.h'.
*** Error code 1
dtss_service_state.c: 82: Unable to find include file 'dcedtssvc.h'.
*** Error code 1
dtss_service_global_set.c: 67: Unable to find include file 'dcedtssvc.h'.
*** Error code 1
logevent_v_ultrix.c: 71: Unable to find include file 'dcedtssvc.h'.
logevent_v_ultrix.c: 73: Unable to find include file 'dcedtsmac.h'.
*** Error code 1
dtss_service_ncl.c: 105: Unable to find include file 'dcedtssvc.h'.
*** Error code 1
dtss_malloc.c: 45: Unable to find include file 'dcedtssvc.h'.
dtss_malloc.c: 47: Unable to find include file 'dcedtsmac.h'.
*** Error code 1
events.c: 87: Unable to find include file 'dcedtssvc.h'.
*** Error code 1
provider_interface.c: 70: Unable to find include file 'dcedtssvc.h'.
*** Error code 1
time_request.c: 73: Unable to find include file 'dcedtssvc.h'.
*** Error code 1
transport_rpc.c: 86: Unable to find include file 'dcedtssvc.h'.
*** Error code 1
`build_all' not remade because of errors.
*** Error code 1

 [ /time/zoneinfo/SystemV ]
`build_all' not remade because of errors.
*** Error code 1

On the AT486:

 [ /time/service at 23:02 (PM) Wednesday ]

/project/dce/build/dce1.1-snap/src/time/service/dtss_service_main.c:143: 
  dcedtssvc.h: No such file or directory
*** Error code 1
/project/dce/build/dce1.1-snap/src/time/service/mgtrpc.c:69:
  dcedtssvc.h: No such file or directory
*** Error code 1
/project/dce/build/dce1.1-snap/src/time/service/dtss_service_state.c:82:
  dcedtssvc.h: No such file or directory
*** Error code 1
/project/dce/build/dce1.1-snap/src/time/service/dtss_service_global_set.c:67:\
  dcedtssvc.h: No such file or directory
*** Error code 1
/project/dce/build/dce1.1-snap/src/time/service/logevent_v_ultrix.c:71:
  dcedtssvc.h: No such file or directory
/project/dce/build/dce1.1-snap/src/time/service/logevent_v_ultrix.c:73:
  dcedtsmac.h: No such file or directory
*** Error code 1
/project/dce/build/dce1.1-snap/src/time/service/dtss_service_ncl.c:105:
  dcedtssvc.h: No such file or directory
*** Error code 1
/project/dce/build/dce1.1-snap/src/time/service/dtss_malloc.c:45:
  dcedtssvc.h: No such file or directory
/project/dce/build/dce1.1-snap/src/time/service/dtss_malloc.c:47:
  dcedtsmac.h: No such file or directory
*** Error code 1
/project/dce/build/dce1.1-snap/src/time/service/events.c:87:
  dcedtssvc.h: No such file or directory
*** Error code 1
/project/dce/build/dce1.1-snap/src/time/service/provider_interface.c:70:
  dcedtssvc.h: No such file or directory
*** Error code 1
/project/dce/build/dce1.1-snap/src/time/service/time_request.c:73:
  dcedtssvc.h: No such file or directory
*** Error code 1
/project/dce/build/dce1.1-snap/src/time/service/transport_rpc.c:86:
  dcedtssvc.h: No such file or directory
*** Error code 1
`build_all' not remade because of errors.
*** Error code 1

 [ /time/zoneinfo/SystemV at 23:08 (PM) Wednesday ]
`build_all' not remade because of errors.
*** Error code 1

 [ /libdce at 00:06 (AM) Thursday ]
`build_all' not remade because of errors.
*** Error code 1
`build_all' not remade because of errors.

On the RIOS (libdce failed to build as well):

 [ /time/service at 01:29 (AM) Thursday ]

"/project/dce/build/dce1.1-snap/src/time/service/dtss_service_main.c",
  line 300.125: 1506-045 (S) Undeclared identifier dts_s_general.
"/project/dce/build/dce1.1-snap/src/time/service/dtss_service_main.c",
  line 423.39: 1506-045 (S) Undeclared identifier dts_svc_table.
"/project/dce/build/dce1.1-snap/src/time/service/dtss_service_main.c",
  line 698.34: 1506-045 (S) Undeclared identifier dts_s_states.
*** Error code 1
<etc.>

[03/28/94 public]
This has long ago been fixed.



CR Number                     : 9807
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : 
Short Description             : unresolved reference to symbol dts_svc_handle
Reported Date                 : 1/24/94
Found in Baseline             : 1.1
Found Date                    : 1/24/94
Severity                      : A
Priority                      : 0
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1
Affected File(s)              : Makefile
Sensitivity                   : public

[1/24/94 public]

After fix for 9798, time component still will not build. Failure 
from hppa/hpux log (also fails on SNI_SVR4):

c89      -z -Wl,-Bimmediate,-Bnonfatal,-a,default,+b,/lib:/usr/lib     -L/u1/sandboxes/dce1_1_daily/export/hp800/usr/shlib -L/u1/sandboxes/dce1_1_daily/export/hp800/usr/shlib -L/project/dce/build/dce1.1/export/hp800/usr/shlib -L/usr/shlib -L/u1/sandboxes/dce1_1_daily/export/hp800/usr/lib     -L/u1/sandboxes/dce1_1_daily/export/hp800/usr/lib     -L/project/dce/build/dce1.1/export/hp800/usr/lib   -o dtsd.X dtsstime_req_cstub.o  dtsstime_req_sstub.o  dtss_globaltime_req_cstub.o  dtss_globaltime_req_sstub.o  dtsprovider_cstub.o  lan_services_cstub.o  dtss_service_main.o  clock_adjust.o  mgtrpc.o  mgtacl.o  dtss_service_state.o  transport.o  clock_adjust_ultrix.o   dtss_service_global_set.o   logevent_v_ultrix.o   dtss_service_ncl.o   dtss_malloc.o  timers.o  events.o  events_unix.o   provider_interface.o  time_request.o  transport_rpc.o  -ldtss_common -ldpeacl -ldce -ldbm -lM   
/bin/ld: Unsatisfied symbols:
   dts_svc_handle (data)
*** Error code 1
1 error
*** Error code 2
1 error
*** Error code 2
1 error

The cause appears to be an external reference in 
obj/time/common/dcedtssvc.h.

[01/24/94 public]
It appears that the files that were checked into the tree are NOT the
ones that I had in my sandbox.  I ran into an ODE bug when I did the
submit and one of the ODE developers took over to get things submitted.
It doesn't look right.  I still have the code in my sandbox, but I am
waiting to hear back from the ODE folks.

[03/28/94 public]
This is long dead, see CRs 9798 and 9804 for more history on this.



CR Number                     : 9804
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : time/common
Short Description             : Include file dcedtsmsg.h not found
Reported Date                 : 1/24/94
Found in Baseline             : 1.1
Found Date                    : 1/24/94
Severity                      : A
Priority                      : 0
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1
Affected File(s)              : dcedtmsg.h
Sensitivity                   : public

[1/24/94 public]

Many errors in various DTS modules:

	time/common,control,service,zoneinfo/SystemV

were causing by a failure to find the include file "dcedtsmsg.h".

For example, from the RIOS:

[ /time/common at 21:16 (PM) Saturday ]

makepath common/. && cd common &&  exec make MAKEFILE_PASS=THIRD build_all 
cc -c       -Dunix -D_BSD -D_ALL_SOURCE -D_ALL_SOURCE -DAIX32   -I. \
  -I/u1/devobj/sb/nb_rios/src/time/common \
  -I/project/dce/build/dce1.1-snap/src/time/common -I. \
  -I/u1/devobj/sb/nb_rios/src/time/common \
  -I/project/dce/build/dce1.1-snap/src/time/common \
  -I/u1/devobj/sb/nb_rios/export/rios/usr/include \
  -I/project/dce/build/dce1.1-snap/export/rios/usr/include/project/dce/build/dce1.1-snap/src/time/common/time_support.c \
Processing include file
/project/dce/build/dce1.1-snap/src/time/common/dtss_includes.h
    1501-106: (S) Include file dcedtsmsg.h not found.
*** Error code 1

Closed.



CR Number                     : 9747
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : 
Short Description             : svc and aud changes
Reported Date                 : 1/14/94
Found in Baseline             : 1.1
Found Date                    : 1/14/94
Severity                      : A
Priority                      : 4
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1
Affected File(s)              : src/time/{service,common}
Sensitivity                   : public

[1/14/94 public]
I need to merge my SVC changes to dtsd, and IBM's audit changes to
dtsd, into the mainline.

[05/12/94 public]
This has long been done.



CR Number                     : 9518
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : doc
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : dtscp
Short Description             : the commands 'set lan/wan timeout' are not documented.
Reported Date                 : 11/18/93
Found in Baseline             : 1.0.3
Found Date                    : 11/18/93
Severity                      : D
Priority                      : 3
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1doc
Affected File(s)              : dce_books/command_ref/man8dts/set.8dts
Sensitivity                   : public

[11/18/93 public]
the commands 'set lan timeout' and 'set wan timeout' are not documented.

[11/19/93 public]
They should be documented as:

	set lan timeout == set local set timeout
	set wan timeout == set global set timeout

[1/18/94 public]

The set(8dts) man page in the DCE Administration Reference
describes set local set timeout and set global set timeout.

Section 15.4.1.7 in the DCE Administration Guide also
explains set local set timeout/set global set timeout.

Consequently, I am cancelling this CR.

[01/18/94 public]
You shouldn't cancel this, you should document that 'lan' and 'wan' timeout
are the same as local/global set timeout.

[3/29/94 public]

Reassigning this CR to Peter Neilson (OSF dts writer). Discussed
this CR with Hal and Tom, and the fix is as Tom says...to add
a note to the set(8dts) that says set lan timeout is same as
set local set timeout and set wan timeout is the same as
set global set timeout. (The 'set lan/wan timeout' commands
are obsolete dtscp commands that still exist in DCE code).

[10/18/94 public]

Added a note.  Verified by Jordahl.

[10/20/94 public]
Closed bug.



CR Number                     : 9517
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : dts
Subcomponent Name             : dtscp
Short Description             : dtscp accepts ths command 'set advertisement interval' which is invalid.
Reported Date                 : 11/18/93
Found in Baseline             : 1.0.3
Found Date                    : 11/18/93
Severity                      : D
Priority                      : 4
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b13
Affected File(s)              : time/control/dtsscp.cdt
Sensitivity                   : public

[11/18/93 public]
dtscp accpt the command 'set advertisement interval', but this
is not a valid command.

[7/19/94 public]
The "set advertisment interval" is not present in the dtsd server.
This command should be deleted from dtscp, and is not present in dcecp.
Hence, as requested, setting the priority of this CR to 4

[7/20/94 public]

Commented out the command from dtsscp.cdt. Entering this command 
now generates an error response.



CR Number                     : 9383
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : i486
S/W Ref Platform              : osf1
Component Name                : dts
Subcomponent Name             : time/service/dts_acts_provider.c
Short Description             : Remove unnecessary include statements
Reported Date                 : 11/5/93
Found in Baseline             : 1.0.3
Found Date                    : 11/5/93
Severity                      : D
Priority                      : 3
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1
Affected File(s)              : dts_acts_provider.c
Sensitivity                   : public

[11/5/93 public]

Full Description:

        dts_acts_provider.c has the following include at the beginning:

#ifdef OSF1
#define _USE_OLD_TTY
#include <sys/ttydev.h>         /* To define CBAUD */
#endif

        It looks like that one needs to have a "-DOSF1" as compiler option
        in order to get the file <sys/ttydev.h> included to have the
	definition of CBAUD.

        Actually this is not needed, since the code also includes <sgtty.h>,
        which includes <ioctl.h> which further includes <ioctl_compat.h>,
        which finall yincludes <ttydev.h>.

Repeat By:

        Check the current build log on 486 and see that we don't define
        -DOSF1 ourselves.

[5/10/94 public]

Looks like Charlie got this one doing code cleanup.

[5/11/94 public]

Fixed in DCE1.1 bl-8. All time providers now use the POSIX termios
interface as specified in the DCE 1.1 style guide



CR Number                     : 9381
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : doc
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : admin_gd
Short Description             : document that courier will synchronize even with no global server available if number of local servers is sufficient
Reported Date                 : 11/5/93
Found in Baseline             : 1.0.2
Found Date                    : 11/5/93
Severity                      : D
Priority                      : 3
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1doc
Affected File(s)              : dce_books/admin_gd/dts/dts/1_intro_dts.gpsml
Sensitivity                   : public

[11/5/93 public]

Somewhere in the documentation of dts server behavior (perhaps in 13.3.2.3
or 15.4.1.1 or maybe in the admin ref. -- 1.0.2 doc) it should be mentioned
that a courier will try to synchronize with a global server if one is
available but that if none is: it will synchronize with local servers
provided enough are available to satisfy the "servers required" attribute
and increase the "no global server detected" count.

[11/12/93 public]

Changed "fixby" to 1.1 from 1.0.3 and assigned
the bug to Bob Mathews (until such time as a writer
is assigned to dts doc bugs.)

[3/29/94 public]

Assigned this CR to Peter Neilson (OSF DTS writer).

[10/18/94 public]
Added a paragraph.  Verified by Jordahl.

[10/20/94 public]
Closed bug.



CR Number                     : 9380
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : dts
Subcomponent Name             : dtsapi
Short Description             : Several routines in the DTS API returns 0 (zero) when passed NULL pointers.
Reported Date                 : 11/5/93
Found in Baseline             : 1.0.3
Found Date                    : 11/5/93
Severity                      : C
Priority                      : 2
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b14
Affected File(s)              : common/utcapi.c
Sensitivity                   : public

[11/5/93 public]
All routines in utcapi.c that calls 'mkcomptime()' will return 0 (zero)
if the output utc structure is NULL.
The code goes
	if (utc != NULL) {
		...do stuff...
	}
	return(0);
This is inconsistent with CR 9153, which says that passing NULL pointers
should cause a core dump. Btw. after good discussion here, we agree with
the conclusion of 9153.

[7/29/94 public]

Added an assert( utc != NULL) at the start of utc_mkcomptime(). 
This will catch the null pointers, and abort with a core dump, instead
of allowing memcpy() to do it for you :-). Those with different views
may choose to compile with -DNDEBUG asserted to restore the "returns
0" behavior.

[8/1/94 public]

As per DCE 1.1 Style Guidelines, changed this to be dce_assert.h,
and dce_assert(...). Note that the DCE use of dce_assert requires that
the macro DCE_ASSERT must be defined; otherwise, the macro has no effect.



CR Number                     : 9349
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : doc
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : port_gd
Short Description             : Some errors for time porting
section 6.2
Reported Date                 : 11/3/93
Found in Baseline             : 1.0.2
Found Date                    : 11/3/93
Severity                      : C
Priority                      : 2
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : port_gd/6_time.gpsml
Sensitivity                   : public

[11/3/93 public]

Licensee reported:

"We have several minor comments on the Porting Guide's DTS chapter we'd
 like to pass along:

 1. In section 6.2, under para. heading "Modify byte-order info.",
        there is no file utctime.h as indicated. It is added under
        machine-dept. directories.

 2. at the end of section 6.2, the machine/utctime.h file is incorrectly
        cited as containing MAXDRIFTRECIP. It is found in
        kern_utctime.c in the reference sources.
"

[11/5/93 public]

Assigned this CR to Doug Weir.

[11/16/93 public]

This is fixed. I made the indicated changes (which amounted to removing
the two spurious references to utctime.h) to Chapter 6 of the Porting
Guide.

[11/16/93 public]

Closed this CR.



CR Number                     : 9340
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : 
Short Description             : use of sys_nerr is not portable
Reported Date                 : 11/3/93
Found in Baseline             : 1.0.2a
Found Date                    : 11/3/93
Severity                      : D
Priority                      : 3
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1
Affected File(s)              : common/dtss_error_unix.c
Sensitivity                   : public

[11/3/93 public]

sys_nerr is a global variable which is used on some UNIX systems to
determine the maximum errno value. It is not supported by POSIX or XOPEN
(in fact XOPEN withdrew its support for it). For portability, the use of
sys_nerr should be removed.

The use of sys_nerr is in GetOsMsg() in common/dtss_error_unix.c.  A
possible solution is to first do a dce_error_inq_text() and check the
status on that call to determine if the error is a dce error:

	dce_error_inq_text(...,&inqstatus);
	if (inqstatus == 0) /* it's a DCE error */
	{
		...
	}
	else /* it's (probably) a system error */
	{	
		...
	}

That way, the else clause is the system error and the test (error <
sys_nerr) is removed.  Also the statement sys_errlist[error] (not ANSI C)
should be replaced by strerror(error) (ANSI C).

[06/27/94 public]
Fixed as per above suggestion. Submitted in nightly build of 06/24/94.



CR Number                     : 9282
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : doc
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : dts
Subcomponent Name             : Admin_ref
Short Description             : Need to add index entry
Reported Date                 : 10/28/93
Found in Baseline             : 1.0.3
Found Date                    : 10/28/93
Severity                      : C
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : /man8dts/dtscp.8dts
Sensitivity                   : public

[10/28/93 public]

In admin_ref/man8dts/dtscp.8dts, the following ending page-range entry has
no corresponding beginning entry.

	.iX "-]" "timestamps" "format"

Please supply beginning entry.

[10/28/93 public]

Added beginning entry described above.

[11/11/93 public]

Verified in index of Admin Ref's latest doc build
and closed this bug.



CR Number                     : 9227
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : dts
Subcomponent Name             : dtscp
Short Description             : dtscp change epoch gives wrong error message
Reported Date                 : 10/21/93
Found in Baseline             : 1.0.3
Found Date                    : 10/21/93
Severity                      : D
Priority                      : 3
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b17
Affected File(s)              : test/service/dtss_service_ncl.c
Sensitivity                   : public

[10/21/93 public]
When trying to change the epoch out of range (ie. >255), the error message
returned is "cannot set value (dce / dts)"
It should be "epoch out of range or must be different than current epoch
 (dce / dts)"

[10/25/93 public]
In DirectiveDeclare() in service/dtss_service_ncl.c I changed this: 
    if (newEpoch > K_EPOCH_NUMBER_MAX)
        return( K_NCLrsp_EPOCH_DIFF );
dtscp now returns the correct message - is the return code correct ?

[8/23/94 public]
Fixed as suggested.



CR Number                     : 9221
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : doc
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : porting guide
Short Description             : Section 6.4.4 not should refer to NOV1974_BUG, not _AIX
Reported Date                 : 10/21/93
Found in Baseline             : 1.0.3
Found Date                    : 10/21/93
Severity                      : B
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : port_gd/6_time.gpsml
Sensitivity                   : public

[10/21/93 public]
In the porting and testing guide, on page 6.17 under section 6.4.4
API Tests, there is a note about the daylight savings time switch 
in October 1974.  The code has been changed to have an ifdef to
control wheather this bug is worked around in the test.

It is called NOV1974_BUG, and is actually defined for all three
of the reference platforms in <TARGET_OS>/osdep.mk.

Basically, the last sentence in the note should refer to NOV1974_BUG
instead of _AIX.

Also note that the rantest_api program takes in a argument.  I believe
this change has already been made, I know there is another bug about it.

[10/22/93 public]

Assigned this CR to Doug Weir.

[11/7/93 public]

This is fixed. Made the change described above.

[11/12/93 public]

Verified change in latest doc build and closed this bug.



CR Number                     : 9219
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : doc
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : porting_guide
Short Description             : Control program testing section needs reworking
Reported Date                 : 10/21/93
Found in Baseline             : 1.0.3
Found Date                    : 10/21/93
Severity                      : B
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : port_gd/6_time.gpsml
Sensitivity                   : public

[10/21/93 public]
Section 6.4.6 of the Porting and testing guide needs a reworking
to describe the improved functional test for dtscp.

There is now a script which run dtscp commands and compares the
output to an expected results file.  Thus the tester doesn't have
to examine to output by hand to verify that the test worked.

There are two scripts and two expected results templates 
in src/test/time/control:
	test_dtscp.ksh
	dtscp.ksh
	test_dtscp_clerk.templ
	test_dtscp_server.templ

The script to run is test_dtscp.ksh (notice the extra 's' is gone 
from the name).  This script takes one arguement, 'server' or 'clerk',
depending on what type of DTS machine you are running.

It then edits the template files with local information such
as the hostname, clock adjustment rate, and the next TDF change.
This gets placed in test_dtscp_{clerk|server}.exp.
The actual results of running the test (the dtscp.ksh script) are
placed in test_dtscp.act.

After the script is run, it reports if the expected matches the actual
output, and puts any differences in test_dtscp.diff.
Test_dtscp.ksh will also test commands which have variable output
(such as the current time) and report any failures.

It should be noted that the server test should be run with a server that
has just been started, with no time provider, in a cell with no 
other dts servers.

The clerk test should be run with a clerk that has just been started,
in a cell with no GLOBAL servers and at least one local server.

Also note that these test turn on and off the DTS trace facility,
so there may be trace output on the tty which dtsd was start from.

Sample output from a clerk test:
# ./test_dtscp.ksh clerk
START DCE time functional test: dtscp.ksh; DATE: Thu Oct 21 11:53:41 EDT 1993
The value of NODE_TYPE is clerk
Begin test of dtscp command structure (Thu Oct 21 11:53:43 EDT 1993)
You are running this test on a dts clerk (right?)
Actual output is in file test_dtscp.act
Expected output is in file test_dtscp_clerk.exp
Compare actual output to expected output
Actual output matches expected output
Execute variable commands
PASSED, Test 1 "TEST_DTSCP" : test ran successfully
END DCE time functional test: dtscp.ksh; DATE: Thu Oct 21 11:59:16 EDT 1993

Sample output from a server test:
START DCE time functional test: dtscp.ksh; DATE: Thu Oct 21 12:10:39 EDT 1993
The value of NODE_TYPE is server
Begin test of dtscp command structure (Thu Oct 21 12:10:42 EDT 1993)
You are running this test on a dts local server (right?)
Actual output is in file test_dtscp.act
Expected output is in file test_dtscp_server.exp
Actual output matches expected output
Execute variable commands
PASSED, Test 1 "TEST_DTSCP" : test ran successfully
END DCE time functional test: dtscp.ksh; DATE: Thu Oct 21 12:15:22 EDT 1993

[10/22/93 public]

Assigned this CR to Doug Weir.

[11/7/93]

Added the above information to Chapter 6 of the Porting Guide.

[11/12/93 public]

Verified change in latest doc build and closed this bug.



CR Number                     : 9201
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : 
Short Description             : rantest_api test fails
Reported Date                 : 10/19/93
Found in Baseline             : 1.0.3
Found Date                    : 10/19/93
Severity                      : B
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : ./test/time/common/AIX/osdep.mk
./test/time/common/HPUX/osdep.mk
./test/time/common/Makefile
./test/time/common/OSF1/osdep.mk
Sensitivity                   : public

[10/19/93 public]
The rantest_api test fails on the 2514 iteration on both the HP and the 486.

To reproduce:
rantest_api 3000

Test output:

count = 2510
ulcl = 2025/7/19 18:50:10 EDT 199 6 1
count = 2511
ulcl = 1978/2/13 13:30:05 EST 43 1 0
count = 2512
ulcl = 1972/9/5 22:03:31 EDT 248 2 1
count = 2513
ulcl = 1974/10/28 20:02:18 EST 300 1 0
utc_localtime differs from localtime
utc_mklocaltime returned error
time was not equal in utc_localtime, utc_mklocaltime compare
inaccuarcy was not equal in utc_localtime, utc_mklocaltime compare
count = 2514
seed = 152240538 = 913019a
ulcl = 1974/10/28 21:02:18 EST 300 1 1
lcl  = 1974/10/28 21:02:18 EDT 300 1 1
ugmt = 1974/10/29 1:02:18 EST 301 2 0
gmt  = 1974/10/29 1:02:18 EST 301 2 0
uany = 1974/10/29 8:32:18 ??? 301 2 -1

[10/19/93 public]
The wrong ifdef (NOV72_BUG) was being defined.
Defined the correct workaround ifdef (NOV1974_BUG) for HP, RIOS, and OSF1.
Fixed up the makefiles to be more OS dependant, not machine dependant.

[11/10/93 public]
Verified and Closed.



CR Number                     : 9200
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : test
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : dtscp test
Short Description             : New dtscp test from HP.
Reported Date                 : 10/19/93
Found in Baseline             : 1.0.3
Found Date                    : 10/19/93
Severity                      : C
Priority                      : 3
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : see below
Sensitivity                   : public

[10/19/93 public]
This bug covers the submission of an improved dtscp test from HP.

It was a TET functional test, and can still be in 1.1, but for
1.0.3 we just made it easier to run and verify output.

files are:
./test/time/control/Makefile
./test/time/control/dtscp.ksh
./test/time/control/test_dtscp.ksh
./test/time/control/test_dtscp_clerk.templ
./test/time/control/test_dtscp_server.templ

Defuncted is:
./test/time/control/test_dtsscp_ultrix.sh

[11/10/93 public]
Functional tests passed build and work great.
Closed.



CR Number                     : 9002
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : doc
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : dts
Subcomponent Name             : admin_ref, admin_gd
Short Description             : show man page wrong
Reported Date                 : 10/5/93
Found in Baseline             : 1.0.2
Found Date                    : 10/5/93
Severity                      : D
Priority                      : 2
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : /admin_ref/man8dts/show8.dts,
/admin_gd/dts/dts/3_managing_dts.gpsml
Sensitivity                   : public

[10/5/93 public]
The show man page for dtscp is incorrect in it's description of status.
The begining of the page says you can do:

	show all
	show all characteristics
	show all counters
	show all status
	show global servers
	show local servers

You can also do

	show current time

The description of the status' lists several things as being displayed
including current time, global servers, local servers.  None of these are
displayed when show all status is entered.  They are only displayed when
the individual commands

	show current time
	show global servers
	show local servers

are entered.

Also, there is a formatting error for the uid status.  It's listed as a
value of the state status, it really is it's own status  (in other words,
end the state list before the uid list item).  I think there is already a
bug opened for this one small point.

[10/5/93 public]
Actually this man page is really bad.  It seems the show command provides
different output if on a clerk or a server.  I don't know if there is any
difference if run on a local or global server or a courier.  Someone really
has to go through running the commands and seeing what the output is.  The
man page must indicate which characteristics/counters/status values are
only shown on a server.

In my runs, I found two counters that I don't see documented:

  Local server not in group
  Servers not in group

Here are the results of some of my test runs.  First on a clerk then on a
server: 

pedro 26 % dtscp> show all
Error Tolerance           = +0-00:10:00.000I-----
Local Time Differential Factor = -0-05:00:00.000I-----
Maximum Inaccuracy        = +0-00:00:00.100I-----
Servers Required          = 1
Query Attempts            = 3
Local Set Timeout         = +0-00:00:05.000I-----
Global Set Timeout        = +0-00:00:15.000I-----
Synchronization Hold Down = +0-00:10:00.000I-----
Type                      = Clerk
Clock Adjustment Rate     = 10000000  nsec/sec
Maximum Clock Drift Rate  = 1000000  nsec/sec
Clock Resolution          = 10000000  nsec
DTS Version               = V1.0.1
Time Representation Version = V1.0.0
Automatic TDF Change      = FALSE
Next TDF Change           = 1993-10-05-14:54:56.994+00:00I0.000

dtscp> show all coun
Creation Time             = 1993-09-23-15:27:01.841+00:00I-----
Local Times Not Intersecting = 0
Too Few Servers Detected  = 225
Time Provider Timeouts Detected = 0
Protocol Mismatches Detected = 0
Time Representation Mismatches Detected = 0
Clock Settings            = 0
System Errors Detected    = 0
Synchronizations Completed = 1592
Enable Directives Completed = 1
Disable Directives Completed = 0
Insufficient Resources Detected = 0
Local server not in group = 0

dtscp> show all stat
Last Synchronization      = 1993-10-05-14:53:48.868+00:00I-----
State                     = On


Now on a server

dtscp> show all   
Updates Initiated         = 0
Enable Directives Completed = 1
Disable Directives Completed = 0
Insufficient Resources Detected = 0
Time Provider Failures Detected = 8
Local server not in group = 0
Servers not in group      = 0

dtscp> show all stat
UID                       = 00004e21-ef9f-2c7c-9100-08005a0d4582
Last Synchronization      = 1993-10-05-11:33:41.632-04:00I-----
State                     = On

[10/5/93 public]
And just for grins, I'll add, that all descriptions of attributes should
have units associated with them.  For example:

	clock adjustment rate      is nsec/sec
        maximum clock drift rate   is nsec/sec
        clock resolution	   is nsec/sec

These might be the only three that are missing.


ALSO, the format of the show local servers and show global servers needs to
be shown and described.  Here is the output of the show local servers
command: 

dtscp> show loc ser


Known Servers
============================================================

Local  /.../sisyphus.osf.org/hosts/alphaville/self
        Last Time Polled         = 1993-10-05-14:53:48.868+00:00I-----
        Last Observed Time       = 1993-10-05-14:53:49.021+00:00I2.164
        Last Observed Skew               = +0-00:00:00.153I-----
        Used in Last Synchronization     = TRUE
        Transport Type          = RPC

Local  /.../sisyphus.osf.org/hosts/nodoz/self
        Last Time Polled         = 1993-10-05-14:53:48.868+00:00I-----
        Last Observed Time       = 1993-10-05-14:54:15.062+00:00I-----
        Last Observed Skew               = +0-00:00:26.194I-----
        Used in Last Synchronization     = TRUE
        Transport Type          = RPC

Local  /.../sisyphus.osf.org/hosts/barge/self
        Last Time Polled         = 1993-10-05-14:53:48.868+00:00I-----
        Last Observed Time       = 1993-10-05-14:53:48.868+00:00I1.385
        Last Observed Skew               = +0-00:00:00.000I-----
        Used in Last Synchronization     = TRUE
        Transport Type          = RPC

[10/18/93 public]

Assigned to writer Larry Kaplan.

[11/05/93 public]
In consultation with Howard Melman, we determined that most of the work
suggested above had already by been done by me for verifying other bugs.
So, most issues had already been reflected in the documentation.

What was added for CR9002 were clear explanations of server-only
output for both the show.8tds reference page of the admin_ref, and the
3_managing_dts.gpsml file of the admin_gd.

Howard Melman approved all changes.

[11/11/93 public]

Verified changes in latest doc build and closed this bug.



CR Number                     : 8870
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 9517
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : dts
Subcomponent Name             : dtscp
Short Description             : No upper bound enforced in "set advertisement interval"
Reported Date                 : 9/29/93
Found in Baseline             : 1.0.3
Found Date                    : 9/29/93
Severity                      : E
Priority                      : 4
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b13
Affected File(s)              : time/control/dtsscp.cdt
Sensitivity                   : public

[9/29/93 public]
According to the man page, the upper bound of the dtscp command
"set advertisement interval" should be 99-99:99:99.999. However,
the code enforces no upper bound.

[10/26/93 public]
changed common/dtss_attr_ranges.h:
 #define K_MAX_ADVERTISE_INT_LO 0x45F82CF0
 #define K_MAX_ADVERTISE_INT_HI 0x00005117

[7/19/94 public]
The "set advertisment interval" is not present in the dtsd server.
This command should be deleted from dtscp, and is not present in dcecp.
Hence, as requested, setting the priority of this CR to 4

[cbrooks 7/20/94] 
Commented out command in dtsscp.cdt. Fixed.



CR Number                     : 8692
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : 
Short Description             : utc_abstime may return negative time
Reported Date                 : 9/27/93
Found in Baseline             : 1.0.3
Found Date                    : 9/27/93
Severity                      : C
Priority                      : 2
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.1b17
Affected File(s)              : time/common/utcapi.c
Sensitivity                   : public

[9/27/93 public]

Full Description:

	utc times are composed of three pieces, a 64 bit 2's complement
time value, a 48 bit innacurracy value, and a 16 bit time differential
factor. Given a utc value, the function utc_abstime, performs an absolute
value function on the time value component of a utc value. Because of the
properties of two's complement arithmatic, if the time value passed as
input to utc_abstime is the greatest possible negative value which can be
stored in 64 bits, the 2's complement operation will not change the sign
of the value it was passed as input (by analogy in 8 bits, the 2'complement
of -127 is -127) and as a result utc_abstime will return a negative time
value.

Proposed Solution:

	utc_abstime, returns -1 indicating an error when it fails at 
performing it's function for reasons other than the situation described
above. utc_abstime, should also return -1, when passed the greatest
possible negative time value (which can be stored in 64 bits).

[8/23/94 public]

Fixed as suggested.



CR Number                     : 8627
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : doc
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : hppa
S/W Ref Platform              : hpux
Component Name                : dts
Subcomponent Name             : admin_ref
Short Description             : missing some counters in show.8dts
Reported Date                 : 9/17/93
Found in Baseline             : 1.0.2
Found Date                    : 9/17/93
Severity                      : C
Priority                      : 3
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : admin_ref/man8dts/show.8dts
Sensitivity                   : public

[9/17/93 public]
the show.8dts man page describes the counters that are returned by the show
all counters command.

It describes "invalid messages detected" but dtscp didn't show me this
counter.  I'm not sure if this is a code or doc bug.

The documentation did not describe two counters that were displayed (this
is a doc bug)

  Local server not in group = 0
  Servers not in group      = 0

[9/28/93 public]

Assigned to writer Larry Kaplan (as are the other open
dts admin bugs).

[10/1/93]

no change.

[10/14/93 public]
Deleted "invalid messages detected" as suggested by Tom Jordahl because
it is not part of the code.

Also added two counters specified by Howard Melman above.

[11/11/93 public]

Verified changes in latest doc build and closed this bug.



CR Number                     : 8460
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : mx300
S/W Ref Platform              : sinix
Component Name                : dts
Subcomponent Name             : 
Short Description             : dtsd grows in size
Reported Date                 : 8/16/93
Found in Baseline             : 1.0.2
Found Date                    : 8/16/93
Severity                      : B
Priority                      : 2
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.0.3
Affected File(s)              : none
Sensitivity                   : public
Transarc Deltas               : 
Transarc Herder               : 
Transarc Status               : 

[8/16/93 public]
dtsd grows in size on the OSF/1 and the SINIX platforms. The rate 
of growth varies depending on the frequency of the synchronization attempts 
made by dtsd. Normally, the growth rate is significant enough that after 48 
hours  we have to restart dtsd because it has grown too big.

[08/16/93 public]
Interesting, I have a cell that has been up and running for 2 weeks:

On a OSF/1 486:

% ps auxww
USER       PID %CPU %MEM   VSZ  RSS TTY      STAT STARTED         TIME COMMAND
root      6537  0.0  5.6 8.73M 2.02 ??       S      Aug 02    20:33.03 /opt/dcelocal/bin/dtsd

% dtscp show sync completed
Synchronizations Completed = 10149

Doesn't look like it is growing *that* much [8.73 Meg].

How big does it get on your OSF/1 system?  What source base are you using?
How do you get a System V based system to show you the size?

On HP-UX (cell server):
% ps -el 
  F S   UID   PID  PPID  C PRI NI     ADDR   SZ    WCHAN TTY      TIME COMD
  1 S     0  3463     1  0 154 20  20fe900 1111   1df100 ?       24:30 dtsd

% dtscp show sync completed
Synchronizations Completed = 2019

[08/17/93 public]
Checked a dtsd server running with only 1 server available overnight:
Mon Aug 16 17:14:22 EDT 1993
USER       PID %CPU %MEM   VSZ  RSS TTY      STAT STARTED         TIME COMMAND
root      6537  0.6  5.6 8.73M 2.03 ??       S      Aug 02    20:37.59 /opt/dce

...

Tue Aug 17 11:00:00 EDT 1993
USER       PID %CPU %MEM   VSZ  RSS TTY      STAT STARTED         TIME COMMAND
root      6537  0.0  5.7 8.77M 2.06 ??       S      Aug 02    23:16.44 /opt/dce

Doesn't seems to be growing significantly.  This is the same server that
had been syncing succesfully for the past two weeks.

I would say that unless you can point to the leak, this isn't a bug
on the 486 or HP-UX.

Assigning the bug to you (sni).

[9/1/93 public]
The question is, how big is the dtsd when it starts??  8.7M seems
huge, and definitely unacceptable in most environments.  In our
environment, it is much smaller than that initially. Even if
it is leaking 8M and then manages to level off, that is going to
be unacceptable in any kind of a 'real' situation.
Added field Transarc Deltas with value `' 
Added field Transarc Herder with value `' 
Added field Transarc Status with value `'

[09/02/93 public]
You obviously aren't running on OSF/1 systems. :-) The 8 Meg *virtual*
size includes libc.so and libdce.so, the shared libraries.  These
are mapping in the virtual address space of the process by the OSF/1
loader.  Since these are preloaded shared libraries, they only
take up the 'space' once, but it is reflected in the VSZ.

Probably the correct item to look at is the Resident set size (RSS)
which is about 2 Meg.  Not great, but OK.  DCE is big...

Any progress on tracking this down on SVR4?

[05/12/94 public]
Here is the latest story on memory leak in dtsd. The memory leak has 
subsided significantly on SVR4 version of dtsd. Following are some numbers:

Date Time   Size     System Time   #sync completed
5/10 9:19am 3002k    0:08 (M:S)    1
5/11 9:45am 3072k    5:32 (M:S)    748

Average memory leak = 70/24:26:00 = 2.87k/hr much smaller than before.
Per, OSF's standard, its negligible. So I'm closing this bug.



CR Number                     : 8459
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : doc
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : sinix
Component Name                : dts
Subcomponent Name             : doc
Short Description             : incorrect sub-command for dtscp
Reported Date                 : 8/16/93
Found in Baseline             : 1.0.2
Found Date                    : 8/16/93
Severity                      : C
Priority                      : 2
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.0.3
Affected File(s)              : admin_ref/man8dts/show.8dts, admin_gd/dts/dts/3_managing_dts.gpsml
Sensitivity                   : public

[8/16/93 public]

The documentation for the dtscp command still lists :

	show time differential factor 

as a valid command. This is incorrect. It is not a valid command 
and the documentation should be changed.

[08/17/93 public]
Assigned this CR to writer Bob Mathews.

[11/12/93 public]

Changed 'fixby' from 1.0.3 to 1.1 per H. Lichtin.

[11/12/93 public]

The name of the characteristic (and subcommand) has changed to "local time
differential factor".  In the show.8dts man page, I changed the name, kept
the existing description, and moved the text so that the list of
characteristics remains sorted.  I also changed the name in the table
titled "Unsettable DTS Characteristics" in the Administration Guide chapter
"Managing the DCE Distributed Time Service".

While doing this, I noticed that "local servers" was in the list of
characteristics in both files.  I verified that "local servers" is not a
characteristic--for instance, it's not included in the output of "show all
characteristics".  I removed this entry from the list of characteristics.
The "show local servers" command is already documented in detail elsewhere
in both files.

Changed status to verified.  Verified by Tom Jordahl and me.

[11/15/93 public]

Verified changes in latest doc build and closed this CR.



CR Number                     : 8373
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : i486
S/W Ref Platform              : osf1
Component Name                : dts
Subcomponent Name             : dtscp enable
Short Description             : dtscp enable command causes dtsd to dump core
Reported Date                 : 07/27/93
Found in Baseline             : 1.0.3
Found Date                    : 07/27/93
Severity                      : A
Priority                      : 0
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : service/time_request.c
Sensitivity                   : public

[07/27/93 public]

Using the nightly build available on July 27th, the "dtscp enable" causes
dtsd to core dump on a 486 configured as a local server:

	root@tahiti> dtsd -d
	Memory fault(coredump)

My cell has three HP local servers configured in it.

Information from Tom:

	The failure occurs in service/time_request.c at line 287.  The
	strcpy call fails because the server name is null and no check of
	the return value is done so the null gets passed along.

[07/28/93 public]
Ther are two problems here:

1. The error handling case when the timestamp versions don't match
was incorrectly getting the name of the principle who provided the
timestamp.  It then did a strcpy with a null pointer, checked to
see if the pointer was null and if not free'd it.

Fix was to use rpc_mgmt_inq_server_princ_name() instead of
rpc_ns_binding_inq_entry_name, and check the return value.

This prevent the core dump.

2. There is a timestamp version mismatch between HP-UX dtsd and
the OSF/1 dtsd.  This is still under investigation

[07/28/93 public]
The timestamp version error looks to be a symptom of an RPC problem.
The utc_t goes in at one end and comes out at the other garbled.

At 1993-07-28-17:09:16.492+00:00I-----  the rpc returns:

	Timestamp is 21801-07-11-14:19:12.680I-----

I suspenct an endian problem, since HP can talk to HP.

The fix for the dtsd problem has been submitted.
I will open a new bug for the rpc/idl problem.

[07/30/93 public]
Verified from the nightly build.
Closed.



CR Number                     : 8353
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 3231
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : dtsd
Short Description             : dtsd should start in useful state
Reported Date                 : 7/22/93
Found in Baseline             : 1.0.3
Found Date                    : 7/22/93
Severity                      : C
Priority                      : 3
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1beta
Fixed In Baseline             : 1.1
Affected File(s)              : see list, below
Sensitivity                   : public

[7/22/93 public]
dtsd currently starts up in a 'useless' state, neither acting as
a server or a clerk.  This is not good.

It requires a 'little file', /etc/rc.dts, to hold the initialization
commands (dtscp commands) for whatever it should be.

A strawman proposal would be to have dtsd start up as a DTS clerk
when given no arguments, and start up as a server when given
an optiuon (say '-server').  

In addition, options for courier role and local or global should also
be added.

Sample usage:

	dtsd [-server] [-global] [-c {none|courier}]
Examples:
	dtsd				- clerk, backup courier
	dtsd -server			- local server, backup courier
	dtsd -server -global -c courier	- global server, courier

[7/22/93 public]
I have to jump in with an explanation of how this is the way it is. DTS's
management is based on the DECnet entity model. In this model, you create an
entity, you tweak any parameters you want to tweak, and you start it up.
Note, since DTS management doesn't maintain any state, you can't 'tweak the
parameters' before you create it! Now, if you wanted to make the change you
propose, that would be changing the model - a fine idea - but, you probably
have to make DTS management stateful.

Now... when I thought about all this early in DCE, I was told (by the OSF),
don't do lots of work on the management interface - DME will fix everything.
I don't think changing the model (to a stateful one ) is a bad idea, but it's
probably more work then you were thinging about.

[5/11/94 public]
This was fixed by Charlie Brooks in bl-8 (dce1.1).

Issues which arose out of this work are a) dts should make use of the 
ACL library; b) dts should use the dced database to store/retrieve 
data. Separate CRs will be filed for these issues.

Some text from the dce-drb submission request follows:

- OT# 8353,3231
- summary of the bug/enhancement 
	+ dtscp/dtsd should support remote management 
	+ dtsd should come up in a known state 

- summary of the fix
changes to dtscp 

	+ new version of dtss_ctrl.idl to permit remote management
	+ added CHANGE HOST TO <name> directive to dtscp to allow interactive 
		change of host 
	+ added "-h <name>" argument to dtscp to allow command line 
		management of remote host 
	+ if monitoring local host, looks up bindings from the file 
		<dce-local>/var/adm/time/dtsd.binding 
	 otherwise, looks up bindings for remote host under 
		/.:/hosts/<hostname>/dts-entity 

changes to dtsd 
	+ now writes binding info to the namespace under 
		/.:/hosts/<hostname>/dts-entity 
	+ writes local bindings in the file 
		<dce-local>/var/adm/time/dtsd.binding
	+ modified to use new control interface definitions 
	+ now removes serviceability endpoints and
		acl_manager_endpoints from endpoint mapper upon exit 

	+ now accepts the following command line switches 
		-s [-k courier|noncourier] [-g] 
			server, default is backup, global
		-c  client 
	with no switches, the default is 1.0.x behavior 
	(no personality, no role to play) 
	+ now correctly waits for server thread to complete initialization 	
	  before exiting (fixes race condition in 1.0.x dtsd/dstcp command 
	  invocation in dce_config)

functional tests 

	scripts were modified to take optional host and machine type 
	arguments for testing of remote servers 

Numerous code cleanup changes were performed. 


- files modified

./test/time/control/dtscp.ksh
./test/time/control/test_dtscp.ksh
./time/common/Makefile
./time/common/dpeacl.c
./time/common/dpeacl.h
./time/common/dpeaclconvert.c
./time/common/dpeaclstore.c
./time/common/dtss_attr_ranges.h
./time/common/dtss_ctrl.acf
./time/common/dtss_ctrl.idl
./time/common/dtss_includes.h
./time/common/dtssdef.h
./time/common/dtssdef_ultrix.h
./time/common/dtssmsg_ultrix.h
./time/common/prsdef.h
./time/common/sysdep.h
./time/common/utc.h
./time/common/utc_arith.h
./time/control/Makefile
./time/control/dtsscp.c
./time/control/dtsscp.cdt
./time/control/prscmd.c
./time/control/prspre.h
./time/control/prsrea.c
./time/service/Makefile
./time/service/aud_evtsp.h
./time/service/clock_adjust.c
./time/service/clock_adjust_ultrix.c
./time/service/dtsd_macros.h
./time/service/dtss_malloc.c
./time/service/dtss_service.h
./time/service/dtss_service_global_set.c
./time/service/dtss_service_main.c
./time/service/dtss_service_ncl.c
./time/service/dtss_service_state.c
./time/service/dtss_service_ultrix.h
./time/service/events.c
./time/service/events_unix.c
./time/service/logevent_v_ultrix.c
./time/service/mgtacl.c
./time/service/mgtrpc.c
./time/service/provider_interface.c
./time/service/time_request.c
./time/service/timers.c
./time/service/transport.c
./time/service/transport_rpc.c

- files defuncted 

	control/dtsscp_ultrix.c

- new files 
	common/write_bindings.c 

	control/POSIX/dtsscp_aux.c
	control/POSIX/prsdep.h
	control/dtscp.h
	control/check_status.h
	control/choosebindings.c
	control/do_import_binding.c
	control/parseargs.c
	control/selectnsibinding.c
	control/checkstatus.c



CR Number                     : 8231
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : dts_ntp_provider
Short Description             : NTP provider does not retry failed requests
Reported Date                 : 7/2/93
Found in Baseline             : 1.0.3
Found Date                    : 7/2/93
Severity                      : C
Priority                      : 3
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : time/service/dts_ntp_provider.c
Sensitivity                   : public

[7/2/93 public]
In looking over the NTP provider code, I noticed that the logic
was incorrect for retrying time requests.

The routine ReadTimes() should not return until 'retry' reaches 0,
but instead, was always returning -1 on the first failure.

Fix is below.

        if (status == 0) {
            i += 1;
        } else {
!           if (status < 0 || retry--)
                return(-1);
        }
      }
--- 1157,1163 ----
        if (status == 0) {
            i += 1;
        } else {
!           if (status < 0 || (--retry == 0))
                return(-1);
        }
      }

[07/16/93 public]
Fix verified.
Closed.



CR Number                     : 8229
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : doc
Inter-dependent CRs           : 7973
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : admin_guide
Short Description             : Too many servers detected counter changed to time provider timeouts detected
Reported Date                 : 7/2/93
Found in Baseline             : 1.0.3
Found Date                    : 7/2/93
Severity                      : B
Priority                      : 2
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : 2
Sensitivity                   : public

[7/2/93 public]
In response to CR #7973, I have removed the "Too Many server Detected"
counter from dtscp.  This should be removed from the show(8dts) man
page.  This counter was never incremented by the code.

It has been replaced by a "Time Provider Timeouts Detected" counter.
This counter is incremented when a dtsd server process initiates
contact with a Time Provider, and does not receive the initial
response within the 'Local Set Timeout' value (default 5 seconds).

This problem occurred on the PMAX because the provider didn't get
back to dtsd in the allotted time, probably due to system load.

The recommended action if you get too many of these timeouts is to increase
the 'local set timeout' (aka 'lan timeout') to a higher value.

In addtion, the set(8dts) man page should probably be updated to indicate
that the local set timeout value is used to control the *initial* contact
with a time provider.  In this initial contact, the time provider itself
provides a timeout value for actually reporting back times.  This allows
a provider attached to a slow source (a modem) to tell dtsd to wait for
5 minutes or something.

[07/06/93 public]
Assigned this CR to myself.

[07/08/93 public]
Changed to "verified".  Made the requested changes to the following
files in the Admin Reference (NOT the Admin Guide, as the CR states):

	man8dts/set.8dts
	man8dts/show.8dts

[08/17/93 public]
Closed bug.



CR Number                     : 8223
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : dtscp
Short Description             : dtscp include allocate_mem.o and never uses it
Reported Date                 : 7/1/93
Found in Baseline             : 1.0.3
Found Date                    : 7/1/93
Severity                      : C
Priority                      : 3
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : time/control/Makefile time/control/allocate_mem.c
Sensitivity                   : public

[7/1/93 public]

The dtscp program links with the file allocate_mem.o, which contain
two functions: DTSSmalloc() and DTSSfree().

The program uses malloc() directly and this module is not needed
and should be defuncted.

[07/16/93 public]
dtscp builds and functions without allocate_mem.c
Closed.



CR Number                     : 8108
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : libutc-user
Short Description             : utc_readlock() problems
Reported Date                 : 6/7/93
Found in Baseline             : 1.0.2
Found Date                    : 6/7/93
Severity                      : B
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : time/libutc/user/utc_shared_map.c
Sensitivity                   : public

[6/7/93 public]

Full Description:
        semctl is called in function utc_readlock() as follows:

	 int write_in_progress = 0;
	 ...
         semctl(utc_sharedptr->writelkid, 1, GETVAL, &write_in_progress)
	 if (write_in_progress)
		utc_readunlock();

        I checked man pages on AIX 3.2 and also our SVR4 based FTX
        operating system - No value is returned as the fourth
        argument to semctl when command is GETVAL - which I also verified 
	with a sample test that creates a semaphore and gets the value.

        The value of semaphore is the return value of the semctl
        call which is ignored by the utc_readlock function.

        I have attempted to fix this by changing the call to
        write_in_progress = semctl(utc_sharedptr, 1, GETVAL, dummy).

        However, this breaks when _DECTHREADS_ is defined - as
        cma_lock_global is called outside of the loop and
        if write is in progress utc_readunlock() will unlock the
        cma global mutex in the look - leading to a possibility that
        global mutex is unlocked without being locked.

        Then we think that there is the third serious matter - which
        is the semaphore number 1 in the semctl call
         semctl(utc_sharedptr->writelkid, 1, GETVAL ... )
        should be 0. ALl other semaphore operations work on sem_num 0.

Possible Solution:
        Some one needs to take a good look at the locking thats
        happening around these parts.
        Things that would help are
         - calling cma_lock_global() within the loop
         - changing the semaphore number in semctl call to 0
         - utilizing the return value of semctl call

        There may still be a window where someone may be writing
        while read is in progress

[06/29/93 public]
You are correct that the semctl() call is wrong.
This will be fixed to use semaphore 0 and use the return value instead
of expecting the fourth argument to get the result.

It is still unclear that the cma lock needs to be inside the loop.
The assumption is that there is only one writer (dtsd), as the utc_adjtime()
interfaces are private to DTS.  So, the loop should only iterate one time
around at the most, when dtsd sneaks in at the wrong time.  Thus, the cma
lock will never be unlocked twice.

[06/30/93 public]

I am not sure if I can agree on above comments on the cma lock issue. 

Even there is only one writer (dtsd), how can you be sure that the loop
would only iterate at most once? The thread who calls this utc_readlock
obviously wants to read. It checks the write semaphore first. If the write
is in process, it does a busy waiting, checking the semaphore again and
again until the write is done.

I don't see the reason that one iteration is the most possible case. 

Unlocking a non-locked global mutex may have unexpected behavior (see man
page for the function). I think we should write the code in the right way.

[07/06/93 public]
After looking at this long and hard, it seems the 'right' way to do this
is to lock the cma lock inside the loop.  This will prevent it from
possibly being unlocked twice.

[07/16/93 public]
Code functions on HP-UX (a user mode implementation).  Its hard to
verify completely locking things such as this, but in code review
everything checks out.
Closed.



CR Number                     : 8101
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : doc
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : 
Short Description             : rantest_api changes should be documented
Reported Date                 : 6/7/93
Found in Baseline             : 1.0.3
Found Date                    : 6/7/93
Severity                      : C
Priority                      : 3
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : port_gd/6_time.gpsml
Sensitivity                   : public

[6/7/93 public]
The rantest_api test for DTS has been/will be enhanced slightly.
It now takes a 'count' argument to specify how many iterations
to do.  This change it 100% backwards compatible as before
this test took no arguments and ran forever.  This behavior
is preserved, so these doc changes are not critical for 1.0.3.

The new usage is:
	rantest_api [count]

This is just something I added to make my life easier, so it might
be nice to tell people about it.

NOTE: if this test is placed under the TET environment, changes
more dramatic that this may have been made to this test.

[06/08/93 public]
Assigned this CR to myself.

[06/15/93 public]
Reassigned to writer Doug Weir.

[09/21/93 public]
Made the addition specified above.

[11/12/93 public]

Verified change in latest doc build and closed this bug.



CR Number                     : 8035
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : doc
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : admin_ref
Short Description             : range for servers required is 1-10
Reported Date                 : 5/21/93
Found in Baseline             : 1.0.2
Found Date                    : 5/21/93
Severity                      : D
Priority                      : 3
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : set.8dts, show.8dts
Sensitivity                   : public

[5/21/93 public]
In the set.8dts man page the range of values for the "servers required"
attribute is given as 1-32.  It was changed to be 1-10 in DCE 1.0.2.
This same bug is repeated in show.8dts as well.

[5/27/93 public]
Assigned to myself.

[6/1/93 public]
Changed to "verified".  Updated servers required range to 1-10
for both of of the specified reference pages.

[08/17/93 public]
Closed bug.



CR Number                     : 7991
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : doc
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : pmax
S/W Ref Platform              : osf1
Component Name                : dts
Subcomponent Name             : admin_ref
Short Description             : problems with dtscp, intro(dts)
Reported Date                 : 5/13/93
Found in Baseline             : 1.0.2
Found Date                    : 5/13/93
Severity                      : B
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : intro.8dts,dtscp.8dts,dtsd.8dts
Sensitivity                   : public

[5/13/93 public]
Hel found the following problems:

Thinking of dtscp, I find a number of approaches that are problematic:
First, the treatment of the dtsc (sub) commands are confusing to a
first-timer.  There is no reference in Related Information or the
Description section of the dtscp reference page to the fact that you should
see the relevant reference page for more information.  This is particularly
a problem with online access, as the relevant pages are not just a thumb
flip away.  Any administrator who has spent some time would know this
intuitively, of course, but as a neophyte, I got real confused for a while.

Second, I find it interesting that the Intro(8_dts) ref page is really the
introduction to he dtscp command, and NOT to the section, which also
contains the dtsd ref page.  It does not mention the dtsd command.  It is
nearly redundant with the dtscp ref page, except that it explains what the
dtscp commands mean, which the dtscp page does not!  Neither it nor the
dtscp reference page list all the subcommands (exit, quit, help).  Neither
it nor any other page define the timestamp format. (Yes, it is in the guide,
but this should be reference info too. )And there is one reall honest to
god bug in the PH book -- the unadvertise reference page has
"synchorinse(8dts) as the "running" top header.  How much of the above was
intentional?

Finally (and randomly): from dtsd "You can enter the command manually if a
DTS daemon fails to start automatically upon reboot, or if you want to
restart a daemon that you disable and delete to perform a backup or do
diagnostic work."  I understand the logical precedence of the clauses, but
it's something of a mouthful.

[5/27/93 public]
Assigned to writer Larry Kaplan.

[10/12/93 public]
Fixed all of the above problems identified by steiner and had them
checked by Tom Jordahl.

[11/11/93 public]

Verified changes in latest doc build and closed this bug.



CR Number                     : 7973
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : src/time
Short Description             : "Too Many Servers Detected"
counter not being updated
Reported Date                 : 5/11/93
Found in Baseline             : 1.0.2
Found Date                    : 5/11/93
Severity                      : C
Priority                      : 2
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : dtsscp.c dtsscp.cdt dtss_mgmt_support.c dtss_service_ncl.c logevent_v_ultrix.c
Sensitivity                   : public

[5/11/93 public]

        The command "show too many servers detected" is
        available in the dtscp. However, looking at the code
        this counter does not get updated. What is the purpose
        of this counter? It apprears that this is an obsolete
        command. Is this true or is this command meaningfull on
        some implementations.

	In function LogEventTooManyServers() in
	src/time/service/logevent_v_ultric.c, there is a call 

	    IncrCounter( &(shmPtr->counters[K_TOO_MANY_CNTR]) ); 

	But this function LogEventTooManyServers() is never called by any
	one.

Proposed Solution:

        If this is an obsolete command, it should be removed form
        the DTSCP commands and the documentation updated. Otherwise,
        the code should be changed to update this counter.

[07/06/93 public]
This counter will be removed.

[07/16/93 public]
This counter was removed and replaced with a 'Time Provider Timeout' counter.
A doc bug has been filed

Verified and Closed.



CR Number                     : 7844
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : doc
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : pmax
S/W Ref Platform              : osf1
Component Name                : dts
Subcomponent Name             : admin_ref
Short Description             : formatting glitch
Reported Date                 : 4/29/93
Found in Baseline             : 1.0.2
Found Date                    : 4/29/93
Severity                      : E
Priority                      : 4
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : 1
Sensitivity                   : public

[4/29/93 public]
In the list of staus's in the show(8dts) man page, the last item is uid.
There is a newline after the .LI in the source file so the uid is indented
too far.  Since there is an indented list before this item, the uid appears
to be in that list as opposed to being its own status.

[5/27/93 public]
Assigned to myself.

[5/28/93 public]
Changed to "verified".  Fixed the formatting problem that was
causing the misleading indent for uid status.

[08/17/93 public]
Closed bug.



CR Number                     : 7843
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : doc
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : pmax
S/W Ref Platform              : osf1
Component Name                : dts
Subcomponent Name             : admin_gd, admin_ref
Short Description             : show command never mentioned
Reported Date                 : 4/29/93
Found in Baseline             : 1.0.1
Found Date                    : 4/29/93
Severity                      : C
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : 
admin_gd/dts/dts/3_managing_dts.gpsml, admin_ref/man8dts/show.8dts
Sensitivity                   : public

[4/29/93 public]
The admin guide only briefly mentions the show command to dtscp.  It never
mentions that you can see 20 different counters or othe things.  An example
of its use and a walkthrough of the output should be included.

[5/27/93 public]
Assigned to writer Larry Kaplan.

[10/18/93]

Changed priority to 1 per Hal Lichtin/Bob Hathaway.

[10/22/93 public]
Did extensive changes to Chapter 15 of the admin_ref, guided and checked
by Howard Melman. Basically, the show command now has more detail and
output included as requested on 4/29 by Howard. However, we also took the
opportunity to add a new table of unsettable characteristics as well as 
to reorganize sections of the chapter.

In addition, although it was not requested by this CR, I also added an
example outputs to the admin_ref/man8dts/show.8dts reference page.

All changed verified by Howard Melman

[11/11/93 public]

Verified changes in latest doc build and closed this bug.



CR Number                     : 7842
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : doc
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : pmax
S/W Ref Platform              : osf1
Component Name                : dts
Subcomponent Name             : admin_gd
Short Description             : server group name is settable
Reported Date                 : 4/29/93
Found in Baseline             : 1.0.1
Found Date                    : 4/29/93
Severity                      : D
Priority                      : 4
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.2a
Affected File(s)              : /dts/dts/3_managing_dts.gpsml
Sensitivity                   : public

[4/29/93 public]
In table 3-2 of the admin guide there is a list of settable DTS
characteristics.  The "server group name" characteristic is not listed
here, but it is listed as settable in the set(8dts) man page.

[5/27/93 public]
Assigned to writer Larry Kaplan.

[6/30/93 public]
Fixed the table as suggested my Howard. The Table is really Table 15-2 in
the admin_gd: Core Components.

[08/17/93 public]
Closed bug.



CR Number                     : 7841
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : doc
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : pmax
S/W Ref Platform              : osf1
Component Name                : dts
Subcomponent Name             : admin_ref
Short Description             : bad characteristic list
Reported Date                 : 4/29/93
Found in Baseline             : 1.0.2
Found Date                    : 4/29/93
Severity                      : E
Priority                      : 3
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : 1
Sensitivity                   : public

[4/29/93 public]
In the arguments section of the set(8dts) man page the list of
characteristics has two problems.  1) global set timout is listed twice.
2) server group name should come before server principal name.

[5/27/93 public]
Assigned to myself.

[6/1/93 public]
Changed to "verified".  Changed "servers group" characteristic to
"server group name".  Also fixed the two problems in the arguments
section described in this CR.

[08/17/93 public]
Closed bug.



CR Number                     : 7838
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : doc
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : pmax
S/W Ref Platform              : osf1
Component Name                : dts
Subcomponent Name             : admin_ref
Short Description             : not a specified server
Reported Date                 : 4/29/93
Found in Baseline             : 1.0.2
Found Date                    : 4/29/93
Severity                      : E
Priority                      : 4
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : 1
Sensitivity                   : public

[4/29/93 public]
In the NAME section of update(8dts) it says "Gradually adjusts the clock on
the specified server node to the time specified by the argument."  Change
"specified server node" to "local node".  There is no server specified in
the command.  It happens on the local node.

[5/27/93 public]
Assigned to myself.

[5/28/93 public]
Changed to "verified".  Made the requested change to the NAME section
of this reference page.

[08/17/93 public]
Closed bug.



CR Number                     : 7837
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : doc
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : pmax
S/W Ref Platform              : osf1
Component Name                : dts
Subcomponent Name             : admin_ref
Short Description             : command descritions useless
Reported Date                 : 4/29/93
Found in Baseline             : 1.0.2
Found Date                    : 4/29/93
Severity                      : D
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : enable.8dts,intro.8dts,create.8dts
Sensitivity                   : public

[4/29/93 public]
The create and enable commands to dtscp are completely confusing.  They are
documented in the create(8dts) enable(8dts) and intro(8dts) man pages and
say things like "The create command, which establishes a DTS entity".  I
have no idea what establishing a DTS entity means.  Or "The create command
creates a time server or time clerk entity on the system where the command
is entered."  What is creating a time entity mean?  Does this command
invoke the dtsd process? (no it doesn't, although the delete command will
stop a running dtsd process!).  The enable command says it "starts a DTS
entity", does this mean it invokes the process? (no, it means the endpoint
gets registered with the rpcd).

Please change the descriptions of these command to be understandable using
simple little words :-)

Also, all of the of the control programs have their own man pages, but some
also have man pages for each command.  dtscp is one of these.  It of all
the control programs doesn't need this.  All of them could be combinded
into one man page (and the show and set commands could avoid duplication).

[5/27/93 public]
Assigned to writer Larry Kaplan.

[10/18/93 public]

Raised priority to 1 per Hal Lichtin/Bob Hathaway.

[10/22/93 public]
Changed the create.8dts and enable.8dts to show the relationship between
create and enable. Also changed the intro.8dts page to show the relationship
between dtsd and dtscp. All changes approved by Tom Jordahl.

[11/11/93 public]

Verified changes in latest doc build and closed this bug.



CR Number                     : 7794
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : dtsd
Short Description             : dtsd: randomness in sync times not random
Reported Date                 : 4/23/93
Found in Baseline             : 1.0.2
Found Date                    : 4/23/93
Severity                      : C
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : timers.c dtss_service_main.c
Sensitivity                   : public

[4/23/93 public]
The randomness function of the syncronization time is miscalculated.

The syncs always take place at about 1:30 with a sync hold down of 2:00.
I believe the math involved in the routine RandomizeInterval() in timers.c
isn't correct.

Looking at the times it comes up with, the randomness is within a range
of .001 - .005 seconds.

Anyone from DEC have an idea on where this math is going wrong?

[07/06/93 public]
Interstingly enough, the cause of this problem seems to be the use
of rand().  Switching to the random() function has made the sync
times truly variable by the correct amount (+/- 25%).

We init the random number generator in dtss_service_main.c.

548c545
<       r.lo = rand () % r.lo;
---
>       r.lo = random () % r.lo;
570c567
<         r.lo = rand () % (intvalPtr->lo / 2);
---
>         r.lo = random () % (intvalPtr->lo / 2);

[07/16/93 public]
Turns out that 'random()' is a bad choice, as its only on BSD-ish systems.
drand48(), on the other hand is and XPG interface and I used that instead.

Setting this to 'fix' till I can get syslog output from dtsd on HP-UX
to make sure the time are good.  Verified on the 486 however.

[11/10/93 public]
Still never got syslog output from HP-UX (since the bug never got fixed),
but verification with a 'show last sync' command seems to show things
working fine.

Closed.



CR Number                     : 7684
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : doc
Inter-dependent CRs           : 7838
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : admin_ref
Short Description             : misc typos in ref pages
Reported Date                 : 4/12/93
Found in Baseline             : 1.0.2
Found Date                    : 4/12/93
Severity                      : E
Priority                      : 3
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : 7
Sensitivity                   : public

[4/12/93 public]
1. In the NAME section of the reference pages for exit, help, quit, there
   appears DTSCP in all uppercase.  It should be dtscp in lowercase and bold
   font. 

2. In the NAME section of the delete ref page it says "DCE Distributed Time
   Service entity", when in all the other ref pages it says "DCE DTS entity".

3. In the NAME section of the disable, enable, and update ref pages it says
   "on the specified node".  All of the DTS commands work only on the local
   node.  This phrase implies that the user can enter a node other than the
   local one to have the command executed on.  Either remove the phrase or
   change it to something like "on the local node".

4. In the NAME section of the synchronize ref page it says "in the system",
   shouldn't it be "on the system"

[5/27/93 public]
Assigned to myself.

[5/82/93 public]
Changed to "verified".  Fixed all of the problems mentioned above,
except for the NAME section of update.8dts, which was already 
addressed by CR #7838.

[08/17/93 public]
Closed bug.



CR Number                     : 7357
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : dts
Subcomponent Name             : 
Short Description             : large max innac causes sync completed counter to increment by more than 1
Reported Date                 : 2/25/93
Found in Baseline             : 1.0.2
Found Date                    : 2/25/93
Severity                      : C
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : common/dtss_attr_ranges.h
Sensitivity                   : public

[2/25/93 public]

Customer reported problem on rs6000/aix, I demonstrated same on
decstation 5000/ultrix.

dtscp>  show sync hold
Synchronization Hold Down = +0-00:02:00.000I-----
dtscp> show maximum inaccuracy
Maximum Inaccuracy        = +41-16:00:00.100I-----
dtscp> show sync com
Synchronizations Completed = 1442
dtscp> sync
dtscp> show sync com
Synchronizations Completed = 1445

Not every sync command caused the synchronization count to increase by more
than 1, but this behavior was shown to happen fairly often in response to
a sync command. Note that the hold down timer (2 minutes) probably did
not expire between the "sync" and "show sync com commands" (since they were
done 1 after the other), and it is unlikely that the maximum inaccuracy
1000 was exceeded.

We used a two local server configuration, servers required = 2, with the
other machine getting its time via dts_ntp_provider (I did at least one
more sync command between precedding dtscp output and the stuff which
follows).

dtscp> show all char
Check Interval            = +0-01:30:00.000I-----
Epoch Number              = 0
Error Tolerance           = +0-00:10:00.000I-----
Local Time Differential Factor = -0-05:00:00.000I-----
Maximum Inaccuracy        = +41-16:00:00.100I-----
Servers Required          = 2
Query Attempts            = 3
Local Set Timeout         = +0-00:00:05.000I-----
Global Set Timeout        = +0-00:00:15.000I-----
Synchronization Hold Down = +0-00:02:00.000I-----
Type                      = Server
Courier Role              = NonCourier
Acting Courier Role       = NonCourier
Clock Adjustment Rate     = 10000000  nsec/sec
Maximum Clock Drift Rate  = 50000  nsec/sec
Clock Resolution          = 3970000  nsec
DTS Version               = V1.0.1
Time Representation Version = V1.0.0
Time Provider Present     = FALSE
Automatic TDF Change      = TRUE
Next TDF Change           = 1993-04-04-03:00:00.000-04:00I0.000
Server Principal Name     = hosts/gaia/self
Server Entry Name         = hosts/gaia/dts-entity
Server Group Name         = subsys/dce/dts-servers
dtscp> show all counters
Creation Time             = 1993-02-23-10:44:07.753-05:00I-----
Local Times Not Intersecting = 0
Server Times Not Intersecting = 0
Different Epochs Detected = 0
Too Few Servers Detected  = 9
Too Many Servers Detected = 0
Protocol Mismatches Detected = 0
Time Representation Mismatches Detected = 0
No Global Servers Detected = 0
Servers Not Responding    = 0
Clock Settings            = 0
Epoch Changes Completed   = 0
System Errors Detected    = 0
Synchronizations Completed = 1449
Updates Initiated         = 0
Enable Directives Completed = 1
Disable Directives Completed = 0
Insufficient Resources Detected = 0
Time Provider Failures Detected = 0
Local server not in group = 0
Servers not in group      = 0
dtscp> show all status
UID                       = 00000066-1183-21CC-A800-08002B2A232C
Last Synchronization      = 1993-02-25-11:40:03.354-05:00I-----
State                     = On

[04/26/93 public]
The problem here is that the max inacuracy is used to calculate the
next sync time.  With a huge value (over 32 days on a PMAX), this
calculation lands sometime in the year 2038.  This is fine as far
as utc things are concerned, but this overflows the timespec
structure which is passed to pthread_cond_timedwait().

See the routine InitiateTimer() in timers.c:
    /*
     * Compute the absolute expiration time by adding the interval to the
     * current time.  We convert all times to utc format for portable time
     * manipulation.
     */
    (void) utc_mkcomptime (&timedInterval, intval, (ExtInacc *)NULL, 0L);
    (void) utc_addtime (&expiration, (utc_t *)NULL, &timedInterval);

    /*
     * Now convert the expiration time into the form required by the timer
     * mechanism (a POSIX timespec) and place it in the timer descriptor.
     */
    (void) utc_bintime (&temp_timespec, (timespec_t *)NULL, (long *)NULL,
                        &expiration);



The timespec returned from utc_bintime() overflows and equates to 
sometime in the 1900's.
So, the call to pthread_cond_timedwait() returns right away and you
get large sync count increments because dtsd is constantly syncing.

Setting the maximum inacuracy to anything but a small value 
(say minutes for an extreme case) makes little sense
given dtsd's mission to keep clocks as close and acurate as possible.
So I am going to put a limit on how large you can set this value.

The value I picked is 24 hours (1 day).  This requires changing
K_MAX_MAX_INACC_{HI,LOW} in common/dtss_attr_ranges.h to a value
equivalent to 24 hrs.

This change will be submitted to 1.0.3 when the tree is opened.

[07/16/93 public]
Verified that max inacc can't be set above 1 day.
Closed.



CR Number                     : 7017
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : other
S/W Ref Platform              : aix
Component Name                : dts
Subcomponent Name             : 
Short Description             : dtscp show global servers fails with a rpc related error.
Reported Date                 : 1/26/93
Found in Baseline             : 1.0.1
Found Date                    : 1/26/93
Severity                      : B
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : mgtrpc.c
Sensitivity                   : public

[1/26/93 public]

Comments from the IBM bug report follow:

notes:
    <Note by rdl (Rick LeMon), 92/10/23 10:08:57, action: open>
the dtscp command "show global servers" fails when dtsd is running, but not
create command is issued.  The failure is:

cannot contact dts daemon - rpc failure:
fault invalid bound (dce / rpc)

I believe that this is a dts error and not an rpc error because all other show
commands fail in the correct way (this is what "show global servers" *should*
do)

error executing command:
         time service has not been created (dce / dts)

[07/06/93 public]
The bug report is a little unclear, but there *was* an error in the
dtsd code.  A variable was not initialized to 0 in the 'ShowLocServersCmd()'
routine (in mgtrpc.c) which caused the error.

[07/16/93 public]
Verified and Closed.



CR Number                     : 7016
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : other
S/W Ref Platform              : aix
Component Name                : dts
Subcomponent Name             : 
Short Description             : executing dtscp adv followed by dtscp enable generates error.
Reported Date                 : 1/26/93
Found in Baseline             : 1.0.1
Found Date                    : 1/26/93
Severity                      : B
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : transport_rpc.c
Sensitivity                   : public

[1/26/93 public]

Comments from the IBM bug report follow:

notes:
    <Note by rdl (Rick LeMon), 92/10/21 16:11:32, action: open>
If dtsd is disabled and either advertised or unadvertised and a
dtscp advertise
is issued (if already advertised it *should* generate a "type already
registered" error) followed by a
dtscp enable
then a
type already registered
error is given, however dtsd is placed in the on state.

[07/06/93 public]
In transport_rpc.c, function RegisterTServerRPC(), check for a type
already registered error.

[07/16/93 public]
Verified and closed.



CR Number                     : 7015
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : other
S/W Ref Platform              : aix
Component Name                : dts
Subcomponent Name             : 
Short Description             : dtscp change does not accept time with commas
Reported Date                 : 1/26/93
Found in Baseline             : 1.0.1
Found Date                    : 1/26/93
Severity                      : C
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : control/dtsscp.cdt
Sensitivity                   : public

[1/26/93 public]

Comments from the IBM bug report follow:

notes:
    <Note by rdl (Rick LeMon), 92/08/11 10:34:21, action: open>
dtscp change epo epo_num time new_time does not accept times in the ISO
format:
CCYY-MM-DDThh:mm:ss,fff[+|-]hh:mm+/-ss,fff
A syntax error is generated for the first comma occuring.

[07/06/93 public]
Allow a comma as well as a period as a decimal point in the grammer
(in dtsscp.cdt).

[07/16/93 public]
VErified and Closed.



CR Number                     : 7014
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : other
S/W Ref Platform              : aix
Component Name                : dts
Subcomponent Name             : 
Short Description             : utc_getusertime returns system TDF not process TDF
Reported Date                 : 1/26/93
Found in Baseline             : 1.0.1
Found Date                    : 1/26/93
Severity                      : B
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : utcapi.c
Sensitivity                   : public

[1/26/93 public]

Comments from the IBM bug report:

notes:
    <Note by rdl (Rick LeMon), 92/06/19 09:39:09, action: open>
utc_getusertime returns the system-specific TDF rather than the TDF represented
by the process-specific (user) TDF represented in the TZ environment variable.

    <Note by rdl (Rick LeMon), 92/09/24 15:01:37, action: note>
utc_getusertime works if the TZ is in the form of ABC#XYZ where ABC is the
name of the standard timezone and XYZ is the daylight name.  utc_getusertime
returns the system-specific time if it is run as root and the TZ is in the
form of ABC or ABC# (for example TZ=GMT or TZ=MST7).  One possible workaround
for the standard time only would be MST7MST7.

[07/06/93 public]
There was a bug in the logic of utc_getnextzone in utcapi.c which
wasn't using the environment variable info if the user didn't
specify the DST zone.  A simple fix, tough to find:

< old
> new
3049c3050
<     } else if (lclstate.timecnt == 1) {
---
>     } else {

[07/16/93 public]
Verified.  Note that a TZ of EST will still return GMT time because
there is no offset specified as required by POSIX.1.

Closed.



CR Number                     : 5146
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : pmax
S/W Ref Platform              : osf1
Component Name                : dts
Subcomponent Name             : dtsd
Short Description             : should conditionalize 'keymgtthread'
Reported Date                 : 8/20/92
Found in Baseline             : 1.0.1
Found Date                    : 8/20/92
Severity                      : D
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : time/service/transport_rpc.c
Sensitivity                   : public

[8/20/92 public]

The routine KeyMgmtThread in module transport_rpc.c should be conditionalized
by the DTS_ENTITY_PRINCIPAL macro. The routine is not called unless that
macro is true, eg we make the image a little smaller.

[07/16/93 public]
Put the code under the ifdef.
Closed.



CR Number                     : 5115
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : doc
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : all
S/W Ref Platform              : all
Component Name                : dts
Subcomponent Name             : app_ref
Short Description             : DTS intro: Suggestion
-Definition notes should come before routines in intro
Reported Date                 : 8/18/92
Found in Baseline             : 1.0
Found Date                    : 8/18/92
Severity                      : D
Priority                      : 3
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.0.3
Affected File(s)              : man3dts/time_intro.3dts
Sensitivity                   : public

[8/18/92 public]

        Suggestion - The notes section in the introduction to DTS might
        be more appropriate before the interface routines descriptions.

[07/06/93 public]
Reassigned this CR to myself.

[07/08/93 public]
Moved the information in the NOTES section 
(containing important definitions) before the alpha listing of 
DTS routines.  This information had been buried at the end of 
the ref page and could easily have been missed by a reader.

[08/19/93 public]
Closed bug.



CR Number                     : 4769
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : dts
Subcomponent Name             : dtscp
Short Description             : DTS...The behaviour of DTS trace is inconsistent
Reported Date                 : 7/17/92
Found in Baseline             : 1.0
Found Date                    : 7/17/92
Severity                      : C
Priority                      : 2
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1
Fixed In Baseline             : 1.0.3
Affected File(s)              : control/dtsscp.c
Sensitivity                   : public

[7/17/92 public]

     The behaviour of DTS traces (communications trace, service trace,
     arithmetic trace) is inconsistent, or inappropriate in the following
     cases:
     1. By issuing HELP SHOW, the user can gets a list of all the
        attributes and characteristics, including the traces.
        However HELP SET does not display the traces among the
        settable characteristics.  This is confusing, since in fact
        the traces are designed to be settable.

     2. The output of traces is sent to the wrong place.
        Currently, if a trace is set to TRUE, the output will appear on
        the same logical terminal from which DTSD was started.  If the
        operator who started DTS has logged off (i.e. the terminal has
        disconnected), the trace output is purged.  This seems
    inappropriate, since we cannot expect the DCE operator to stay
    logged on all the time.

[06/07/93 public]
I will probably fix 1, but these trace option work in conjunction with
the -d (debug) switch for dtsd.  This prevents dtsd from disconnecting
from the tty on startup.

[06/07/93 public]

I continue to believe that it's a crock that the OSF documents these commands
at all. Enabling them seriously degrades the time service's performance. They
should be used only by someone who can think about what effect this degradation
will have on what he's measuring (i.e. a developer or field support person).
My recommendation is to delete these commands from the man page.

[06/07/93 public]
Joe is correct, OSF shouldn't have these in the help messages.
I do not think they are in the man pages.
Also (I forgot) for 1.1 the debug messages will use the new
serviceability interfaces.

[07/16/93 public]
The trace commands have been removed from the show help.
The are controlled by the DEBUG macro.
Verified and closed.



CR Number                     : 4697
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : rs6000
S/W Ref Platform              : aix
Component Name                : dts
Subcomponent Name             : 
Short Description             : Immediate Synchronization with NULL Time Provider is imprecise
Reported Date                 : 7/10/92
Found in Baseline             : 1.0
Found Date                    : 7/10/92
Severity                      : C
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : service/dtss_service_state.c
Sensitivity                   : public

[7/10/92 public]

Full Description:

An edited version of the Null Time Provider was programmed to always
return a specified time. Executing the DTSCP command, "Synchronize Set
Clock True" should instantaneously set the clock to the new time.
For unknown reasons, the command must be invoked multiple times,
usually 3 or 4, before the clock synchronizes successfully.
On the prior invocations, the time is changed to a seemingly random
time between the current time and the target time.  Frequently,
on the first invocation, the clock jumps half way to the new time, and
then synchronizes successfully on the second invocation.

This shows that when synchronizing with the 'set clock true' option,
it may take more than one try before the clock actually synchronizes with
the time which the time provider is returning.

Initial time is Noon, on July 7, 1992.
First, I try to synchronize with a 'set clock true' option to
2:00pm, on the same day.  This is accomplished by using a time provider
which returns a time stamp specified by a datafile.
This works on the first try, as follows:

dtscp> sho cur tim
Current Time              = 1992-07-03-12:00:13.189-04:00I44572.151

dtscp> syn set clock tru

dtscp> sho cur tim
Current Time              = 1992-07-03-14:01:14.823-04:00I1.102


Note that on the above try, it was the first time a 'syn set clock tru'
was executed after entering DTSCP.  It seems that you get one successful
implementation, but all subsequent tries work as shown below.

Immediately after this, I reset the Time Provider to return a time of
6:00pm, on the same day.  I then began synchronizing with as above, with
the same options.  I issued the command as many times as needed until
synchronization occurred.  It took 2 tries, as follows:


dtscp> syn set clock tru

dtscp> sho cur tim
Current Time              = 1992-07-03-16:00:49.390-04:00I7157.816

dtscp> syn set clock tru

dtscp> sho cur tim
Current Time              = 1992-07-03-18:02:01.143-04:00I1.147


Note that the times shown are not on the hour exactly due to poor
response time from the system.  During the test, I monitored the
system clock, and found that the times were exactly on the hour
when the synchronizations were run.


Repeat By:


Proposed Solution:

[02/03/93 public]
I have noticed that dtsd will only wait a small amount of time before
timeing out a Time Provider.  It uses the Local Set Timeout value
which defaults to 5 seconds.  Since you commented on poor system
performance in your description, this may be the cause.

You can verify this by running your test this way:
Start dtsd with the -d switch.
Run /etc/rc.dts to initialize dtsd.
in dtscp, give the command 'set service trace true'
In the session with the dtsd running in it, you will start to see
various messages.
Do a sync.

Watch for these state messages (times will vary):
Next to state STstPrvdrSync, at 93-02-03-16:39:29.126 GMT
Wait to state STprvdrWTMO, at 93-02-03-16:39:29.180 GMT
Stimulus INrcvdTPresponse to state STprvdrWTMO, at 93-02-03-16:39:36.840 GMT

If a timer expires before you the the INrcvdTPresponse, you should see
a switch to state STnoPrvdr, which means that for that sync, the provider
was ingored.  Later on in the trace dtsd will get INrcvdTPresponse, but
it will do a STignore because its busy getting times from other servers.

Try increasing the value of Local State Timeout and see if this helps.

I realize this bug is pretty stale, so please let me know your status.
DCE 1.0.2 is *very* close to freezing, and I would like to determine
if this really is a bug.

[06/16/93 public]

Ok, ignore the timeout idea above.  That isn't the problem.
Here is what is happening (deep breath):

Say you are at 10:00 and the null Time Provider returns 11:00.

The problem is that when sync-ing with a TP, the 
hosts clock is factored in to the calculation.

When the end points get sorted, the times do not intersect:

	|--10:00--|	|-11:00-|
	  5 sec inacc     500 mili-secs inacc

So the computations take the lowest endpoint and the highest endpoint
to get an interval like:
	|---------10:30---------|
	   30 minute inacc

And set the clock to 10:30.

The next time you do the 'sync set clock true', the 'target' time (11:00) is
within the interval, so it will correctly set the clock:

|------------10:30--------------|
		            |-11:00-|


This works the *first* time, in your example, because you have a large
initial inaccuracy.  Preferably, it is infinite when you first fire
up DTS on a host, and do a sync set clock true.  Thus, the calcualtion
works because the new time (11:00) is in the range of *possible* values
that the current time (10:00) could be.

So, what did I do?

Now when you try this test, dtsd will report (via syslog in 1.0.x) that
the local clock is faulty (which it is, if you are believing the TP)
and it will try to make an adjustment exactly the same way (ie it will
hit on 10:30).  This may not make sense from a standpoint of 'believe
what I tell you', but DTS is *designed* not to believe what everyone tells
it.  It takes *both* the local clock and the TP in to account
in deciding who has the right time.  Bingo, right in the middle.

The important thing from a user standpoint is this, when the clock is
*way* wrong (with infinite inaccuracy) and you hook up a time provider
and say 'sync set clock true', the time will be set correctly.  Subsequent
syncs will happen normally because the time provider wont jump 3-4 
hours ahead as it does in our test scenario, ie dtsd wont have to
chase utc-time.

Bottom line:  
	The algorithm is working correctly.
	It was not correctly reporting a local clock fault.
	Dtsd now reports a fault.  (or will when I submit this to 1.0.3).

[07/16/93 public]
dtsd now reports a local clock fault if a TP provides a time not
in the local clocks inaccuracy interval.
Verified and Closed.



CR Number                     : 3231
Defect or Enhancement?        : enh
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 8353
Project Name                  : dce
H/W Ref Platform              : other
S/W Ref Platform              : other
Component Name                : dts
Subcomponent Name             : time/control/dtsscp.c
Short Description             : DTS dtscp handles local DTS
Entity only.
Reported Date                 : 5/4/92
Found in Baseline             : 1.0
Found Date                    : 5/4/92
Severity                      : C
Priority                      : 3
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.1beta
Fixed In Baseline             : 1.1
Affected File(s)              : see CR 8353
Sensitivity                   : public

[5/4/92 public]

Full Description:

        Although the communication protocol between the Control Program
        and the DTS Entity is built on RPC, the address

        "ncadg_ip_udp:127.0.0.1"

        is hardcoded in the the main Control Program source file:

        time/control/dtsscp.c

        which limits the access of RPC to remote machines and defeats the
        purpose of using RPC as a communication method between the two
        tasks.

        Others things still needs to be done to make the Control Program
        capable of handling remote machines Entities, e.g. a way to
        identify the remote machine with whom the Control Program would
        like to communicate.

[5/5/92 public]

	This is an enhancement. This enhancement has been discussed for
	DCE 1.1. This should have a priority of E5 and marked as enhancement.

[05/12/92 public]
    Changed to C3 enhancement.

[06/12/92 public]
Made Ko the "Resp. Eng.".

[06/07/93 public]
This looks to be one of the few enhancement which will be made to dtscp in 1.1.

[06/07/93 public]

Tom, just be forwared that the dtscp <--> dtsd protocol should be changed. As
it is currently defined, it will not interoperate between big-endian and
little endian machines... We knew about this, but decided not to fix it since
dtscp didn't support non-local operation.

[5/11/94 public]

This was fixed in bl-8 by Charlie Brooks. See Inter-dependent CR 8353
for more info/details.



CR Number                     : 2741
Defect or Enhancement?        : def
CR in Code, Doc, or Test?     : code
Inter-dependent CRs           : 
Project Name                  : dce
H/W Ref Platform              : pmax
S/W Ref Platform              : osf1
Component Name                : dts
Subcomponent Name             : 
Short Description             : failure in rantest_api
Reported Date                 : 4/14/92
Found in Baseline             : 1.0.1b10
Found Date                    : 4/14/92
Severity                      : B
Priority                      : 1
Status                        : closed
Duplicate Of                  : 
Fix By Baseline               : 1.0.3
Fixed In Baseline             : 1.0.3
Affected File(s)              : test/time/common/rantest_api.c
Sensitivity                   : public

[4/14/92 public]
Running rantest_api on a pmax with TZ set to EST5EDT4,M4.1.0,M10.5.0
resulted in:

ulcl = 2013/10/31 5:00:39 EST 303 4 0
utc_localtime differs from localtime
utc_mklocaltime returned error
time was not equal in utc_localtime, utc_mklocaltime compare
inaccuarcy was not equal in utc_localtime, utc_mklocaltime compare
count = 12
seed = 1383213639 = 52722a47
ulcl = 2013/10/31 6:00:39 EST 303 4 1
lcl  = 2013/10/31 6:00:39 EDT 303 4 1
ugmt = 2013/10/31 10:00:39 EST 303 4 0
gmt  = 2013/10/31 10:00:39 EST 303 4 0
uany = 2013/10/31 16:53:39 ??? 303 4 -1

This might be related to problems on the boundaries of timezone conversion.

[4/15/92 public]

This appears to be a problem in OSF/1's implementation of localtime,tzset etc.
I've sent a small program to Howard and Rich which exhibits the bug in OSF/1.
Basically, if the TZ variable is set to EST5EDT4,M4.1.0,M10.5.0 OSF/1 assumes
the fall timezone convertion occurs on the fifth Sunday of October, even if
there are only four Sundays (The `5' in M10.5.0 is a special case, it means
the `last Sunday in October' according to POSIX!).

I'm not sure what to do about this test if, indeed, OSF/1 is broken.

[5/9/92 public]

At SNI we encountered the same problem on the SVR4 platform. The test failed 
on a date in the last week of October. It turned out to be a bug in our 
"localtime" routine (as Joe has described above). The bug has been fixed on 
our platform and the test runs fine.
n

[06/12/92 public]
Made Joe Comuzzi "Resp Eng".

[6/19/92 public]

As this defect cannot be fixed until the defect in OSF/1 is fixed. (Unless the
OSF wants to remove this test.) I'm changing the responsible Eng. back to an
OSF individual.

[10/19/92 public]
Changed priority = 1 for all bugs > 6 months old.

[10/29/92 public]

Set to defer until bug in OSF/1 is fixed.  Then this bug can be cancelled.

[04/08/93 public]
The bug has been fixed in OSF/1 Release 1.2.
I am leaving this bug until we have upgraded to OSF/1 on the 486
which will be release 1.2.
I can then verify that this OS bug has been fixed.

[06/07/93 public]
OSF/1 R1.2 does not fix this problem.  Sigh
I am going to modify this test for OSF/1 so this date will pass.

[comuzzi 06/07/93 public}

How can this be? Doesn't 1.2 have the public domain timezone stuff? If it
doesn't, do you really think that special casing the test to say it's alright
that the OSF OSF/1 and the OSF DCE give different answer is the right thing
to do??? If 1.2 does have the public domain stuff and they're giving different
answers, someone's code is broken...

[06/29/93 public]
Fix:  I changed what was an #ifdef AIX to be the feature macro 'NOV72_BUG'.
This way, if other unix implimentations have this bug in their ctime routines,
they can define this macro and the test will pass.

In addition, I enchanced the test to take a number of iterations to run,
as opposed to letting it run forever.  If no number is specified, the test
will run forever, so this change is backwards compatible.

This fix will be submitted to 1.0.3 as soon as it is opened for bug fixes.

[08/02/93 public]
Added macro to rantest_api.c, turn it on for OSF/1 and AIX in
<target_os>/osdep.mk.

Closed.



